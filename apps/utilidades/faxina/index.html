<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Faxina Express | Plena Apps</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Fredoka', sans-serif;
            background-color: #e0f2fe;
        }

        [v-cloak] {
            display: none;
        }

        .progress-ring {
            transition: stroke-dashoffset 0.35s;
            transform: rotate(-90deg);
            transform-origin: 50% 50%;
        }
    </style>
    <script src="../../../assets/js/plena-lock.js"></script>
</head>

<body class="min-h-screen">

    <div id="app" v-cloak class="max-w-md mx-auto min-h-screen bg-white shadow-xl flex flex-col">

        <!-- HEADER -->
        <header class="bg-sky-500 text-white p-6 rounded-b-3xl shadow-lg z-10 text-center">
            <h1 class="text-3xl font-bold mb-1">Faxina Express</h1>
            <p class="text-sky-100 text-sm">Sua casa brilhando!</p>

            <div class="mt-6 bg-sky-600 rounded-xl p-4 flex items-center justify-between">
                <div class="text-left">
                    <div class="text-xs text-sky-200 uppercase tracking-widest">Progresso Total</div>
                    <div class="text-2xl font-bold">{{ overallProgress }}%</div>
                </div>
                <button @click="resetAll" class="text-xs bg-sky-700 hover:bg-sky-800 px-3 py-1 rounded-full"><i
                        class="fa-solid fa-rotate-right mr-1"></i> Reiniciar</button>
            </div>
        </header>

        <!-- ROOMS GRID -->
        <div class="flex-grow p-6 space-y-4">

            <div v-for="room in rooms" :key="room.name"
                class="bg-white border rounded-2xl p-4 shadow-sm hover:shadow-md transition cursor-pointer"
                :class="room.expanded ? 'border-sky-300 ring-2 ring-sky-100' : 'border-gray-200'">

                <!-- Room Head -->
                <div @click="toggleRoom(room)" class="flex items-center justify-between">
                    <div class="flex items-center gap-4">
                        <div class="w-12 h-12 rounded-full flex items-center justify-center text-xl"
                            :class="getRoomProgress(room) === 100 ? 'bg-green-100 text-green-600' : 'bg-sky-50 text-sky-500'">
                            <i :class="room.icon"></i>
                        </div>
                        <div>
                            <h3 class="font-bold text-gray-700">{{ room.name }}</h3>
                            <div class="h-1.5 w-24 bg-gray-100 rounded-full mt-1 overflow-hidden">
                                <div class="h-full bg-green-400" :style="{ width: getRoomProgress(room) + '%' }"></div>
                            </div>
                        </div>
                    </div>
                    <i class="fa-solid fa-chevron-down text-gray-300 transition"
                        :class="room.expanded ? 'rotate-180' : ''"></i>
                </div>

                <!-- Checklist -->
                <div v-if="room.expanded" class="mt-4 pt-4 border-t border-gray-100 space-y-2 animate-fade-in-down">
                    <label v-for="(task, idx) in room.tasks" :key="idx"
                        class="flex items-center gap-3 p-2 hover:bg-gray-50 rounded-lg cursor-pointer">
                        <input type="checkbox" v-model="task.done"
                            class="w-5 h-5 text-sky-500 rounded focus:ring-sky-500">
                        <span :class="task.done ? 'line-through text-gray-400' : 'text-gray-700'">{{ task.name }}</span>
                    </label>
                </div>
            </div>

        </div>

        <div class="text-center p-4 text-xs text-gray-400">
            Dica: Coloque uma m칰sica animada! 游꿧
        </div>

    </div>

    <script>
        const { createApp, ref, computed, onMounted, watch } = Vue;

        createApp({
            setup() {
                const roomsData = [
                    {
                        name: "Cozinha", icon: "fa-solid fa-utensils", tasks: [
                            { name: "Lavar Lou칞a", done: false },
                            { name: "Limpar Fog칚o", done: false },
                            { name: "Limpar Microondas", done: false },
                            { name: "Varre/Passar Pano", done: false },
                            { name: "Tirar o Lixo", done: false }
                        ]
                    },
                    {
                        name: "Banheiro", icon: "fa-solid fa-bath", tasks: [
                            { name: "Lavar Vaso Sanit치rio", done: false },
                            { name: "Limpar Pia e Espelho", done: false },
                            { name: "Lavar Box/Banhiera", done: false },
                            { name: "Trocar Toalhas", done: false },
                            { name: "Limpar Ch칚o", done: false }
                        ]
                    },
                    {
                        name: "Sala", icon: "fa-solid fa-couch", tasks: [
                            { name: "Tirar P칩 dos M칩veis", done: false },
                            { name: "Aspirar Sof치", done: false },
                            { name: "Limpar Vidros", done: false },
                            { name: "Varrer Ch칚o", done: false }
                        ]
                    },
                    {
                        name: "Quarto", icon: "fa-solid fa-bed", tasks: [
                            { name: "Trocar Roupa de Cama", done: false },
                            { name: "Organizar Guarda-Roupa", done: false },
                            { name: "Tirar P칩", done: false },
                            { name: "Limpar Ch칚o", done: false }
                        ]
                    }
                ];

                const rooms = ref(roomsData.map(r => ({ ...r, expanded: false })));

                const toggleRoom = (r) => r.expanded = !r.expanded;

                const getRoomProgress = (room) => {
                    const total = room.tasks.length;
                    const done = room.tasks.filter(t => t.done).length;
                    return total === 0 ? 0 : Math.round((done / total) * 100);
                };

                const overallProgress = computed(() => {
                    let totalTasks = 0;
                    let doneTasks = 0;
                    rooms.value.forEach(r => {
                        totalTasks += r.tasks.length;
                        doneTasks += r.tasks.filter(t => t.done).length;
                    });
                    return totalTasks === 0 ? 0 : Math.round((doneTasks / totalTasks) * 100);
                });

                const resetAll = () => {
                    if (confirm("Reiniciar toda a faxina?")) {
                        rooms.value.forEach(r => r.tasks.forEach(t => t.done = false));
                    }
                };

                // Persistence
                onMounted(() => {
                    const saved = localStorage.getItem('plena_faxina');
                    if (saved) {
                        try {
                            const parsed = JSON.parse(saved);
                            // Merge done states only, keep structure dynamic if code updates
                            rooms.value.forEach(r => {
                                const savedRoom = parsed.find(sr => sr.name === r.name);
                                if (savedRoom) {
                                    r.tasks.forEach(t => {
                                        const savedTask = savedRoom.tasks.find(st => st.name === t.name);
                                        if (savedTask) t.done = savedTask.done;
                                    });
                                }
                            });
                        } catch (e) { }
                    }
                });

                watch(rooms, () => {
                    // Save simplified structure
                    const toSave = rooms.value.map(r => ({
                        name: r.name,
                        tasks: r.tasks.map(t => ({ name: t.name, done: t.done }))
                    }));
                    localStorage.setItem('plena_faxina', JSON.stringify(toSave));
                }, { deep: true });

                return {
                    rooms, toggleRoom, getRoomProgress, overallProgress, resetAll
                };
            }
        }).mount('#app');
    </script>
</body>

</html>