<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fração Visual | Plena Apps</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600&display=swap" rel="stylesheet">
    <style>
        body {
            background-color: #e0f2fe;
            font-family: 'Fredoka', sans-serif;
        }

        [v-cloak] {
            display: none;
        }
    </style>
    <script src="../../../assets/js/plena-lock.js"></script>
</head>

<body class="pb-20">

    <div id="app" v-cloak class="max-w-xl mx-auto min-h-screen bg-white shadow-2xl flex flex-col">

        <header class="bg-sky-500 text-white p-6 shadow-md text-center rounded-b-[40px]">
            <h1 class="text-3xl font-bold mb-1">Fração Visual</h1>
            <p class="text-sky-100">Matemática Descomplicada</p>
        </header>

        <div class="flex-grow p-8 flex flex-col items-center">

            <!-- INPUTS -->
            <div class="flex flex-col items-center mb-10 w-full animate-fade-in">
                <div class="flex gap-4 items-center mb-2">
                    <button @click="numerator > 0 ? numerator-- : null"
                        class="w-8 h-8 rounded-full bg-gray-200 text-gray-600 font-bold">-</button>
                    <input v-model.number="numerator" type="number"
                        class="w-20 text-center text-4xl font-bold text-sky-600 border-2 border-sky-200 rounded-lg p-2 outline-none">
                    <button @click="numerator++"
                        class="w-8 h-8 rounded-full bg-gray-200 text-gray-600 font-bold">+</button>
                </div>
                <div class="w-32 h-1 bg-gray-300 rounded mb-2"></div>
                <div class="flex gap-4 items-center">
                    <button @click="denominator > 1 ? denominator-- : null"
                        class="w-8 h-8 rounded-full bg-gray-200 text-gray-600 font-bold">-</button>
                    <input v-model.number="denominator" type="number"
                        class="w-20 text-center text-4xl font-bold text-gray-600 border-2 border-gray-200 rounded-lg p-2 outline-none">
                    <button @click="denominator < 20 ? denominator++ : null"
                        class="w-8 h-8 rounded-full bg-gray-200 text-gray-600 font-bold">+</button>
                </div>
            </div>

            <!-- VISUALIZATION (PIE SVG) -->
            <div class="mb-10 relative w-64 h-64">
                <svg viewBox="0 0 100 100" class="w-full h-full transform -rotate-90">
                    <!-- Base Circle -->
                    <circle cx="50" cy="50" r="45" fill="#f0f9ff" stroke="#bae6fd" stroke-width="2" />

                    <!-- Slices -->
                    <path v-for="(slice, idx) in slices" :key="idx" :d="getSlicePath(idx)"
                        :fill="idx < numerator ? '#0ea5e9' : 'transparent'" stroke="#bae6fd" stroke-width="1"
                        class="transition-all duration-300 ease-in-out" />
                </svg>
                <!-- Percentage Center -->
                <div class="absolute inset-0 flex items-center justify-center pointer-events-none">
                    <span class="text-2xl font-bold text-sky-800 bg-white/80 px-2 rounded">{{ percentage }}%</span>
                </div>
            </div>

            <!-- BAR VISUALIZATION -->
            <div class="w-full h-12 bg-gray-100 rounded-full overflow-hidden border border-gray-200 flex mb-8">
                <div v-for="n in denominator" :key="n"
                    class="h-full border-r border-white/50 transition-all duration-300"
                    :class="n <= numerator ? 'bg-sky-500' : 'bg-transparent'"
                    :style="{ width: (100/denominator) + '%' }">
                </div>
            </div>

            <!-- TEXT EXPLANATION -->
            <div class="text-center bg-sky-50 p-6 rounded-2xl w-full">
                <p class="text-lg text-gray-600 italic">
                    "Você selecionou <strong class="text-sky-600">{{ numerator }}</strong> partes de um total de <strong
                        class="text-gray-700">{{ denominator }}</strong>."
                </p>
                <p class="text-sm text-gray-400 mt-2 font-mono">
                    {{ numerator }} ÷ {{ denominator }} = {{ (numerator/denominator).toFixed(2) }}
                </p>
            </div>

        </div>

    </div>

    <script>
        const { createApp, ref, computed } = Vue;

        createApp({
            setup() {
                const numerator = ref(1);
                const denominator = ref(4);

                const percentage = computed(() => {
                    if (denominator.value === 0) return 0;
                    return ((numerator.value / denominator.value) * 100).toFixed(0);
                });

                const slices = computed(() => {
                    if (denominator.value <= 0) return [];
                    return new Array(denominator.value).fill(0);
                });

                const getSlicePath = (idx) => {
                    const total = denominator.value;
                    const startAngle = (idx * 360) / total;
                    const endAngle = ((idx + 1) * 360) / total;

                    // Convert polar to cartesian
                    const start = polarToCartesian(50, 50, 45, endAngle);
                    const end = polarToCartesian(50, 50, 45, startAngle);

                    const largeArcFlag = endAngle - startAngle <= 180 ? "0" : "1";

                    return [
                        "M", 50, 50,
                        "L", start.x, start.y,
                        "A", 45, 45, 0, largeArcFlag, 0, end.x, end.y,
                        "L", 50, 50
                    ].join(" ");
                };

                const polarToCartesian = (centerX, centerY, radius, angleInDegrees) => {
                    const angleInRadians = (angleInDegrees - 90) * Math.PI / 180.0;
                    return {
                        x: centerX + (radius * Math.cos(angleInRadians)),
                        y: centerY + (radius * Math.sin(angleInRadians))
                    };
                };

                return {
                    numerator, denominator, percentage, slices, getSlicePath
                };
            }
        }).mount('#app');
    </script>
</body>

</html>