<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Redação Nota 1000 | Plena Apps</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            background-color: #f8fafc;
            font-family: 'Georgia', serif;
        }

        [v-cloak] {
            display: none;
        }

        .sans {
            font-family: 'Segoe UI', sans-serif;
        }
    </style>
    <script src="../../../assets/js/plena-lock.js"></script>
</head>

<body class="pb-20">

    <div id="app" v-cloak class="max-w-3xl mx-auto min-h-screen bg-white shadow-xl flex flex-col">

        <header class="bg-indigo-700 text-white p-6 shadow-md rounded-b-lg mb-8">
            <div class="flex justify-between items-center">
                <h1 class="text-2xl font-bold sans italic"><i class="fa-solid fa-pen-nib"></i> Redação Nota 1000</h1>
                <button @click="backupData" class="text-indigo-200 hover:text-white" title="Salvar Rascunho"><i
                        class="fa-solid fa-download"></i></button>
            </div>
            <p class="text-indigo-200 text-sm mt-1 sans">Guia estruturado para o ENEM</p>
        </header>

        <!-- WIZARD NAV -->
        <div class="flex justify-center mb-8 px-4 gap-2 sans">
            <button v-for="s in steps" :key="s.id" @click="step = s.id"
                class="px-4 py-2 rounded-full text-xs font-bold transition border"
                :class="step === s.id ? 'bg-indigo-600 text-white border-indigo-600' : 'bg-white text-gray-500 hover:bg-gray-100'">
                {{ s.label }}
            </button>
        </div>

        <!-- CONTENT -->
        <div class="px-8 flex-grow">

            <div class="mb-4">
                <h2 class="text-xl font-bold text-gray-800 mb-2">{{ getStepTitle }}</h2>
                <p class="text-gray-500 text-sm sans italic mb-4">{{ getStepTip }}</p>
            </div>

            <textarea v-model="text[step]"
                class="w-full h-64 p-4 border-2 border-indigo-100 rounded-xl outline-none focus:border-indigo-400 text-lg leading-relaxed resize-none shadow-inner"
                placeholder="Escreva aqui..."></textarea>

            <div class="text-right text-xs text-gray-400 mt-2 sans">
                {{ text[step].length }} caracteres | {{ text[step].split(/\s+/).filter(w => w.length > 0).length }}
                palavras
            </div>

            <!-- Pre-defined Connectives Helper -->
            <div class="mt-4 sans">
                <p class="text-xs font-bold text-gray-400 uppercase mb-2">Conectivos Sugeridos</p>
                <div class="flex flex-wrap gap-2">
                    <button v-for="c in getConnectives" :key="c" @click="insertConnective(c)"
                        class="bg-gray-100 hover:bg-indigo-100 hover:text-indigo-700 text-gray-600 px-3 py-1 rounded text-xs transition">
                        {{ c }}
                    </button>
                </div>
            </div>

        </div>

        <!-- NAVIGATION -->
        <div class="p-8 border-t bg-gray-50 flex justify-between sans">
            <button v-if="step > 1" @click="step--" class="text-gray-500 font-bold hover:text-gray-800">Voltar</button>
            <div v-else></div>

            <button v-if="step < 4" @click="step++"
                class="bg-indigo-600 hover:bg-indigo-700 text-white px-6 py-2 rounded-lg font-bold shadow">
                Próxima Etapa <i class="fa-solid fa-arrow-right ml-2"></i>
            </button>
            <button v-else @click="finish"
                class="bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded-lg font-bold shadow animate-bounce">
                Finalizar Redação <i class="fa-solid fa-check ml-2"></i>
            </button>
        </div>

        <!-- FINAL MODAL -->
        <div v-if="showFinal" class="fixed inset-0 bg-black/80 z-50 flex justify-end p-0 md:p-10">
            <div class="bg-white w-full md:max-w-2xl h-full rounded-xl shadow-2xl flex flex-col p-8 animate-slide-up">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold sans">Sua Redação</h2>
                    <button @click="showFinal = false" class="text-gray-400 hover:text-red-500"><i
                            class="fa-solid fa-xmark text-2xl"></i></button>
                </div>

                <div
                    class="flex-grow overflow-y-auto bg-gray-50 p-6 rounded-lg border leading-loose text-justify whitespace-pre-wrap font-serif text-gray-800">
                    &emsp;&emsp;{{ text[1].trim() }}
                    &emsp;&emsp;{{ text[2].trim() }}
                    &emsp;&emsp;{{ text[3].trim() }}
                    &emsp;&emsp;{{ text[4].trim() }}
                </div>

                <div class="mt-6 flex gap-3 sans">
                    <button @click="copyText"
                        class="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-800 py-3 rounded font-bold">Copiar
                        Texto</button>
                    <button @click="shareWhatsapp"
                        class="flex-1 bg-green-500 hover:bg-green-600 text-white py-3 rounded font-bold"><i
                            class="fa-brands fa-whatsapp"></i> Enviar</button>
                </div>
            </div>
        </div>

    </div>

    <script>
        const { createApp, ref, computed, onMounted, watch } = Vue;

        createApp({
            setup() {
                const step = ref(1);
                const showFinal = ref(false);
                const text = ref({ 1: '', 2: '', 3: '', 4: '' });

                const steps = [
                    { id: 1, label: 'Introdução', tip: 'Apresente o tema, a tese e o contexto histórico ou cultural.' },
                    { id: 2, label: 'Desenv. 1', tip: 'Primeiro argumento. Use dados, fatos e aprofunde a causa do problema.' },
                    { id: 3, label: 'Desenv. 2', tip: 'Segundo argumento. Explore consequências ou outro ponto de vista.' },
                    { id: 4, label: 'Conclusão', tip: 'Proposta de intervenção: Quem? O que? Como? Para que?' }
                ];

                const connectives = {
                    1: ['Atualmente', 'No contexto', 'Ao analisar', 'É consenso que'],
                    2: ['Em primeiro lugar', 'Sob esse viés', 'Ademais', 'Vale ressaltar que'],
                    3: ['Além disso', 'Outro fator relevante', 'Em consequência', 'Por outro lado'],
                    4: ['Portanto', 'Dessa forma', 'Logo', 'É mister que']
                };

                const getStepTitle = computed(() => steps.find(s => s.id === step.value).label);
                const getStepTip = computed(() => steps.find(s => s.id === step.value).tip);
                const getConnectives = computed(() => connectives[step.value]);

                const insertConnective = (c) => {
                    text.value[step.value] += (text.value[step.value].length > 0 ? ' ' : '') + c + ' ';
                };

                const finish = () => showFinal.value = true;

                const getFullText = () => `${text.value[1]}\n\n${text.value[2]}\n\n${text.value[3]}\n\n${text.value[4]}`;

                const copyText = () => {
                    navigator.clipboard.writeText(getFullText());
                    alert('Copiado!');
                };

                const shareWhatsapp = () => {
                    window.open(`https://wa.me/?text=${encodeURIComponent("*Minha Redação:*\n\n" + getFullText())}`, '_blank');
                };

                const backupData = () => {
                    const blob = new Blob([JSON.stringify(text.value)], { type: "application/json" });
                    const a = document.createElement('a');
                    a.href = URL.createObjectURL(blob);
                    a.download = `redacao_${Date.now()}.json`;
                    a.click();
                };

                onMounted(() => {
                    const d = localStorage.getItem('plena_redacao');
                    if (d) text.value = JSON.parse(d);
                });
                watch(text, () => localStorage.setItem('plena_redacao', JSON.stringify(text.value)), { deep: true });

                return {
                    step, steps, text, showFinal,
                    getStepTitle, getStepTip, getConnectives,
                    insertConnective, finish, copyText, shareWhatsapp, backupData
                };
            }
        }).mount('#app');
    </script>
</body>

</html>