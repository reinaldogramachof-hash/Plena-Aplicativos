<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Driver Pro | Plena Transportes</title>
    <!-- LIBS -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Exo+2:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Exo 2', sans-serif;
        }

        [v-cloak] {
            display: none;
        }

        .dark-card {
            background: linear-gradient(145deg, #1e293b, #0f172a);
        }

        .glass {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
    </style>
</head>

<body class="bg-gray-900 text-gray-100">

    <div id="app" v-cloak class="max-w-md mx-auto min-h-screen bg-black shadow-2xl flex flex-col relative">

        <!-- HEADER -->
        <header class="p-6 pb-2 sticky top-0 z-50 bg-black/80 backdrop-blur-md">
            <div class="flex justify-between items-center mb-4">
                <h1 class="text-2xl font-bold flex items-center gap-2 text-cyan-400">
                    <i class="fa-solid fa-car-side"></i> DRIVER PRO
                </h1>
                <div class="flex items-center gap-3">
                    <button @click="resetDay"
                        class="text-xs text-red-400 font-bold border border-red-900 rounded px-2 py-1">Zerar
                        Dia</button>
                    <button @click="showSettings = true" class="text-gray-400 hover:text-white">
                        <i class="fa-solid fa-gear text-xl"></i>
                    </button>
                </div>
            </div>

            <!-- DASHBOARD -->
            <div class="grid grid-cols-2 gap-3 mb-2">
                <div class="dark-card p-4 rounded-2xl border border-gray-800 relative overflow-hidden">
                    <div class="text-xs text-gray-500 font-bold uppercase">Meta: R$ {{ dailyGoal }}</div>
                    <div class="text-3xl font-bold text-white mt-1">R$ {{ totalEarnings.toFixed(2) }}</div>
                    <div class="h-1 bg-gray-800 mt-2 rounded-full overflow-hidden">
                        <div :style="{ width: progressPercentage + '%' }"
                            class="h-full bg-cyan-500 shadow-[0_0_10px_rgba(6,182,212,0.5)]"></div>
                    </div>
                </div>
                <div class="dark-card p-4 rounded-2xl border border-gray-800">
                    <div class="text-xs text-gray-500 font-bold uppercase">Lucro Líquido</div>
                    <div :class="netProfit >= 0 ? 'text-green-400' : 'text-red-400'" class="text-3xl font-bold mt-1">
                        R$ {{ netProfit.toFixed(2) }}
                    </div>
                </div>
            </div>
        </header>

        <!-- MAIN CONTENT -->
        <main class="flex-grow p-4 overflow-y-auto pb-24">

            <!-- CONTROLS -->
            <div class="grid grid-cols-3 gap-3 mb-6">
                <button @click="openModal('ride')"
                    class="glass p-4 rounded-xl flex flex-col items-center gap-2 hover:bg-cyan-900/30 transition border-b-2 border-cyan-500">
                    <i class="fa-brands fa-uber text-2xl text-cyan-400"></i>
                    <span class="text-xs font-bold">Corrida</span>
                </button>
                <button @click="openModal('fuel')"
                    class="glass p-4 rounded-xl flex flex-col items-center gap-2 hover:bg-yellow-900/30 transition border-b-2 border-yellow-500">
                    <i class="fa-solid fa-gas-pump text-2xl text-yellow-400"></i>
                    <span class="text-xs font-bold">Abastecer</span>
                </button>
                <button @click="openModal('maint')"
                    class="glass p-4 rounded-xl flex flex-col items-center gap-2 hover:bg-red-900/30 transition border-b-2 border-red-500">
                    <i class="fa-solid fa-wrench text-2xl text-red-400"></i>
                    <span class="text-xs font-bold">Manut.</span>
                </button>
            </div>

            <!-- FEED -->
            <h2 class="font-bold text-gray-500 text-xs uppercase mb-3 flex justify-between items-center">
                <span>Atividade Recente</span>
                <span>{{ history.length }} registros</span>
            </h2>

            <div v-if="history.length === 0" class="text-center py-10 opacity-30">
                <i class="fa-solid fa-road text-5xl mb-3"></i>
                <p>Pronto para rodar.</p>
            </div>

            <div class="space-y-3">
                <div v-for="item in sortedHistory" :key="item.id"
                    class="bg-gray-900 border border-gray-800 p-4 rounded-xl flex justify-between items-center">

                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 rounded-full flex items-center justify-center bg-gray-800">
                            <i :class="getIcon(item)" :style="{ color: getColor(item) }"></i>
                        </div>
                        <div>
                            <div class="font-bold text-sm text-gray-200">{{ item.description || getLabel(item) }}</div>
                            <div class="text-xs text-gray-500">{{ formatTime(item.timestamp) }} <span v-if="item.km">•
                                    {{ item.km }}km</span></div>
                        </div>
                    </div>

                    <div class="text-right">
                        <div :class="item.type === 'ride' ? 'text-green-400' : 'text-red-400'" class="font-bold">
                            {{ item.type === 'ride' ? '+' : '-' }} R$ {{ Number(item.amount).toFixed(2) }}
                        </div>
                        <button @click="deleteItem(item.id)" class="text-xs text-gray-600 hover:text-red-500 mt-1">
                            <i class="fa-solid fa-trash"></i>
                        </button>
                    </div>

                </div>
            </div>

        </main>

        <!-- MODAL -->
        <div v-if="showModal" class="fixed inset-0 z-[60] flex items-end sm:items-center justify-center sm:p-4">
            <div class="absolute inset-0 bg-black/90 backdrop-blur-sm transition-opacity" @click="closeModal"></div>
            <div
                class="bg-gray-900 w-full max-w-md rounded-t-2xl sm:rounded-2xl p-6 relative z-10 border border-gray-700 animate-slide-up">

                <h3 class="text-xl font-bold mb-6 text-white flex items-center gap-2">
                    <i :class="getModalIcon()" :style="{ color: getModalColor() }" class="fa-solid"></i>
                    {{ getModalTitle() }}
                </h3>

                <div class="space-y-4">
                    <!-- Value Input -->
                    <div>
                        <label class="block text-xs font-bold text-gray-500 mb-1 uppercase">Valor Total (R$)</label>
                        <input v-model="form.amount" type="number"
                            class="w-full bg-black border border-gray-700 rounded-xl p-4 text-3xl font-bold text-white focus:border-cyan-500 outline-none"
                            placeholder="0.00" autoFocus>
                    </div>

                    <!-- Ride Specifics -->
                    <div v-if="modalType === 'ride'" class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-xs font-bold text-gray-500 mb-1 uppercase">KM Rodado</label>
                            <input v-model="form.km" type="number"
                                class="w-full bg-black border border-gray-700 rounded-xl p-3 text-white"
                                placeholder="0">
                        </div>
                        <div>
                            <label class="block text-xs font-bold text-gray-500 mb-1 uppercase">App</label>
                            <select v-model="form.description"
                                class="w-full bg-black border border-gray-700 rounded-xl p-3 text-white">
                                <option value="Uber">Uber</option>
                                <option value="99">99</option>
                                <option value="Indrive">Indrive</option>
                                <option value="Particular">Particular</option>
                            </select>
                        </div>
                    </div>

                    <!-- Fuel Specifics -->
                    <div v-if="modalType === 'fuel'">
                        <label class="block text-xs font-bold text-gray-500 mb-1 uppercase">Combustível</label>
                        <div class="grid grid-cols-3 gap-2">
                            <button @click="form.description = 'GNV'"
                                :class="form.description === 'GNV' ? 'bg-yellow-600 text-white' : 'bg-gray-800 text-gray-400'"
                                class="p-3 rounded-lg font-bold text-sm">GNV</button>
                            <button @click="form.description = 'Gasolina'"
                                :class="form.description === 'Gasolina' ? 'bg-yellow-600 text-white' : 'bg-gray-800 text-gray-400'"
                                class="p-3 rounded-lg font-bold text-sm">Gas</button>
                            <button @click="form.description = 'Etanol'"
                                :class="form.description === 'Etanol' ? 'bg-yellow-600 text-white' : 'bg-gray-800 text-gray-400'"
                                class="p-3 rounded-lg font-bold text-sm">Alc</button>
                        </div>
                    </div>

                    <!-- Maintenance Specifics -->
                    <div v-if="modalType === 'maint'">
                        <label class="block text-xs font-bold text-gray-500 mb-1 uppercase">Serviço</label>
                        <input v-model="form.description" type="text"
                            class="w-full bg-black border border-gray-700 rounded-xl p-3 text-white"
                            placeholder="Ex: Troca de Óleo, Pneu...">
                    </div>
                </div>

                <div class="mt-8 flex gap-3">
                    <button @click="closeModal"
                        class="flex-1 bg-gray-800 text-gray-400 font-bold py-3 rounded-xl">Cancelar</button>
                    <button @click="saveEntry"
                        class="flex-[2] bg-cyan-600 text-white font-bold py-3 rounded-xl shadow-lg shadow-cyan-900/20">SALVAR</button>
                </div>

            </div>
        </div>

        <!-- SETTINGS MODAL -->
        <div v-if="showSettings" class="fixed inset-0 z-[70] flex items-center justify-center p-4">
            <div class="absolute inset-0 bg-black/90 backdrop-blur-sm" @click="showSettings = false"></div>
            <div class="bg-gray-900 w-full max-w-sm rounded-2xl p-6 relative z-10 border border-gray-700">
                <h3 class="text-xl font-bold mb-4 text-white">Configurações</h3>
                <div class="mb-4">
                    <label class="block text-xs font-bold text-gray-500 mb-1 uppercase">Meta Diária (R$)</label>
                    <input v-model="dailyGoal" @change="saveData" type="number"
                        class="w-full bg-black border border-gray-700 rounded-lg p-3 text-white">
                </div>
                <button @click="showSettings = false"
                    class="w-full bg-gray-800 text-white font-bold py-3 rounded-xl">Fechar</button>
            </div>
        </div>

    </div>

    <script>
        const { createApp, ref, computed, onMounted, watch } = Vue;

        createApp({
            setup() {
                const showModal = ref(false);
                const showSettings = ref(false);
                const modalType = ref('ride'); // ride | fuel | maint
                const dailyGoal = ref(300);
                const history = ref([]);

                const form = ref({ amount: '', km: '', description: 'Uber' });

                // --- PERSISTENCE ---
                const saveData = () => {
                    localStorage.setItem('driver_pro_data', JSON.stringify({
                        history: history.value,
                        goal: dailyGoal.value
                    }));
                };

                const loadData = () => {
                    const saved = localStorage.getItem('driver_pro_data');
                    if (saved) {
                        const data = JSON.parse(saved);
                        history.value = data.history || [];
                        dailyGoal.value = data.goal || 300;
                    }
                };

                onMounted(() => loadData());
                watch([history, dailyGoal], saveData, { deep: true });

                // --- COMPUTED ---
                const sortedHistory = computed(() => {
                    return [...history.value].sort((a, b) => b.timestamp - a.timestamp);
                });

                const totalEarnings = computed(() => {
                    return history.value.filter(i => i.type === 'ride').reduce((sum, i) => sum + Number(i.amount), 0);
                });

                const totalExpenses = computed(() => {
                    return history.value.filter(i => i.type !== 'ride').reduce((sum, i) => sum + Number(i.amount), 0);
                });

                const netProfit = computed(() => totalEarnings.value - totalExpenses.value);

                const progressPercentage = computed(() => {
                    if (dailyGoal.value <= 0) return 0;
                    return Math.min(100, Math.floor((totalEarnings.value / dailyGoal.value) * 100)); // Progress based on Revenue, not Profit, usually motivates driver more to hit "Gross Goal", but arguably Profit is better. Let's stick to Revenue for Goal as Uber drivers usually think "Need to make 300 on the app".
                });

                // --- ACTIONS ---
                const openModal = (type) => {
                    modalType.value = type;
                    const defaultDesc = type === 'ride' ? 'Uber' : (type === 'fuel' ? 'GNV' : '');
                    form.value = { amount: '', km: '', description: defaultDesc };
                    showModal.value = true;
                };

                const closeModal = () => showModal.value = false;

                const saveEntry = () => {
                    if (!form.value.amount) return alert('Digite o valor!');

                    history.value.push({
                        id: Date.now(),
                        type: modalType.value,
                        amount: Number(form.value.amount).toFixed(2),
                        km: form.value.km,
                        description: form.value.description,
                        timestamp: Date.now()
                    });
                    closeModal();
                };

                const deleteItem = (id) => {
                    if (confirm('Apagar registro?')) {
                        history.value = history.value.filter(i => i.id !== id);
                    }
                };

                const resetDay = () => {
                    if (confirm("Vai zerar todo o histórico de HOJE. Certeza?")) {
                        history.value = [];
                    }
                };

                // --- UTILS ---
                const getIcon = (item) => {
                    if (item.type === 'ride') return 'fa-car';
                    if (item.type === 'fuel') return 'fa-gas-pump';
                    return 'fa-wrench';
                };

                const getColor = (item) => {
                    if (item.type === 'ride') return '#22d3ee'; // cyan
                    if (item.type === 'fuel') return '#fbbf24'; // yellow
                    return '#f87171'; // red
                };
                const getLabel = (item) => {
                    if (item.type === 'ride') return 'Corrida';
                    if (item.type === 'fuel') return 'Abastecimento';
                    return 'Manutenção';
                };

                const getModalTitle = () => {
                    if (modalType.value === 'ride') return 'Nova Corrida';
                    if (modalType.value === 'fuel') return 'Abastecer';
                    return 'Manutenção';
                };

                const getModalIcon = () => {
                    if (modalType.value === 'ride') return 'fa-car';
                    if (modalType.value === 'fuel') return 'fa-gas-pump';
                    return 'fa-wrench';
                }
                const getModalColor = () => {
                    if (modalType.value === 'ride') return '#22d3ee';
                    if (modalType.value === 'fuel') return '#fbbf24';
                    return '#f87171';
                }

                const formatTime = (ts) => {
                    return new Date(ts).toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });
                };

                return {
                    showModal, showSettings, modalType, dailyGoal, form, history,
                    sortedHistory, totalEarnings, netProfit, progressPercentage,
                    openModal, closeModal, saveEntry, deleteItem, resetDay,
                    getIcon, getColor, getLabel, getModalTitle, getModalIcon, getModalColor, formatTime, saveData
                };
            }
        }).mount('#app');
    </script>
</body>

</html>