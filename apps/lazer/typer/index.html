<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste de Digitação | Plena Apps</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            background-color: #22c55e;
            font-family: 'Roboto Mono', monospace;
        }

        [v-cloak] {
            display: none;
        }

        .word-active {
            background-color: #d1fae5;
            color: #166534;
            border-radius: 4px;
        }

        .word-error {
            text-decoration: underline;
            text-decoration-color: red;
        }
    </style>
</head>

<body class="pb-20">

    <div id="app" v-cloak class="max-w-md mx-auto min-h-screen bg-white shadow-2xl flex flex-col p-6">

        <header class="flex justify-between items-end mb-8 border-b-2 border-gray-100 pb-4">
            <div>
                <h1 class="text-3xl font-bold text-gray-800">Typer<span class="text-green-500">Pro</span></h1>
                <div class="text-xs text-gray-400">Teste sua velocidade</div>
            </div>
            <div class="text-right">
                <div class="text-xs text-gray-400 uppercase">Recorde</div>
                <div class="text-xl font-bold text-green-600">{{ bestWpm }} WPM</div>
            </div>
        </header>

        <!-- GAME -->
        <div v-if="gameState === 'playing' || gameState === 'ready'" class="flex-grow flex flex-col">

            <div class="flex justify-between items-center mb-4 text-gray-500 font-bold">
                <div class="text-3xl">{{ timeLeft }}s</div>
                <div class="text-sm bg-gray-100 px-3 py-1 rounded-full cursor-help" title="Palavras por Minuto">WPM: {{
                    currentWpm }}</div>
            </div>

            <!-- WORD DISPLAY -->
            <div class="bg-gray-50 p-6 rounded-xl border-2 border-gray-100 mb-6 text-lg leading-relaxed h-48 overflow-hidden relative"
                @click="$refs.input.focus()">
                <div class="flex flex-wrap gap-2 transition-all duration-300"
                    :style="{ transform: `translateY(-${lineOffset}px)` }">
                    <span v-for="(word, idx) in words" :key="idx" :class="{
                              'word-active': idx === currentWordIdx,
                              'text-green-500': idx < currentWordIdx && wordResults[idx] === true,
                              'text-red-500 line-through': idx < currentWordIdx && wordResults[idx] === false,
                              'text-gray-300': idx > currentWordIdx
                          }" class="px-1 transition-colors">
                        {{ word }}
                    </span>
                </div>
                <!-- Fader for bottom of box -->
                <div class="absolute bottom-0 left-0 w-full h-12 bg-gradient-to-t from-gray-50 to-transparent"></div>
            </div>

            <input ref="input" v-model="userInput" @input="checkInput" @keyup.space="finishWord"
                :disabled="gameState==='finished'"
                class="w-full border-b-4 border-green-500 bg-transparent text-2xl outline-none py-2 text-center font-bold text-gray-700 placeholder-gray-200"
                placeholder="Digite aqui..." autofocus>
            <p class="text-center text-xs text-gray-400 mt-2">Pressione ESPAÇO para avançar</p>

            <button v-if="gameState === 'ready'" @click="startGame"
                class="mt-8 w-full bg-green-500 hover:bg-green-600 text-white font-bold py-4 rounded-xl shadow-lg border-b-4 border-green-700 active:border-0 active:mt-9">
                COMEÇAR
            </button>

        </div>

        <!-- RESULTS -->
        <div v-if="gameState === 'finished'" class="flex-grow flex flex-col justify-center text-center animate-fade-in">
            <div class="text-6xl font-bold text-gray-800 mb-2">{{ finalWpm }}</div>
            <div class="text-green-500 font-bold uppercase tracking-widest mb-8">WPM</div>

            <div class="grid grid-cols-2 gap-4 mb-8">
                <div class="bg-gray-50 p-4 rounded-xl">
                    <div class="text-2xl font-bold text-gray-700">{{ accuracy }}%</div>
                    <div class="text-xs text-gray-400">Precisão</div>
                </div>
                <div class="bg-gray-50 p-4 rounded-xl">
                    <div class="text-2xl font-bold text-green-600">{{ correctWords }}</div>
                    <div class="text-xs text-gray-400">Acertos</div>
                </div>
            </div>

            <button @click="resetGame"
                class="w-full bg-gray-800 hover:bg-gray-700 text-white font-bold py-4 rounded-xl shadow-lg mb-3">
                <i class="fa-solid fa-rotate-right"></i> Tentar Novamente
            </button>
            <button @click="share"
                class="w-full bg-green-500 hover:bg-green-600 text-white font-bold py-4 rounded-xl shadow-lg">
                <i class="fa-brands fa-whatsapp"></i> Desafiar Amigos
            </button>
        </div>

    </div>

    <script>
        const { createApp, ref, computed, onMounted, nextTick } = Vue;

        createApp({
            setup() {
                const wordList = ["gato", "casa", "vida", "amor", "tempo", "jogo", "mesa", "livro", "carro", "fogo", "agua", "terra", "ar", "luz", "som", "cor", "flor", "sol", "lua", "mar", "rio", "voce", "mim", "ele", "ela", "nos", "bom", "mau", "sim", "nao", "hoje", "agora", "sempre", "nunca", "talvez", "quem", "que", "onde", "como", "quando", "fazer", "dizer", "ver", "ir", "vir", "ter", "ser", "estar", "poder", "querer", "saber", "dar", "ler", "rir", "paz", "fe", "dor", "fim", "ola", "rei", "pai", "mae", "tio", "avo", "filho", "irmao", "amigo", "feliz", "triste", "alto", "baixo", "grande", "pequeno", "novo", "velho", "belo", "feio", "plena", "apps", "web", "site", "net", "app", "code", "java", "html", "css", "vue"];

                const words = ref([]);
                const currentWordIdx = ref(0);
                const userInput = ref('');
                const wordResults = ref([]); // true/false
                const gameState = ref('ready'); // ready, playing, finished
                const timeLeft = ref(60);
                const timer = ref(null);
                const bestWpm = ref(0);

                const lineOffset = computed(() => {
                    // Simple logic to scroll lines: every 5 words roughly equals a line break visually? 
                    // Better: actually calculating line height. For now, approximate:
                    return Math.floor(currentWordIdx.value / 6) * 40;
                });

                const shuffle = () => {
                    words.value = [];
                    for (let i = 0; i < 100; i++) words.value.push(wordList[Math.floor(Math.random() * wordList.length)]);
                };

                const startGame = () => {
                    shuffle();
                    currentWordIdx.value = 0;
                    userInput.value = '';
                    wordResults.value = [];
                    timeLeft.value = 60;
                    gameState.value = 'playing';
                    nextTick(() => document.querySelector('input').focus());

                    timer.value = setInterval(() => {
                        timeLeft.value--;
                        if (timeLeft.value <= 0) finishGame();
                    }, 1000);
                };

                const finishWord = () => {
                    const target = words.value[currentWordIdx.value];
                    const typed = userInput.value.trim();

                    if (!typed) return; // Ignore empty spaces

                    wordResults.value.push(typed === target);
                    currentWordIdx.value++;
                    userInput.value = '';
                };

                // Real-time check for typo styling? Not needed for simple version, finishWord handles validation.
                // Could add class active error if typed doesnt startWith target.

                const finishGame = () => {
                    clearInterval(timer.value);
                    gameState.value = 'finished';
                    if (finalWpm.value > bestWpm.value) {
                        bestWpm.value = finalWpm.value;
                        localStorage.setItem('plena_typer_score', bestWpm.value);
                    }
                };

                const resetGame = () => {
                    gameState.value = 'ready';
                    timeLeft.value = 60;
                };

                const correctWords = computed(() => wordResults.value.filter(r => r).length);

                const currentWpm = computed(() => {
                    const elapsed = 60 - timeLeft.value;
                    if (elapsed === 0) return 0;
                    return Math.round((correctWords.value / elapsed) * 60);
                });

                const finalWpm = computed(() => correctWords.value); // Since it is always 60s game, WPM = Correct Count

                const accuracy = computed(() => {
                    if (wordResults.value.length === 0) return 0;
                    return Math.round((correctWords.value / wordResults.value.length) * 100);
                });

                const share = () => {
                    const msg = `⌨️ *Desafio TyperPro*\n\nMinha velocidade: *${finalWpm.value} WPM*!\nPrecisão: ${accuracy.value}%\n\nVocê consegue me vencer? Tente em Plena Apps.`;
                    window.open(`https://wa.me/?text=${encodeURIComponent(msg)}`, '_blank');
                };

                onMounted(() => {
                    shuffle();
                    const s = localStorage.getItem('plena_typer_score');
                    if (s) bestWpm.value = parseInt(s);
                });

                return { words, currentWordIdx, userInput, gameState, timeLeft, startGame, finishWord, finishGame, resetGame, correctWords, currentWpm, finalWpm, accuracy, share, bestWpm, lineOffset, wordResults };
            }
        }).mount('#app');
    </script>
</body>

</html>