<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meu Mapa Astral | Plena Apps</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            background-color: #0f172a;
            color: white;
            background-image: radial-gradient(circle at center, #1e293b 0%, #0f172a 100%);
            font-family: 'Segoe UI', sans-serif;
        }

        [v-cloak] {
            display: none;
        }

        input {
            color-scheme: dark;
        }
    </style>
    <script src="../../../assets/js/plena-lock.js"></script>
</head>

<body class="pb-20">

    <div id="app" v-cloak class="max-w-md mx-auto min-h-screen p-6 flex flex-col">

        <header class="text-center mb-10 mt-4">
            <i class="fa-solid fa-star-of-david text-4xl text-purple-400 mb-2 animate-pulse"></i>
            <h1 class="text-2xl font-bold tracking-widest uppercase">Mapa Astral</h1>
            <p class="text-xs text-gray-500">Descubra sua ess√™ncia c√≥smica</p>
        </header>

        <!-- FORM -->
        <div v-if="!result"
            class="bg-gray-800/50 p-6 rounded-2xl border border-gray-700 shadow-xl backdrop-blur animate-fade-in">
            <div class="space-y-4">
                <div>
                    <label class="block text-xs uppercase text-gray-400 mb-1">Nome</label>
                    <input v-model="name"
                        class="w-full bg-gray-900 border border-gray-600 rounded p-3 focus:border-purple-500 outline-none"
                        placeholder="Seu Nome">
                </div>
                <div>
                    <label class="block text-xs uppercase text-gray-400 mb-1">Data de Nascimento</label>
                    <input type="date" v-model="birthDate"
                        class="w-full bg-gray-900 border border-gray-600 rounded p-3 focus:border-purple-500 outline-none">
                </div>
                <div>
                    <label class="block text-xs uppercase text-gray-400 mb-1">Hora (Opcional p/ Asc)</label>
                    <input type="time" v-model="birthTime"
                        class="w-full bg-gray-900 border border-gray-600 rounded p-3 focus:border-purple-500 outline-none">
                </div>
                <button @click="calculate"
                    class="w-full bg-purple-600 hover:bg-purple-500 text-white font-bold py-4 rounded-xl mt-4 shadow-lg shadow-purple-900/50">
                    REVELAR MAPA
                </button>
            </div>
        </div>

        <!-- RESULT -->
        <div v-else class="flex-grow flex flex-col animate-slide-up">

            <div
                class="bg-gradient-to-b from-indigo-900 to-purple-900 rounded-3xl p-8 text-center shadow-2xl border border-indigo-500/30 relative overflow-hidden mb-6">
                <!-- Stars BG -->
                <div class="absolute inset-0 opacity-20"
                    style="background-image: url('https://www.transparenttextures.com/patterns/stardust.png');"></div>

                <h2 class="text-xl font-bold mb-6 relative z-10">{{ name }}</h2>

                <div class="grid grid-cols-2 gap-8 relative z-10">
                    <div>
                        <div class="text-xs text-indigo-300 uppercase mb-1">Signo Solar</div>
                        <i :class="getIcon(solar.sign)" class="text-4xl text-yellow-400 mb-2 block"></i>
                        <div class="text-2xl font-bold">{{ solar.sign }}</div>
                        <div class="text-[10px] text-gray-300">{{ solar.element }}</div>
                    </div>
                    <div>
                        <div class="text-xs text-indigo-300 uppercase mb-1">Ascendente</div>
                        <i v-if="ascendant" :class="getIcon(ascendant)" class="text-4xl text-purple-300 mb-2 block"></i>
                        <span v-else class="text-2xl block mb-2">?</span>
                        <div class="text-2xl font-bold">{{ ascendant || '--' }}</div>
                        <div v-if="!ascendant" class="text-[10px] text-gray-400">Hora necess√°ria</div>
                    </div>
                </div>

                <div class="mt-8 text-left bg-black/20 p-4 rounded-xl backdrop-blur relative z-10">
                    <p class="text-sm italic text-gray-200">"{{ solar.desc }}"</p>
                </div>
            </div>

            <div class="space-y-3">
                <button @click="share"
                    class="w-full bg-green-600 hover:bg-green-500 text-white font-bold py-3 rounded-xl shadow flex items-center justify-center gap-2">
                    <i class="fa-brands fa-whatsapp"></i> Compartilhar
                </button>
                <button @click="result = null"
                    class="w-full bg-gray-800 hover:bg-gray-700 text-gray-400 font-bold py-3 rounded-xl">
                    Novo Mapa
                </button>
            </div>

        </div>

    </div>

    <script>
        const { createApp, ref, computed } = Vue;

        createApp({
            setup() {
                const name = ref('');
                const birthDate = ref('');
                const birthTime = ref('');
                const result = ref(null);
                const solar = ref({});
                const ascendant = ref(null);

                const zodiacDates = [
                    { sign: "Capric√≥rnio", endMonth: 1, endDay: 19, icon: "fa-solid fa-mountain", element: "Terra", desc: "Ambicioso, disciplinado e pr√°tico." },
                    { sign: "Aqu√°rio", endMonth: 2, endDay: 18, icon: "fa-solid fa-water", element: "Ar", desc: "Original, independente e humanit√°rio." },
                    { sign: "Peixes", endMonth: 3, endDay: 20, icon: "fa-solid fa-fish", element: "√Ågua", desc: "Sens√≠vel, art√≠stico e intuitivo." },
                    { sign: "√Åries", endMonth: 4, endDay: 19, icon: "fa-solid fa-fire", element: "Fogo", desc: "Corajoso, determinado e confiante." },
                    { sign: "Touro", endMonth: 5, endDay: 20, icon: "fa-solid fa-bullhorn", element: "Terra", desc: "Confi√°vel, paciente e pr√°tico." },
                    { sign: "G√™meos", endMonth: 6, endDay: 20, icon: "fa-solid fa-user-group", element: "Ar", desc: "Curioso, adapt√°vel e carinhoso." },
                    { sign: "C√¢ncer", endMonth: 7, endDay: 22, icon: "fa-solid fa-moon", element: "√Ågua", desc: "Leal, emocional e simp√°tico." },
                    { sign: "Le√£o", endMonth: 8, endDay: 22, icon: "fa-solid fa-crown", element: "Fogo", desc: "Criativo, apaixonado e generoso." },
                    { sign: "Virgem", endMonth: 9, endDay: 22, icon: "fa-solid fa-wheat-awn", element: "Terra", desc: "Anal√≠tico, gentil e trabalhador." },
                    { sign: "Libra", endMonth: 10, endDay: 22, icon: "fa-solid fa-scale-balanced", element: "Ar", desc: "Diplom√°tico, gracioso e justo." },
                    { sign: "Escorpi√£o", endMonth: 11, endDay: 21, icon: "fa-solid fa-scorpion", element: "√Ågua", desc: "Engenhoso, corajoso e apaixonado." },
                    { sign: "Sagit√°rio", endMonth: 12, endDay: 21, icon: "fa-solid fa-bow-arrow", element: "Fogo", desc: "Generoso, idealista e bem-humorado." },
                    { sign: "Capric√≥rnio", endMonth: 12, endDay: 31, icon: "fa-solid fa-mountain", element: "Terra", desc: "Ambicioso, disciplinado e pr√°tico." }
                ];

                const getSign = (date) => {
                    const d = new Date(date);
                    const day = d.getDate() + 1; // fix timezone offset simplistic
                    const month = d.getMonth() + 1;

                    for (let z of zodiacDates) {
                        if (month < z.endMonth || (month === z.endMonth && day <= z.endDay)) {
                            return z; // This logic is slightly flawed for Capricorn wrap-around, handled by list order
                        }
                    }
                    return zodiacDates[0]; // Capric√≥rnio fallback
                };

                // Fixed getSign logic properly:
                const getSignFixed = (dateStr) => {
                    const date = new Date(dateStr + 'T12:00:00'); // midday to avoid timezone issues
                    const day = date.getDate();
                    const month = date.getMonth() + 1;

                    if ((month == 1 && day <= 19) || (month == 12 && day >= 22)) return zodiacDates.find(z => z.sign === "Capric√≥rnio");
                    if ((month == 1 && day >= 20) || (month == 2 && day <= 18)) return zodiacDates.find(z => z.sign === "Aqu√°rio");
                    if ((month == 2 && day >= 19) || (month == 3 && day <= 20)) return zodiacDates.find(z => z.sign === "Peixes");
                    if ((month == 3 && day >= 21) || (month == 4 && day <= 19)) return zodiacDates.find(z => z.sign === "√Åries");
                    if ((month == 4 && day >= 20) || (month == 5 && day <= 20)) return zodiacDates.find(z => z.sign === "Touro");
                    if ((month == 5 && day >= 21) || (month == 6 && day <= 20)) return zodiacDates.find(z => z.sign === "G√™meos");
                    if ((month == 6 && day >= 21) || (month == 7 && day <= 22)) return zodiacDates.find(z => z.sign === "C√¢ncer");
                    if ((month == 7 && day >= 23) || (month == 8 && day <= 22)) return zodiacDates.find(z => z.sign === "Le√£o");
                    if ((month == 8 && day >= 23) || (month == 9 && day <= 22)) return zodiacDates.find(z => z.sign === "Virgem");
                    if ((month == 9 && day >= 23) || (month == 10 && day <= 22)) return zodiacDates.find(z => z.sign === "Libra");
                    if ((month == 10 && day >= 23) || (month == 11 && day <= 21)) return zodiacDates.find(z => z.sign === "Escorpi√£o");
                    if ((month == 11 && day >= 22) || (month == 12 && day <= 21)) return zodiacDates.find(z => z.sign === "Sagit√°rio");
                    return zodiacDates[0];
                };

                // Simple Ascendant Table (Approximate, knowing Sunrise ~6am = Sun Sign = Ascendant)
                // Offset +2 hours per Sign
                const getAscendant = (sunSignIdx, hour) => {
                    const sunRise = 6;
                    let diff = hour - sunRise;
                    if (diff < 0) diff += 24;
                    const signOffset = Math.floor(diff / 2); // Every 2 hours sign changes
                    const signsList = ["√Åries", "Touro", "G√™meos", "C√¢ncer", "Le√£o", "Virgem", "Libra", "Escorpi√£o", "Sagit√°rio", "Capric√≥rnio", "Aqu√°rio", "Peixes"];

                    // Find index of sun sign in standard order
                    const startIdx = signsList.indexOf(sunSignIdx);
                    const ascIdx = (startIdx + signOffset) % 12;
                    return signsList[ascIdx];
                };

                const calculate = () => {
                    if (!birthDate.value) return;
                    solar.value = getSignFixed(birthDate.value);

                    if (birthTime.value) {
                        const h = parseInt(birthTime.value.split(':')[0]);
                        ascendant.value = getAscendant(solar.value.sign, h);
                    } else {
                        ascendant.value = null;
                    }
                    result.value = true;
                };

                const getIcon = (signName) => {
                    const z = zodiacDates.find(z => z.sign === signName) || zodiacDates.find(z => z.sign === "√Åries"); // fallback
                    return z.icon;
                };

                const share = () => {
                    let text = `‚ú® *Meu Mapa Astral*\n\n‚òÄÔ∏è Sol: ${solar.value.sign} (${solar.value.element})\n`;
                    if (ascendant.value) text += `üåÖ Ascendente: ${ascendant.value}\n`;
                    text += `\n"${solar.value.desc}"\n\nDescubra o seu em Plena Apps.`;
                    window.open(`https://wa.me/?text=${encodeURIComponent(text)}`, '_blank');
                };

                return { name, birthDate, birthTime, result, calculate, solar, ascendant, getIcon, share };
            }
        }).mount('#app');
    </script>
</body>

</html>