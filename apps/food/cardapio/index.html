<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Card√°pio Digital | Plena</title>

    <meta name="theme-color" content="#18181B">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        plena: {
                            primary: '#F59E0B', // Amber for Food
                            secondary: '#10B981',
                            dark: '#18181B', // Zinc 900
                            darker: '#09090B' // Zinc 950
                        }
                    },
                    fontFamily: {
                        brand: ['Oswald', 'sans-serif'],
                        sans: ['Inter', 'sans-serif']
                    }
                }
            }
        }
    </script>

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>

    <!-- Google Fonts -->
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Oswald:wght@400;500;700&display=swap"
        rel="stylesheet">

    <!-- Upsell Script -->
    <script src="../../../assets/js/plena_upsell.js"></script>

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #09090B;
            color: #F4F4F5;
        }

        .hide-scrollbar::-webkit-scrollbar {
            display: none;
        }

        .hide-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        /* Smooth scroll behavior */
        html {
            scroll-behavior: smooth;
        }

        /* Animations */
        @keyframes slideUp {
            from {
                transform: translateY(100%);
            }

            to {
                transform: translateY(0);
            }
        }

        .animate-slide-up {
            animation: slideUp 0.3s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        .animate-fade-in {
            animation: fadeIn 0.3s ease-out;
        }

        /* Notification Toast */
        #notification-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .notification {
            background: #27272A;
            color: white;
            padding: 16px 24px;
            border-radius: 12px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3);
            display: flex;
            align-items: center;
            gap: 12px;
            min-width: 300px;
            transform: translateX(120%);
            transition: transform 0.3s ease;
            border-left: 4px solid #F59E0B;
        }

        .notification.show {
            transform: translateX(0);
        }

        /* Cart Badge Pulse */
        @keyframes cartPulse {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.2);
            }

            100% {
                transform: scale(1);
            }
        }

        .cart-bump {
            animation: cartPulse 0.3s ease-out;
        }
    </style>
    <script src="../../../assets/js/plena-lock.js"></script>
</head>

<body class="flex flex-col h-screen overflow-hidden">

    <!-- OVERLAY -->
    <div id="overlay" class="fixed inset-0 bg-black/80 hidden z-40 backdrop-blur-sm transition-opacity opacity-0"
        onclick="closeAllModals()"></div>

    <!-- HEADER / NAVIGATION -->
    <header class="bg-zinc-900 border-b border-zinc-800 z-30 shrink-0">
        <div class="px-4 h-16 flex items-center justify-between max-w-5xl mx-auto">
            <div class="flex items-center gap-3">
                <div
                    class="w-9 h-9 bg-amber-500 rounded-lg flex items-center justify-center text-zinc-900 shadow-lg shadow-amber-500/20">
                    <i data-lucide="utensils" class="w-5 h-5"></i>
                </div>
                <h1 class="font-brand font-bold text-xl text-white tracking-wide">Plena<span
                        class="text-amber-500">Food</span></h1>
            </div>

            <div class="flex items-center gap-4">
                <button onclick="toggleAdminPanel()" class="text-zinc-500 hover:text-white transition p-2">
                    <i data-lucide="settings" class="w-5 h-5"></i>
                </button>
                <div class="relative cursor-pointer" onclick="toggleCart()">
                    <i data-lucide="shopping-bag" class="w-6 h-6 text-white hover:text-amber-500 transition"></i>
                    <span id="cart-badge"
                        class="absolute -top-1 -right-1 bg-red-500 text-white text-[10px] w-4 h-4 rounded-full flex items-center justify-center font-bold hidden">0</span>
                </div>
            </div>
        </div>
    </header>

    <!-- CONTENT SCROLLABLE -->
    <main class="flex-1 overflow-y-auto hide-scrollbar scroll-smooth relative" id="main-scroll">

        <!-- COVER HERO -->
        <div class="relative h-64 w-full bg-zinc-800 shrink-0 group">
            <img id="cover-img" src="https://images.unsplash.com/photo-1550547660-d9450f859349?w=1000&q=80"
                class="w-full h-full object-cover opacity-60 transition duration-500 group-hover:scale-105 group-hover:opacity-50"
                alt="Cover">
            <div class="absolute inset-0 bg-gradient-to-t from-zinc-950 via-zinc-900/40 to-transparent"></div>

            <div class="absolute bottom-0 left-0 w-full p-6 max-w-5xl mx-auto">
                <div id="restaurant-info" class="mb-4">
                    <h2 id="rest-name"
                        class="text-4xl md:text-5xl font-brand font-bold text-white mb-1 shadow-black drop-shadow-md">
                        Burger House</h2>
                    <p id="rest-address" class="text-zinc-300 text-sm flex items-center gap-2 font-medium">
                        <i data-lucide="map-pin" class="w-4 h-4 text-amber-500"></i> Rua dos Sabores, 123
                    </p>
                </div>
            </div>

            <!-- Edit Button (Admin Only) -->
            <button id="edit-cover-btn" onclick="editRestaurantInfo()"
                class="absolute top-4 right-4 bg-black/50 text-white p-2 rounded-lg hidden hover:bg-amber-500 hover:text-black transition">
                <i data-lucide="edit-3" class="w-4 h-4"></i>
            </button>
        </div>

        <!-- CATEGORY NAV (STICKY) -->
        <div class="sticky top-0 z-20 bg-zinc-950/95 backdrop-blur border-b border-zinc-800 py-3">
            <div class="max-w-5xl mx-auto px-4 overflow-x-auto hide-scrollbar flex gap-3" id="category-nav">
                <!-- Categories injected js -->
            </div>
        </div>

        <!-- MENU ITEMS GRID -->
        <div class="max-w-5xl mx-auto px-4 py-8 pb-32 min-h-[500px]">
            <div id="menu-grid" class="grid md:grid-cols-2 gap-6">
                <!-- Items injected js -->
            </div>

            <div id="empty-state" class="hidden py-20 text-center opacity-40">
                <i data-lucide="search-x" class="w-16 h-16 mx-auto mb-4"></i>
                <p>Nenhum item encontrado nesta categoria.</p>
            </div>
        </div>

    </main>

    <!-- FLOATING CHECKOUT BAR -->
    <div id="checkout-bar"
        class="fixed bottom-0 left-0 w-full bg-zinc-900 border-t border-zinc-800 p-4 transform translate-y-full transition-transform duration-300 z-30">
        <div class="max-w-5xl mx-auto">
            <button onclick="toggleCart()"
                class="w-full bg-amber-500 hover:bg-amber-400 text-zinc-950 px-6 py-4 rounded-xl flex items-center justify-between font-bold shadow-lg shadow-amber-900/20 active:scale-[0.98] transition-all">
                <div class="flex items-center gap-3">
                    <div id="bar-count"
                        class="bg-zinc-900/20 w-8 h-8 rounded-full flex items-center justify-center text-sm">0</div>
                    <span class="text-sm uppercase tracking-wider">Ver Sacola</span>
                </div>
                <span id="bar-total" class="text-lg">R$ 0,00</span>
            </button>
        </div>
    </div>

    <!-- CART MODAL / BOTTOM SHEET -->
    <div id="cart-modal"
        class="fixed inset-x-0 bottom-0 z-50 transform translate-y-full transition-transform duration-300 md:inset-y-0 md:right-0 md:left-auto md:w-[450px] md:translate-x-full bg-zinc-900 border-l border-zinc-800 shadow-2xl flex flex-col md:h-full max-h-[90vh] md:max-h-full rounded-t-3xl md:rounded-none">

        <div class="p-6 border-b border-zinc-800 flex justify-between items-center bg-zinc-900 md:bg-transparent">
            <h2 class="font-brand font-bold text-2xl text-white flex items-center gap-2">
                <i data-lucide="shopping-bag" class="w-6 h-6 text-amber-500"></i> Sua Sacola
            </h2>
            <button onclick="toggleCart()" class="p-2 text-zinc-500 hover:text-white rounded-full bg-zinc-800">
                <i data-lucide="x" class="w-5 h-5"></i>
            </button>
        </div>

        <div id="cart-items" class="flex-1 overflow-y-auto p-6 space-y-4">
            <!-- Cart items injected js -->
        </div>

        <div class="p-6 bg-zinc-800/50 border-t border-zinc-800 space-y-4">
            <div>
                <label class="text-xs font-bold text-zinc-500 uppercase mb-2 block">Observa√ß√µes</label>
                <textarea id="order-obs" rows="2"
                    class="w-full bg-zinc-900 border border-zinc-700 rounded-lg p-3 text-sm text-white focus:border-amber-500 outline-none resize-none"
                    placeholder="Ex: Sem cebola, troco para 50..."></textarea>
            </div>

            <div class="flex justify-between items-end">
                <span class="text-zinc-400 text-sm">Total</span>
                <span id="cart-modal-total" class="text-3xl font-brand font-bold text-amber-500">R$ 0,00</span>
            </div>

            <button onclick="sendOrder()"
                class="w-full bg-green-600 hover:bg-green-500 text-white font-bold py-4 rounded-xl flex items-center justify-center gap-2 active:scale-[0.98] transition">
                <i data-lucide="message-circle" class="w-5 h-5"></i> Enviar Pedido
            </button>
        </div>
    </div>

    <!-- ADMIN PANEL DRAWER -->
    <div id="admin-panel"
        class="fixed inset-y-0 left-0 w-80 bg-zinc-900 border-r border-zinc-800 transform -translate-x-full transition-transform duration-300 z-50 flex flex-col shadow-2xl">
        <div class="p-6 border-b border-zinc-800 bg-zinc-950 flex justify-between items-center">
            <h2 class="font-bold text-white flex items-center gap-2">
                <i data-lucide="shield-check" class="text-amber-500"></i> Admin
            </h2>
            <button onclick="toggleAdminPanel()" class="text-zinc-500 hover:text-white"><i data-lucide="x"
                    class="w-5 h-5"></i></button>
        </div>

        <div class="p-4 flex-1 overflow-y-auto space-y-6">

            <!-- Quick Edit Toggle -->
            <div class="bg-zinc-800/50 p-4 rounded-xl border border-zinc-700/50">
                <div class="flex items-center justify-between mb-2">
                    <span class="text-sm font-medium text-white">Modo Edi√ß√£o</span>
                    <label class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" id="edit-mode-toggle" class="sr-only peer" onchange="toggleEditMode()">
                        <div
                            class="w-11 h-6 bg-zinc-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-amber-500">
                        </div>
                    </label>
                </div>
                <p class="text-xs text-zinc-500">Habilita bot√µes de editar/excluir nos itens.</p>
            </div>

            <!-- Add Item -->
            <div>
                <h3 class="text-xs font-bold text-zinc-500 uppercase mb-3">Novo Produto</h3>
                <form onsubmit="event.preventDefault(); addNewItem();" class="space-y-3">
                    <input id="new-name" placeholder="Nome"
                        class="w-full bg-zinc-950 border border-zinc-700 rounded-lg p-2.5 text-sm text-white outline-none focus:border-amber-500">
                    <input id="new-price" type="number" step="0.50" placeholder="Pre√ßo (R$)"
                        class="w-full bg-zinc-950 border border-zinc-700 rounded-lg p-2.5 text-sm text-white outline-none focus:border-amber-500">
                    <select id="new-cat"
                        class="w-full bg-zinc-950 border border-zinc-700 rounded-lg p-2.5 text-sm text-white outline-none focus:border-amber-500">
                        <!-- Options JS -->
                    </select>
                    <textarea id="new-desc" rows="2" placeholder="Descri√ß√£o"
                        class="w-full bg-zinc-950 border border-zinc-700 rounded-lg p-2.5 text-sm text-white outline-none focus:border-amber-500 resize-none"></textarea>
                    <button type="submit"
                        class="w-full bg-amber-600 hover:bg-amber-500 text-white font-bold py-2 rounded-lg text-sm transition">Adicionar
                        Item</button>
                </form>
            </div>

            <hr class="border-zinc-800">

            <!-- Data Management -->
            <div class="space-y-2">
                <button onclick="backupData()"
                    class="w-full flex items-center gap-2 px-4 py-3 bg-zinc-800 hover:bg-zinc-700 text-white rounded-xl text-sm transition">
                    <i data-lucide="download" class="w-4 h-4"></i> Backup JSON
                </button>
                <label
                    class="w-full flex items-center gap-2 px-4 py-3 bg-zinc-800 hover:bg-zinc-700 text-white rounded-xl text-sm transition cursor-pointer">
                    <i data-lucide="upload" class="w-4 h-4"></i> Restaurar JSON
                    <input type="file" onchange="restoreData(this)" class="hidden" accept=".json">
                </label>
            </div>

            <div class="pt-4 text-center">
                <a href="../../../index.html" class="text-xs text-zinc-500 hover:text-white underline">Voltar para Loja
                    de Apps</a>
            </div>
        </div>
    </div>

    <!-- NOTIFICATION CONTAINER -->
    <div id="notification-container"></div>

    <script>
        // --- DATA & STATE ---
        const state = {
            config: {
                name: 'Burger House',
                address: 'Rua dos Sabores, 123',
                cover: 'https://images.unsplash.com/photo-1550547660-d9450f859349?w=1000&q=80'
            },
            categories: ['Lanches', 'Bebidas', 'Acompanhamentos', 'Sobremesas'],
            activeCat: 'Lanches',
            items: [
                { id: 1, name: 'X-Burger Cl√°ssico', desc: 'P√£o brioche, blend 150g, queijo cheddar e maionese da casa.', price: 22.00, cat: 'Lanches' },
                { id: 2, name: 'X-Salada', desc: 'P√£o brioche, blend 150g, queijo, alface e tomate.', price: 24.00, cat: 'Lanches' },
                { id: 3, name: 'Coca-Cola Lata', desc: '350ml gelada.', price: 6.00, cat: 'Bebidas' },
                { id: 4, name: 'Batata Frita', desc: 'Por√ß√£o individual crocante.', price: 12.00, cat: 'Acompanhamentos' }
            ],
            cart: [],
            isEditMode: false,
            isCartOpen: false
        };

        // --- INIT ---
        document.addEventListener('DOMContentLoaded', () => {
            loadLocalData();
            renderCategories();
            renderMenu();
            lucide.createIcons();

            // Upsell Init
            if (window.PlenaUpsell) {
                PlenaUpsell.init({
                    appName: 'Card√°pio Digital',
                    plusName: 'Plena Delivery',
                    plusLink: '../../../../Mercado Livre/apps.plus/plena_delivery.html',
                    dashboardPreview: 'https://images.unsplash.com/photo-1555396273-367ea4eb4db5?w=800&q=80'
                });
            }
        });

        // --- UI RENDERING ---

        function renderCategories() {
            const nav = document.getElementById('category-nav');
            const select = document.getElementById('new-cat');

            nav.innerHTML = '';
            select.innerHTML = '';

            state.categories.forEach(cat => {
                // Nav Button
                const btn = document.createElement('button');
                const isActive = state.activeCat === cat;
                btn.className = `px-5 py-2 rounded-full text-sm font-bold whitespace-nowrap transition border ${isActive ? 'bg-amber-500 border-amber-500 text-black' : 'bg-zinc-900 border-zinc-800 text-zinc-400 hover:text-white hover:border-zinc-700'}`;
                btn.textContent = cat;
                btn.onclick = () => {
                    state.activeCat = cat;
                    renderCategories();
                    renderMenu();
                    document.getElementById('main-scroll').scrollTo({ top: 0, behavior: 'smooth' });
                };
                nav.appendChild(btn);

                // Admin Select
                const opt = document.createElement('option');
                opt.value = cat;
                opt.textContent = cat;
                select.appendChild(opt);
            });
        }

        function renderMenu() {
            const grid = document.getElementById('menu-grid');
            const empty = document.getElementById('empty-state');
            grid.innerHTML = '';

            const items = state.items.filter(i => i.cat === state.activeCat);

            if (items.length === 0) {
                empty.classList.remove('hidden');
            } else {
                empty.classList.add('hidden');
                items.forEach(item => {
                    const el = document.createElement('div');
                    el.className = 'bg-zinc-900 border border-zinc-800 rounded-2xl p-5 flex gap-4 hover:border-amber-500/30 transition shadow-lg group relative overflow-hidden animate-fade-in';

                    const deleteBtn = state.isEditMode ?
                        `<button onclick="deleteItem(${item.id})" class="absolute top-2 right-2 p-2 bg-red-500 text-white rounded-lg shadow z-10 hover:bg-red-600 transition"><i data-lucide="trash-2" class="w-4 h-4"></i></button>`
                        : '';

                    el.innerHTML = `
                        ${deleteBtn}
                        <div class="absolute left-0 top-0 bottom-0 w-1 bg-amber-500 transform -translate-x-full group-hover:translate-x-0 transition-transform duration-300"></div>
                        <div class="flex-1">
                            <div class="flex justify-between items-start mb-1">
                                <h3 class="font-brand font-bold text-xl text-white leading-tight">${item.name}</h3>
                                <div class="text-right ml-2">
                                    <span class="block font-mono font-bold text-amber-500 text-lg">R$ ${item.price.toFixed(2)}</span>
                                </div>
                            </div>
                            <p class="text-zinc-400 text-sm leading-relaxed line-clamp-2 mb-4 h-10">${item.desc}</p>
                            <button onclick="addToCart(${item.id})" class="w-full bg-zinc-800 hover:bg-amber-500 hover:text-zinc-950 text-zinc-300 py-2.5 rounded-xl font-bold text-sm transition flex items-center justify-center gap-2 group-hover:bg-zinc-700">
                                <i data-lucide="plus" class="w-4 h-4"></i> Adicionar
                            </button>
                        </div>
                    `;
                    grid.appendChild(el);
                });
            }
            lucide.createIcons();
        }

        function renderCart() {
            const container = document.getElementById('cart-items');
            container.innerHTML = '';

            if (state.cart.length === 0) {
                container.innerHTML = `
                    <div class="h-64 flex flex-col items-center justify-center text-zinc-600 opacity-50 space-y-4">
                        <i data-lucide="shopping-cart" class="w-16 h-16"></i>
                        <p class="font-medium">Sua sacola est√° vazia</p>
                    </div>
                `;
            } else {
                state.cart.forEach((item, idx) => {
                    const el = document.createElement('div');
                    el.className = 'flex gap-4 items-start bg-zinc-800/50 p-4 rounded-xl border border-zinc-700/50 animate-fade-in';
                    el.innerHTML = `
                        <div class="w-8 h-8 bg-amber-500/10 text-amber-500 rounded flex items-center justify-center font-bold text-sm shrink-0 mt-1">${item.qty}x</div>
                        <div class="flex-1">
                            <h4 class="font-bold text-white text-sm">${item.name}</h4>
                            <p class="text-xs text-zinc-500 mt-0.5">Unit: R$ ${item.price.toFixed(2)}</p>
                        </div>
                        <div class="text-right">
                            <p class="font-mono font-bold text-amber-500">R$ ${(item.price * item.qty).toFixed(2)}</p>
                            <div class="flex items-center gap-2 mt-2 justify-end">
                                <button onclick="adjustQty(${idx}, -1)" class="w-7 h-7 rounded bg-zinc-700 text-zinc-400 hover:text-white flex items-center justify-center"><i data-lucide="minus" class="w-3 h-3"></i></button>
                                <button onclick="adjustQty(${idx}, 1)" class="w-7 h-7 rounded bg-zinc-700 text-zinc-400 hover:text-white flex items-center justify-center"><i data-lucide="plus" class="w-3 h-3"></i></button>
                            </div>
                        </div>
                    `;
                    container.appendChild(el);
                });
            }

            updateCartTotals();
            lucide.createIcons();
        }

        // --- ACTIONS ---

        function addToCart(id) {
            const item = state.items.find(i => i.id === id);
            const existing = state.cart.find(c => c.id === id);

            if (existing) {
                existing.qty++;
            } else {
                state.cart.push({ ...item, qty: 1 });
            }

            showNotification(`${item.name} adicionado!`, 'success');

            // Bump animation
            const badge = document.getElementById('cart-badge');
            badge.classList.remove('hidden');
            badge.classList.remove('cart-bump');
            void badge.offsetWidth; // trigger reflow
            badge.classList.add('cart-bump');

            updateCartTotals();
        }

        function adjustQty(idx, amount) {
            const item = state.cart[idx];
            item.qty += amount;
            if (item.qty <= 0) state.cart.splice(idx, 1);
            renderCart();
        }

        function updateCartTotals() {
            const count = state.cart.reduce((acc, i) => acc + i.qty, 0);
            const total = state.cart.reduce((acc, i) => acc + (i.price * i.qty), 0);

            // Badges & Labels
            document.getElementById('cart-badge').textContent = count;
            if (count === 0) document.getElementById('cart-badge').classList.add('hidden');

            document.getElementById('bar-count').textContent = count;
            document.getElementById('bar-total').textContent = `R$ ${total.toFixed(2)}`;
            document.getElementById('cart-modal-total').textContent = `R$ ${total.toFixed(2)}`;

            // Bar Visibility
            const bar = document.getElementById('checkout-bar');
            if (count > 0 && !state.isCartOpen) {
                bar.classList.remove('translate-y-full');
            } else {
                bar.classList.add('translate-y-full');
            }
        }

        function toggleCart() {
            state.isCartOpen = !state.isCartOpen;
            const modal = document.getElementById('cart-modal');
            const overlay = document.getElementById('overlay');
            const bar = document.getElementById('checkout-bar');

            if (state.isCartOpen) {
                renderCart();
                // Desktop vs Mobile transform
                if (window.innerWidth >= 768) {
                    modal.classList.remove('md:translate-x-full');
                } else {
                    modal.classList.remove('translate-y-full');
                }

                overlay.classList.remove('hidden');
                setTimeout(() => overlay.classList.remove('opacity-0'), 10);

                bar.classList.add('translate-y-full'); // Hide floating bar when modal is open
            } else {
                if (window.innerWidth >= 768) {
                    modal.classList.add('md:translate-x-full');
                } else {
                    modal.classList.add('translate-y-full');
                }

                overlay.classList.add('opacity-0');
                setTimeout(() => overlay.classList.add('hidden'), 300);

                if (state.cart.length > 0) bar.classList.remove('translate-y-full');
            }
        }

        function addNewItem() {
            const name = document.getElementById('new-name').value;
            const price = parseFloat(document.getElementById('new-price').value);
            const cat = document.getElementById('new-cat').value;
            const desc = document.getElementById('new-desc').value;

            if (!name || isNaN(price)) return showNotification('Preencha os campos!', 'warning');

            state.items.push({
                id: Date.now(),
                name, price, cat, desc
            });

            saveLocalData();
            renderMenu();
            showNotification('Produto Criado!', 'success');

            // Clear form
            document.getElementById('new-name').value = '';
            document.getElementById('new-price').value = '';
            document.getElementById('new-desc').value = '';
        }

        function deleteItem(id) {
            if (confirm('Tem certeza que deseja apagar este item?')) {
                state.items = state.items.filter(i => i.id !== id);
                renderMenu();
                saveLocalData();
                showNotification('Item removido.', 'info');
            }
        }

        function sendOrder() {
            const obs = document.getElementById('order-obs').value;
            let text = `üçî *NOVO PEDIDO - ${state.config.name.toUpperCase()}*\n`;
            text += `‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n`;
            state.cart.forEach(i => {
                text += `‚ñ™Ô∏è ${i.qty}x *${i.name}*\n   R$ ${(i.qty * i.price).toFixed(2)}\n`;
            });
            text += `‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n`;
            if (obs) text += `üìù *Obs:* ${obs}\n`;

            const total = state.cart.reduce((acc, i) => acc + (i.price * i.qty), 0);
            text += `üí∞ *TOTAL: R$ ${total.toFixed(2)}*\n`;

            window.open(`https://wa.me/?text=${encodeURIComponent(text)}`, '_blank');
        }

        // --- ADMIN & UTILS ---

        function toggleAdminPanel() {
            const p = document.getElementById('admin-panel');
            const o = document.getElementById('overlay');
            const isOpen = !p.classList.contains('-translate-x-full');

            if (isOpen) {
                p.classList.add('-translate-x-full');
                o.classList.add('opacity-0');
                setTimeout(() => o.classList.add('hidden'), 300);
            } else {
                p.classList.remove('-translate-x-full');
                o.classList.remove('hidden');
                setTimeout(() => o.classList.remove('opacity-0'), 10);
            }
        }

        function toggleEditMode() {
            state.isEditMode = !state.isEditMode;
            renderMenu();
            // Show/Hide edit buttons in header not implemented fully here for brevity, 
            // but item delete buttons will appear.
            const editBtn = document.getElementById('edit-cover-btn');
            if (state.isEditMode) editBtn.classList.remove('hidden'); else editBtn.classList.add('hidden');
        }

        function editRestaurantInfo() {
            const newName = prompt("Nome do Restaurante:", state.config.name);
            if (newName) {
                state.config.name = newName;
                document.getElementById('rest-name').textContent = newName;
                saveLocalData();
            }
        }

        function closeAllModals() {
            if (state.isCartOpen) toggleCart();
            // Close admin panel logic duplicate
            const p = document.getElementById('admin-panel');
            if (!p.classList.contains('-translate-x-full')) toggleAdminPanel();
        }

        function showNotification(msg, type = 'info') {
            const c = document.getElementById('notification-container');
            const el = document.createElement('div');
            el.className = 'notification';
            if (type === 'success') { el.style.borderLeftColor = '#10B981'; }
            else if (type === 'danger') { el.style.borderLeftColor = '#EF4444'; }

            el.innerHTML = `<i data-lucide="${type === 'success' ? 'check-circle' : 'info'}" class="w-5 h-5"></i> <span>${msg}</span>`;
            c.appendChild(el);
            lucide.createIcons();
            requestAnimationFrame(() => el.classList.add('show'));
            setTimeout(() => {
                el.classList.remove('show');
                setTimeout(() => el.remove(), 300);
            }, 3000);
        }

        // --- BACKUP ---
        function backupData() {
            const data = JSON.stringify({ items: state.items, config: state.config });
            const blob = new Blob([data], { type: "application/json" });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `backup_cardapio.json`;
            a.click();
        }

        function restoreData(input) {
            const file = input.files[0];
            if (!file) return;
            const r = new FileReader();
            r.onload = (e) => {
                try {
                    const d = JSON.parse(e.target.result);
                    if (d.items) state.items = d.items;
                    if (d.config) state.config = d.config;
                    renderMenu();
                    showNotification('Dados restaurados!', 'success');
                    saveLocalData();
                } catch (err) { showNotification('Erro ao restaurar', 'danger'); }
            };
            r.readAsText(file);
        }

        // --- STORAGE ---
        function saveLocalData() {
            localStorage.setItem('plena_cardapio_v3', JSON.stringify({ items: state.items, config: state.config }));
        }
        function loadLocalData() {
            const d = localStorage.getItem('plena_cardapio_v3');
            if (d) {
                try {
                    const p = JSON.parse(d);
                    state.items = p.items || state.items;
                    state.config = p.config || state.config;

                    document.getElementById('rest-name').textContent = state.config.name;
                    document.getElementById('rest-address').innerHTML = `<i data-lucide="map-pin" class="w-4 h-4 text-amber-500"></i> ${state.config.address}`;
                    document.getElementById('cover-img').src = state.config.cover;
                } catch (e) { }
            }
        }

    </script>
</body>

</html>