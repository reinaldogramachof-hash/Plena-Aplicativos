<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ficha T√©cnica | Plena Apps</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            background-color: #f1f5f9;
            font-family: 'Segoe UI', sans-serif;
        }

        [v-cloak] {
            display: none;
        }
    </style>
</head>

<body class="pb-20">

    <div id="app" v-cloak class="max-w-4xl mx-auto min-h-screen bg-white shadow-xl flex flex-col">

        <!-- HEADER -->
        <header class="bg-indigo-600 text-white p-6 flex justify-between items-center shadow-lg">
            <h1 class="text-xl font-bold"><i class="fa-solid fa-clipboard-list"></i> Ficha T√©cnica Pro</h1>
            <div class="flex gap-2">
                <button @click="backupData" class="bg-indigo-500 hover:bg-indigo-400 p-2 rounded transition"
                    title="Backup"><i class="fa-solid fa-download"></i></button>
                <label class="bg-indigo-500 hover:bg-indigo-400 p-2 rounded transition cursor-pointer" title="Restore">
                    <i class="fa-solid fa-upload"></i>
                    <input type="file" @change="restoreData" class="hidden" accept=".json">
                </label>
            </div>
        </header>

        <!-- MAIN -->
        <div class="p-8 flex-grow">

            <!-- HEADER INFO -->
            <div
                class="bg-indigo-50 p-6 rounded-xl border border-indigo-100 mb-8 grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Nome do Prato</label>
                    <input v-model="dishName" type="text"
                        class="w-full text-xl font-bold text-gray-800 bg-transparent border-b-2 border-indigo-200 outline-none focus:border-indigo-500"
                        placeholder="Ex: Risoto de Camar√£o">
                </div>
                <div>
                    <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Rendimento (Por√ß√µes)</label>
                    <input v-model.number="yields" type="number"
                        class="w-full text-xl font-bold text-gray-800 bg-transparent border-b-2 border-indigo-200 outline-none focus:border-indigo-500"
                        placeholder="1">
                </div>
            </div>

            <!-- INGREDIENTS -->
            <div class="mb-8">
                <h3 class="font-bold text-gray-700 mb-4 flex items-center gap-2">
                    <span
                        class="bg-indigo-600 text-white w-6 h-6 rounded-full flex items-center justify-center text-xs">1</span>
                    Ingredientes & Custos
                </h3>

                <table class="w-full text-left text-sm mb-4">
                    <thead class="bg-gray-100 text-gray-500 uppercase text-xs">
                        <tr>
                            <th class="p-3 rounded-tl-lg">Ingrediente</th>
                            <th class="p-3">Qtd Bruta</th>
                            <th class="p-3">Unidade</th>
                            <th class="p-3">Custo Total (R$)</th>
                            <th class="p-3 w-10"></th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-gray-100">
                        <tr v-for="(ing, idx) in ingredients" :key="idx" class="group hover:bg-gray-50">
                            <td class="p-2"><input v-model="ing.name" placeholder="Item"
                                    class="w-full bg-transparent outline-none"></td>
                            <td class="p-2"><input v-model.number="ing.qty" placeholder="0"
                                    class="w-full bg-transparent outline-none"></td>
                            <td class="p-2">
                                <select v-model="ing.unit" class="bg-transparent outline-none text-gray-500">
                                    <option value="kg">kg</option>
                                    <option value="g">g</option>
                                    <option value="L">L</option>
                                    <option value="ml">ml</option>
                                    <option value="un">un</option>
                                </select>
                            </td>
                            <td class="p-2 font-bold text-gray-700"><input v-model.number="ing.cost" placeholder="0.00"
                                    class="w-full bg-transparent outline-none"></td>
                            <td class="p-2 text-center"><button @click="ingredients.splice(idx,1)"
                                    class="text-gray-300 hover:text-red-500"><i class="fa-solid fa-xmark"></i></button>
                            </td>
                        </tr>
                    </tbody>
                </table>

                <button @click="ingredients.push({name:'', qty:null, unit:'kg', cost:null})"
                    class="text-indigo-600 font-bold text-sm hover:underline">+ Adicionar Ingrediente</button>
            </div>

            <!-- PREPARATION -->
            <div class="mb-8">
                <h3 class="font-bold text-gray-700 mb-4 flex items-center gap-2">
                    <span
                        class="bg-indigo-600 text-white w-6 h-6 rounded-full flex items-center justify-center text-xs">2</span>
                    Modo de Preparo
                </h3>
                <textarea v-model="method" rows="6"
                    class="w-full bg-gray-50 border border-gray-200 rounded-xl p-4 outline-none focus:border-indigo-500"
                    placeholder="Descreva o passo a passo..."></textarea>
            </div>

            <!-- SUMMARY -->
            <div class="bg-gray-900 text-white p-6 rounded-xl shadow-lg">
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-center">
                    <div>
                        <p class="text-gray-400 text-xs uppercase mb-1">Custo Total</p>
                        <p class="text-xl font-bold text-red-400">R$ {{ totalCost.toFixed(2) }}</p>
                    </div>
                    <div>
                        <p class="text-gray-400 text-xs uppercase mb-1">Custo/Por√ß√£o</p>
                        <p class="text-xl font-bold text-yellow-400">R$ {{ costPerPortion.toFixed(2) }}</p>
                    </div>
                    <div
                        class="col-span-2 md:col-span-2 border-t md:border-t-0 md:border-l border-gray-700 pt-4 md:pt-0 pl-0 md:pl-4 text-left">
                        <div class="flex gap-2 items-center mb-2">
                            <span class="text-gray-400 text-xs uppercase">Pre√ßo Venda:</span>
                            <input v-model.number="salePrice" type="number"
                                class="bg-gray-800 border border-gray-600 rounded p-1 w-24 text-center text-white font-bold">
                        </div>
                        <div class="flex justify-between items-center bg-gray-800 p-2 rounded">
                            <span class="text-sm">Lucro:</span>
                            <span class="font-bold text-green-400">R$ {{ profit.toFixed(2) }} ({{
                                profitMargin.toFixed(0) }}%)</span>
                        </div>
                    </div>
                </div>
            </div>

        </div>

        <!-- ACTIONS -->
        <div class="p-4 bg-gray-100 border-t flex justify-end gap-2">
            <button @click="clear"
                class="bg-white text-gray-600 px-4 py-2 rounded shadow font-bold hover:bg-gray-50">Novo</button>
            <button @click="shareWhatsapp"
                class="bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded shadow font-bold flex items-center gap-2">
                <i class="fa-brands fa-whatsapp"></i> Compartilhar Ficha
            </button>
        </div>

    </div>

    <script>
        const { createApp, ref, computed, onMounted, watch } = Vue;

        createApp({
            setup() {
                const dishName = ref('');
                const yields = ref(1);
                const ingredients = ref([{ name: '', qty: null, unit: 'kg', cost: null }]);
                const method = ref('');
                const salePrice = ref(0);

                // Computed
                const totalCost = computed(() => ingredients.value.reduce((acc, i) => acc + (i.cost || 0), 0));

                const costPerPortion = computed(() => {
                    if (yields.value <= 0) return 0;
                    return totalCost.value / yields.value;
                });

                const profit = computed(() => {
                    if (costPerPortion.value === 0) return 0;
                    return salePrice.value - costPerPortion.value;
                });

                const profitMargin = computed(() => {
                    if (salePrice.value <= 0) return 0;
                    return (profit.value / salePrice.value) * 100;
                });

                // Actions
                const clear = () => {
                    if (confirm('Limpar ficha?')) {
                        dishName.value = '';
                        yields.value = 1;
                        ingredients.value = [{ name: '', qty: null, unit: 'kg', cost: null }];
                        method.value = '';
                        salePrice.value = 0;
                    }
                };

                const shareWhatsapp = () => {
                    let text = `üìã *Ficha T√©cnica: ${dishName.value}*\n` +
                        `üçΩÔ∏è Rendimento: ${yields.value} por√ß√µes\n\n` +
                        `*CUSTOS:*\n` +
                        `üî¥ Total: R$ ${totalCost.value.toFixed(2)}\n` +
                        `üü° Por Por√ß√£o: R$ ${costPerPortion.value.toFixed(2)}\n\n` +
                        `*PRE√áIFICA√á√ÉO:*\n` +
                        `üí≤ Venda Sugerida: R$ ${salePrice.value.toFixed(2)}\n` +
                        `üü¢ Lucro L√≠quido: R$ ${profit.value.toFixed(2)} (${profitMargin.value.toFixed(0)}%)\n`;
                    window.open(`https://wa.me/?text=${encodeURIComponent(text)}`, '_blank');
                };

                // Backup
                const backupData = () => {
                    const data = { dishName: dishName.value, yields: yields.value, ingredients: ingredients.value, method: method.value, salePrice: salePrice.value };
                    const blob = new Blob([JSON.stringify(data)], { type: "application/json" });
                    const a = document.createElement('a');
                    a.href = URL.createObjectURL(blob);
                    a.download = `ficha_${dishName.value || 'tecnica'}_${Date.now()}.json`;
                    a.click();
                };

                const restoreData = (e) => {
                    const f = e.target.files[0];
                    if (!f) return;
                    const r = new FileReader();
                    r.onload = (v) => {
                        try {
                            const d = JSON.parse(v.target.result);
                            dishName.value = d.dishName; yields.value = d.yields; ingredients.value = d.ingredients;
                            method.value = d.method; salePrice.value = d.salePrice;
                            alert("Ficha Carregada!");
                        } catch (e) { alert("Erro!"); }
                    };
                    r.readAsText(f);
                };

                // Storage (Auto-save current draft)
                onMounted(() => {
                    const d = localStorage.getItem('plena_ficha_draft');
                    if (d) {
                        const parsed = JSON.parse(d);
                        dishName.value = parsed.dishName; yields.value = parsed.yields; ingredients.value = parsed.ingredients;
                        method.value = parsed.method; salePrice.value = parsed.salePrice;
                    }
                });

                watch([dishName, yields, ingredients, method, salePrice], () => {
                    localStorage.setItem('plena_ficha_draft', JSON.stringify({
                        dishName: dishName.value, yields: yields.value, ingredients: ingredients.value, method: method.value, salePrice: salePrice.value
                    }));
                }, { deep: true });

                return {
                    dishName, yields, ingredients, method, salePrice,
                    totalCost, costPerPortion, profit, profitMargin,
                    clear, shareWhatsapp, backupData, restoreData
                };
            }
        }).mount('#app');
    </script>
</body>

</html>