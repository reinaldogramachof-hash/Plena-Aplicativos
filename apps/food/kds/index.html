<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KDS Kitchen | Plena Chefs</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link
        href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@500;700&family=Inter:wght@400;600;700&display=swap"
        rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #111827;
            color: #f3f4f6;
        }

        .font-mono {
            font-family: 'JetBrains Mono', monospace;
        }

        [v-cloak] {
            display: none;
        }

        /* Custom Scrollbar for Dark Theme */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #1f2937;
        }

        ::-webkit-scrollbar-thumb {
            background: #374151;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #4b5563;
        }
    </style>
</head>

<body class="flex flex-col md:flex-row h-screen overflow-hidden">

    <div id="app" v-cloak class="flex-1 flex h-full w-full relative">

        <!-- SIDEBAR -->
        <aside :class="sidebarOpen ? 'translate-x-0' : '-translate-x-full'"
            class="fixed md:relative md:translate-x-0 w-64 bg-slate-900 border-r border-slate-800 h-full z-30 transition-transform duration-300 flex flex-col shadow-2xl">
            <div class="p-6 flex items-center gap-3 border-b border-slate-800">
                <div
                    class="w-8 h-8 bg-orange-500 rounded-lg flex items-center justify-center shadow-lg shadow-orange-500/20">
                    <i class="fa-solid fa-fire-burner text-slate-900 text-sm"></i>
                </div>
                <span class="font-bold text-lg tracking-tight text-white">Plena<span
                        class="text-orange-500">KDS</span></span>
            </div>

            <nav class="flex-1 py-6 px-4 space-y-4">

                <div class="bg-slate-800/50 rounded-xl p-4 border border-slate-700">
                    <div class="text-[10px] font-bold text-slate-500 uppercase tracking-widest mb-1">Cozinha</div>
                    <div class="text-2xl font-bold text-white font-mono">{{ currentTime }}</div>
                </div>

                <button @click="newOrder"
                    class="w-full bg-blue-600 hover:bg-blue-500 text-white p-3 rounded-xl font-bold shadow-lg shadow-blue-600/20 transition flex items-center justify-center gap-2">
                    <i class="fa-solid fa-plus"></i> Novo Pedido
                </button>

                <div class="px-2">
                    <div class="flex justify-between items-center text-sm text-slate-400 mb-2">
                        <span>Fila</span>
                        <span class="font-bold text-white">{{ orders.filter(o => o.status === 'todo').length }}</span>
                    </div>
                    <div class="w-full bg-slate-800 rounded-full h-1.5">
                        <div class="bg-red-500 h-1.5 rounded-full" :style="{ width: getPercentage('todo') + '%' }">
                        </div>
                    </div>
                </div>

                <div class="px-2">
                    <div class="flex justify-between items-center text-sm text-slate-400 mb-2">
                        <span>Em Preparo</span>
                        <span class="font-bold text-white">{{ orders.filter(o => o.status === 'prep').length }}</span>
                    </div>
                    <div class="w-full bg-slate-800 rounded-full h-1.5">
                        <div class="bg-yellow-500 h-1.5 rounded-full" :style="{ width: getPercentage('prep') + '%' }">
                        </div>
                    </div>
                </div>

            </nav>

            <div class="p-4 border-t border-slate-800 text-xs text-slate-500">
                <a href="../../../index.html"
                    class="flex items-center gap-2 hover:text-white transition text-sm px-2 group">
                    <i class="fa-solid fa-arrow-left group-hover:-translate-x-1 transition-transform"></i> Voltar à Loja
                </a>
            </div>
        </aside>

        <!-- OVERLAY -->
        <div v-if="sidebarOpen" @click="sidebarOpen = false"
            class="fixed inset-0 bg-black/80 z-20 md:hidden backdrop-blur-sm"></div>

        <!-- MAIN KANBAN -->
        <main class="flex-1 h-full flex flex-col bg-slate-950 relative w-full overflow-hidden">

            <!-- MOBILE HEADER -->
            <header
                class="md:hidden h-16 bg-slate-900 border-b border-slate-800 flex items-center justify-between px-4 z-20 shrink-0">
                <div class="flex items-center gap-2">
                    <div class="w-8 h-8 bg-orange-500 rounded-lg flex items-center justify-center text-slate-900">
                        <i class="fa-solid fa-fire-burner text-xs"></i>
                    </div>
                    <!-- Time in mobile header -->
                    <span class="font-mono font-bold text-white">{{ currentTime }}</span>
                </div>
                <button @click="sidebarOpen = !sidebarOpen"
                    class="w-10 h-10 flex items-center justify-center text-slate-400 hover:bg-slate-800 rounded-lg transition">
                    <i class="fa-solid fa-bars text-xl"></i>
                </button>
            </header>

            <!-- KANBAN BOARD -->
            <div class="flex-1 overflow-x-auto overflow-y-hidden p-4 md:p-6">
                <div class="flex h-full gap-4 md:gap-6 min-w-[900px]">

                    <!-- COL: A FAZER -->
                    <div
                        class="flex-1 flex flex-col bg-slate-900/50 border border-slate-800 rounded-2xl overflow-hidden">
                        <div
                            class="p-4 border-b border-slate-800 flex justify-between items-center bg-slate-900/80 backdrop-blur">
                            <h2 class="font-bold text-red-500 flex items-center gap-2">
                                <i class="fa-solid fa-receipt"></i> A Fazer
                            </h2>
                            <span
                                class="bg-red-500/10 text-red-500 px-2 py-0.5 rounded text-xs font-bold border border-red-500/20">
                                {{ orders.filter(o => o.status === 'todo').length }}
                            </span>
                        </div>
                        <div class="flex-1 overflow-y-auto p-3 space-y-3 custom-scrollbar">
                            <transition-group name="list">
                                <div v-for="order in orders.filter(o => o.status === 'todo')" :key="order.id"
                                    class="bg-slate-800 rounded-xl p-4 border-l-4 border-red-500 shadow-lg group hover:bg-slate-750 transition relative">
                                    <div class="flex justify-between items-start mb-3">
                                        <div class="flex flex-col">
                                            <span class="font-bold text-xl text-white">#{{ order.id }}</span>
                                            <span class="text-[10px] text-slate-500 font-mono">Chegou: {{ order.time
                                                }}</span>
                                        </div>
                                        <div
                                            class="flex items-center gap-1 text-red-400 font-mono font-bold bg-red-950/30 px-2 py-1 rounded">
                                            <i class="fa-regular fa-clock text-xs"></i>
                                            {{ getTimer(order) }}
                                        </div>
                                    </div>
                                    <ul class="text-slate-300 text-sm space-y-1 mb-4 font-medium pl-1">
                                        <li v-for="item in order.items" class="flex items-start gap-2">
                                            <span class="text-slate-500 text-xs mt-1">1x</span> {{ item }}
                                        </li>
                                    </ul>
                                    <button @click="setStatus(order, 'prep')"
                                        class="w-full bg-slate-700 hover:bg-yellow-600 hover:text-white text-slate-300 py-2 rounded-lg font-bold text-sm transition flex items-center justify-center gap-2">
                                        Iniciar Preparo <i class="fa-solid fa-arrow-right"></i>
                                    </button>
                                </div>
                            </transition-group>
                        </div>
                    </div>

                    <!-- COL: PREPARANDO -->
                    <div
                        class="flex-1 flex flex-col bg-slate-900/50 border border-slate-800 rounded-2xl overflow-hidden">
                        <div
                            class="p-4 border-b border-slate-800 flex justify-between items-center bg-slate-900/80 backdrop-blur">
                            <h2 class="font-bold text-yellow-500 flex items-center gap-2">
                                <i class="fa-solid fa-fire animate-pulse"></i> Preparando
                            </h2>
                            <span
                                class="bg-yellow-500/10 text-yellow-500 px-2 py-0.5 rounded text-xs font-bold border border-yellow-500/20">
                                {{ orders.filter(o => o.status === 'prep').length }}
                            </span>
                        </div>
                        <div class="flex-1 overflow-y-auto p-3 space-y-3 custom-scrollbar">
                            <transition-group name="list">
                                <div v-for="order in orders.filter(o => o.status === 'prep')" :key="order.id"
                                    class="bg-slate-800 rounded-xl p-4 border-l-4 border-yellow-500 shadow-lg ring-1 ring-yellow-500/20">
                                    <div class="flex justify-between items-start mb-3">
                                        <div class="flex flex-col">
                                            <span class="font-bold text-xl text-white">#{{ order.id }}</span>
                                        </div>
                                        <div
                                            class="flex items-center gap-1 text-yellow-500 font-mono font-bold bg-yellow-950/30 px-2 py-1 rounded animate-pulse">
                                            <i class="fa-solid fa-stopwatch text-xs"></i>
                                            {{ getTimer(order) }}
                                        </div>
                                    </div>
                                    <ul class="text-white text-sm space-y-1 mb-4 font-medium pl-1">
                                        <li v-for="item in order.items" class="flex items-start gap-2">
                                            <i class="fa-solid fa-check text-[10px] mt-1 text-yellow-500"></i> {{ item
                                            }}
                                        </li>
                                    </ul>
                                    <button @click="setStatus(order, 'ready')"
                                        class="w-full bg-green-600 hover:bg-green-500 text-white py-2 rounded-lg font-bold text-sm transition shadow-lg shadow-green-600/20 flex items-center justify-center gap-2">
                                        <i class="fa-solid fa-check"></i> PRONTO
                                    </button>
                                </div>
                            </transition-group>
                        </div>
                    </div>

                    <!-- COL: PRONTO -->
                    <div
                        class="flex-1 flex flex-col bg-slate-900/50 border border-slate-800 rounded-2xl overflow-hidden">
                        <div
                            class="p-4 border-b border-slate-800 flex justify-between items-center bg-slate-900/80 backdrop-blur">
                            <h2 class="font-bold text-green-500 flex items-center gap-2">
                                <i class="fa-solid fa-bell-concierge"></i> Pronto / Entregar
                            </h2>
                            <span
                                class="bg-green-500/10 text-green-500 px-2 py-0.5 rounded text-xs font-bold border border-green-500/20">
                                {{ orders.filter(o => o.status === 'ready').length }}
                            </span>
                        </div>
                        <div class="flex-1 overflow-y-auto p-3 space-y-3 custom-scrollbar">
                            <transition-group name="list">
                                <div v-for="order in orders.filter(o => o.status === 'ready')" :key="order.id"
                                    class="bg-slate-800/80 rounded-xl p-4 border-l-4 border-green-500 shadow-lg opacity-90 hover:opacity-100 transition">
                                    <div class="flex justify-between items-start mb-2">
                                        <span class="font-bold text-xl text-green-400">#{{ order.id }}</span>
                                        <span
                                            class="text-[10px] bg-green-500/20 text-green-400 px-2 py-0.5 rounded font-bold uppercase">Aguardando</span>
                                    </div>
                                    <ul class="text-slate-400 text-sm space-y-1 mb-3 pl-1">
                                        <li v-for="item in order.items">{{ item }}</li>
                                    </ul>
                                    <div class="flex justify-between items-center pt-3 border-t border-slate-700">
                                        <span class="text-xs text-slate-500 font-mono">Total: {{ order.finishTime ||
                                            '00:00' }}</span>
                                        <button @click="archiveOrder(order.id)"
                                            class="text-xs text-slate-400 hover:text-white flex items-center gap-1 transition">
                                            <i class="fa-solid fa-box-archive"></i> Arquivar
                                        </button>
                                    </div>
                                </div>
                            </transition-group>
                        </div>
                    </div>

                </div>
            </div>

        </main>
    </div>

    <style>
        .list-enter-active,
        .list-leave-active {
            transition: all 0.4s ease;
        }

        .list-enter-from,
        .list-leave-to {
            opacity: 0;
            transform: translateY(20px);
        }
    </style>

    <script>
        const { createApp, ref, computed, onMounted, onUnmounted, watch } = Vue;

        createApp({
            setup() {
                const sidebarOpen = ref(false);
                const currentTime = ref('');
                const now = ref(Date.now());

                // Sample Data
                const orders = ref([
                    { id: 101, time: '12:00', startTimestamp: Date.now() - 300000, status: 'prep', items: ['Hamburguer Duplo', 'Batata Frita'] },
                    { id: 102, time: '12:05', startTimestamp: Date.now() - 60000, status: 'todo', items: ['Coca-Cola', 'X-Salada'] }
                ]);

                // Timer
                const interval = setInterval(() => {
                    now.value = Date.now();
                    currentTime.value = new Date().toLocaleTimeString().slice(0, 5);
                }, 1000);
                onUnmounted(() => clearInterval(interval));

                const getTimer = (order) => {
                    if (order.finishTime) return order.finishTime;
                    // Prevent negative if system time changes weirdly, mostly for demo safety
                    const diff = Math.max(0, Math.floor((now.value - order.startTimestamp) / 1000));
                    const m = Math.floor(diff / 60).toString().padStart(2, '0');
                    const s = (diff % 60).toString().padStart(2, '0');
                    return `${m}:${s}`;
                };

                const getPercentage = (status) => {
                    const total = orders.value.length;
                    if (total === 0) return 0;
                    return (orders.value.filter(o => o.status === status).length / total) * 100;
                };

                const newOrder = () => {
                    const id = orders.value.length > 0 ? Math.max(...orders.value.map(o => o.id)) + 1 : 100;
                    const itemsOpts = ['Cheeseburger', 'Bacon Blast', 'Fritas Grande', 'Onion Rings', 'Milkshake Choc', 'Suco Laranja', 'Combo Família'];
                    const count = Math.ceil(Math.random() * 3);
                    const randomItems = [];
                    for (let i = 0; i < count; i++) randomItems.push(itemsOpts[Math.floor(Math.random() * itemsOpts.length)]);

                    orders.value.push({
                        id: id,
                        time: new Date().toLocaleTimeString().slice(0, 5),
                        startTimestamp: Date.now(),
                        status: 'todo',
                        items: randomItems
                    });
                    // Scroll effect via animation handles itself
                };

                const setStatus = (order, status) => {
                    order.status = status;
                    if (status === 'ready') {
                        const diff = Math.floor((Date.now() - order.startTimestamp) / 1000);
                        const m = Math.floor(diff / 60).toString().padStart(2, '0');
                        const s = (diff % 60).toString().padStart(2, '0');
                        order.finishTime = `${m}:${s}`;
                    }
                };

                const archiveOrder = (id) => {
                    // Could confirm here? nah, speed is key in KDS
                    orders.value = orders.value.filter(o => o.id !== id);
                };

                // Persistence
                onMounted(() => {
                    const d = localStorage.getItem('plena_kds_v2');
                    if (d) {
                        try {
                            const parsed = JSON.parse(d);
                            // Adjust startTimestamp to resume relative timing?
                            // For simplicity in this demo, we assume relatively fresh data or reset.
                            // Ideally KDS connects to backend. Here we just load.
                            orders.value = parsed;
                        } catch (e) { }
                    }
                });

                watch(orders, () => {
                    localStorage.setItem('plena_kds_v2', JSON.stringify(orders.value));
                }, { deep: true });

                return {
                    sidebarOpen, currentTime, orders,
                    getTimer, newOrder, setStatus, archiveOrder, getPercentage
                };
            }
        }).mount('#app');
    </script>
</body>

</html>