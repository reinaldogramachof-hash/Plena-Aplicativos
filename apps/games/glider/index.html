<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sky Glider | Plena Apps</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            background-color: #0f172a;
            touch-action: none;
            overflow: hidden;
            user-select: none;
        }

        canvas {
            box-shadow: 0 0 20px rgba(56, 189, 248, 0.2);
        }
    </style>
</head>

<body class="h-screen w-screen flex flex-col items-center justify-center relative">

    <!-- UI LAYER -->
    <div class="absolute top-4 w-full px-6 flex justify-between items-center text-white pointer-events-none z-10">
        <div>
            <h1 class="font-bold italic text-sky-400 text-2xl drop-shadow">SKY GLIDER</h1>
            <p class="text-xs text-sky-200">Toque para voar</p>
        </div>
        <div class="text-right">
            <p class="text-xs text-gray-400 uppercase">Score</p>
            <p id="score" class="text-4xl font-black font-mono">0</p>
        </div>
    </div>

    <!-- GAME OVER SCREEN -->
    <div id="gameOver" class="absolute inset-0 bg-black/80 flex flex-col items-center justify-center z-20 hidden">
        <h2 class="text-5xl font-black text-red-500 mb-2 italic transform -skew-x-12">GAME OVER</h2>
        <p class="text-white text-xl mb-6">Score Final: <span id="finalScore" class="font-bold text-yellow-400">0</span>
        </p>

        <p class="text-gray-400 text-sm mb-2">High Score: <span id="highScore">0</span></p>

        <button onclick="startGame()"
            class="bg-sky-500 hover:bg-sky-400 text-white px-8 py-3 rounded-full font-bold shadow-lg transform transition hover:scale-110 mb-4">
            <i class="fa-solid fa-play mr-2"></i> Tentar Novamente
        </button>

        <button onclick="shareScore()" class="text-green-400 font-bold hover:text-green-300">
            <i class="fa-brands fa-whatsapp"></i> Compartilhar
        </button>
    </div>

    <!-- CANVAS -->
    <canvas id="gameCanvas" class="bg-gray-900 rounded-lg border-2 border-gray-800"></canvas>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const scoreEl = document.getElementById('score');
        const finalScoreEl = document.getElementById('finalScore');
        const highScoreEl = document.getElementById('highScore');
        const gameOverEl = document.getElementById('gameOver');

        // Resize
        function resize() {
            canvas.width = Math.min(window.innerWidth - 20, 600);
            canvas.height = Math.min(window.innerHeight - 20, 800);
        }
        window.addEventListener('resize', resize);
        resize();

        // Game State
        let isPlaying = false;
        let score = 0;
        let frames = 0;
        let speed = 3;

        // Player
        const player = {
            x: 50, y: 0, w: 30, h: 30, dy: 0,
            draw() {
                ctx.fillStyle = '#38bdf8'; // Sky blue
                ctx.beginPath();
                ctx.roundRect(this.x, this.y, this.w, this.h, 5);
                ctx.fill();
                // Tail effect
                ctx.fillStyle = 'rgba(56, 189, 248, 0.3)';
                ctx.fillRect(this.x - 10, this.y + 5, 10, 20);
            },
            update() {
                this.dy += 0.5; // Gravity
                this.y += this.dy;
                // Boundaries
                if (this.y + this.h > canvas.height) { endGame(); }
                if (this.y < 0) { this.y = 0; this.dy = 0; }
            },
            jump() {
                this.dy = -8;
            }
        };

        // Obstacles
        let obstacles = [];
        class Obstacle {
            constructor() {
                this.w = 50;
                this.gap = 180; // Size of gap
                // Random position for the gap
                this.topH = Math.random() * (canvas.height - this.gap - 100) + 50;
                this.x = canvas.width;
                this.passed = false;
            }
            draw() {
                ctx.fillStyle = '#ef4444'; // Red
                // Top part
                ctx.roundRect(this.x, 0, this.w, this.topH, 0);
                // Bottom part
                ctx.roundRect(this.x, this.topH + this.gap, this.w, canvas.height - (this.topH + this.gap), 0);
                ctx.fill();
            }
            update() {
                this.x -= speed;

                // Collision
                if (
                    player.x < this.x + this.w &&
                    player.x + player.w > this.x &&
                    (player.y < this.topH || player.y + player.h > this.topH + this.gap)
                ) {
                    endGame();
                }

                // Score
                if (this.x + this.w < player.x && !this.passed) {
                    score++;
                    scoreEl.innerText = score;
                    this.passed = true;
                    if (score % 5 === 0) speed += 0.5; // Difficulty
                }
            }
        }

        function loop() {
            if (!isPlaying) return;

            // Update
            player.update();

            // Add obstacle
            if (frames % 120 === 0) { // Every ~2 seconds
                obstacles.push(new Obstacle());
            }

            // Draw BG
            ctx.fillStyle = '#111827';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Draw Pipes
            obstacles.forEach((ob, i) => {
                ob.update();
                ob.draw();
                if (ob.x + ob.w < 0) obstacles.splice(i, 1);
            });

            // Draw Player
            player.draw();

            frames++;
            requestAnimationFrame(loop);
        }

        function startGame() {
            // Reset
            player.y = canvas.height / 2;
            player.dy = 0;
            obstacles = [];
            score = 0;
            frames = 0;
            speed = 3;
            isPlaying = true;
            scoreEl.innerText = '0';
            gameOverEl.classList.add('hidden');
            loop();
        }

        function endGame() {
            isPlaying = false;
            finalScoreEl.innerText = score;

            let hs = localStorage.getItem('sky_highscore') || 0;
            if (score > hs) {
                hs = score;
                localStorage.setItem('sky_highscore', hs);
            }
            highScoreEl.innerText = hs;

            gameOverEl.classList.remove('hidden');
        }

        // Controls
        window.addEventListener('keydown', (e) => {
            if (e.code === 'Space') {
                if (!isPlaying && gameOverEl.classList.contains('hidden')) startGame(); // Initial start
                else player.jump();
            }
        });
        window.addEventListener('touchstart', onTouch);
        window.addEventListener('mousedown', onTouch);

        function onTouch(e) {
            e.preventDefault();
            if (!isPlaying && gameOverEl.classList.contains('hidden')) startGame();
            else if (isPlaying) player.jump();
        }

        function shareScore() {
            let hs = localStorage.getItem('sky_highscore') || 0;
            const text = `ðŸš€ *Sky Glider*\n\nFiz ${score} pontos!\nMeu Recorde: ${hs}\n\nConsegue me vencer?`;
            window.open(`https://wa.me/?text=${encodeURIComponent(text)}`, '_blank');
        }

        // Init Highscore display
        highScoreEl.innerText = localStorage.getItem('sky_highscore') || 0;

    </script>
</body>

</html>