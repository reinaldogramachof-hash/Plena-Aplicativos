<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Gerador de Holerite | Plena Aplicativos</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Courier+Prime:wght@400;700&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        mono: ['Courier Prime', 'monospace']
                    },
                    colors: {
                        slate: { 850: '#151e2e' }
                    }
                }
            }
        }
    </script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f1f5f9;
            -webkit-print-color-adjust: exact;
        }

        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }

        @media print {
            body {
                background: white;
            }

            .no-print {
                display: none !important;
            }

            .print-only {
                display: block !important;
            }

            .page-break {
                page-break-after: always;
            }

            #preview-container {
                box-shadow: none;
                border: none;
                width: 100%;
                max-width: none;
            }
        }
    </style>
</head>

<body class="h-screen overflow-hidden flex flex-col md:flex-row text-slate-800">

    <div id="app" class="flex-1 flex h-full w-full relative">

        <!-- Sidebar Editor -->
        <aside
            class="w-full md:w-[450px] bg-white border-r border-slate-200 z-10 flex flex-col h-full shadow-xl no-print">
            <div class="p-6 border-b border-slate-100 flex items-center gap-3 bg-slate-50">
                <div
                    class="w-10 h-10 bg-blue-600 rounded-xl flex items-center justify-center text-white shadow-lg shadow-blue-600/30">
                    <i class="fa-solid fa-file-invoice-dollar text-lg"></i>
                </div>
                <div>
                    <h1 class="font-bold text-xl text-slate-800 tracking-tight">Holerite <span
                            class="text-blue-600">Fácil</span></h1>
                    <p class="text-xs text-slate-400">Emissor de Recibos</p>
                </div>
                <!-- Mini Menu -->
                <div class="ml-auto relative group">
                    <button class="text-slate-400 hover:text-blue-600 p-2"><i
                            class="fa-solid fa-ellipsis-v"></i></button>
                    <div
                        class="absolute right-0 top-8 bg-white border rounded-lg shadow-xl hidden group-hover:block z-50 w-40">
                        <button @click="resetForm"
                            class="w-full text-left px-4 py-3 text-xs font-bold text-red-500 hover:bg-slate-50">Novo
                            Holerite</button>
                        <button @click="backupData"
                            class="w-full text-left px-4 py-3 text-xs font-bold text-slate-600 hover:bg-slate-50">Backup
                            Dados</button>
                        <label
                            class="w-full text-left px-4 py-3 text-xs font-bold text-slate-600 hover:bg-slate-50 block cursor-pointer">
                            Restaurar <input type="file" class="hidden" @change="importData">
                        </label>
                    </div>
                </div>
            </div>

            <div class="flex-1 overflow-y-auto p-6 space-y-6">

                <!-- Section 1: Header Info -->
                <div class="space-y-4">
                    <h3 class="text-xs font-bold text-slate-400 uppercase tracking-wider flex items-center gap-2">
                        <i class="fa-solid fa-building"></i> Dados da Empresa e Funcionário
                    </h3>
                    <div class="grid grid-cols-2 gap-3">
                        <div class="col-span-2">
                            <label class="label">Empresa / Empregador</label>
                            <input v-model="form.company" class="input" placeholder="Nome da Empresa LTDA">
                        </div>
                        <div class="col-span-1">
                            <label class="label">CNPJ</label>
                            <input v-model="form.cnpj" class="input" placeholder="00.000.000/0000-00">
                        </div>
                        <div class="col-span-1">
                            <label class="label">Mês Referência</label>
                            <input v-model="form.reference" type="month" class="input">
                        </div>
                        <div class="col-span-2">
                            <label class="label">Funcionário</label>
                            <input v-model="form.employee" class="input" placeholder="Nome Completo">
                        </div>
                        <div class="col-span-1">
                            <label class="label">Cargo</label>
                            <input v-model="form.role" class="input" placeholder="Ex: Vendedor">
                        </div>
                        <div class="col-span-1">
                            <label class="label">Data Pagto</label>
                            <input v-model="form.payDate" type="date" class="input">
                        </div>
                    </div>
                </div>

                <!-- Section 2: Earnings -->
                <div class="space-y-4">
                    <div class="flex justify-between items-center">
                        <h3 class="text-xs font-bold text-green-600 uppercase tracking-wider flex items-center gap-2">
                            <i class="fa-solid fa-plus-circle"></i> Vencimentos (Créditos)
                        </h3>
                        <button @click="addEarning"
                            class="text-xs bg-green-50 text-green-600 border border-green-200 px-2 py-1 rounded hover:bg-green-100 font-bold">+
                            Add</button>
                    </div>
                    <div class="space-y-2">
                        <div v-for="(item, idx) in form.earnings" :key="'e'+idx" class="flex gap-2">
                            <input v-model="item.desc" class="input flex-1" placeholder="Descrição (Ex: Salário Base)">
                            <div class="relative w-24 md:w-32">
                                <span class="absolute left-3 top-2.5 text-xs text-slate-400">R$</span>
                                <input v-model.number="item.value" type="number" step="0.01"
                                    class="input pl-8 text-right font-mono text-green-700">
                            </div>
                            <button @click="form.earnings.splice(idx, 1)"
                                class="text-slate-300 hover:text-red-500 px-1"><i
                                    class="fa-solid fa-times"></i></button>
                        </div>
                    </div>
                </div>

                <!-- Section 3: Deductions -->
                <div class="space-y-4">
                    <div class="flex justify-between items-center">
                        <h3 class="text-xs font-bold text-red-500 uppercase tracking-wider flex items-center gap-2">
                            <i class="fa-solid fa-minus-circle"></i> Descontos (Débitos)
                        </h3>
                        <button @click="addDeduction"
                            class="text-xs bg-red-50 text-red-500 border border-red-200 px-2 py-1 rounded hover:bg-red-100 font-bold">+
                            Add</button>
                    </div>
                    <div class="space-y-2">
                        <div v-for="(item, idx) in form.deductions" :key="'d'+idx" class="flex gap-2">
                            <input v-model="item.desc" class="input flex-1" placeholder="Descrição (Ex: INSS, Vale)">
                            <div class="relative w-24 md:w-32">
                                <span class="absolute left-3 top-2.5 text-xs text-slate-400">R$</span>
                                <input v-model.number="item.value" type="number" step="0.01"
                                    class="input pl-8 text-right font-mono text-red-700">
                            </div>
                            <button @click="form.deductions.splice(idx, 1)"
                                class="text-slate-300 hover:text-red-500 px-1"><i
                                    class="fa-solid fa-times"></i></button>
                        </div>
                    </div>

                    <!-- Quick Tax Calc Helper (Optional) -->
                    <div class="bg-blue-50 p-3 rounded-lg border border-blue-100">
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-[10px] font-bold text-blue-800 uppercase">Calculadora Rápida (Est.)</span>
                        </div>
                        <div class="flex gap-2 text-xs">
                            <button @click="calcINSS"
                                class="bg-white border border-blue-200 text-blue-600 px-2 py-1 rounded hover:bg-blue-100">Calc.
                                INSS</button>
                            <button @click="calcVT"
                                class="bg-white border border-blue-200 text-blue-600 px-2 py-1 rounded hover:bg-blue-100">VT
                                (6%)</button>
                        </div>
                    </div>
                </div>

            </div>

            <div class="p-6 border-t border-slate-200 bg-white shadow-[0_-5px_15px_rgba(0,0,0,0.05)] z-20">
                <button @click="printStub"
                    class="w-full bg-slate-850 hover:bg-slate-700 text-white font-bold py-4 rounded-xl shadow-lg transition flex items-center justify-center gap-2">
                    <i class="fa-solid fa-print"></i> Imprimir / Salvar PDF
                </button>
            </div>
        </aside>

        <!-- Preview Area -->
        <main class="flex-1 bg-slate-100 flex items-center justify-center p-8 overflow-y-auto">

            <!-- Pay Stub Visual -->
            <div id="preview-container"
                class="bg-white w-full max-w-[210mm] min-h-[148mm] shadow-2xl p-8 border border-slate-200 font-mono text-sm relative">

                <!-- Border Frame -->
                <div class="border-2 border-slate-800 h-full p-1">
                    <div class="border border-slate-800 h-full flex flex-col">

                        <!-- Header -->
                        <div class="border-b border-slate-800 p-4 flex justify-between items-start">
                            <div>
                                <h1 class="font-bold text-xl uppercase mb-1">{{ form.company || 'NOME DA EMPRESA' }}
                                </h1>
                                <p class="text-xs">{{ form.cnpj ? `CNPJ: ${form.cnpj}` : 'CNPJ: 00.000.000/0000-00' }}
                                </p>
                            </div>
                            <div class="text-right">
                                <h2
                                    class="font-bold border border-slate-800 px-4 py-1 inline-block uppercase bg-slate-50">
                                    Recibo de Pagamento</h2>
                                <p class="text-xs mt-2">Referência: <span class="font-bold">{{
                                        formatMonth(form.reference) }}</span></p>
                            </div>
                        </div>

                        <!-- Employee Info -->
                        <div
                            class="border-b border-slate-800 p-2 grid grid-cols-12 gap-2 text-xs uppercase bg-slate-50">
                            <div class="col-span-2 font-bold border-r border-slate-300 pr-2">Cód.<br>001</div>
                            <div class="col-span-6 border-r border-slate-300 pr-2">Funcionário<br><span
                                    class="font-bold text-sm">{{ form.employee || 'NOME DO FUNCIONÁRIO' }}</span></div>
                            <div class="col-span-4">Cargo<br><span class="font-bold">{{ form.role || 'CARGO' }}</span>
                            </div>
                        </div>

                        <!-- Table Header -->
                        <div
                            class="grid grid-cols-12 gap-2 border-b border-slate-800 px-2 py-1 text-xs font-bold uppercase bg-slate-100">
                            <div class="col-span-2">Cód.</div>
                            <div class="col-span-5">Descrição</div>
                            <div class="col-span-1 text-center">Ref.</div>
                            <div class="col-span-2 text-right">Vencimentos</div>
                            <div class="col-span-2 text-right">Descontos</div>
                        </div>

                        <!-- Table Rows -->
                        <div class="flex-1 p-2 space-y-1">
                            <!-- Earnings -->
                            <div v-for="(item, idx) in form.earnings" :key="'ve'+idx"
                                class="grid grid-cols-12 gap-2 text-xs">
                                <div class="col-span-2 text-slate-500">{{ 101 + idx }}</div>
                                <div class="col-span-5 uppercase">{{ item.desc }}</div>
                                <div class="col-span-1 text-center text-slate-500"></div>
                                <div class="col-span-2 text-right">{{ formatCurrency(item.value) }}</div>
                                <div class="col-span-2 text-right"></div>
                            </div>
                            <!-- Deductions -->
                            <div v-for="(item, idx) in form.deductions" :key="'vd'+idx"
                                class="grid grid-cols-12 gap-2 text-xs">
                                <div class="col-span-2 text-slate-500">{{ 501 + idx }}</div>
                                <div class="col-span-5 uppercase">{{ item.desc }}</div>
                                <div class="col-span-1 text-center text-slate-500"></div>
                                <div class="col-span-2 text-right"></div>
                                <div class="col-span-2 text-right">{{ formatCurrency(item.value) }}</div>
                            </div>
                        </div>

                        <!-- Totals -->
                        <div
                            class="border-t border-slate-800 grid grid-cols-12 text-xs font-bold divide-x divide-slate-800 h-16 items-center bg-slate-50">
                            <div class="col-span-8 p-2 flex flex-col justify-center h-full">
                                <span class="uppercase text-[10px] text-slate-500">Mensagem</span>
                                <span class="uppercase italic text-slate-400 font-normal scale-90 origin-left">Depósito
                                    em C/C: {{ formatDate(form.payDate) }}</span>
                            </div>
                            <div class="col-span-2 p-2 text-right flex flex-col justify-center h-full">
                                <span class="uppercase text-[10px] text-slate-500">Total Vencimentos</span>
                                <span>{{ formatCurrency(totals.earnings) }}</span>
                            </div>
                            <div class="col-span-2 p-2 text-right flex flex-col justify-center h-full">
                                <span class="uppercase text-[10px] text-slate-500">Total Descontos</span>
                                <span>{{ formatCurrency(totals.deductions) }}</span>
                            </div>
                        </div>

                        <!-- Net Pay -->
                        <div class="border-t border-slate-800 grid grid-cols-12 items-center bg-slate-200">
                            <div class="col-span-8 p-2 text-[10px] uppercase">
                                Declaro ter recebido a importância líquida discriminada neste recibo.
                            </div>
                            <div
                                class="col-span-2 border-l border-slate-500 p-2 text-right uppercase text-[10px] font-bold">
                                Valor Líquido ➔
                            </div>
                            <div
                                class="col-span-2 border-l border-slate-500 p-2 text-right font-black text-sm bg-slate-300">
                                {{ formatCurrency(totals.net) }}
                            </div>
                        </div>

                        <!-- Footer Signatures -->
                        <div class="p-6 mt-4 flex justify-between items-end gap-10">
                            <div class="flex-1 border-t border-slate-800 pt-1 text-center">
                                <p class="text-[10px] uppercase font-bold">{{ formatDate(form.payDate) || 'DATA' }}</p>
                                <p class="text-[10px] uppercase">Data</p>
                            </div>
                            <div class="flex-[2] border-t border-slate-800 pt-1 text-center">
                                <p class="text-[10px] uppercase font-bold">{{ form.employee || 'ASSINATURA' }}</p>
                                <p class="text-[10px] uppercase">Assinatura do Funcionário</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Watermark -->
                <div
                    class="absolute inset-0 flex items-center justify-center opacity-5 pointer-events-none select-none">
                    <span class="text-6xl font-black uppercase -rotate-45">Modelo Demonstrativo</span>
                </div>

            </div>
        </main>

    </div>

    <style>
        .label {
            display: block;
            font-size: 0.70rem;
            font-weight: 700;
            color: #64748b;
            text-transform: uppercase;
            margin-bottom: 0.25rem;
        }

        .input {
            width: 100%;
            padding: 0.5rem 0.75rem;
            border-radius: 0.5rem;
            border: 1px solid #e2e8f0;
            outline: none;
            transition: all;
            background: #f8fafc;
            font-size: 0.85rem;
            font-weight: 500;
        }

        .input:focus {
            border-color: #3b82f6;
            background: #fff;
            ring: 1px solid #3b82f6;
        }
    </style>

    <script>
        const { createApp, ref, computed, onMounted, watch } = Vue;
        const DB_KEY = 'plena_holerite_v1';

        createApp({
            setup() {
                const form = ref({
                    company: '', cnpj: '', reference: new Date().toISOString().substring(0, 7), employee: '', role: '', payDate: new Date().toISOString().substring(0, 10),
                    earnings: [{ desc: 'Salário Base', value: 1412.00 }],
                    deductions: []
                });

                // Init
                onMounted(() => {
                    const d = localStorage.getItem(DB_KEY);
                    if (d) form.value = JSON.parse(d);
                });

                watch(form, () => {
                    localStorage.setItem(DB_KEY, JSON.stringify(form.value));
                }, { deep: true });

                // Computed Logic
                const totals = computed(() => {
                    const e = form.value.earnings.reduce((a, b) => a + (b.value || 0), 0);
                    const d = form.value.deductions.reduce((a, b) => a + (b.value || 0), 0);
                    return { earnings: e, deductions: d, net: e - d };
                });

                // Formatters
                const formatCurrency = (val) => {
                    return new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(val || 0);
                };
                const formatDate = (ds) => {
                    if (!ds) return '';
                    const [y, m, d] = ds.split('-');
                    return `${d}/${m}/${y}`;
                };
                const formatMonth = (ms) => {
                    if (!ms) return '';
                    const [y, m] = ms.split('-');
                    const date = new Date(y, m - 1);
                    return date.toLocaleString('pt-BR', { month: 'long', year: 'numeric' }).toUpperCase();
                };

                // Actions
                const addEarning = () => form.value.earnings.push({ desc: '', value: 0 });
                const addDeduction = () => form.value.deductions.push({ desc: '', value: 0 });

                const resetForm = () => {
                    if (confirm('Limpar formulário?')) {
                        form.value = {
                            company: '', cnpj: '', reference: '', employee: '', role: '', payDate: '',
                            earnings: [{ desc: 'Salário Base', value: 1412.00 }], deductions: []
                        };
                        form.value.reference = new Date().toISOString().substring(0, 7);
                        form.value.payDate = new Date().toISOString().substring(0, 10);
                    }
                };

                // Helper Calcs (Simple Approximations for Reference)
                // NOTE: These are simplified Brazilian labor laws for demonstration
                const calcINSS = () => {
                    const base = form.value.earnings.find(e => e.desc.toLowerCase().includes('salário') || e.desc.toLowerCase().includes('base'))?.value || totals.value.earnings;
                    let tax = 0;
                    // Tabela 2024 (Simplificada)
                    if (base <= 1412.00) tax = base * 0.075;
                    else if (base <= 2666.68) tax = (base * 0.09) - 21.18;
                    else if (base <= 4000.03) tax = (base * 0.12) - 101.18;
                    else if (base <= 7786.02) tax = (base * 0.14) - 181.18;
                    else tax = 7786.02 * 0.14 - 181.18; // Teto

                    form.value.deductions.push({ desc: 'INSS (Estimado)', value: parseFloat(tax.toFixed(2)) });
                };

                const calcVT = () => {
                    const base = form.value.earnings.find(e => e.desc.toLowerCase().includes('salário'))?.value || 0;
                    if (base > 0) form.value.deductions.push({ desc: 'Vale Transporte (6%)', value: parseFloat((base * 0.06).toFixed(2)) });
                };

                const printStub = () => {
                    window.print();
                };

                // Backup
                const backupData = () => {
                    const blob = new Blob([JSON.stringify(form.value)], { type: 'application/json' });
                    const a = document.createElement('a');
                    a.href = URL.createObjectURL(blob);
                    a.download = 'holerite_backup.json';
                    a.click();
                };
                const importData = (e) => {
                    const f = e.target.files[0];
                    if (!f) return;
                    const r = new FileReader();
                    r.onload = (ev) => {
                        form.value = JSON.parse(ev.target.result);
                    }
                    r.readAsText(f);
                };

                return {
                    form, totals,
                    formatCurrency, formatDate, formatMonth,
                    addEarning, addDeduction, resetForm, calcINSS, calcVT, printStub,
                    backupData, importData
                };
            }
        }).mount('#app');
    </script>
</body>

</html>