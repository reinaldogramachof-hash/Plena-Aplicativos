<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Plena Manager Basic - Gest√£o Simples</title>

    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#FF6600">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="description" content="Controle financeiro b√°sico para pequenos neg√≥cios - Plena Aplicativos">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        plena: { orange: '#FF6600', dark: '#cc5200', black: '#1a1a1a', blue: '#3B82F6', green: '#10B981', red: '#EF4444', yellow: '#F59E0B' },
                    }
                }
            }
        }
    </script>

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Upsell Lib -->
    <script src="../../../assets/js/plena_upsell.js"></script>

    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background-color: #F3F4F6;
            -webkit-tap-highlight-color: transparent;
        }

        .hide {
            display: none !important;
        }

        .fade-in {
            animation: fadeIn 0.3s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(5px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Bar Chart Styles */
        .chart-container {
            display: flex;
            align-items: flex-end;
            justify-content: space-between;
            height: 180px;
            gap: 2%;
        }

        .bar-group {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            height: 100%;
            position: relative;
        }

        .bar-wrapper {
            display: flex;
            align-items: flex-end;
            justify-content: center;
            gap: 2px;
            height: 100%;
            width: 100%;
        }

        .bar {
            width: 45%;
            border-radius: 6px 6px 0 0;
            min-height: 2px;
            position: relative;
        }

        .x-label {
            font-size: 10px;
            color: #666;
            text-align: center;
            margin-top: 8px;
            font-weight: 500;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 3px;
        }

        /* Locked Feature Style */
        .locked-feature {
            opacity: 0.6;
            position: relative;
            cursor: not-allowed;
        }

        .locked-feature::after {
            content: 'üîí Premium';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #1a1a1a;
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            pointer-events: none;
            z-index: 10;
        }

        .nav-item.locked i {
            color: #9CA3AF !important;
        }
    </style>
</head>

<body class="text-gray-800 antialiased">

    <!-- Overlay -->
    <div id="overlay" class="fixed inset-0 bg-black/50 hidden z-40 transition-opacity" onclick="toggleSidebar()"></div>

    <!-- Sidebar -->
    <aside id="sidebar"
        class="fixed inset-y-0 left-0 bg-[#1a1a1a] text-white w-72 transform -translate-x-full lg:translate-x-0 transition-transform duration-300 z-50 shadow-2xl flex flex-col">
        <div class="h-20 flex items-center px-6 bg-gradient-to-r from-plena-orange to-plena-dark">
            <i data-lucide="wallet" class="w-8 h-8 mr-3"></i>
            <div>
                <h1 class="text-xl font-bold tracking-tight">PLENA MANAGER</h1>
                <span
                    class="text-[10px] bg-white/20 px-2 py-0.5 rounded text-white font-bold uppercase tracking-wider">Basic</span>
            </div>
        </div>

        <nav class="p-4 space-y-2 flex-1 overflow-y-auto">
            <button onclick="router('dashboard')"
                class="nav-item w-full flex items-center px-4 py-3 rounded-xl hover:bg-white/10 transition-all group active-nav"
                id="nav-dashboard">
                <i data-lucide="layout-dashboard" class="w-5 h-5 mr-3 text-gray-400 group-hover:text-white"></i>
                Dashboard
            </button>
            <button onclick="router('transactions')"
                class="nav-item w-full flex items-center px-4 py-3 rounded-xl hover:bg-white/10 transition-all group"
                id="nav-transactions">
                <i data-lucide="arrow-right-left" class="w-5 h-5 mr-3 text-gray-400 group-hover:text-white"></i>
                Transa√ß√µes
            </button>
            <!-- LOCKED FEATURES -->
            <button onclick="router('reports')"
                class="nav-item w-full flex items-center px-4 py-3 rounded-xl hover:bg-white/5 transition-all group relative opacity-70"
                id="nav-reports">
                <i data-lucide="lock" class="w-5 h-5 mr-3 text-gray-500"></i>
                Relat√≥rios <span class="ml-auto text-[10px] bg-gray-700 px-1.5 py-0.5 rounded text-gray-300">PLUS</span>
            </button>
            <button onclick="router('settings')"
                class="nav-item w-full flex items-center px-4 py-3 rounded-xl hover:bg-white/10 transition-all group"
                id="nav-settings">
                <i data-lucide="settings" class="w-5 h-5 mr-3 text-gray-400 group-hover:text-white"></i>
                Configura√ß√µes
            </button>
            <button onclick="router('about')"
                class="nav-item w-full flex items-center px-4 py-3 rounded-xl hover:bg-white/10 transition-all group"
                id="nav-about">
                <i data-lucide="info" class="w-5 h-5 mr-3 text-gray-400 group-hover:text-white"></i>
                Sobre a Plena
            </button>
        </nav>

        <!-- UPSELL BANNER -->
        <div class="p-4">
            <div onclick="showUpsell()"
                class="bg-gradient-to-br from-gray-800 to-black p-4 rounded-xl border border-gray-700 cursor-pointer hover:border-plena-orange transition-colors group">
                <div class="flex items-center gap-3 mb-2">
                    <div class="w-8 h-8 rounded-full bg-plena-orange/20 flex items-center justify-center">
                        <i data-lucide="star" class="w-4 h-4 text-plena-orange"></i>
                    </div>
                    <div>
                        <p class="text-xs font-bold text-white group-hover:text-plena-orange transition-colors">Seja PRO
                        </p>
                        <p class="text-[10px] text-gray-400">Desbloqueie relat√≥rios</p>
                    </div>
                </div>
                <button
                    class="w-full py-1.5 bg-white/10 hover:bg-plena-orange text-white text-xs rounded-lg transition-colors font-medium">
                    Ver Planos
                </button>
            </div>
        </div>

        <div class="p-6 border-t border-white/10 text-center">
            <a href="../../../index.html"
                class="flex items-center justify-center gap-2 text-xs text-gray-400 hover:text-white transition-colors mb-4">
                <i data-lucide="arrow-left" class="w-3 h-3"></i> Voltar √† Loja
            </a>
            <p class="text-[10px] text-gray-600">Plena Solu√ß√µes Digitais &copy; 2025</p>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="lg:ml-72 min-h-screen flex flex-col">
        <!-- Header -->
        <header
            class="bg-white h-20 flex items-center justify-between px-4 lg:px-8 sticky top-0 z-30 shadow-sm border-b border-gray-100">
            <div class="flex items-center gap-4">
                <button onclick="toggleSidebar()" class="lg:hidden p-2 hover:bg-gray-100 rounded-lg text-gray-600">
                    <i data-lucide="menu" class="w-6 h-6"></i>
                </button>
                <h2 id="page-title" class="text-xl font-bold text-gray-800 hidden sm:block">Dashboard</h2>
            </div>

            <div class="flex items-center gap-2 sm:gap-3">
                <button onclick="openTransactionModal()"
                    class="flex items-center px-4 py-2.5 bg-plena-orange text-white rounded-lg text-sm font-bold hover:bg-plena-dark transition-all shadow-lg shadow-orange-200 active:scale-95">
                    <i data-lucide="plus" class="w-5 h-5 sm:mr-2"></i>
                    <span class="hidden sm:inline">Nova Transa√ß√£o</span>
                    <span class="sm:hidden">Novo</span>
                </button>
            </div>
        </header>

        <!-- Content Area -->
        <div class="p-4 lg:p-8 flex-1 overflow-y-auto">

            <!-- DASHBOARD -->
            <section id="view-dashboard" class="view-section fade-in">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100">
                        <p class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-1">Saldo Total</p>
                        <h3 id="dash-balance" class="text-3xl font-bold text-gray-900">R$ 0,00</h3>
                    </div>
                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100">
                        <p class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-1">Entradas (M√™s)</p>
                        <h3 id="dash-income" class="text-2xl font-bold text-green-600">+R$ 0,00</h3>
                    </div>
                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100">
                        <p class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-1">Sa√≠das (M√™s)</p>
                        <h3 id="dash-expense" class="text-2xl font-bold text-red-600">-R$ 0,00</h3>
                    </div>
                </div>

                <!-- Basic Chart (Simplified) -->
                <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100 mb-8">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="font-bold text-gray-800">FluxoRecente (7 Dias)</h3>
                        <span class="text-xs text-gray-400">Vers√£o Basic</span>
                    </div>
                    <div id="chart-area" class="chart-container"></div>
                </div>

                <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="font-bold text-gray-800">√öltimas Movimenta√ß√µes</h3>
                        <button onclick="router('transactions')" class="text-sm text-plena-orange hover:underline">Ver
                            todas</button>
                    </div>
                    <div id="recent-transactions" class="space-y-3"></div>
                </div>
            </section>

            <!-- TRANSACTIONS -->
            <section id="view-transactions" class="view-section hide fade-in">
                <div class="mb-6 flex justify-between items-center">
                    <h2 class="text-xl font-bold text-gray-800">Hist√≥rico</h2>
                    <button onclick="showUpsell()"
                        class="flex items-center gap-2 px-3 py-1.5 bg-gray-100 text-gray-500 rounded-lg text-xs hover:bg-gray-200">
                        <i data-lucide="lock" class="w-3 h-3"></i> Exportar CSV (Premium)
                    </button>
                </div>

                <div class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden">
                    <div class="overflow-x-auto">
                        <table class="w-full text-left">
                            <thead class="bg-gray-50 text-gray-500 text-xs uppercase">
                                <tr>
                                    <th class="px-6 py-3">Data</th>
                                    <th class="px-6 py-3">Descri√ß√£o</th>
                                    <th class="px-6 py-3">Valor</th>
                                    <th class="px-6 py-3 text-center">A√ß√µes</th>
                                </tr>
                            </thead>
                            <tbody id="trans-table-body" class="divide-y divide-gray-100 text-sm"></tbody>
                        </table>
                    </div>
                    <div id="empty-msg" class="hidden p-8 text-center text-gray-400">
                        Nenhuma transa√ß√£o encontrada.
                    </div>
                </div>
            </section>

            <!-- SETTINGS -->
            <section id="view-settings" class="view-section hide fade-in">
                <h2 class="text-xl font-bold text-gray-800 mb-6">Configura√ß√µes</h2>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100">
                        <h3 class="font-bold text-gray-800 mb-4">Categorias</h3>
                        <div id="cat-list" class="space-y-2 mb-4"></div>

                        <div class="p-4 bg-yellow-50 rounded-lg border border-yellow-100 text-sm text-yellow-800 mb-4">
                            <i data-lucide="alert-circle" class="w-4 h-4 inline mr-1"></i>
                            Vers√£o Basic limitada a 3 categorias personalizadas.
                        </div>

                        <div class="flex gap-2">
                            <input type="text" id="new-cat-name" placeholder="Nova Categoria"
                                class="border p-2 rounded-lg text-sm flex-1">
                            <button onclick="addCategory()"
                                class="bg-gray-800 text-white px-4 rounded-lg text-sm font-bold">Adicionar</button>
                        </div>
                    </div>

                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100">
                        <h3 class="font-bold text-gray-800 mb-4">Dados</h3>
                        <p class="text-sm text-gray-600 mb-4">Seus dados s√£o salvos no navegador.</p>
                        <button onclick="clearAllTransactions()"
                            class="w-full py-2 border border-red-200 text-red-600 rounded-lg text-sm hover:bg-red-50">
                            Apagar Tudo (Reset)
                        </button>
                    </div>
                </div>
            </section>

            <!-- ABOUT View -->
            <section id="view-about" class="view-section hide fade-in">
                <div class="max-w-2xl mx-auto bg-white p-8 rounded-2xl shadow-sm border border-gray-100 text-center">
                    <h2 class="text-2xl font-bold text-gray-800 mb-2">Sobre a Plena</h2>
                    <p class="text-gray-600 mb-6">Solu√ß√µes digitais para quem empreende.</p>
                    <a href="mailto:tecnologia@plenainformatica.com.br"
                        class="text-plena-orange font-bold hover:underline block mb-2">tecnologia@plenainformatica.com.br</a>
                    <a href="https://www.plenaaplicativos.com.br" target="_blank"
                        class="text-gray-500 text-sm hover:underline">www.plenaaplicativos.com.br</a>
                </div>
            </section>

        </div>
    </main>

    <!-- Transaction Modal -->
    <div id="transactionModal"
        class="fixed inset-0 bg-black/50 hidden z-50 flex items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md p-6">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-lg font-bold text-gray-800">Nova Transa√ß√£o</h3>
                <button onclick="closeModal('transactionModal')" class="text-gray-400 hover:text-gray-600"><i
                        data-lucide="x"></i></button>
            </div>
            <form onsubmit="submitTransaction(event)" class="space-y-4">
                <input type="hidden" id="t-id">
                <div class="grid grid-cols-2 gap-3 p-1 bg-gray-100 rounded-lg">
                    <label class="cursor-pointer text-center"><input type="radio" name="t-type" value="income"
                            class="peer hidden">
                        <div
                            class="py-2 text-sm font-bold text-gray-500 rounded-md peer-checked:bg-white peer-checked:text-green-600 shadow-sm">
                            Receita</div>
                    </label>
                    <label class="cursor-pointer text-center"><input type="radio" name="t-type" value="expense"
                            class="peer hidden" checked>
                        <div
                            class="py-2 text-sm font-bold text-gray-500 rounded-md peer-checked:bg-white peer-checked:text-red-600 shadow-sm">
                            Despesa</div>
                    </label>
                </div>
                <input type="number" id="t-amount" step="0.01" required
                    class="w-full border-2 border-gray-200 p-3 rounded-xl text-lg font-bold outline-none focus:border-plena-orange"
                    placeholder="R$ 0,00">
                <input type="text" id="t-desc" required class="w-full border p-2 rounded-lg text-sm"
                    placeholder="Descri√ß√£o">
                <select id="t-cat" class="w-full border p-2 rounded-lg text-sm bg-white"></select>
                <input type="date" id="t-date" required class="w-full border p-2 rounded-lg text-sm bg-white">
                <button type="submit"
                    class="w-full bg-plena-orange text-white py-3 rounded-xl font-bold shadow-lg shadow-orange-200">Salvar</button>
            </form>
        </div>
    </div>

    <!-- SCRIPT LOGIC -->
    <script>
        const { createIcons } = lucide;
        const DB_KEY = 'plena_basic_v1';

        // Base Data with fewer categories for Basic
        const defaultDB = {
            transactions: [],
            categories: [
                { id: '1', name: 'Vendas', type: 'income', color: '#10B981' },
                { id: '2', name: 'Servi√ßos', type: 'income', color: '#3B82F6' },
                { id: '3', name: 'Fornecedor', type: 'expense', color: '#EF4444' },
                { id: '4', name: 'Custos', type: 'expense', color: '#F59E0B' }
            ]
        };

        let db = JSON.parse(localStorage.getItem(DB_KEY)) || defaultDB;

        function init() {
            createIcons();
            renderDashboard();

            // Upsell Initialization
            if (window.PlenaUpsell) {
                PlenaUpsell.init({
                    appName: 'Plena Manager Basic',
                    plusName: 'Plena Manager PRO',
                    plusLink: '../../../../Mercado Livre/apps.plus/plena_controle.html',
                    features: ['Relat√≥rios Avan√ßados', 'Categorias Ilimitadas', 'Exporta√ß√£o PDF/Excel', 'Backup em Nuvem']
                });
            }
        }

        function save() { localStorage.setItem(DB_KEY, JSON.stringify(db)); }
        function getID() { return Date.now().toString(36); }
        function fmtMoney(v) { return v.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' }); }

        function router(view) {
            // Lock Reports
            if (view === 'reports') {
                showUpsell();
                return;
            }

            document.querySelectorAll('.view-section').forEach(el => el.classList.add('hide'));
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('bg-white/10', 'text-white'));

            document.getElementById(`view-${view}`).classList.remove('hide');
            document.getElementById(`nav-${view}`).classList.add('bg-white/10', 'text-white');

            const titles = { dashboard: 'Dashboard', transactions: 'Transa√ß√µes', settings: 'Configura√ß√µes', about: 'Sobre' };
            document.getElementById('page-title').innerText = titles[view];

            if (window.innerWidth < 1024) toggleSidebar();

            if (view === 'dashboard') renderDashboard();
            if (view === 'transactions') renderTransactions();
            if (view === 'settings') renderCats();
        }

        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('-translate-x-full');
            document.getElementById('overlay').classList.toggle('hidden');
        }

        function showUpsell() {
            if (window.PlenaUpsell) PlenaUpsell.showModal();
            else alert("Vers√£o Premium necess√°ria para esta fun√ß√£o.");
        }

        // --- DASHBOARD ---
        function renderDashboard() {
            const income = db.transactions.filter(t => t.type === 'income').reduce((a, b) => a + b.amount, 0);
            const expense = db.transactions.filter(t => t.type === 'expense').reduce((a, b) => a + b.amount, 0);

            document.getElementById('dash-balance').innerText = fmtMoney(income - expense);
            document.getElementById('dash-income').innerText = `+${fmtMoney(income)}`;
            document.getElementById('dash-expense').innerText = `-${fmtMoney(expense)}`;

            renderRecentTransactions();
            renderSimpleChart();
        }

        function renderRecentTransactions() {
            const recent = [...db.transactions].sort((a, b) => new Date(b.date) - new Date(a.date)).slice(0, 5);
            const html = recent.map(t => `
                <div class="flex justify-between items-center p-3 border-b border-gray-50 last:border-0">
                    <div>
                        <p class="font-medium text-sm text-gray-800">${t.desc}</p>
                        <p class="text-xs text-gray-500">${new Date(t.date).toLocaleDateString('pt-BR')}</p>
                    </div>
                    <span class="font-bold text-sm ${t.type === 'income' ? 'text-green-600' : 'text-red-600'}">
                        ${t.type === 'income' ? '+' : '-'}${fmtMoney(t.amount)}
                    </span>
                </div>
            `).join('') || '<p class="text-xs text-gray-400 text-center py-2">Sem dados.</p>';
            document.getElementById('recent-transactions').innerHTML = html;
        }

        function renderSimpleChart() {
            // Simplified chart just showing 4 weeks bars visually (mock-like but real data)
            const area = document.getElementById('chart-area');
            area.innerHTML = '';

            // Just take last 5 transactions to build a visual dummy if no heavy logic involved, 
            // OR use the actual logic from Plus but simplified.
            // Let's use simple logic: Income vs Expense bar
            const income = db.transactions.filter(t => t.type === 'income').reduce((a, b) => a + b.amount, 0);
            const expense = db.transactions.filter(t => t.type === 'expense').reduce((a, b) => a + b.amount, 0);
            const max = Math.max(income, expense, 100);

            area.innerHTML = `
                <div class="bar-group">
                    <div class="bar-wrapper">
                         <div class="bar bg-green-500" style="height:${(income / max) * 100}%" data-value="${fmtMoney(income)}"></div>
                         <div class="bar bg-red-500" style="height:${(expense / max) * 100}%" data-value="${fmtMoney(expense)}"></div>
                    </div>
                    <div class="x-label">Total</div>
                </div>
            `;
        }

        // --- TRANSACTIONS ---
        function renderTransactions() {
            const tbody = document.getElementById('trans-table-body');
            const sorted = [...db.transactions].sort((a, b) => new Date(b.date) - new Date(a.date));

            if (sorted.length === 0) {
                document.getElementById('empty-msg').classList.remove('hidden');
                tbody.innerHTML = '';
                return;
            }
            document.getElementById('empty-msg').classList.add('hidden');

            tbody.innerHTML = sorted.map(t => `
                <tr class="hover:bg-gray-50">
                    <td class="px-6 py-4 text-gray-500">${new Date(t.date).toLocaleDateString('pt-BR')}</td>
                    <td class="px-6 py-4 font-medium text-gray-800">${t.desc}</td>
                    <td class="px-6 py-4 font-bold ${t.type === 'income' ? 'text-green-600' : 'text-red-600'}">
                        ${t.type === 'income' ? '+' : '-'}${fmtMoney(t.amount)}
                    </td>
                    <td class="px-6 py-4 text-center">
                        <button onclick="deleteTransaction('${t.id}')" class="text-red-400 hover:text-red-600"><i data-lucide="trash-2" class="w-4 h-4"></i></button>
                    </td>
                </tr>
            `).join('');
            createIcons();
        }

        function openTransactionModal() {
            const catSelect = document.getElementById('t-cat');
            const type = document.querySelector('input[name="t-type"]:checked').value;
            catSelect.innerHTML = db.categories.filter(c => c.type === type).map(c => `<option value="${c.id}">${c.name}</option>`).join('');

            document.getElementById('t-date').value = new Date().toISOString().split('T')[0];
            document.getElementById('transactionModal').classList.remove('hidden');
        }

        function closeModal(id) { document.getElementById(id).classList.add('hidden'); }

        function submitTransaction(e) {
            e.preventDefault();
            const type = document.querySelector('input[name="t-type"]:checked').value;
            const amount = parseFloat(document.getElementById('t-amount').value);
            const desc = document.getElementById('t-desc').value;
            const catId = document.getElementById('t-cat').value;
            const date = document.getElementById('t-date').value;

            db.transactions.push({ id: getID(), type, amount, desc, catId, date });
            save();
            closeModal('transactionModal');
            e.target.reset();

            renderDashboard();
            renderTransactions();
        }

        function deleteTransaction(id) {
            if (confirm("Excluir?")) {
                db.transactions = db.transactions.filter(t => t.id !== id);
                save();
                renderTransactions();
                renderDashboard();
            }
        }

        // --- SETTINGS ---
        function renderCats() {
            const div = document.getElementById('cat-list');
            div.innerHTML = db.categories.map(c => `
                <div class="flex justify-between items-center p-2 bg-gray-50 rounded text-sm">
                    <div class="flex items-center gap-2">
                        <div class="w-2 h-2 rounded-full" style="background:${c.color}"></div>
                        ${c.name}
                    </div>
                    ${(!['1', '2', '3', '4'].includes(c.id)) ? `<button onclick="delCat('${c.id}')" class="text-red-400"><i data-lucide="x" class="w-3 h-3"></i></button>` : ''}
                </div>
            `).join('');
            createIcons();
        }

        function addCategory() {
            const customCats = db.categories.filter(c => !['1', '2', '3', '4'].includes(c.id));
            if (customCats.length >= 3) {
                showUpsell();
                return;
            }
            const name = document.getElementById('new-cat-name').value;
            if (!name) return;

            db.categories.push({ id: getID(), name, type: 'expense', color: '#666' });
            document.getElementById('new-cat-name').value = '';
            save();
            renderCats();
        }

        function delCat(id) {
            if (confirm("Excluir categoria?")) {
                db.categories = db.categories.filter(c => c.id !== id);
                save();
                renderCats();
            }
        }

        function clearAllTransactions() {
            if (confirm("Isso apagar√° todos os dados!")) {
                localStorage.removeItem(DB_KEY);
                location.reload();
            }
        }

        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>

</html>