<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Di√°rio do Beb√™ | Plena Aplicativos</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link
        href="https://fonts.googleapis.com/css2?family=Comfortaa:wght@400;600;700&family=Nunito:wght@400;600;700&display=swap"
        rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Nunito', 'sans-serif'], cute: ['Comfortaa', 'sans-serif'] },
                    colors: {
                        baby: {
                            pink: '#fce7f3', pinkDark: '#ec4899',
                            blue: '#e0f2fe', blueDark: '#0ea5e9',
                            yellow: '#fef3c7', yellowDark: '#d97706',
                            green: '#dcfce7', greenDark: '#16a34a'
                        }
                    }
                }
            }
        }
    </script>
    <style>
        body {
            background-color: #fdfbf7;
            font-family: 'Nunito', sans-serif;
        }

        .cloud-pattern {
            background-image: radial-gradient(#f1f5f9 15%, transparent 16%), radial-gradient(#f1f5f9 15%, transparent 16%);
            background-size: 60px 60px;
            background-position: 0 0, 30px 30px;
        }

        .soft-shadow {
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.05), 0 8px 10px -6px rgba(0, 0, 0, 0.01);
        }

        .gender-male {
            --main-color: #0ea5e9;
            --bg-color: #e0f2fe;
        }

        .gender-female {
            --main-color: #ec4899;
            --bg-color: #fce7f3;
        }

        .gender-neutral {
            --main-color: #d97706;
            --bg-color: #fef3c7;
        }
    </style>
</head>

<body class="h-screen overflow-hidden flex flex-col md:flex-row bg-[#fdfbf7]">

    <div id="app"
        class="flex-1 flex h-full w-full relative max-w-5xl mx-auto shadow-xl bg-white md:rounded-3xl md:my-6 overflow-hidden border-4 border-white">

        <!-- Sidebar Profile -->
        <aside
            :class="['w-full md:w-80 border-r border-slate-100 z-10 flex flex-col h-full bg-slate-50 relative transition-colors duration-500']"
            :style="{ backgroundColor: theme.bg }">

            <div class="p-8 flex flex-col items-center text-center">
                <div class="relative w-32 h-32 mb-4 group cursor-pointer" @click="editProfile">
                    <div
                        class="w-full h-full rounded-full border-4 border-white shadow-lg overflow-hidden bg-white flex items-center justify-center text-5xl text-slate-200">
                        <img v-if="profile.photo" :src="profile.photo" class="w-full h-full object-cover">
                        <i v-else class="fa-solid fa-baby"></i>
                    </div>
                    <div
                        class="absolute bottom-0 right-0 w-8 h-8 bg-white rounded-full shadow-md flex items-center justify-center text-slate-400 group-hover:text-blue-500 transition">
                        <i class="fa-solid fa-camera text-xs"></i>
                    </div>
                </div>

                <h1 class="font-cute font-bold text-2xl text-slate-800 mb-1">{{ profile.name || 'Meu Beb√™' }}</h1>
                <p class="text-sm font-bold text-slate-500 uppercase tracking-wide mb-4">{{ profile.birth ?
                    calculateAgeDetailed(profile.birth) : 'Rec√©m-nascido' }}</p>

                <div class="w-full grid grid-cols-2 gap-3 mb-6">
                    <div class="bg-white/60 rounded-xl p-2 backdrop-blur-sm">
                        <span class="block text-[10px] font-bold uppercase text-slate-400">Peso Atual</span>
                        <strong class="text-slate-700 text-lg" :style="{ color: theme.main }">{{ currentWeight }} <span
                                class="text-xs">kg</span></strong>
                    </div>
                    <div class="bg-white/60 rounded-xl p-2 backdrop-blur-sm">
                        <span class="block text-[10px] font-bold uppercase text-slate-400">Altura Atual</span>
                        <strong class="text-slate-700 text-lg" :style="{ color: theme.main }">{{ currentHeight }} <span
                                class="text-xs">cm</span></strong>
                    </div>
                </div>

                <button @click="openEntryModal"
                    class="w-full py-3 rounded-full text-white font-bold shadow-lg transition transform hover:scale-105 active:scale-95 flex items-center justify-center gap-2"
                    :style="{ backgroundColor: theme.main }">
                    <i class="fa-solid fa-plus"></i> Novo Registro
                </button>
            </div>

            <!-- Mini Summary -->
            <div class="flex-1 overflow-y-auto px-6 pb-6">
                <h3 class="font-bold text-xs text-slate-400 uppercase mb-3">Linha do Tempo</h3>
                <div class="space-y-4 border-l-2 border-slate-200 ml-2 pl-4 relative">
                    <div v-for="milestone in recentMilestones" :key="milestone.id" class="relative">
                        <div class="absolute -left-[23px] top-1 w-3 h-3 rounded-full border-2 border-white shadow-sm"
                            :style="{ backgroundColor: theme.main }"></div>
                        <p class="text-xs font-bold text-slate-400 mb-0.5">{{ formatDate(milestone.date) }}</p>
                        <h4 class="text-sm font-bold text-slate-700">{{ milestone.title }}</h4>
                        <p class="text-xs text-slate-500 leading-snug">{{ milestone.desc }}</p>
                    </div>
                    <div v-if="recentMilestones.length === 0" class="text-xs text-slate-400 italic">Nenhum marco
                        registrado ainda.</div>
                </div>
            </div>

        </aside>

        <!-- Main Content -->
        <main class="flex-1 bg-white relative overflow-hidden flex flex-col">
            <div class="cloud-pattern absolute inset-0 opacity-40 pointer-events-none"></div>

            <div class="p-6 md:p-8 flex-1 overflow-y-auto relative z-10">

                <!-- Measurements Chart Section -->
                <div class="mb-10">
                    <div class="flex justify-between items-end mb-4">
                        <h2 class="font-cute font-bold text-xl text-slate-700 flex items-center gap-2">
                            <i class="fa-solid fa-ruler-vertical text-slate-300"></i> Crescimento
                        </h2>
                        <div class="flex gap-2 text-xs font-bold bg-slate-100 p-1 rounded-lg">
                            <button @click="chartMode = 'weight'" class="px-3 py-1 rounded-md transition"
                                :class="chartMode === 'weight' ? 'bg-white shadow text-slate-800' : 'text-slate-400'">Peso</button>
                            <button @click="chartMode = 'height'" class="px-3 py-1 rounded-md transition"
                                :class="chartMode === 'height' ? 'bg-white shadow text-slate-800' : 'text-slate-400'">Altura</button>
                        </div>
                    </div>

                    <!-- Simple CSS Bar Chart -->
                    <div class="h-48 flex items-end gap-2 md:gap-4 overflow-x-auto pb-2 scrollbar-hide">
                        <div v-if="measurements.length === 0"
                            class="w-full h-full flex items-center justify-center text-slate-300 italic text-sm border-2 border-dashed border-slate-100 rounded-xl">
                            Adicione medidas para ver o gr√°fico
                        </div>
                        <div v-for="(m, i) in measurements" :key="m.id"
                            class="flex flex-col justify-end items-center group min-w-[40px]">
                            <span
                                class="text-[10px] font-bold text-slate-500 mb-1 opacity-0 group-hover:opacity-100 transition">{{
                                chartMode === 'weight' ? m.weight + 'kg' : m.height + 'cm' }}</span>
                            <div class="w-3 md:w-6 rounded-t-lg transition-all duration-500 relative group-hover:opacity-80"
                                :style="{ height: getBarHeight(m) + '%', backgroundColor: theme.main }">
                            </div>
                            <span class="text-[10px] font-bold text-slate-300 mt-2 truncate w-full text-center">{{
                                formatDateShort(m.date) }}</span>
                        </div>
                    </div>
                </div>

                <!-- Milestones Grid -->
                <div>
                    <h2 class="font-cute font-bold text-xl text-slate-700 mb-4 flex items-center gap-2">
                        <i class="fa-solid fa-star text-slate-300"></i> Marcos & Conquistas
                    </h2>

                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">

                        <!-- Auto-Generated Quick Add Milestones -->
                        <div v-if="milestones.length === 0"
                            class="col-span-full py-8 text-center bg-slate-50 rounded-2xl border-2 border-dashed border-slate-100">
                            <p class="text-slate-400 text-sm mb-4">Comece registrando os primeiros momentos!</p>
                            <div class="flex flex-wrap justify-center gap-2">
                                <button @click="quickAdd('Primeira Palavra', 'fa-comment')"
                                    class="px-4 py-2 bg-white border border-slate-200 shadow-sm rounded-full text-xs font-bold text-slate-600 hover:border-baby-pinkDark hover:text-baby-pinkDark transition">üó£
                                    Primeiro "Agugu"</button>
                                <button @click="quickAdd('Primeiros Passos', 'fa-shoe-prints')"
                                    class="px-4 py-2 bg-white border border-slate-200 shadow-sm rounded-full text-xs font-bold text-slate-600 hover:border-baby-blueDark hover:text-baby-blueDark transition">üë£
                                    Primeiros Passos</button>
                                <button @click="quickAdd('Primeiro Dente', 'fa-tooth')"
                                    class="px-4 py-2 bg-white border border-slate-200 shadow-sm rounded-full text-xs font-bold text-slate-600 hover:border-baby-yellowDark hover:text-baby-yellowDark transition">ü¶∑
                                    Primeiro Dentinho</button>
                            </div>
                        </div>

                        <div v-for="item in milestones" :key="item.id"
                            class="bg-white p-4 rounded-2xl soft-shadow border border-slate-50 flex gap-4 group hover:border-slate-200 transition relative overflow-hidden">
                            <div class="absolute top-0 right-0 p-2 opacity-0 group-hover:opacity-100 transition">
                                <button @click="deleteItem(item)" class="text-slate-300 hover:text-red-400"><i
                                        class="fa-solid fa-trash"></i></button>
                            </div>

                            <div class="w-12 h-12 rounded-full flex items-center justify-center text-xl flex-shrink-0"
                                :class="getIconBg(item.icon)" :style="{ color: theme.main, backgroundColor: theme.bg }">
                                <i :class="'fa-solid ' + (item.icon || 'fa-star')"></i>
                            </div>
                            <div>
                                <h3 class="font-bold text-slate-700">{{ item.title }}</h3>
                                <p class="text-xs font-bold text-slate-400 uppercase mb-1">{{ formatDate(item.date) }} ‚Ä¢
                                    {{ calculateAgeAtDate(item.date) }}</p>
                                <p class="text-sm text-slate-500 leading-snug">{{ item.desc }}</p>
                            </div>
                        </div>

                    </div>
                </div>

            </div>

        </main>

        <!-- Entry Modal -->
        <div v-if="showModal"
            class="absolute inset-0 z-50 bg-black/40 backdrop-blur-sm flex items-center justify-center p-4">
            <div class="bg-white w-full max-w-md rounded-3xl shadow-2xl p-6 animate-fadeInUp">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="font-cute font-bold text-xl text-slate-700">Novo Registro</h3>
                    <div class="flex gap-2 rounded-lg bg-slate-100 p-1">
                        <button @click="entryType = 'growth'" class="px-3 py-1 rounded-md text-xs font-bold transition"
                            :class="entryType === 'growth' ? 'bg-white shadow text-slate-800' : 'text-slate-400'">Medidas</button>
                        <button @click="entryType = 'milestone'"
                            class="px-3 py-1 rounded-md text-xs font-bold transition"
                            :class="entryType === 'milestone' ? 'bg-white shadow text-slate-800' : 'text-slate-400'">Marco</button>
                    </div>
                </div>

                <div v-if="entryType === 'growth'" class="space-y-4">
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="text-xs font-bold text-slate-400 uppercase">Data</label>
                            <input type="date" v-model="formGrowth.date"
                                class="w-full p-3 bg-slate-50 rounded-xl outline-none">
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="text-xs font-bold text-slate-400 uppercase">Peso (kg)</label>
                            <input type="number" step="0.01" v-model="formGrowth.weight"
                                class="w-full p-3 bg-slate-50 rounded-xl outline-none text-lg text-slate-700 font-bold">
                        </div>
                        <div>
                            <label class="text-xs font-bold text-slate-400 uppercase">Altura (cm)</label>
                            <input type="number" step="0.1" v-model="formGrowth.height"
                                class="w-full p-3 bg-slate-50 rounded-xl outline-none text-lg text-slate-700 font-bold">
                        </div>
                    </div>
                    <button @click="saveGrowth" class="w-full py-3 rounded-xl text-white font-bold shadow-md mt-2"
                        :style="{ backgroundColor: theme.main }">Salvar Medidas</button>
                </div>

                <div v-if="entryType === 'milestone'" class="space-y-4">
                    <div>
                        <label class="text-xs font-bold text-slate-400 uppercase">T√≠tulo</label>
                        <input v-model="formMilestone.title" placeholder="Ex: Primeiro Sorriso"
                            class="w-full p-3 bg-slate-50 rounded-xl outline-none">
                    </div>
                    <div>
                        <label class="text-xs font-bold text-slate-400 uppercase">Data</label>
                        <input type="date" v-model="formMilestone.date"
                            class="w-full p-3 bg-slate-50 rounded-xl outline-none">
                    </div>
                    <div>
                        <label class="text-xs font-bold text-slate-400 uppercase">Descri√ß√£o/Detalhes</label>
                        <textarea v-model="formMilestone.desc" rows="3"
                            class="w-full p-3 bg-slate-50 rounded-xl outline-none"></textarea>
                    </div>
                    <div>
                        <label class="text-xs font-bold text-slate-400 uppercase mb-2 block">√çcone</label>
                        <div class="flex gap-2 overflow-x-auto pb-2">
                            <div v-for="icon in icons" :key="icon" @click="formMilestone.icon = icon"
                                class="w-10 h-10 flex-shrink-0 rounded-full flex items-center justify-center cursor-pointer transition border-2"
                                :class="formMilestone.icon === icon ? 'border-indigo-400 bg-indigo-50 text-indigo-500' : 'border-slate-100 text-slate-300 hover:bg-slate-50'">
                                <i :class="'fa-solid ' + icon"></i>
                            </div>
                        </div>
                    </div>
                    <button @click="saveMilestone" class="w-full py-3 rounded-xl text-white font-bold shadow-md mt-2"
                        :style="{ backgroundColor: theme.main }">Salvar Conquista</button>
                </div>

                <button @click="showModal = false"
                    class="w-full text-center text-sm text-slate-400 mt-4 hover:text-slate-600">Cancelar</button>
            </div>
        </div>

        <!-- Profile Modal -->
        <div v-if="showProfileModal"
            class="absolute inset-0 z-50 bg-black/40 backdrop-blur-sm flex items-center justify-center p-4">
            <div class="bg-white w-full max-w-sm rounded-3xl shadow-2xl p-6 animate-fadeInUp">
                <h3 class="font-cute font-bold text-xl text-slate-700 mb-6 text-center">Editar Perfil</h3>

                <div class="space-y-4">
                    <input v-model="profile.name" placeholder="Nome do Beb√™"
                        class="w-full p-3 bg-slate-50 rounded-xl outline-none text-center font-bold text-lg">

                    <div class="flex justify-center gap-4">
                        <label
                            class="flex flex-col items-center gap-2 cursor-pointer p-3 rounded-xl border-2 transition"
                            :class="profile.gender === 'boy' ? 'border-sky-400 bg-sky-50' : 'border-transparent'">
                            <input type="radio" v-model="profile.gender" value="boy" class="hidden">
                            <span class="text-2xl">üë¶</span>
                            <span class="text-xs font-bold text-slate-500">Menino</span>
                        </label>
                        <label
                            class="flex flex-col items-center gap-2 cursor-pointer p-3 rounded-xl border-2 transition"
                            :class="profile.gender === 'girl' ? 'border-pink-400 bg-pink-50' : 'border-transparent'">
                            <input type="radio" v-model="profile.gender" value="girl" class="hidden">
                            <span class="text-2xl">üëß</span>
                            <span class="text-xs font-bold text-slate-500">Menina</span>
                        </label>
                        <label
                            class="flex flex-col items-center gap-2 cursor-pointer p-3 rounded-xl border-2 transition"
                            :class="profile.gender === 'neutral' ? 'border-yellow-400 bg-yellow-50' : 'border-transparent'">
                            <input type="radio" v-model="profile.gender" value="neutral" class="hidden">
                            <span class="text-2xl">üë∂</span>
                            <span class="text-xs font-bold text-slate-500">Neutro</span>
                        </label>
                    </div>

                    <div>
                        <label class="text-xs font-bold text-slate-400 uppercase block text-center mb-1">Data de
                            Nascimento</label>
                        <input type="date" v-model="profile.birth"
                            class="w-full p-3 bg-slate-50 rounded-xl outline-none text-center">
                    </div>

                    <button @click="showProfileModal = false"
                        class="w-full py-3 rounded-xl bg-slate-800 text-white font-bold shadow-md">Salvar</button>
                </div>
            </div>
        </div>

    </div>

    <script>
        const { createApp, ref, computed, onMounted, watch } = Vue;
        const DB_KEY = 'plena_baby_v1';

        createApp({
            setup() {
                const profile = ref({ name: '', birth: '', gender: 'neutral', photo: '' });
                const measurements = ref([]);
                const milestones = ref([]);

                // UI States
                const showModal = ref(false);
                const showProfileModal = ref(false);
                const entryType = ref('growth');
                const chartMode = ref('weight');

                const formGrowth = ref({ date: '', weight: '', height: '' });
                const formMilestone = ref({ title: '', date: '', desc: '', icon: 'fa-star' });

                const icons = ['fa-star', 'fa-baby', 'fa-comment', 'fa-shoe-prints', 'fa-tooth', 'fa-utensils', 'fa-bed', 'fa-bath', 'fa-shapes'];

                onMounted(() => {
                    const d = localStorage.getItem(DB_KEY);
                    if (d) {
                        const data = JSON.parse(d);
                        profile.value = data.profile;
                        measurements.value = data.measurements || [];
                        milestones.value = data.milestones || [];
                    } else {
                        // Init
                        setTimeout(() => showProfileModal.value = true, 500);
                        formGrowth.value.date = new Date().toISOString().split('T')[0];
                        formMilestone.value.date = new Date().toISOString().split('T')[0];
                    }
                });

                watch([profile, measurements, milestones], () => {
                    localStorage.setItem(DB_KEY, JSON.stringify({
                        profile: profile.value,
                        measurements: measurements.value,
                        milestones: milestones.value
                    }));
                }, { deep: true });

                // Computed
                const theme = computed(() => {
                    if (profile.value.gender === 'boy') return { main: '#0ea5e9', bg: '#f0f9ff' };
                    if (profile.value.gender === 'girl') return { main: '#ec4899', bg: '#fdf2f8' };
                    return { main: '#d97706', bg: '#fffbeb' };
                });

                const currentWeight = computed(() => {
                    if (measurements.value.length === 0) return '--';
                    return measurements.value[measurements.value.length - 1].weight;
                });

                const currentHeight = computed(() => {
                    if (measurements.value.length === 0) return '--';
                    return measurements.value[measurements.value.length - 1].height;
                });

                const recentMilestones = computed(() => {
                    return [...milestones.value].sort((a, b) => new Date(b.date) - new Date(a.date));
                });

                // Helpers
                const formatDate = (d) => { if (!d) return ''; return new Date(d + 'T12:00:00').toLocaleDateString('pt-BR'); };
                const formatDateShort = (d) => { if (!d) return ''; return new Date(d + 'T12:00:00').toLocaleDateString('pt-BR', { day: '2-digit', month: '2-digit' }); };

                const calculateAgeDetailed = (birth) => {
                    if (!birth) return '';
                    const diff = Date.now() - new Date(birth).getTime();
                    const days = Math.floor(diff / (1000 * 60 * 60 * 24));
                    if (days < 30) return days + " dias";
                    const months = Math.floor(days / 30);
                    if (months < 24) return months + " meses";
                    return Math.floor(months / 12) + " anos";
                };

                const calculateAgeAtDate = (date) => {
                    if (!profile.value.birth || !date) return '';
                    const birthTime = new Date(profile.value.birth).getTime();
                    const dateTime = new Date(date).getTime();
                    const diff = dateTime - birthTime;
                    const months = Math.floor(diff / (1000 * 60 * 60 * 24 * 30));
                    if (months < 0) return '';
                    if (months === 0) return 'Rec√©m-nascido';
                    return months + ' meses';
                };

                const getBarHeight = (m) => {
                    // Simple scaling for demo. Real apps use D3.
                    const vals = measurements.value.map(x => chartMode.value === 'weight' ? parseFloat(x.weight) : parseFloat(x.height));
                    const min = Math.min(...vals) * 0.9;
                    const max = Math.max(...vals) * 1.1;
                    const val = chartMode.value === 'weight' ? parseFloat(m.weight) : parseFloat(m.height);
                    return ((val - min) / (max - min)) * 100;
                };

                const getIconBg = (icon) => {
                    return ''; // Handled by inline style now for theme consistency
                };

                const quickAdd = (title, icon) => {
                    milestones.value.push({
                        id: Date.now(),
                        title,
                        icon,
                        date: new Date().toISOString().split('T')[0],
                        desc: 'Momento especial registrado!'
                    });
                };

                // Actions
                const openEntryModal = () => {
                    formGrowth.value.date = new Date().toISOString().split('T')[0];
                    formMilestone.value.date = new Date().toISOString().split('T')[0];
                    showModal.value = true;
                };

                const editProfile = () => showProfileModal.value = true;

                const saveGrowth = () => {
                    if (!formGrowth.value.weight || !formGrowth.value.height) return;
                    measurements.value.push({
                        id: Date.now(),
                        ...formGrowth.value
                    });
                    measurements.value.sort((a, b) => new Date(a.date) - new Date(b.date));
                    showModal.value = false;
                };

                const saveMilestone = () => {
                    if (!formMilestone.value.title) return;
                    milestones.value.push({
                        id: Date.now(),
                        ...formMilestone.value
                    });
                    showModal.value = false;
                    formMilestone.value = { title: '', date: '', desc: '', icon: 'fa-star' };
                };

                const deleteItem = (item) => {
                    if (confirm('Remover este item?')) {
                        milestones.value = milestones.value.filter(m => m.id !== item.id);
                    }
                };

                return {
                    profile, measurements, milestones, recentMilestones,
                    showModal, showProfileModal, entryType, chartMode,
                    formGrowth, formMilestone, icons, theme,
                    currentWeight, currentHeight,
                    formatDate, formatDateShort, calculateAgeDetailed, calculateAgeAtDate, getBarHeight, getIconBg,
                    openEntryModal, editProfile, saveGrowth, saveMilestone, deleteItem, quickAdd
                };
            }
        }).mount('#app');
    </script>
</body>

</html>