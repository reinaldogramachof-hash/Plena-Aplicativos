<!DOCTYPE html>
<html lang="pt-BR">
<!-- 
    PLENA 3D - GESTÃO DE IMPRESSÃO PROFISSIONAL
    Architecture: Single File PWA (Offline-First)
    Stack: Vanilla JS + TailwindCSS + LocalStorage
    Theme: Tech Blue / Dark Glass
-->

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Plena 3D - Gestão Maker</title>
    <!-- PWA -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#0ea5e9">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- Libs -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <!-- Config -->
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        tech: {
                            blue: '#0ea5e9',    // Sky 500
                            dark: '#020617',    // Slate 950
                            surface: '#0f172a', // Slate 900
                            glass: 'rgba(15, 23, 42, 0.7)',
                            neon: '#38bdf8'     // Sky 400
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                    }
                }
            }
        }
    </script>
    <link rel="stylesheet" href="assets/css/style.css">
</head>

<body onload="init()">
    <!-- Mobile Backdrop -->
    <div id="backdrop" class="fixed inset-0 bg-black/80 backdrop backdrop-blur-sm z-40 lg:hidden"
        onclick="toggleSidebar()"></div>
    <!-- SIDEBAR -->
    <aside id="sidebar" class="sidebar fixed top-0 left-0 h-screen w-[280px] flex flex-col z-50">
        <div class="h-20 flex items-center px-6 border-b border-white/5">
            <div class="bg-gradient-to-br from-cyan-500 to-blue-600 p-2 rounded-lg shadow-lg shadow-cyan-500/20 mr-3">
                <i data-lucide="box" class="w-6 h-6 text-white"></i>
            </div>
            <div>
                <h1 class="font-bold text-white tracking-tight">PLENA 3D</h1>
                <p class="text-[10px] text-cyan-400 font-mono tracking-wider">Gestão de Stúdio</p>
            </div>
        </div>
        <nav class="flex-1 p-4 space-y-1 overflow-y-auto">
            <p class="px-4 text-[10px] font-bold text-slate-500 uppercase tracking-widest mb-2">Operacional</p>
            <button onclick="router('dashboard')" id="nav-dashboard"
                class="nav-item w-full flex items-center px-4 py-3 rounded-lg text-slate-400 hover:text-white hover:bg-white/5 transition-all group"><i
                    data-lucide="layout-dashboard" class="w-5 h-5 mr-3 group-hover:text-cyan-400"></i>Dashboard
            </button>
            <button onclick="router('pdv')" id="nav-pdv"
                class="nav-item w-full flex items-center px-4 py-3 rounded-lg text-slate-400 hover:text-white hover:bg-white/5 transition-all group"><i
                    data-lucide="shopping-cart" class="w-5 h-5 mr-3 group-hover:text-cyan-400"></i>PDV
            </button>
            <button onclick="router('budgets')" id="nav-budgets"
                class="nav-item w-full flex items-center px-4 py-3 rounded-lg text-slate-400 hover:text-white hover:bg-white/5 transition-all group"><i
                    data-lucide="file-text" class="w-5 h-5 mr-3 group-hover:text-cyan-400"></i>Orçamentos
            </button>
            <button onclick="router('inventory')" id="nav-inventory"
                class="nav-item w-full flex items-center px-4 py-3 rounded-lg text-slate-400 hover:text-white hover:bg-white/5 transition-all group"><i
                    data-lucide="package" class="w-5 h-5 mr-3 group-hover:text-cyan-400"></i>Estoque </button>
            <div class="my-4 border-t border-white/5"></div>
            <p class="px-4 text-[10px] font-bold text-slate-500 uppercase tracking-widest mb-2">Gestão</p>

            <button onclick="router('projects')" id="nav-projects"
                class="nav-item w-full flex items-center px-4 py-3 rounded-lg text-slate-400 hover:text-white hover:bg-white/5 transition-all group"><i
                    data-lucide="printer" class="w-5 h-5 mr-3 group-hover:text-cyan-400"></i>Projetos (Produção)
            </button>
            <button onclick="router('clients')" id="nav-clients"
                class="nav-item w-full flex items-center px-4 py-3 rounded-lg text-slate-400 hover:text-white hover:bg-white/5 transition-all group"><i
                    data-lucide="users" class="w-5 h-5 mr-3 group-hover:text-cyan-400"></i>Clientes </button>
            <button onclick="router('financial')" id="nav-financial"
                class="nav-item w-full flex items-center px-4 py-3 rounded-lg text-slate-400 hover:text-white hover:bg-white/5 transition-all group"><i
                    data-lucide="wallet" class="w-5 h-5 mr-3 group-hover:text-cyan-400"></i>Financeiro
            </button>
            <button onclick="router('reports')" id="nav-reports"
                class="nav-item w-full flex items-center px-4 py-3 rounded-lg text-slate-400 hover:text-white hover:bg-white/5 transition-all group"><i
                    data-lucide="bar-chart-3" class="w-5 h-5 mr-3 group-hover:text-cyan-400"></i>Relatórios
            </button>
            <div class="my-4 border-t border-white/5"></div>
            <p class="px-4 text-[10px] font-bold text-slate-500 uppercase tracking-widest mb-2">Sistema</p><button
                onclick="router('manual')" id="nav-manual"
                class="nav-item w-full flex items-center px-4 py-3 rounded-lg text-slate-400 hover:text-white hover:bg-white/5 transition-all group"><i
                    data-lucide="book-open" class="w-5 h-5 mr-3 group-hover:text-cyan-400"></i>Manual de Uso
            </button><button onclick="router('settings')" id="nav-settings"
                class="nav-item w-full flex items-center px-4 py-3 rounded-lg text-slate-400 hover:text-white hover:bg-white/5 transition-all group"><i
                    data-lucide="settings" class="w-5 h-5 mr-3 group-hover:text-cyan-400"></i>Configurações
            </button><button onclick="router('support')" id="nav-support"
                class="nav-item w-full flex items-center px-4 py-3 rounded-lg text-slate-400 hover:text-white hover:bg-white/5 transition-all group"><i
                    data-lucide="life-buoy" class="w-5 h-5 mr-3 group-hover:text-cyan-400"></i>Suporte
            </button>
        </nav>
        <div class="p-4 border-t border-white/5 bg-black/20">
            <div class="glass-panel p-3 rounded-lg flex items-center gap-3">
                <div
                    class="w-8 h-8 rounded-full bg-cyan-900/50 flex items-center justify-center border border-cyan-500/30">
                    <i data-lucide="user" class="w-4 h-4 text-cyan-400"></i>
                </div>
                <div class="overflow-hidden">
                    <p class="text-xs font-bold text-white truncate" id="sidebar-user">Maker</p>
                    <p class="text-[10px] text-green-400 flex items-center"><span
                            class="w-1.5 h-1.5 rounded-full bg-green-500 mr-1.5"></span>Online</p>
                </div>
            </div>
        </div>
    </aside>
    <!-- CONTENT -->
    <main class="main-content min-h-screen flex flex-col">
        <!-- Header -->
        <header
            class="glass-header h-16 sticky top-0 z-30 px-4 md:px-8 flex items-center justify-between shadow-lg shadow-black/20">
            <div class="flex items-center gap-4"><button onclick="toggleSidebar()"
                    class="menu-btn text-slate-400 hover:text-white"><i data-lucide="menu"></i></button>
                <div class="flex flex-col"><span id="header-time"
                        class="text-lg font-bold text-white tracking-tight leading-none">00:00</span><span
                        id="header-date"
                        class="text-[10px] font-bold text-slate-400 uppercase tracking-widest leading-none">Data</span>
                </div>
            </div>
            <div class="flex gap-3"><button onclick="openTransactionModal()"
                    class="bg-slate-800 hover:bg-slate-700 text-white px-4 py-2 rounded-lg text-sm font-bold flex items-center border border-slate-600 transition-all hidden sm:flex"><i
                        data-lucide="plus-circle" class="w-4 h-4 mr-2"></i>Lançamento </button><button
                    onclick="router('projects'); openProjectModal()"
                    class="bg-cyan-600 hover:bg-cyan-500 text-white px-4 py-2 rounded-lg text-sm font-bold flex items-center shadow-lg shadow-cyan-900/50 transition-all"><i
                        data-lucide="plus" class="w-4 h-4 mr-2"></i><span class="hidden sm:inline">Novo
                        Projeto</span></button></div>
        </header>
        <!-- Views -->
        <div class="flex-1 p-4 md:p-8 overflow-y-auto">
            <!-- PDV (Ponto de Venda) -->


            <!-- PDV (Ponto de Venda) -->
            <section id="view-pdv" class="view fade-in hide">
                <header class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4">
                    <div>
                        <h2
                            class="text-3xl font-bold bg-gradient-to-r from-cyan-400 to-purple-500 bg-clip-text text-transparent">
                            Frente de Caixa (PDV)
                        </h2>
                        <div class="flex items-center gap-2 mt-1">
                            <span id="pdv-register-status"
                                class="flex items-center gap-1.5 px-2 py-0.5 rounded text-[10px] font-bold uppercase transition-all">
                                <!-- Dynamic status badge -->
                            </span>
                            <p class="text-slate-400 text-sm">Venda balcão rápida de produtos e serviços.</p>
                        </div>
                    </div>
                    <div class="flex gap-2">
                        <button id="btn-pdv-open" onclick="App.pdvManager.openOpenRegisterModal()"
                            class="bg-green-600 hover:bg-green-500 text-white px-4 py-2 rounded-lg text-sm font-bold flex items-center shadow-lg shadow-green-900/40 transition-all hidden">
                            <i data-lucide="lock-open" class="w-4 h-4 mr-2"></i>Abrir Caixa
                        </button>
                        <button id="btn-pdv-close" onclick="App.pdvManager.openCloseRegisterModal()"
                            class="bg-red-900/20 hover:bg-red-900/40 text-red-500 border border-red-500/20 px-4 py-2 rounded-lg text-sm font-bold flex items-center transition-all hidden">
                            <i data-lucide="lock" class="w-4 h-4 mr-2"></i>Fechar Caixa
                        </button>
                    </div>
                </header>

                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <!-- Coluna 1: Lista de Produtos (Grid) -->
                    <div class="lg:col-span-2 space-y-4">
                        <!-- TABS PDV -->
                        <div class="flex border-b border-white/5 gap-6 mb-4">
                            <button id="tab-pdv-vendas" onclick="App.pdvManager.switchTab('vendas')"
                                class="pb-2 text-sm font-bold text-cyan-400 border-b-2 border-cyan-400 transition-all">Vendas</button>
                            <button id="tab-pdv-historico" onclick="App.pdvManager.switchTab('historico')"
                                class="pb-2 text-sm font-bold text-slate-500 hover:text-white transition-all">Histórico
                                (Sessão)</button>
                        </div>

                        <div id="pdv-panel-vendas" class="space-y-4">
                            <div class="glass-panel p-4 rounded-xl border border-white/5 sticky top-4 z-10">
                                <div class="relative">
                                    <i data-lucide="search"
                                        class="absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-500 w-4 h-4"></i>
                                    <input type="text" id="pdv-search" placeholder="Buscar produto..."
                                        class="w-full bg-slate-950 border border-slate-700 rounded-lg py-2 pl-10 pr-4 text-sm text-white focus:outline-none focus:border-cyan-500 transition-colors"
                                        onkeyup="App.pdvManager.render()">
                                </div>
                            </div>

                            <div id="pdv-products-grid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-3">
                                <!-- Products rendered here -->
                            </div>
                        </div>

                        <div id="pdv-panel-historico" class="space-y-4 hidden h-[calc(100vh-250px)] overflow-y-auto">
                            <div class="glass-panel p-4 rounded-xl border border-white/5">
                                <table class="w-full text-left">
                                    <thead
                                        class="text-[10px] uppercase text-slate-500 font-bold border-b border-white/5">
                                        <tr>
                                            <th class="px-4 py-3">Hora</th>
                                            <th class="px-4 py-3">Resumo</th>
                                            <th class="px-4 py-3 text-right">Valor</th>
                                            <th class="px-4 py-3 text-right">Ação</th>
                                        </tr>
                                    </thead>
                                    <tbody id="pdv-session-history" class="divide-y divide-white/5">
                                        <!-- History items -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- Coluna 2: Carrinho de Compras -->
                    <div class="lg:col-span-1">
                        <div
                            class="glass-panel p-0 rounded-xl border border-white/5 overflow-hidden flex flex-col h-[calc(100vh-200px)] sticky top-4">
                            <div class="p-4 bg-slate-800/50 border-b border-white/5 flex justify-between items-center">
                                <h3 class="font-bold text-white flex items-center gap-2"><i data-lucide="shopping-cart"
                                        class="w-4 h-4 text-cyan-400"></i> Carrinho</h3>
                                <button onclick="App.pdvManager.cart = []; App.pdvManager.renderCart()"
                                    class="text-xs text-red-400 hover:text-red-300">Limpar</button>
                            </div>

                            <div id="pdv-cart-list" class="flex-1 overflow-y-auto p-2 space-y-1">
                                <!-- Cart Items rendered here -->
                            </div>

                            <div class="p-4 bg-slate-900 border-t border-white/5">
                                <div class="mb-4">
                                    <label
                                        class="text-xs font-bold text-slate-500 uppercase block mb-1">Pagamento</label>
                                    <select id="pdv-payment-method"
                                        class="w-full bg-slate-800 border border-slate-700 rounded p-2 text-white text-sm focus:border-cyan-500 outline-none">
                                        <option value="Pix">Pix</option>
                                        <option value="Dinheiro">Dinheiro</option>
                                        <option value="Crédito">Crédito</option>
                                        <option value="Débito">Débito</option>
                                    </select>
                                </div>
                                <div class="flex justify-between items-end mb-4">
                                    <span class="text-slate-400 text-sm">Total</span>
                                    <span id="pdv-total" class="text-2xl font-bold text-cyan-400 font-mono">R$
                                        0,00</span>
                                </div>
                                <button onclick="App.pdvManager.checkout()"
                                    class="w-full bg-green-600 hover:bg-green-500 text-white font-bold py-3 rounded-lg shadow-lg shadow-green-900/20 transition-all flex items-center justify-center gap-2">
                                    <i data-lucide="check-circle" class="w-5 h-5"></i> Finalizar Venda
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- ORÇAMENTOS -->
            <section id="view-budgets" class="view fade-in hide">
                <div class="flex flex-col md:flex-row justify-between items-center mb-6 gap-4">
                    <h2 class="text-xl font-bold text-white">Orçamentos</h2>
                    <div class="flex gap-2">
                        <div class="relative w-full md:w-64">
                            <i data-lucide="search" class="absolute left-3 top-3 w-4 h-4 text-slate-500"></i>
                            <input type="text" id="bdg-search" onkeyup="renderProjects('budgets')"
                                placeholder="Buscar orçamento..."
                                class="w-full bg-slate-900 border border-slate-700 rounded-lg pl-10 pr-4 py-2.5 text-sm focus:border-cyan-500 outline-none text-white">
                        </div>
                        <button onclick="openProjectModal()"
                            class="bg-cyan-600 hover:bg-cyan-500 text-white px-4 py-2 rounded-lg text-sm font-bold flex items-center shadow-lg shadow-cyan-900/50 transition-all">
                            <i data-lucide="plus" class="w-4 h-4 mr-2"></i>Novo
                        </button>
                    </div>
                </div>
                <div id="budgets-grid" class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6"></div>
            </section>

            <!-- DASHBOARD -->
            <section id="view-dashboard" class="view fade-in">
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <!-- KPI Cards -->
                    <div class="glass-panel p-6 rounded-xl relative overflow-hidden group">
                        <div class="absolute right-0 top-0 p-4 opacity-10 group-hover:opacity-20 transition-all">
                            <i data-lucide="dollar-sign" class="w-16 h-16 text-cyan-400"></i>
                        </div>
                        <p class="text-slate-400 text-xs font-bold uppercase tracking-wider">
                            Faturamento (Mês)</p>
                        <h3 id="kpi-revenue" class="text-3xl font-bold text-white mt-1">R$ 0,
                            00</h3>
                        <p class="text-xs text-green-400 mt-2 flex items-center"><i data-lucide="trending-up"
                                class="w-3 h-3 mr-1"></i>Projetos
                            Concluídos</p>
                    </div>
                    <div class="glass-panel p-6 rounded-xl relative overflow-hidden group">
                        <div class="absolute right-0 top-0 p-4 opacity-10 group-hover:opacity-20 transition-all">
                            <i data-lucide="layers" class="w-16 h-16 text-purple-400"></i>
                        </div>
                        <p class="text-slate-400 text-xs font-bold uppercase tracking-wider">
                            Filamento Gasto</p>
                        <h3 id="kpi-filament" class="text-3xl font-bold text-white mt-1">0g</h3>
                        <p class="text-xs text-purple-400 mt-2 flex items-center"><i data-lucide="spool"
                                class="w-3 h-3 mr-1"></i>Total Estimado</p>
                    </div>
                    <div class="glass-panel p-6 rounded-xl relative overflow-hidden group">
                        <div class="absolute right-0 top-0 p-4 opacity-10 group-hover:opacity-20 transition-all">
                            <i data-lucide="clock" class="w-16 h-16 text-orange-400"></i>
                        </div>
                        <p class="text-slate-400 text-xs font-bold uppercase tracking-wider">
                            Horas Impressão</p>
                        <h3 id="kpi-hours" class="text-3xl font-bold text-white mt-1">0h</h3>
                        <p class="text-xs text-orange-400 mt-2 flex items-center"><i data-lucide="zap"
                                class="w-3 h-3 mr-1"></i>Tempo de Máquina</p>
                    </div>
                    <div class="glass-panel p-6 rounded-xl relative overflow-hidden group">
                        <div class="absolute right-0 top-0 p-4 opacity-10 group-hover:opacity-20 transition-all">
                            <i data-lucide="activity" class="w-16 h-16 text-red-400"></i>
                        </div>
                        <p class="text-slate-400 text-xs font-bold uppercase tracking-wider">
                            Projetos Ativos</p>
                        <h3 id="kpi-active" class="text-3xl font-bold text-white mt-1">0</h3>
                        <p class="text-xs text-red-400 mt-2 flex items-center"><i data-lucide="loader"
                                class="w-3 h-3 mr-1"></i>Na Fila /
                            Imprimindo</p>
                    </div>
                </div>

                <!-- Financial History Chart (New) -->
                <div class="glass-panel p-6 rounded-xl mb-6 relative overflow-hidden">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-bold text-white flex items-center"><i data-lucide="bar-chart-2"
                                class="w-5 h-5 mr-2 text-green-400"></i>Histórico Financeiro (6 Meses)</h3>
                    </div>
                    <div id="financial-history-chart" class="h-40 w-full flex items-end justify-between gap-2 px-2">
                        <!-- Chart Bars Injected via JS -->
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <div class="glass-panel p-6 rounded-xl lg:col-span-2">
                        <h3 class="text-lg font-bold text-white mb-4 flex items-center"><i data-lucide="list"
                                class="w-5 h-5 mr-2 text-cyan-400"></i>Projetos
                            Recentes</h3>
                        <div id="recent-projects-list" class="space-y-3">
                            <!-- JS Injected -->
                        </div>
                    </div>
                    <div class="glass-panel p-6 rounded-xl">
                        <h3 class="text-lg font-bold text-white mb-4 flex items-center"><i data-lucide="spool"
                                class="w-5 h-5 mr-2 text-purple-400"></i>Estoque
                            Baixo</h3>
                        <div id="low-stock-list" class="space-y-3">
                            <!-- JS Injected -->
                        </div>
                    </div>
                </div>
            </section>
            <!-- FINANCIAL -->
            <section id="view-financial" class="view fade-in hide">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                    <div class="glass-panel p-6 rounded-xl border-l-4 border-green-500">
                        <p class="text-xs font-bold text-slate-400 uppercase">Entradas</p>
                        <h3 id="fin-income" class="text-2xl font-bold text-green-400 mt-1">R$ 0,
                            00</h3>
                    </div>
                    <div class="glass-panel p-6 rounded-xl border-l-4 border-red-500">
                        <p class="text-xs font-bold text-slate-400 uppercase">Saídas</p>
                        <h3 id="fin-expense" class="text-2xl font-bold text-red-400 mt-1">R$ 0,
                            00</h3>
                    </div>
                    <div class="glass-panel p-6 rounded-xl border-l-4 border-cyan-500">
                        <p class="text-xs font-bold text-slate-400 uppercase">Saldo</p>
                        <h3 id="fin-balance" class="text-2xl font-bold text-white mt-1">R$ 0,
                            00</h3>
                    </div>
                </div>
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-bold text-white">Extrato Financeiro</h3>
                    <div class="flex items-center gap-2 bg-slate-800/50 p-1 rounded-xl border border-white/5">
                        <div class="relative">
                            <i data-lucide="calendar"
                                class="absolute left-3 top-2.5 w-4 h-4 text-slate-500 pointer-events-none"></i>
                            <input type="month" id="fin-month" onchange="renderFinancial()"
                                class="bg-slate-900 border border-slate-700 rounded-lg pl-9 pr-3 py-2 text-sm text-white focus:border-cyan-500 outline-none">
                        </div>
                        <button onclick="_('fin-month').value = ''; renderFinancial()"
                            class="text-[10px] font-bold text-slate-500 hover:text-white uppercase px-2 py-2 transition-colors"
                            title="Ver todo o histórico">
                            Tudo
                        </button>
                        <button onclick="openTransactionModal()"
                            class="bg-cyan-600 hover:bg-cyan-500 text-white px-4 py-2 rounded-lg text-sm font-bold shadow-lg shadow-cyan-900/50 flex items-center gap-2">
                            <i data-lucide="plus" class="w-4 h-4"></i> <span class="hidden sm:inline">Novo</span>
                        </button>
                    </div>
                </div>
                <div class="glass-panel rounded-xl overflow-hidden">
                    <table class="w-full text-left text-sm text-slate-400">
                        <thead class="bg-black/20 text-xs uppercase font-bold text-slate-500 border-b border-white/5">
                            <tr>
                                <th class="px-6 py-4">Data</th>
                                <th class="px-6 py-4">Descrição</th>
                                <th class="px-6 py-4">Categoria/Meio</th>
                                <th class="px-6 py-4 text-right">Valor</th>
                                <th class="px-6 py-4 text-center">Tipo</th>
                            </tr>
                        </thead>
                        <tbody id="financial-table" class="divide-y divide-white/5"></tbody>
                    </table>
                </div>
            </section>
            <!-- REPORTS -->
            <section id="view-reports" class="view fade-in hide">
                <!-- Cabeçalho apenas para IMPRESSÃO (PDF) -->
                <div class="hidden print:block border-b-2 border-slate-900 pb-6 mb-8">
                    <div class="flex justify-between items-end">
                        <div>
                            <h1 class="text-3xl font-bold uppercase tracking-wide text-slate-900 mb-1">PLENA 3D -
                                RELATÓRIO</h1>
                            <p class="text-sm text-slate-500">Documento de acompanhamento gerencial</p>
                        </div>
                        <div class="text-right">
                            <p class="text-xs font-bold text-slate-400 uppercase">Período Selecionado</p>
                            <p id="print-rep-dates" class="text-sm font-mono text-slate-900"></p>
                        </div>
                    </div>
                </div>

                <div class="flex flex-col md:flex-row justify-between items-center mb-6 gap-4 print-hidden">
                    <h2 class="text-xl font-bold text-white">Relatórios Gerenciais</h2>
                    <div class="flex flex-wrap items-center gap-2 bg-slate-800/50 p-2 rounded-xl border border-white/5">
                        <div class="flex items-center gap-2">
                            <input type="date" id="rep-start-date"
                                class="bg-slate-900 border border-slate-700 rounded-lg px-3 py-2 text-xs text-white focus:border-cyan-500 outline-none">
                            <span class="text-slate-500 text-xs">até</span>
                            <input type="date" id="rep-end-date"
                                class="bg-slate-900 border border-slate-700 rounded-lg px-3 py-2 text-xs text-white focus:border-cyan-500 outline-none">
                        </div>
                        <button onclick="renderReports()"
                            class="bg-cyan-600 hover:bg-cyan-500 text-white px-4 py-2 rounded-lg text-xs font-bold shadow-lg shadow-cyan-900/50 flex items-center gap-2 transition-all">
                            <i data-lucide="refresh-cw" class="w-3.5 h-3.5"></i> Gerar Relatório
                        </button>
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
                    <div class="glass-panel p-6 rounded-xl">
                        <h3 class="text-lg font-bold text-white mb-4"><i data-lucide="pie-chart"
                                class="w-5 h-5 inline mr-2 text-cyan-400"></i>Lucro X Custo
                        </h3>
                        <div class="flex items-center justify-center p-4">
                            <div
                                class="w-32 h-32 rounded-full border-8 border-cyan-500 flex items-center justify-center relative">
                                <span id="rep-profit-margin" class="text-xl font-bold text-white">0%</span>
                                <div class="absolute inset-0 rounded-full border-8 border-red-500"
                                    style="clip-path: polygon(0 0, 100% 0, 100% 50%, 0 50%); transform: rotate(180deg); opacity: 0.3;">
                                </div>
                            </div>
                        </div>
                        <div class="text-center mt-4 space-y-2">
                            <div class="flex justify-between text-xs px-2">
                                <span class="text-slate-400">Receita Total:</span>
                                <span id="rep-total-revenue" class="text-green-400 font-bold">R$ 0,00</span>
                            </div>
                            <div class="flex justify-between text-xs px-2">
                                <span class="text-slate-400">Despesa Total:</span>
                                <span id="rep-total-expense" class="text-red-400 font-bold">R$ 0,00</span>
                            </div>
                            <p class="text-[10px] text-slate-500 pt-2 border-t border-white/5 uppercase font-bold">
                                Baseado no período</p>
                        </div>
                    </div>
                    <div class="glass-panel p-6 rounded-xl col-span-1 lg:col-span-2">
                        <h3 class="text-lg font-bold text-white mb-4"><i data-lucide="spool"
                                class="w-5 h-5 inline mr-2 text-purple-400"></i>Top
                            Filamentos</h3>
                        <div id="rep-top-filaments" class="space-y-3">
                            <!-- JS Injected -->
                        </div>
                    </div>
                </div>

                <!-- NOVOS KPIs DE PERFORMANCE -->
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
                    <div class="glass-panel p-4 rounded-xl border border-white/5 kpi-card">
                        <div class="kpi-legend">
                            <strong>Ticket Médio:</strong> Representa o valor médio que cada cliente gasta por pedido. É
                            calculado dividindo a receita total pelo número de clientes únicos.
                        </div>
                        <p class="text-[10px] font-bold text-slate-500 uppercase">Ticket Médio</p>
                        <h4 id="rep-avg-ticket" class="text-lg font-bold text-white mt-1">R$ 0,00</h4>
                    </div>
                    <div class="glass-panel p-4 rounded-xl border border-white/5 kpi-card">
                        <div class="kpi-legend">
                            <strong>Taxa de Conversão:</strong> Mostra a eficiência das suas vendas. É a porcentagem de
                            orçamentos que foram aprovados e concluídos em relação ao total de pedidos.
                        </div>
                        <p class="text-[10px] font-bold text-slate-500 uppercase">Taxa de Conversão</p>
                        <h4 id="rep-conversion" class="text-lg font-bold text-cyan-400 mt-1">0%</h4>
                    </div>
                    <div class="glass-panel p-4 rounded-xl border border-white/5 kpi-card">
                        <div class="kpi-legend">
                            <strong>Eficiência Operacional:</strong> Indica quanto cada hora de funcionamento da sua
                            impressora gera em faturamento. Fundamental para precificar sua hora-máquina.
                        </div>
                        <p class="text-[10px] font-bold text-slate-500 uppercase">Eficiência (R$/h)</p>
                        <h4 id="rep-efficiency" class="text-lg font-bold text-purple-400 mt-1">R$ 0,00</h4>
                    </div>
                    <div class="glass-panel p-4 rounded-xl border border-white/5 kpi-card">
                        <div class="kpi-legend">
                            <strong>Custo Médio/Grama:</strong> Reflete o custo direto de material por grama produzida.
                            Ajuda a monitorar desperdícios e variações no preço dos filamentos.
                        </div>
                        <p class="text-[10px] font-bold text-slate-500 uppercase">Custo Médio/Grama</p>
                        <h4 id="rep-cost-gram" class="text-lg font-bold text-red-400 mt-1">R$ 0,00</h4>
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                    <!-- GASTOS POR CATEGORIA -->
                    <div class="glass-panel p-6 rounded-xl">
                        <h3 class="text-lg font-bold text-white mb-4"><i data-lucide="bar-chart-3"
                                class="w-5 h-5 inline mr-2 text-red-400"></i>Gastos por Categoria</h3>
                        <div id="rep-expense-breakdown" class="space-y-4">
                            <!-- JS Injected -->
                        </div>
                    </div>
                    <!-- PERFORMANCE DE ORÇAMENTOS -->
                    <div class="glass-panel p-6 rounded-xl">
                        <h3 class="text-lg font-bold text-white mb-4"><i data-lucide="check-square"
                                class="w-5 h-5 inline mr-2 text-green-400"></i>Status de Orçamentos</h3>
                        <div id="rep-budget-performance" class="space-y-4">
                            <!-- JS Injected -->
                        </div>
                    </div>
                </div>

                <div class="glass-panel p-6 rounded-xl">
                    <h3 class="text-lg font-bold text-white mb-4"><i data-lucide="users"
                            class="w-5 h-5 inline mr-2 text-green-400"></i>Melhores Clientes
                    </h3>
                    <div id="rep-top-clients" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                        <!-- JS Injected -->
                    </div>
                </div>

                <!-- Ações de Exportação (Posicionadas abaixo para clareza) -->
                <div id="rep-export-actions" class="flex justify-end gap-3 mt-8 print-hidden hidden">
                    <button onclick="printReport()"
                        class="bg-slate-800 hover:bg-slate-700 text-white px-6 py-3 rounded-xl text-sm font-bold flex items-center gap-2 border border-white/5 transition-all">
                        <i data-lucide="printer" class="w-4 h-4 text-cyan-400"></i> Imprimir Relatório (PDF)
                    </button>
                    <button onclick="shareReportWhatsApp()"
                        class="bg-green-600/20 hover:bg-green-600/30 text-green-400 px-6 py-3 rounded-xl text-sm font-bold flex items-center gap-2 border border-green-500/20 transition-all">
                        <i data-lucide="message-circle" class="w-4 h-4"></i> Compartilhar no WhatsApp
                    </button>
                </div>
            </section>
            <!-- PROJECTS (PRODUÇÃO) -->
            <section id="view-projects" class="view fade-in hide">
                <div class="flex flex-col md:flex-row justify-between items-center mb-6 gap-4">
                    <h2 class="text-xl font-bold text-white">Projetos em Produção</h2>
                    <div class="flex flex-col md:flex-row gap-2 w-full md:w-auto">
                        <div class="relative w-full md:w-64"><i data-lucide="search"
                                class="absolute left-3 top-3 w-4 h-4 text-slate-500"></i><input type="text"
                                id="proj-search" onkeyup="renderProjects('projects')" placeholder="Buscar projeto..."
                                class="w-full bg-slate-900 border border-slate-700 rounded-lg pl-10 pr-4 py-2.5 text-sm focus:border-cyan-500 outline-none text-white">
                        </div>
                        <div class="flex gap-2"><select id="proj-filter" onchange="renderProjects('projects')"
                                class="bg-slate-900 border border-slate-700 rounded-lg px-4 py-2.5 text-sm text-white focus:border-cyan-500 outline-none">
                                <option value="all">Todos (Produção)</option>
                                <option value="Fila">Na Fila</option>
                                <option value="Imprimindo">Imprimindo</option>
                                <option value="Concluido">Concluídos</option>
                            </select></div>
                    </div>
                </div>
                <div id="projects-grid" class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6"></div>
            </section>
            <!-- CLIENTS (CRM) -->
            <section id="view-clients" class="view fade-in hide">
                <div class="flex flex-col md:flex-row justify-between items-center mb-6 gap-4">
                    <h2 class="text-xl font-bold text-white">Carteira de Clientes
                    </h2>
                    <div class="flex gap-3 w-full md:w-auto">
                        <div class="relative flex-1 md:w-64"><i data-lucide="search"
                                class="absolute left-3 top-3 w-4 h-4 text-slate-500"></i><input type="text"
                                id="cli-search" onkeyup="renderClients()"
                                class="w-full bg-slate-800 border border-slate-700 text-white text-sm rounded-lg pl-10 p-2.5 focus:border-purple-500 outline-none"
                                placeholder="Buscar cliente..."></div><button onclick="openClientDetails()"
                            class="bg-purple-600 hover:bg-purple-500 text-white px-4 py-2 rounded-lg text-sm font-bold flex items-center shadow-lg shadow-purple-900/50 transition-all"><i
                                data-lucide="user-plus" class="w-4 h-4 mr-2"></i>Novo </button>
                    </div>
                </div>
                <!-- CRM Grid -->
                <div id="clients-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                </div>
            </section>
            <!-- INVENTORY -->
            <section id="view-inventory" class="view fade-in hide">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-xl font-bold text-white">Gestão de Estoque</h2>
                    <button onclick="openInventoryModal()"
                        class="bg-purple-600 hover:bg-purple-500 text-white px-4 py-2 rounded-lg text-sm font-bold flex items-center shadow-lg shadow-purple-900/50"><i
                            data-lucide="plus" class="w-4 h-4 mr-2"></i>Adicionar Item</button>
                </div>

                <!-- Category Tabs -->
                <div class="flex gap-2 mb-6 border-b border-white/10 overflow-x-auto">
                    <button onclick="switchInventoryTab('impressoras')" id="tab-inv-impressoras"
                        class="px-4 py-3 text-sm font-bold transition-all whitespace-nowrap text-purple-400 border-b-2 border-purple-400">
                        <i data-lucide="printer" class="w-4 h-4 inline mr-1"></i>Impressoras
                    </button>
                    <button onclick="switchInventoryTab('filamentos')" id="tab-inv-filamentos"
                        class="px-4 py-3 text-sm font-bold transition-all whitespace-nowrap text-slate-500">
                        <i data-lucide="spool" class="w-4 h-4 inline mr-1"></i>Filamentos
                    </button>
                    <button onclick="switchInventoryTab('resinas')" id="tab-inv-resinas"
                        class="px-4 py-3 text-sm font-bold transition-all whitespace-nowrap text-slate-500">
                        <i data-lucide="droplet" class="w-4 h-4 inline mr-1"></i>Resinas
                    </button>
                    <button onclick="switchInventoryTab('pecas')" id="tab-inv-pecas"
                        class="px-4 py-3 text-sm font-bold transition-all whitespace-nowrap text-slate-500">
                        <i data-lucide="wrench" class="w-4 h-4 inline mr-1"></i>Peças
                    </button>
                    <button onclick="switchInventoryTab('ferramentas')" id="tab-inv-ferramentas"
                        class="px-4 py-3 text-sm font-bold transition-all whitespace-nowrap text-slate-500">
                        <i data-lucide="hammer" class="w-4 h-4 inline mr-1"></i>Ferramentas
                    </button>
                    <button onclick="switchInventoryTab('historico')" id="tab-inv-historico"
                        class="px-4 py-3 text-sm font-bold transition-all whitespace-nowrap text-slate-500">
                        <i data-lucide="history" class="w-4 h-4 inline mr-1"></i>Histórico
                    </button>
                </div>

                <!-- Tab Content -->
                <div id="view-inv-impressoras" class="inv-tab-content">
                    <div id="printers-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
                </div>
                <div id="view-inv-filamentos" class="inv-tab-content hidden">
                    <div id="filaments-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6"></div>
                </div>
                <div id="view-inv-resinas" class="inv-tab-content hidden">
                    <div id="resins-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6"></div>
                </div>
                <div id="view-inv-pecas" class="inv-tab-content hidden">
                    <div id="parts-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
                </div>
                <div id="view-inv-ferramentas" class="inv-tab-content hidden">
                    <div id="tools-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
                </div>
                <div id="view-inv-historico" class="inv-tab-content hidden">
                    <div class="glass-panel rounded-xl overflow-hidden">
                        <table class="w-full text-left text-sm text-slate-400">
                            <thead
                                class="bg-black/20 text-xs uppercase font-bold text-slate-500 border-b border-white/5">
                                <tr>
                                    <th class="px-6 py-4">Data</th>
                                    <th class="px-6 py-4">Item</th>
                                    <th class="px-6 py-4 text-center">Tipo</th>
                                    <th class="px-6 py-4 text-right">Qtd</th>
                                    <th class="px-6 py-4">Descrição</th>
                                </tr>
                            </thead>
                            <tbody id="inventory-logs-table" class="divide-y divide-white/5"></tbody>
                        </table>
                    </div>
                </div>
            </section>
            <!-- MANUAL -->
            <section id="view-manual" class="view fade-in hide">
                <h2 class="text-xl font-bold text-white mb-6">Manual do
                    Sistema</h2>
                <div class="space-y-4 max-w-3xl mx-auto">
                    <div class="glass-panel p-6 rounded-xl">
                        <h3 class="text-lg font-bold text-white mb-2 text-cyan-400">
                            <i data-lucide="calculator" class="w-5 h-5 inline mr-2"></i>Como
                            funciona a Precificação?
                        </h3>
                        <p class="text-sm text-slate-400 leading-relaxed">O
                            Plena 3D usa uma fórmula profissional para
                            garantir que você não tenha
                            prejuízo:<br><br><code
                                class="bg-black/30 px-2 py-1 rounded text-cyan-200 block mb-2 font-mono text-xs">(Peso Ã— Custo Filamento)+(Tempo Ã— Custo Energia)+(Tempo Ã— Depreciação)+Margem de Risco</code>O
                            sistema soma tudo isso para chegar ao <b>Custo
                                Total</b>. Depois,
                            aplica sua <b>Margem de Lucro</b>desejada para
                            sugerir o <b>Preço Final</b>. </p>
                    </div>
                    <div class="glass-panel p-6 rounded-xl">
                        <h3 class="text-lg font-bold text-white mb-2 text-purple-400">
                            <i data-lucide="spool" class="w-5 h-5 inline mr-2"></i>Gestão de
                            Estoque
                        </h3>
                        <p class="text-sm text-slate-400 leading-relaxed">
                            Sempre que você cria um projeto (que não seja
                            apenas Orçamento),
                            o sistema <b>desconta automaticamente</b>o peso
                            usado do rolo de filamento selecionado. A barra
                            de progresso no menu "Filamentos" muda de cor
                            (Verde > Amarelo > Vermelho) para te avisar
                            quando o material está acabando. </p>
                    </div>
                    <div class="glass-panel p-6 rounded-xl">
                        <h3 class="text-lg font-bold text-white mb-2 text-green-400">
                            <i data-lucide="wallet" class="w-5 h-5 inline mr-2"></i>Financeiro
                        </h3>
                        <p class="text-sm text-slate-400 leading-relaxed">
                            Use o botão <b>"Lançamento" </b>no topo da
                            tela
                            para registrar qualquer entrada ou saída
                            rápida.<br>Exemplo: Vendeu uma peça à vista?
                            Lançamento>Entrada. Comprou álcool
                            isopropílico?
                            Lançamento>Saída.<br>No fim do mês,
                            vá na aba <b>Relatórios</b>para ver se sua
                            operação está dando lucro real. </p>
                    </div>
                    <div class="glass-panel p-6 rounded-xl">
                        <h3 class="text-lg font-bold text-white mb-2 text-orange-400">
                            <i data-lucide="cloud-off" class="w-5 h-5 inline mr-2"></i>Backup e
                            Offline
                        </h3>
                        <p class="text-sm text-slate-400 leading-relaxed">
                            <b>Seus dados ficam salvos apenas no seu
                                navegador.</b>Nós não temos acesso a
                            eles.<br>Por segurança,
                            vá em <b>Configurações>Exportar Dados</b>uma
                            vez
                            por semana e guarde o arquivo de backup em um
                            local seguro (Google Drive, Pen Drive, etc.).
                        </p>
                    </div>
                </div>
            </section>
            <!-- SETTINGS -->
            <section id="view-settings" class="view fade-in hide">
                <div class="max-w-3xl mx-auto space-y-8">
                    <!-- Store Settings -->
                    <div class="glass-panel p-6 rounded-xl border border-white/5">
                        <h3 class="font-bold text-white text-lg mb-4 flex items-center">
                            <i data-lucide="store" class="w-5 h-5 mr-2 text-cyan-400"></i>Dados
                            da Loja
                        </h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div><label class="block text-xs font-bold text-slate-400 uppercase mb-1">Nome
                                    do Estabelecimento</label><input type="text" id="conf-store-name"
                                    class="w-full bg-slate-900 border border-slate-700 p-3 rounded-lg text-white"
                                    placeholder="Ex: Plena 3D Print">
                            </div>
                            <div><label class="block text-xs font-bold text-slate-400 uppercase mb-1">CNPJ
                                    / CPF</label><input type="text" id="conf-store-doc"
                                    class="w-full bg-slate-900 border border-slate-700 p-3 rounded-lg text-white"
                                    placeholder="00.000.000/0000-00">
                            </div>
                        </div>
                    </div>
                    <!-- Printer Settings -->
                    <div class="glass-panel p-6 rounded-xl border border-white/5">
                        <h3 class="text-lg font-bold text-white mb-6 flex items-center">
                            <i data-lucide="printer" class="w-5 h-5 mr-2 text-cyan-400"></i>Custos
                            da Impressora
                        </h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div><label class="text-xs font-bold text-slate-500 uppercase">Consumo
                                    (Watts)</label><input type="number" id="conf-watts"
                                    class="w-full bg-slate-900 border border-slate-700 p-3 rounded-lg mt-1 text-white"
                                    placeholder="Ex: 350"></div>
                            <div><label class="text-xs font-bold text-slate-500 uppercase">Custo
                                    Energia
                                    (R$/kWh)</label><input type="number" step="0.01" id="conf-kwh"
                                    class="w-full bg-slate-900 border border-slate-700 p-3 rounded-lg mt-1 text-white"
                                    placeholder="Ex: 0.90">
                            </div>
                            <div><label class="text-xs font-bold text-slate-500 uppercase">Taxa
                                    de Depreciação
                                    (R$/Hora)</label><input type="number" step="0.01" id="conf-depreciation"
                                    class="w-full bg-slate-900 border border-slate-700 p-3 rounded-lg mt-1 text-white"
                                    placeholder="Ex: 1.50">
                            </div>
                            <div><label class="text-xs font-bold text-slate-500 uppercase">Taxa
                                    de Falha (%)</label><input type="number" id="conf-failure"
                                    class="w-full bg-slate-900 border border-slate-700 p-3 rounded-lg mt-1 text-white"
                                    placeholder="Ex: 10"></div>
                        </div>
                    </div>
                    <!-- Backup -->
                    <div class="glass-panel p-6 rounded-xl border border-white/5">
                        <h3 class="text-lg font-bold text-white mb-6">
                            Backup de Dados</h3>
                        <div class="flex gap-4"><button onclick="exportData()"
                                class="flex-1 bg-slate-800 hover:bg-slate-700 text-white p-4 rounded-xl font-bold flex flex-col items-center border border-slate-600"><i
                                    data-lucide="download" class="w-6 h-6 mb-2"></i>Exportar
                                Dados </button><label
                                class="flex-1 bg-slate-800 hover:bg-slate-700 text-white p-4 rounded-xl font-bold flex flex-col items-center border border-slate-600 cursor-pointer"><i
                                    data-lucide="upload" class="w-6 h-6 mb-2"></i>Importar
                                Backup <input type="file" onchange="importData(this)" class="hidden"
                                    accept=".json"></label>
                        </div>
                        <div class="mt-4">
                            <button onclick="seedTestData()"
                                class="w-full bg-indigo-900/40 hover:bg-indigo-900/60 text-indigo-400 p-3 rounded-xl font-bold flex items-center justify-center gap-2 border border-indigo-500/20 transition-all">
                                <i data-lucide="database" class="w-4 h-4"></i> Gerar Dados de Teste (Povoar Sistema)
                            </button>
                        </div>
                    </div>
                </div><button onclick="saveSettings()"
                    class="w-full bg-cyan-600 hover:bg-cyan-500 text-white py-4 rounded-xl font-bold text-lg shadow-lg shadow-cyan-900/50">Salvar
                    Alterações</button>
        </div>
        </section>
        </div>
    </main>
    <!-- MODALS -->
    <!-- PROJECT MODAL -->
    <div id="projectModal"
        class="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 hidden flex items-center justify-center p-4">
        <div
            class="bg-slate-900 border border-slate-700 w-full max-w-4xl max-h-[90vh] overflow-y-auto rounded-2xl shadow-2xl">
            <div class="flex justify-between items-center p-6 border-b border-slate-800">
                <h3 class="text-xl font-bold text-white">Novo Projeto / Orçamento</h3><button
                    onclick="closeModal('projectModal')" class="text-slate-400 hover:text-white"><i
                        data-lucide="x"></i></button>
            </div>
            <form onsubmit="submitProject(event)" class="p-6 space-y-8"><input type="hidden" id="pj-id">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <!-- Left: Inputs -->
                    <!-- Left: Inputs -->
                    <div class="space-y-6">
                        <div class="grid grid-cols-12 gap-4">
                            <div class="col-span-8">
                                <label class="text-xs font-bold text-slate-500 uppercase">Nome do Projeto</label>
                                <input type="text" id="pj-name" required
                                    class="w-full bg-slate-950 border border-slate-700 p-3 rounded-lg mt-1 text-white focus:border-cyan-500 outline-none"
                                    placeholder="Ex: Suporte de Headset">
                            </div>
                            <div class="col-span-4">
                                <label class="text-xs font-bold text-slate-500 uppercase text-center block">Qtd.</label>
                                <input type="number" id="pj-quantity" value="1" min="1" required
                                    oninput="App.projectManager.calculateCost()"
                                    class="w-full bg-slate-950 border border-slate-700 p-3 rounded-lg mt-1 text-white text-center font-bold text-yellow-500 focus:border-yellow-500 outline-none">
                            </div>
                        </div>

                        <div><label class="text-xs font-bold text-slate-500 uppercase">Cliente</label><select
                                id="pj-client"
                                class="w-full bg-slate-950 border border-slate-700 p-3 rounded-lg mt-1 text-white focus:border-cyan-500 outline-none">
                                <option value="">Selecione ou deixe vazio...</option>
                            </select></div>

                        <!-- Bloco Material -->
                        <div class="glass-panel p-4 rounded-lg border-l-4 border-purple-500">
                            <div class="flex justify-between items-center mb-4">
                                <h4 class="font-bold text-purple-400 text-sm"><i data-lucide="spool"
                                        class="w-4 h-4 inline mr-1"></i>Materiais & Consumíveis
                                </h4>
                                <button type="button" onclick="App.projectManager.addMaterialRow()"
                                    class="text-[10px] bg-purple-600/20 hover:bg-purple-600/40 text-purple-300 px-2 py-1 rounded border border-purple-600/30 transition-all">
                                    <i data-lucide="plus" class="w-3 h-3 inline"></i> Adicionar
                                </button>
                            </div>

                            <div id="material-list" class="space-y-3 mb-4">
                                <!-- Linhas de material injetadas via JS -->
                            </div>

                            <div class="grid grid-cols-1 gap-4 pt-4 border-t border-white/5">
                                <div><label class="text-[10px] uppercase text-slate-500">Acabam./Extras (Unitário
                                        R$)</label><input type="number" step="0.01" id="pj-extras"
                                        oninput="App.projectManager.calculateCost()"
                                        class="w-full bg-slate-950 border border-slate-700 p-2 rounded text-white"
                                        placeholder="0.00"></div>
                            </div>
                        </div>

                        <!-- Bloco Tempo & Serviço -->
                        <div class="glass-panel p-4 rounded-lg border-l-4 border-orange-500">
                            <h4 class="font-bold text-orange-400 text-sm mb-4"><i data-lucide="clock"
                                    class="w-4 h-4 inline mr-1"></i>Tempo & Serviço
                            </h4>
                            <div class="grid grid-cols-2 gap-4">
                                <div><label class="text-[10px] uppercase text-slate-500">Tempo Impressão
                                        (Unitário/h)</label><input type="number" step="0.1" id="pj-time" required
                                        oninput="App.projectManager.calculateCost()"
                                        class="w-full bg-slate-950 border border-slate-700 p-2 rounded text-white"
                                        placeholder="0.0"></div>
                                <div><label class="text-[10px] uppercase text-slate-500">Modelagem/Setup
                                        (R$)</label><input type="number" step="0.01" id="pj-setup"
                                        oninput="App.projectManager.calculateCost()"
                                        class="w-full bg-slate-950 border border-slate-700 p-2 rounded text-white"
                                        placeholder="0.00"></div>
                            </div>
                        </div>

                        <!-- Bloco Precificação -->
                        <div class="glass-panel p-4 rounded-lg border-l-4 border-green-500">
                            <h4 class="font-bold text-green-400 text-sm mb-4"><i data-lucide="dollar-sign"
                                    class="w-4 h-4 inline mr-1"></i>Precificação</h4>
                            <div class="grid grid-cols-2 gap-4">
                                <div><label class="text-[10px] uppercase text-slate-500">Lucro
                                        Desejado (%)</label><input type="number" id="pj-markup" value="100"
                                        oninput="App.projectManager.calculateCost()"
                                        class="w-full bg-slate-950 border border-slate-700 p-2 rounded text-white">
                                </div>
                                <div><label class="text-[10px] uppercase text-slate-500">Status</label><select
                                        id="pj-status"
                                        class="w-full bg-slate-950 border border-slate-700 p-2 rounded text-white">
                                        <option value="Orçamento">Orçamento</option>
                                        <option value="Fila">Na Fila</option>
                                        <option value="Imprimindo">Imprimindo</option>
                                        <option value="Concluido">Concluído</option>
                                    </select></div>
                            </div>
                        </div>

                        <!-- Notes -->
                        <div>
                            <label class="text-xs font-bold text-slate-500 uppercase">Observações / Detalhes</label>
                            <textarea id="pj-notes" rows="2"
                                class="w-full bg-slate-950 border border-slate-700 p-3 rounded-lg mt-1 text-white text-sm focus:border-cyan-500 outline-none placeholder-slate-600"
                                placeholder="Detalhes de acabamento, cor específica, etc..."></textarea>
                        </div>
                    </div>

                    <!-- Right: Results -->
                    <div class="flex flex-col justify-between">
                        <div class="glass-panel p-6 rounded-xl bg-slate-800/50">
                            <h4 class="text-sm font-bold text-slate-400 uppercase mb-4">
                                Composição de Custo</h4>
                            <div class="space-y-3 text-sm">
                                <div class="flex justify-between border-b border-white/5 pb-2">
                                    <span>Material (+Perdas)</span><span id="cost-material"
                                        class="font-mono text-white">R$ 0,
                                        00</span>
                                </div>
                                <div class="flex justify-between border-b border-white/5 pb-2">
                                    <span>Energia</span><span id="cost-energy" class="font-mono text-white">R$ 0,
                                        00</span>
                                </div>
                                <div class="flex justify-between border-b border-white/5 pb-2">
                                    <span>Depreciação Máq.</span><span id="cost-machine" class="font-mono text-white">R$
                                        0,
                                        00</span>
                                </div>
                                <div class="flex justify-between border-b border-white/5 pb-2">
                                    <span>Extras / Acabamento</span><span id="cost-extras"
                                        class="font-mono text-white">R$
                                        0,
                                        00</span>
                                </div>
                                <div class="flex justify-between border-b border-white/5 pb-2 text-red-400">
                                    <span>Risco Falha</span><span id="cost-failure" class="font-mono">R$ 0,
                                        00</span>
                                </div>
                                <div class="flex justify-between pt-2"><span class="font-bold text-white">Custo
                                        Total</span><span id="cost-total" class="font-bold text-white font-mono">R$ 0,
                                        00</span></div>
                            </div>
                        </div>
                        <div class="mt-6 text-center">
                            <p class="text-xs text-slate-500 font-bold uppercase mb-2">Preço
                                Final Sugerido</p>
                            <h2 id="final-price" class="text-5xl font-bold text-cyan-400 tracking-tight">R$ 0,
                                00</h2>
                            <p class="text-[10px] text-slate-500 mt-2 flex justify-center gap-2">
                                <span id="label-setup-cost" class="hidden text-purple-400 font-bold">+ Setup/Modelagem
                                </span>
                            </p>
                            <div class="mt-8 flex gap-3"><button type="button" onclick="sendWhatsapp()"
                                    class="flex-1 bg-[#25D366] hover:bg-[#1ebc57] text-white py-3 rounded-lg font-bold flex items-center justify-center transition-all"><i
                                        data-lucide="message-circle" class="w-5 h-5 mr-2"></i><span
                                        id="btn-wa-text">Enviar
                                        Orçamento</span></button><button type="submit"
                                    class="flex-1 bg-cyan-600 hover:bg-cyan-500 text-white py-3 rounded-lg font-bold shadow-lg shadow-cyan-900/50 transition-all">Salvar
                                    Projeto</button></div>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>
    <!-- TRANSACTION MODAL -->
    <div id="transactionModal"
        class="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 hidden flex items-center justify-center p-4">
        <div class="bg-slate-900 border border-slate-700 w-full max-w-md rounded-2xl shadow-2xl p-6">
            <h3 class="text-xl font-bold text-white mb-6" id="tr-modal-title">Novo Lançamento</h3>
            <form onsubmit="submitTransaction(event)" class="space-y-4">
                <input type="hidden" id="tr-id">
                <div class="grid grid-cols-2 gap-2 p-1 bg-slate-950 rounded-lg"><label
                        class="cursor-pointer text-center"><input type="radio" name="tr-type" value="income"
                            class="peer hidden" checked>
                        <div
                            class="py-2 text-sm font-bold text-slate-500 rounded-md peer-checked:bg-slate-800 peer-checked:text-green-500 transition-all">
                            Entrada</div>
                    </label><label class="cursor-pointer text-center"><input type="radio" name="tr-type" value="expense"
                            class="peer hidden">
                        <div
                            class="py-2 text-sm font-bold text-slate-500 rounded-md peer-checked:bg-slate-800 peer-checked:text-red-500 transition-all">
                            Saída</div>
                    </label></div><input type="number" step="0.01" id="tr-amount" required
                    class="w-full bg-slate-950 border border-slate-700 p-4 rounded-xl text-2xl font-bold text-white text-center placeholder-slate-600"
                    placeholder="R$ 0,00"><input type="text" id="tr-desc" required
                    class="w-full bg-slate-950 border border-slate-700 p-3 rounded-lg text-white placeholder-slate-600"
                    placeholder="Descrição">
                <div class="grid grid-cols-2 gap-4"><select id="tr-cat"
                        class="w-full bg-slate-950 border border-slate-700 p-3 rounded-lg text-white">
                        <option value="Venda">Venda</option>
                        <option value="Serviço">Serviço</option>
                        <option value="Material">Material</option>
                        <option value="Energia">Energia</option>
                        <option value="Outros">Outros</option>
                    </select>
                    <select id="tr-method"
                        class="w-full bg-slate-950 border border-slate-700 p-3 rounded-lg text-white">
                        <option value="Pix">Pix</option>
                        <option value="Dinheiro">Dinheiro</option>
                        <option value="Cartão">Cartão</option>
                        <option value="Boleto">Boleto</option>
                    </select>
                </div>
                <div>
                    <label class="text-[10px] font-bold text-slate-500 uppercase ml-1">Data do Lançamento</label>
                    <input type="date" id="tr-date" required
                        class="w-full bg-slate-950 border border-slate-700 p-3 rounded-lg text-white mt-1">
                </div>
                <div class="flex gap-3 mt-6"><button type="button" onclick="closeModal('transactionModal')"
                        class="flex-1 bg-slate-800 text-white py-3 rounded-lg font-bold">Cancelar</button><button
                        type="submit" class="flex-1 bg-cyan-600 text-white py-3 rounded-lg font-bold">Salvar</button>
                </div>
            </form>
        </div>
    </div>
    <!-- CLIENT DETAILS MODAL (CRM v2) -->
    <div id="clientDetailsModal"
        class="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 hidden flex items-center justify-center p-4">
        <div
            class="bg-slate-900 border border-slate-700 w-full max-w-2xl max-h-[90vh] overflow-y-auto rounded-2xl shadow-2xl flex flex-col">
            <!-- Header -->
            <div class="p-6 border-b border-slate-800 flex justify-between items-start bg-slate-950/50">
                <div>
                    <h3 class="text-xl font-bold text-white flex items-center gap-2"><i data-lucide="user"
                            class="text-purple-400"></i><span id="cd-title">Novo Cliente</span></h3>
                    <p class="text-xs text-slate-500 mt-1">Gerencie dados,
                        histórico e preferências.</p>
                </div><button onclick="closeModal('clientDetailsModal')" class="text-slate-400 hover:text-white"><i
                        data-lucide="x"></i></button>
            </div>
            <!-- Tabs -->
            <div class="flex border-b border-slate-800 px-6 bg-slate-950/30"><button
                    onclick="switchClientTab('profile')" id="tab-cli-profile"
                    class="px-4 py-3 text-sm font-bold text-purple-400 border-b-2 border-purple-400 transition-colors">Perfil</button><button
                    onclick="switchClientTab('history')" id="tab-cli-history"
                    class="px-4 py-3 text-sm font-bold text-slate-500 hover:text-white transition-colors">Histórico</button>
            </div>
            <!-- Content -->
            <form onsubmit="submitClient(event)" class="flex-1 overflow-y-auto">
                <input type="hidden" id="cd-id">
                <!-- TAB: PROFILE -->
                <div id="view-cli-profile" class="p-6 space-y-5">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div><label class="text-xs font-bold text-slate-500 uppercase">Nome
                                Completo</label><input type="text" id="cd-name" required
                                class="w-full bg-slate-950 border border-slate-700 p-3 rounded-lg mt-1 text-white focus:border-purple-500 outline-none"
                                placeholder="Ex: João da Silva"></div>
                        <div><label class="text-xs font-bold text-slate-500 uppercase">WhatsApp</label><input
                                type="text" id="cd-phone" required
                                class="w-full bg-slate-950 border border-slate-700 p-3 rounded-lg mt-1 text-white focus:border-purple-500 outline-none"
                                placeholder="Apenas números"></div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div><label class="text-xs font-bold text-slate-500 uppercase">Email
                                (Opcional)</label><input type="email" id="cd-email"
                                class="w-full bg-slate-950 border border-slate-700 p-3 rounded-lg mt-1 text-white focus:border-purple-500 outline-none"
                                placeholder="cliente@email.com"></div>
                        <div><label class="text-xs font-bold text-slate-500 uppercase">Data
                                de Nascimento</label><input type="date" id="cd-birth"
                                class="w-full bg-slate-950 border border-slate-700 p-3 rounded-lg mt-1 text-white focus:border-purple-500 outline-none">
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div><label class="text-xs font-bold text-slate-500 uppercase">Cliente
                                Desde</label><input type="date" id="cd-joined"
                                class="w-full bg-slate-950 border border-slate-700 p-3 rounded-lg mt-1 text-white focus:border-purple-500 outline-none">
                        </div>
                        <div><label class="text-xs font-bold text-slate-500 uppercase">Como
                                nos conheceu?</label><select id="cd-source"
                                class="w-full bg-slate-950 border border-slate-700 p-3 rounded-lg mt-1 text-white focus:border-purple-500 outline-none">
                                <option value="">Selecione...</option>
                                <option value="Instagram">Instagram</option>
                                <option value="Indicação">Indicação</option>
                                <option value="Google">Google</option>
                                <option value="Facebook">Facebook</option>
                                <option value="Passante">Passante/Loja</option>
                                <option value="Outros">Outros</option>
                            </select></div>
                    </div>
                    <div><label class="text-xs font-bold text-slate-500 uppercase mb-2 flex items-center gap-2"><i
                                data-lucide="sticky-note" class="w-3 h-3"></i>Notas & Observações
                            (Dossiê)
                        </label><textarea id="cd-notes" rows="4"
                            class="w-full bg-slate-950 border border-slate-700 p-3 rounded-lg text-white text-sm focus:border-purple-500 outline-none placeholder-slate-600"
                            placeholder="Ex: Gosta de peças com preenchimento alto; Paga sempre via Pix; Aniversário 10/05..."></textarea>
                    </div>
                </div>
                <!-- TAB: HISTORY -->
                <div id="view-cli-history" class="p-6 hidden">
                    <div id="cli-history-list" class="space-y-3">
                        <!-- Populated by JS -->
                        <p class="text-center text-slate-500 py-4">
                            Nenhum histórico encontrado.</p>
                    </div>
                </div>
                <!-- Footer Action -->
                <div class="p-6 border-t border-slate-800 bg-slate-950/30 flex justify-end gap-3">
                    <button type="button" onclick="closeModal('clientDetailsModal')"
                        class="px-4 py-2 text-sm font-bold text-slate-400 hover:text-white transition-colors">Cancelar</button><button
                        type="submit"
                        class="bg-purple-600 hover:bg-purple-500 text-white px-6 py-2 rounded-lg text-sm font-bold shadow-lg shadow-purple-900/50 transition-all">Salvar
                        Dados</button>
                </div>
            </form>
        </div>
    </div>
    <!-- WHATSAPP ACTIONS MODAL -->
    <div id="whatsappActionsModal"
        class="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 hidden flex items-center justify-center p-4">
        <div class="bg-slate-900 border border-slate-700 w-full max-w-lg rounded-2xl shadow-2xl flex flex-col">
            <div class="p-6 border-b border-slate-800 bg-slate-950/50 flex justify-between items-center">
                <h3 class="text-xl font-bold text-white flex items-center gap-2"><i data-lucide="message-circle"
                        class="text-green-500"></i><span id="wa-title">Contato com Cliente</span></h3><button
                    onclick="closeModal('whatsappActionsModal')" class="text-slate-400 hover:text-white"><i
                        data-lucide="x"></i></button>
            </div>
            <div class="p-6 space-y-4">
                <p class="text-sm text-slate-400">Escolha um modelo de mensagem:</p>
                <div id="wa-options" class="grid grid-cols-1 gap-2">
                    <!-- Options injected via JS -->
                </div>
                <div class="mt-4"><label class="text-xs font-bold text-slate-500 uppercase">Mensagem Final
                        (Editável)</label><textarea id="wa-preview" rows="5"
                        class="w-full bg-slate-950 border border-slate-700 p-3 rounded-lg mt-2 text-white text-sm focus:border-green-500 outline-none font-mono"></textarea>
                </div>
            </div>
            <div class="p-6 border-t border-slate-800 bg-slate-950/30 flex justify-end gap-3">
                <button onclick="closeModal('whatsappActionsModal')"
                    class="px-4 py-2 text-sm font-bold text-slate-400 hover:text-white transition-colors">Cancelar</button><button
                    onclick="confirmWhatsappSend()"
                    class="bg-[#25D366] hover:bg-[#20bd5a] text-black px-6 py-2 rounded-lg text-sm font-bold shadow-lg shadow-green-900/20 transition-all flex items-center"><i
                        data-lucide="send" class="w-4 h-4 mr-2"></i>Enviar WhatsApp
                </button>
            </div>
        </div>
    </div>
    <!-- INVENTORY MODAL -->
    <div id="inventoryModal"
        class="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 hidden flex items-center justify-center p-4">
        <div
            class="bg-slate-900 border border-slate-700 w-full max-w-2xl max-h-[90vh] overflow-y-auto rounded-2xl shadow-2xl">
            <div class="flex justify-between items-center p-6 border-b border-slate-800 sticky top-0 bg-slate-900 z-10">
                <h3 class="text-xl font-bold text-white" id="inv-modal-title">Adicionar Item ao Estoque</h3>
                <button onclick="closeModal('inventoryModal')" class="text-slate-400 hover:text-white">
                    <i data-lucide="x"></i>
                </button>
            </div>
            <form onsubmit="submitInventory(event)" class="p-6 space-y-6">
                <input type="hidden" id="inv-id">

                <!-- Category Selection -->
                <div>
                    <label class="text-xs font-bold text-slate-500 uppercase">Categoria</label>
                    <select id="inv-category" onchange="updateInventoryFormFields()" required
                        class="w-full bg-slate-950 border border-slate-700 p-3 rounded-lg mt-1 text-white focus:border-purple-500 outline-none">
                        <option value="">Selecione...</option>
                        <option value="impressora">🖨️ Impressora 3D</option>
                        <option value="filamento">🧵 Filamento</option>
                        <option value="resina">💧 Resina</option>
                        <option value="peca">🔧 Peça de Reposição</option>
                        <option value="ferramenta">🔨 Ferramenta</option>
                    </select>
                </div>

                <!-- Common Fields -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="text-xs font-bold text-slate-500 uppercase">Nome</label>
                        <input type="text" id="inv-name" required
                            class="w-full bg-slate-950 border border-slate-700 p-3 rounded-lg mt-1 text-white focus:border-purple-500 outline-none"
                            placeholder="Ex: Ender 3 Pro">
                    </div>
                    <div>
                        <label class="text-xs font-bold text-slate-500 uppercase">Marca</label>
                        <input type="text" id="inv-brand" required
                            class="w-full bg-slate-950 border border-slate-700 p-3 rounded-lg mt-1 text-white focus:border-purple-500 outline-none"
                            placeholder="Ex: Creality">
                    </div>
                </div>

                <!-- Dynamic Fields Container -->
                <div id="inv-dynamic-fields" class="space-y-4"></div>

                <!-- Quantity & Cost -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div>
                        <label class="text-xs font-bold text-slate-500 uppercase">Quantidade</label>
                        <input type="number" id="inv-quantity" required min="0"
                            class="w-full bg-slate-950 border border-slate-700 p-3 rounded-lg mt-1 text-white focus:border-purple-500 outline-none"
                            placeholder="0">
                    </div>
                    <div>
                        <label class="text-xs font-bold text-slate-500 uppercase">Estoque Mínimo</label>
                        <input type="number" id="inv-minstock" required min="0"
                            class="w-full bg-slate-950 border border-slate-700 p-3 rounded-lg mt-1 text-white focus:border-purple-500 outline-none"
                            placeholder="0">
                    </div>
                    <div>
                        <label class="text-xs font-bold text-slate-500 uppercase">Custo (R$)</label>
                        <input type="number" step="0.01" id="inv-cost" required min="0"
                            class="w-full bg-slate-950 border border-slate-700 p-3 rounded-lg mt-1 text-white focus:border-purple-500 outline-none"
                            placeholder="0.00">
                    </div>
                    <div>
                        <label class="text-xs font-bold text-slate-500 uppercase">Preço Venda (R$)</label>
                        <input type="number" step="0.01" id="inv-price" min="0"
                            class="w-full bg-slate-950 border border-slate-700 p-3 rounded-lg mt-1 text-white focus:border-green-500 outline-none"
                            placeholder="Auto (+50%)">
                    </div>
                </div>

                <!-- Actions -->
                <div class="flex gap-3 pt-4 border-t border-slate-800">
                    <button type="button" onclick="closeModal('inventoryModal')"
                        class="flex-1 bg-slate-800 hover:bg-slate-700 text-white py-3 rounded-lg font-bold transition-all">
                        Cancelar
                    </button>
                    <button type="submit"
                        class="flex-1 bg-purple-600 hover:bg-purple-500 text-white py-3 rounded-lg font-bold shadow-lg shadow-purple-900/50 transition-all">
                        Salvar Item
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- MAINTENANCE MODAL -->
    <div id="maintenanceModal"
        class="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 hidden flex items-center justify-center p-4">
        <div class="bg-slate-900 border border-slate-700 w-full max-w-lg rounded-2xl shadow-2xl">
            <div class="flex justify-between items-center p-6 border-b border-slate-800">
                <h3 class="text-xl font-bold text-white">Registrar Manutenção</h3>
                <button onclick="closeModal('maintenanceModal')" class="text-slate-400 hover:text-white">
                    <i data-lucide="x"></i>
                </button>
            </div>
            <form onsubmit="submitMaintenance(event)" class="p-6 space-y-4">
                <input type="hidden" id="maint-printer-id">

                <div>
                    <label class="text-xs font-bold text-slate-500 uppercase">Tipo de Manutenção</label>
                    <select id="maint-type" required
                        class="w-full bg-slate-950 border border-slate-700 p-3 rounded-lg mt-1 text-white focus:border-purple-500 outline-none">
                        <option value="preventiva">Preventiva</option>
                        <option value="corretiva">Corretiva</option>
                    </select>
                </div>

                <div>
                    <label class="text-xs font-bold text-slate-500 uppercase">Descrição</label>
                    <textarea id="maint-desc" required rows="3"
                        class="w-full bg-slate-950 border border-slate-700 p-3 rounded-lg mt-1 text-white focus:border-purple-500 outline-none"
                        placeholder="Ex: Troca de bico, limpeza de extrusora..."></textarea>
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="text-xs font-bold text-slate-500 uppercase">Custo (R$)</label>
                        <input type="number" step="0.01" id="maint-cost" required min="0"
                            class="w-full bg-slate-950 border border-slate-700 p-3 rounded-lg mt-1 text-white focus:border-purple-500 outline-none"
                            placeholder="0.00">
                    </div>
                    <div>
                        <label class="text-xs font-bold text-slate-500 uppercase">Próxima Manutenção</label>
                        <input type="date" id="maint-next"
                            class="w-full bg-slate-950 border border-slate-700 p-3 rounded-lg mt-1 text-white focus:border-purple-500 outline-none">
                    </div>
                </div>

                <div class="flex gap-3 pt-4 border-t border-slate-800">
                    <button type="button" onclick="closeModal('maintenanceModal')"
                        class="flex-1 bg-slate-800 hover:bg-slate-700 text-white py-3 rounded-lg font-bold transition-all">
                        Cancelar
                    </button>
                    <button type="submit"
                        class="flex-1 bg-green-600 hover:bg-green-500 text-white py-3 rounded-lg font-bold shadow-lg shadow-green-900/50 transition-all">
                        Registrar
                    </button>
                </div>
            </form>
        </div>
    </div>
    <!-- BUDGET MODAL (PRINT ONLY STYLE) -->
    <div id="budgetModal" class="fixed inset-0 bg-black/90 backdrop-blur-md z-[60] hidden overflow-y-auto">
        <div class="min-h-screen flex items-center justify-center p-4">
            <div class="bg-white w-full max-w-2xl shadow-2xl relative rounded-sm">
                <!-- No Print Controls -->
                <div class="bg-slate-900 text-white p-4 flex justify-between items-center no-print">
                    <h3 class="font-bold flex items-center gap-2"><i data-lucide="file-check"
                            class="w-5 h-5 text-cyan-400"></i>Orçamento Formal
                    </h3>
                    <div class="flex gap-3"><button onclick="window.print()"
                            class="bg-cyan-600 hover:bg-cyan-500 px-4 py-2 rounded-lg text-sm font-bold flex items-center gap-2 transition-colors"><i
                                data-lucide="printer" class="w-4 h-4"></i>Imprimir / PDF
                        </button><button onclick="closeModal('budgetModal')"
                            class="text-slate-400 hover:text-white transition-colors"><i data-lucide="x"
                                class="w-6 h-6"></i></button>
                    </div>
                </div>
                <!-- Print Content -->
                <div class="p-12 md:p-16 text-slate-900 leading-relaxed" id="budget-content">
                    <!-- Header -->
                    <div class="flex justify-between items-end border-b-2 border-slate-900 pb-6 mb-8">
                        <div>
                            <h1 id="bdg-store-name"
                                class="text-3xl font-bold uppercase tracking-wide text-slate-900 mb-1">
                                Plena 3D</h1>
                            <p id="bdg-store-doc" class="text-sm text-slate-500 font-mono">
                                CNPJ: 00.000.000/0000-00</p>
                        </div>
                        <div class="text-right">
                            <p class="text-xs font-bold text-slate-400 uppercase">
                                Orçamento NÂº</p>
                            <p id="bdg-id" class="font-mono font-bold text-lg select-all">
                                #0000</p>
                        </div>
                    </div>
                    <!-- Client Info -->
                    <div class="bg-slate-50 p-6 rounded-lg mb-8 border border-slate-100">
                        <p class="text-xs font-bold text-slate-400 uppercase mb-2">
                            Cliente</p>
                        <h2 id="bdg-client-name" class="text-xl font-bold text-slate-800">
                            Nome do Cliente</h2>
                        <p id="bdg-client-contact" class="text-sm text-slate-600 mt-1">
                            Contato: -</p>
                    </div>
                    <!-- Project Details -->
                    <div class="mb-8">
                        <h3 class="font-bold text-slate-800 border-b border-slate-200 pb-2 mb-4 uppercase text-sm">
                            Detalhes do Projeto</h3>
                        <table class="w-full text-sm">
                            <tbody id="bdg-tbody">
                                <!-- Conteúdo gerado via JS -->
                            </tbody>
                        </table>
                    </div>
                    <!-- Total -->
                    <div class="flex justify-end mb-12">
                        <div class="text-right">
                            <p class="text-xs font-bold text-slate-400 uppercase mb-1">
                                Valor Total</p>
                            <p id="bdg-total" class="text-4xl font-black text-slate-900">
                                R$ 0,
                                00</p>
                            <p class="text-xs text-slate-400 mt-1">
                                Válido por 15 dias</p>
                        </div>
                    </div>
                    <!-- Footer -->
                    <div class="mt-20 pt-8 border-t border-slate-200 flex justify-between items-end">
                        <div class="text-xs text-slate-400">
                            <p>Este documento não é
                                fiscal.</p>
                            <p>Gerado digitalmente por
                                Plena 3D.</p>
                        </div>
                        <div class="text-center px-8 border-t border-slate-900 pt-2 w-48">
                            <p class="text-xs font-bold text-slate-900 uppercase">
                                Assinatura</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- PRINT STYLES -->
    <style>
        @media print {
            @page {
                size: A4;
                margin: 0;
            }

            /* HIDE EVERYTHING by default if Budget Modal is OPEN/ACTIVE */
            /* We use the fact that the modal is visible (display: block) to trigger this */
            /* Modern browsers support :has() */
            body:has(#budgetModal:not(.hidden))>*:not(#budgetModal) {
                display: none !important;
            }

            /* Compatibility fallback: If body has class 'printing-modal' */
            body.printing-modal>*:not(#budgetModal) {
                display: none !important;
            }

            /* When Budget Modal is active, force it to show properly */
            #budgetModal:not(.hidden) {
                position: absolute !important;
                left: 0 !important;
                top: 0 !important;
                width: 100% !important;
                height: auto !important;
                background: white !important;
                z-index: 9999;
                padding: 0 !important;
                margin: 0 !important;
                display: block !important;
                overflow: visible !important;
            }

            /* Hide print buttons inside modal */
            #budgetModal button,
            .no-print {
                display: none !important;
            }

            /* Reset colors for print */
            #budgetModal {
                color: black !important;
            }

            /* Remove shadows/borders */
            .glass-panel {
                background: white !important;
                box-shadow: none !important;
                border: 1px solid #ddd !important;
            }

            #budgetModal .bg-white {
                box-shadow: none !important;
                max-width: 210mm !important;
                width: 210mm !important;
                margin: 0 auto !important;
                padding: 0 !important;
            }

            /* A4 Content Area with Margins */
            #budget-content {
                width: 210mm;
                min-height: 296mm;
                padding: 15mm 20mm !important;
                margin: 0 auto;
                background: white;
                box-sizing: border-box;
                overflow: visible;
            }

            /* Adjust colors for print */
            .bg-slate-50 {
                background-color: #f8fafc !important;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }

            /* General text color reset */
            .text-white,
            .text-slate-400,
            .text-slate-300,
            .text-cyan-400,
            .text-purple-400,
            .text-green-400,
            .text-red-400,
            .text-slate-500 {
                color: black !important;
            }
        }
    </style>
    <!-- REGISTER OPEN MODAL -->
    <div id="openRegisterModal"
        class="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 hidden flex items-center justify-center p-4">
        <div class="bg-slate-900 border border-slate-700 w-full max-w-sm rounded-2xl shadow-2xl overflow-hidden">
            <div class="p-6 border-b border-slate-800">
                <h3 class="text-xl font-bold text-white">Abrir Caixa</h3>
            </div>
            <form onsubmit="App.pdvManager.submitOpenRegister(event)" class="p-6 space-y-4">
                <div>
                    <label class="text-xs font-bold text-slate-500 uppercase">Fundo de Troco (R$)</label>
                    <input type="number" step="0.01" id="reg-initial-value" required
                        class="w-full bg-slate-950 border border-slate-700 p-3 rounded-lg mt-1 text-white focus:border-green-500 outline-none"
                        placeholder="0.00">
                </div>
                <div class="flex justify-end gap-3 mt-6">
                    <button type="button" onclick="closeModal('openRegisterModal')"
                        class="px-4 py-2 text-sm font-bold text-slate-400 hover:text-white transition-colors">Cancelar</button>
                    <button type="submit"
                        class="bg-green-600 hover:bg-green-500 text-white px-6 py-2 rounded-lg text-sm font-bold shadow-lg shadow-green-900/20 transition-all">Abrir
                        Caixa</button>
                </div>
            </form>
        </div>
    </div>

    <!-- REGISTER CLOSE MODAL -->
    <div id="closeRegisterModal"
        class="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 hidden flex items-center justify-center p-4">
        <div class="bg-slate-900 border border-slate-700 w-full max-w-md rounded-2xl shadow-2xl overflow-hidden">
            <div class="p-6 border-b border-slate-800">
                <h3 class="text-xl font-bold text-white">Fechar Caixa</h3>
            </div>
            <div id="close-register-summary" class="p-6 space-y-4">
                <!-- Summary injected here -->
            </div>
            <div class="p-6 border-t border-slate-800 flex justify-end gap-3">
                <button onclick="closeModal('closeRegisterModal')"
                    class="px-4 py-2 text-sm font-bold text-slate-400 hover:text-white transition-colors">Cancelar</button>
                <button onclick="App.pdvManager.confirmCloseRegister()"
                    class="bg-red-600 hover:bg-red-500 text-white px-6 py-2 rounded-lg text-sm font-bold shadow-lg shadow-red-900/20 transition-all">Encerrar
                    Caixa</button>
            </div>
        </div>
    </div>

    <script src='assets/js/core/Utils.js?v=4'></script>
    <script src='assets/js/core/Database.js?v=4'></script>
    <script src='assets/js/modules/ProjectManager.js?v=4'></script>
    <script src='assets/js/modules/FinancialManager.js?v=4'></script>
    <script src='assets/js/modules/InventoryManager.js?v=4'></script>
    <script src='assets/js/modules/ClientManager.js?v=4'></script>
    <script src='assets/js/modules/DashboardManager.js?v=4'></script>
    <script src='assets/js/modules/ReportsManager.js?v=4'></script>
    <script src='assets/js/modules/SupportManager.js?v=4'></script>
    <script src='assets/js/modules/SettingsManager.js?v=4'></script>
    <script src='assets/js/core/TestData.js?v=4'></script>
    <script src='assets/js/modules/PDVManager.js?v=4'></script>
    <script src='assets/js/app.js?v=4'></script>
    <script src='assets/js/core/LegacyBindings.js?v=4'></script>
</body>

</html>