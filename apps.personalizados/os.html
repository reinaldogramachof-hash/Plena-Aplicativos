<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>OS Manager | Sistema de Ordens de Servi√ßo</title>

    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#1E40AF">
    <meta name="description" content="Sistema completo de gest√£o de ordens de servi√ßo para assist√™ncia t√©cnica">
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/svg+xml"
        href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üîß</text></svg>">
    <link rel="apple-touch-icon" href="/icons/icon-192.png">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        os: {
                            primary: '#3B82F6',    // Blue
                            secondary: '#10B981',  // Green
                            accent: '#8B5CF6',     // Purple
                            warning: '#F59E0B',    // Amber
                            danger: '#EF4444',     // Red
                            dark: '#1F2937',
                            darker: '#111827',
                            light: '#F9FAFB'
                        }
                    },
                    fontFamily: {
                        brand: ['Oswald', 'sans-serif'],
                        sans: ['Inter', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace']
                    },
                    animation: {
                        'slide-in': 'slideIn 0.3s ease-out',
                        'slide-up': 'slideUp 0.3s ease-out',
                        'fade-in': 'fadeIn 0.5s ease-out',
                        'pulse-subtle': 'pulseSubtle 2s infinite',
                        'spin-slow': 'spin 3s linear infinite'
                    },
                    keyframes: {
                        slideIn: {
                            '0%': { transform: 'translateX(-100%)' },
                            '100%': { transform: 'translateX(0)' }
                        },
                        slideUp: {
                            '0%': { transform: 'translateY(100%)' },
                            '100%': { transform: 'translateY(0)' }
                        },
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' }
                        },
                        pulseSubtle: {
                            '0%, 100%': { opacity: '1' },
                            '50%': { opacity: '0.8' }
                        }
                    }
                }
            }
        }
    </script>

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>

    <!-- Google Fonts -->
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Oswald:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap"
        rel="stylesheet">

    <!-- QR Code Library -->
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>

    <!-- Barcode Scanner -->
    <script src="https://unpkg.com/html5-qrcode"></script>

    <style>
        :root {
            --os-primary: #3B82F6;
            --os-dark: #1F2937;
            --os-darker: #111827;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #111827 0%, #1F2937 100%);
            color: #F9FAFB;
        }

        /* Status Colors */
        .status-aberto {
            background: linear-gradient(135deg, #3B82F6 0%, #1D4ED8 100%);
        }

        .status-analise {
            background: linear-gradient(135deg, #8B5CF6 0%, #7C3AED 100%);
        }

        .status-aprovado {
            background: linear-gradient(135deg, #10B981 0%, #059669 100%);
        }

        .status-execucao {
            background: linear-gradient(135deg, #F59E0B 0%, #D97706 100%);
        }

        .status-aguardando {
            background: linear-gradient(135deg, #EC4899 0%, #DB2777 100%);
        }

        .status-concluido {
            background: linear-gradient(135deg, #6B7280 0%, #4B5563 100%);
        }

        .status-entregue {
            background: linear-gradient(135deg, #10B981 0%, #059669 100%);
        }

        .status-cancelado {
            background: linear-gradient(135deg, #EF4444 0%, #DC2626 100%);
        }

        /* Priority Colors */
        .priority-baixa {
            background: linear-gradient(135deg, #10B981 0%, #059669 100%);
        }

        .priority-media {
            background: linear-gradient(135deg, #F59E0B 0%, #D97706 100%);
        }

        .priority-alta {
            background: linear-gradient(135deg, #EF4444 0%, #DC2626 100%);
        }

        .priority-urgente {
            background: linear-gradient(135deg, #8B5CF6 0%, #7C3AED 100%);
        }

        /* OS Card */
        .os-card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border-left: 4px solid transparent;
        }

        .os-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.5);
        }

        .os-card.aberto {
            border-left-color: #3B82F6;
        }

        .os-card.analise {
            border-left-color: #8B5CF6;
        }

        .os-card.aprovado {
            border-left-color: #10B981;
        }

        .os-card.execucao {
            border-left-color: #F59E0B;
        }

        .os-card.aguardando {
            border-left-color: #EC4899;
        }

        .os-card.concluido {
            border-left-color: #6B7280;
        }

        .os-card.entregue {
            border-left-color: #10B981;
        }

        .os-card.cancelado {
            border-left-color: #EF4444;
        }

        /* Glass Effect */
        .glass {
            background: rgba(31, 41, 55, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #374151;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: #3B82F6;
            border-radius: 4px;
        }

        /* Timeline */
        .timeline-step {
            position: relative;
            padding-left: 30px;
        }

        .timeline-step::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: #374151;
            border: 2px solid #3B82F6;
        }

        .timeline-step.active::before {
            background: #3B82F6;
            box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.3);
        }

        .timeline-step.completed::before {
            background: #10B981;
            border-color: #10B981;
        }

        /* Loading Spinner */
        .spinner {
            border: 3px solid rgba(59, 130, 246, 0.3);
            border-top: 3px solid #3B82F6;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        /* Print Styles */
        @media print {
            .no-print {
                display: none !important;
            }

            body {
                background: white !important;
                color: black !important;
            }

            .os-details {
                break-inside: avoid;
            }
        }

        /* Signature Pad */
        .signature-pad {
            border: 2px dashed #4B5563;
            border-radius: 8px;
            background: #1F2937;
        }

        /* Tech Badge */
        .tech-badge {
            transition: all 0.3s ease;
        }

        .tech-badge:hover {
            transform: scale(1.05);
        }

        /* Equipment Photo */
        .equipment-photo {
            transition: transform 0.3s ease;
        }

        .equipment-photo:hover {
            transform: scale(1.05);
        }

        /* Filter Tags */
        .filter-tag {
            transition: all 0.2s ease;
        }

        .filter-tag:hover {
            transform: scale(1.05);
        }

        /* Kanban Column */
        .kanban-column {
            min-height: 500px;
            background: rgba(31, 41, 55, 0.5);
            border-radius: 12px;
        }

        /* Animated Notification */
        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }

            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .notification-slide {
            animation: slideInRight 0.3s ease-out;
        }
    </style>
</head>

<body class="flex flex-col h-screen overflow-hidden">

    <!-- Install Prompt -->
    <div id="install-prompt"
        class="fixed bottom-0 left-0 right-0 bg-gradient-to-r from-blue-600 to-blue-800 p-4 z-50 shadow-2xl transform translate-y-full transition-transform">
        <div class="max-w-7xl mx-auto flex items-center justify-between">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 bg-white rounded-xl flex items-center justify-center">
                    <i data-lucide="wrench" class="w-5 h-5 text-blue-600"></i>
                </div>
                <div>
                    <p class="font-bold text-white">Instalar OS Manager</p>
                    <p class="text-sm text-blue-200">Acesso r√°pido ao sistema de ordens de servi√ßo</p>
                </div>
            </div>
            <div class="flex gap-2">
                <button onclick="dismissInstallPrompt()" class="px-4 py-2 text-blue-200 hover:text-white">
                    Agora n√£o
                </button>
                <button onclick="installPWA()"
                    class="px-4 py-2 bg-white text-blue-600 font-bold rounded-lg hover:bg-blue-50 transition">
                    Instalar
                </button>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loading" class="fixed inset-0 bg-os-darker flex flex-col items-center justify-center z-50">
        <div class="spinner w-12 h-12 mb-4"></div>
        <p class="text-gray-400">Carregando sistema de ordens de servi√ßo...</p>
    </div>

    <!-- Main App Container -->
    <div id="app" class="flex flex-col h-full hidden">

        <!-- Top Bar -->
        <div class="glass border-b border-gray-800 p-4 shrink-0">
            <div class="max-w-7xl mx-auto flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <div
                        class="w-10 h-10 bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl flex items-center justify-center shadow-lg shadow-blue-500/20">
                        <i data-lucide="wrench" class="w-5 h-5 text-white"></i>
                    </div>
                    <div>
                        <h1 class="font-brand font-bold text-xl text-white">OS<span class="text-blue-400">Manager</span>
                        </h1>
                        <p class="text-xs text-gray-500 -mt-1" id="current-time">--:--</p>
                    </div>
                </div>

                <div class="flex items-center gap-4">
                    <!-- Quick Stats -->
                    <div class="hidden md:flex items-center gap-4">
                        <div class="text-center">
                            <div class="text-lg font-bold text-white" id="stats-abertas">0</div>
                            <div class="text-xs text-gray-500">Abertas</div>
                        </div>
                        <div class="text-center">
                            <div class="text-lg font-bold text-white" id="stats-execucao">0</div>
                            <div class="text-xs text-gray-500">Em Execu√ß√£o</div>
                        </div>
                        <div class="text-center">
                            <div class="text-lg font-bold text-white" id="stats-atrasadas">0</div>
                            <div class="text-xs text-gray-500 text-red-400">Atrasadas</div>
                        </div>
                    </div>

                    <!-- Notifications -->
                    <div class="relative">
                        <button onclick="toggleNotifications()"
                            class="p-2 text-gray-400 hover:text-white hover:bg-gray-800 rounded-lg transition relative">
                            <i data-lucide="bell" class="w-5 h-5"></i>
                            <span id="notification-count"
                                class="absolute -top-1 -right-1 bg-red-500 text-white text-xs w-5 h-5 rounded-full flex items-center justify-center hidden">0</span>
                        </button>
                    </div>

                    <!-- Search -->
                    <button onclick="toggleSearch()"
                        class="p-2 text-gray-400 hover:text-white hover:bg-gray-800 rounded-lg transition">
                        <i data-lucide="search" class="w-5 h-5"></i>
                    </button>

                    <!-- User Menu -->
                    <div class="relative">
                        <button onclick="toggleUserMenu()"
                            class="flex items-center gap-2 p-2 text-gray-400 hover:text-white hover:bg-gray-800 rounded-lg transition">
                            <div
                                class="w-8 h-8 bg-gradient-to-br from-blue-500 to-blue-600 rounded-full flex items-center justify-center">
                                <span class="font-bold text-white text-sm">TE</span>
                            </div>
                            <span class="hidden md:inline text-sm">T√©cnico</span>
                            <i data-lucide="chevron-down" class="w-4 h-4 hidden md:inline"></i>
                        </button>

                        <!-- User Dropdown -->
                        <div id="user-menu"
                            class="absolute right-0 top-full mt-2 w-48 bg-gray-900 border border-gray-800 rounded-xl shadow-2xl hidden z-40">
                            <div class="p-4 border-b border-gray-800">
                                <p class="font-bold text-white">T√©cnico Principal</p>
                                <p class="text-xs text-gray-500">tecnico@osmanager.com</p>
                            </div>
                            <div class="p-2">
                                <button onclick="openSettings()"
                                    class="w-full text-left px-4 py-2 text-gray-400 hover:text-white hover:bg-gray-800 rounded-lg transition flex items-center gap-2">
                                    <i data-lucide="settings" class="w-4 h-4"></i> Configura√ß√µes
                                </button>
                                <button onclick="logout()"
                                    class="w-full text-left px-4 py-2 text-gray-400 hover:text-white hover:bg-gray-800 rounded-lg transition flex items-center gap-2">
                                    <i data-lucide="log-out" class="w-4 h-4"></i> Sair
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Search Bar -->
        <div id="search-bar" class="bg-gray-900 border-b border-gray-800 hidden animate-slide-in">
            <div class="max-w-7xl mx-auto px-4 py-3">
                <div class="relative">
                    <input type="text" id="search-input" placeholder="Buscar OS, cliente, equipamento..."
                        class="w-full bg-gray-800 border border-gray-700 rounded-xl py-3 pl-12 pr-4 text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    <i data-lucide="search" class="absolute left-4 top-3.5 w-5 h-5 text-gray-500"></i>
                    <button onclick="clearSearch()" class="absolute right-4 top-3.5 text-gray-500 hover:text-white">
                        <i data-lucide="x" class="w-5 h-5"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="flex flex-1 overflow-hidden">

            <!-- Sidebar -->
            <div id="sidebar" class="w-64 bg-gray-900 border-r border-gray-800 hidden md:flex flex-col">
                <div class="p-6 border-b border-gray-800">
                    <h2 class="font-bold text-white text-lg">Painel T√©cnico</h2>
                    <p class="text-sm text-gray-500 mt-1">Gest√£o completa de OS</p>
                </div>

                <nav class="flex-1 p-4 space-y-1 overflow-y-auto">
                    <button onclick="switchView('dashboard')" class="sidebar-btn active">
                        <i data-lucide="layout-dashboard" class="w-5 h-5"></i>
                        <span>Dashboard</span>
                    </button>

                    <button onclick="switchView('os')" class="sidebar-btn">
                        <i data-lucide="clipboard-list" class="w-5 h-5"></i>
                        <span>Ordens de Servi√ßo</span>
                        <span id="os-count" class="sidebar-badge">0</span>
                    </button>

                    <button onclick="switchView('kanban')" class="sidebar-btn">
                        <i data-lucide="columns" class="w-5 h-5"></i>
                        <span>Kanban OS</span>
                    </button>

                    <button onclick="switchView('calendar')" class="sidebar-btn">
                        <i data-lucide="calendar" class="w-5 h-5"></i>
                        <span>Calend√°rio</span>
                    </button>

                    <button onclick="switchView('clients')" class="sidebar-btn">
                        <i data-lucide="users" class="w-5 h-5"></i>
                        <span>Clientes</span>
                        <span id="client-count" class="sidebar-badge">0</span>
                    </button>

                    <button onclick="switchView('technicians')" class="sidebar-btn">
                        <i data-lucide="user-cog" class="w-5 h-5"></i>
                        <span>T√©cnicos</span>
                        <span id="tech-count" class="sidebar-badge">0</span>
                    </button>

                    <button onclick="switchView('equipment')" class="sidebar-btn">
                        <i data-lucide="cpu" class="w-5 h-5"></i>
                        <span>Equipamentos</span>
                    </button>

                    <button onclick="switchView('stock')" class="sidebar-btn">
                        <i data-lucide="package" class="w-5 h-5"></i>
                        <span>Estoque</span>
                    </button>

                    <button onclick="switchView('reports')" class="sidebar-btn">
                        <i data-lucide="bar-chart-3" class="w-5 h-5"></i>
                        <span>Relat√≥rios</span>
                    </button>

                    <button onclick="switchView('billing')" class="sidebar-btn">
                        <i data-lucide="credit-card" class="w-5 h-5"></i>
                        <span>Financeiro</span>
                    </button>

                    <div class="pt-6">
                        <p class="text-xs text-gray-500 uppercase font-bold px-4 mb-2">Utilit√°rios</p>
                        <button onclick="openQRScanner()" class="sidebar-btn">
                            <i data-lucide="qrcode" class="w-5 h-5"></i>
                            <span>Scanner QR</span>
                        </button>
                        <button onclick="printOS()" class="sidebar-btn">
                            <i data-lucide="printer" class="w-5 h-5"></i>
                            <span>Imprimir OS</span>
                        </button>
                        <button onclick="openSignature()" class="sidebar-btn">
                            <i data-lucide="pen-tool" class="w-5 h-5"></i>
                            <span>Assinatura Digital</span>
                        </button>
                    </div>

                    <div class="pt-6">
                        <p class="text-xs text-gray-500 uppercase font-bold px-4 mb-2">Sistema</p>
                        <button onclick="switchView('settings')" class="sidebar-btn">
                            <i data-lucide="settings" class="w-5 h-5"></i>
                            <span>Configura√ß√µes</span>
                        </button>
                        <button onclick="switchView('help')" class="sidebar-btn">
                            <i data-lucide="help-circle" class="w-5 h-5"></i>
                            <span>Ajuda</span>
                        </button>
                    </div>
                </nav>

                <!-- Quick Add -->
                <div class="p-4 border-t border-gray-800">
                    <button onclick="createNewOS()"
                        class="w-full bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-400 hover:to-blue-500 text-white font-bold py-3 rounded-lg transition flex items-center justify-center gap-2">
                        <i data-lucide="plus" class="w-5 h-5"></i>
                        Nova OS
                    </button>
                </div>

                <!-- Offline Status -->
                <div id="offline-status" class="hidden p-4 border-t border-gray-800">
                    <div class="flex items-center gap-2 text-amber-500">
                        <i data-lucide="wifi-off" class="w-4 h-4"></i>
                        <span class="text-sm font-medium">Modo Offline</span>
                    </div>
                </div>
            </div>

            <!-- Mobile Menu Button -->
            <button id="mobile-menu-btn" onclick="toggleSidebar()"
                class="md:hidden fixed bottom-4 right-4 z-30 w-14 h-14 bg-gradient-to-br from-blue-500 to-blue-600 text-white rounded-full shadow-2xl flex items-center justify-center">
                <i data-lucide="menu" class="w-6 h-6"></i>
            </button>

            <!-- Content Area -->
            <div class="flex-1 overflow-y-auto">

                <!-- Dashboard View -->
                <div id="dashboard-view" class="view active p-6">
                    <div class="max-w-7xl mx-auto">
                        <!-- Welcome Card -->
                        <div class="glass rounded-2xl p-6 mb-8">
                            <div class="flex flex-col md:flex-row md:items-center justify-between gap-4">
                                <div>
                                    <h1 class="text-2xl font-bold text-white mb-2">Bem-vindo, T√©cnico!</h1>
                                    <p class="text-gray-400">Aqui est√° o resumo das suas atividades t√©cnicas</p>
                                </div>
                                <div class="flex items-center gap-3">
                                    <div class="text-center">
                                        <div class="text-3xl font-bold text-white" id="dashboard-os-hoje">0</div>
                                        <div class="text-sm text-gray-500">OS hoje</div>
                                    </div>
                                    <div class="h-10 w-px bg-gray-700"></div>
                                    <div class="text-center">
                                        <div class="text-3xl font-bold text-green-500" id="dashboard-concluidas">0</div>
                                        <div class="text-sm text-gray-500">Conclu√≠das</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Stats Grid -->
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                            <div class="glass p-6 rounded-2xl">
                                <div class="flex items-center justify-between mb-4">
                                    <div class="p-3 bg-blue-500/10 rounded-lg">
                                        <i data-lucide="clock" class="w-6 h-6 text-blue-500"></i>
                                    </div>
                                    <span class="text-sm text-gray-500">Em aberto</span>
                                </div>
                                <h3 class="text-3xl font-bold text-white mb-2" id="stat-os-abertas">0</h3>
                                <p class="text-gray-400">Ordens pendentes</p>
                            </div>

                            <div class="glass p-6 rounded-2xl">
                                <div class="flex items-center justify-between mb-4">
                                    <div class="p-3 bg-amber-500/10 rounded-lg">
                                        <i data-lucide="alert-triangle" class="w-6 h-6 text-amber-500"></i>
                                    </div>
                                    <span class="text-sm text-gray-500">Urgentes</span>
                                </div>
                                <h3 class="text-3xl font-bold text-white mb-2" id="stat-os-urgentes">0</h3>
                                <p class="text-gray-400">Prioridade alta</p>
                            </div>

                            <div class="glass p-6 rounded-2xl">
                                <div class="flex items-center justify-between mb-4">
                                    <div class="p-3 bg-green-500/10 rounded-lg">
                                        <i data-lucide="dollar-sign" class="w-6 h-6 text-green-500"></i>
                                    </div>
                                    <span class="text-sm text-gray-500">Este m√™s</span>
                                </div>
                                <h3 class="text-3xl font-bold text-white mb-2" id="stat-faturamento">R$ 0</h3>
                                <p class="text-gray-400">Faturamento</p>
                            </div>

                            <div class="glass p-6 rounded-2xl">
                                <div class="flex items-center justify-between mb-4">
                                    <div class="p-3 bg-purple-500/10 rounded-lg">
                                        <i data-lucide="star" class="w-6 h-6 text-purple-500"></i>
                                    </div>
                                    <span class="text-sm text-gray-500">M√©dia</span>
                                </div>
                                <h3 class="text-3xl font-bold text-white mb-2" id="stat-satisfacao">0.0</h3>
                                <p class="text-gray-400">Satisfa√ß√£o</p>
                            </div>
                        </div>

                        <!-- Quick Actions -->
                        <div class="mb-8">
                            <h2 class="text-xl font-bold text-white mb-4">A√ß√µes R√°pidas</h2>
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                                <button onclick="createNewOS()"
                                    class="bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-400 hover:to-blue-500 text-white p-4 rounded-xl flex flex-col items-center justify-center gap-2 transition">
                                    <i data-lucide="plus-circle" class="w-8 h-8"></i>
                                    <span class="font-medium">Nova OS</span>
                                </button>
                                <button onclick="switchView('calendar')"
                                    class="bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-400 hover:to-emerald-500 text-white p-4 rounded-xl flex flex-col items-center justify-center gap-2 transition">
                                    <i data-lucide="calendar" class="w-8 h-8"></i>
                                    <span class="font-medium">Agendar</span>
                                </button>
                                <button onclick="openQRScanner()"
                                    class="bg-gradient-to-r from-purple-500 to-pink-600 hover:from-purple-400 hover:to-pink-500 text-white p-4 rounded-xl flex flex-col items-center justify-center gap-2 transition">
                                    <i data-lucide="qrcode" class="w-8 h-8"></i>
                                    <span class="font-medium">Scanner</span>
                                </button>
                                <button onclick="printReports()"
                                    class="bg-gradient-to-r from-amber-500 to-orange-600 hover:from-amber-400 hover:to-orange-500 text-white p-4 rounded-xl flex flex-col items-center justify-center gap-2 transition">
                                    <i data-lucide="printer" class="w-8 h-8"></i>
                                    <span class="font-medium">Relat√≥rios</span>
                                </button>
                            </div>
                        </div>

                        <!-- Recent OS & Activity -->
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                            <!-- Recent OS -->
                            <div>
                                <div class="flex items-center justify-between mb-4">
                                    <h2 class="text-xl font-bold text-white">OS Recentes</h2>
                                    <button onclick="switchView('os')"
                                        class="text-blue-500 hover:text-blue-400 text-sm font-medium flex items-center gap-1">
                                        Ver todas <i data-lucide="chevron-right" class="w-4 h-4"></i>
                                    </button>
                                </div>
                                <div id="recent-os" class="space-y-4">
                                    <!-- OS cards injected via JS -->
                                </div>
                            </div>

                            <!-- Activity Timeline -->
                            <div>
                                <h2 class="text-xl font-bold text-white mb-4">Linha do Tempo</h2>
                                <div class="glass rounded-xl p-6">
                                    <div id="activity-timeline" class="space-y-6">
                                        <!-- Timeline items injected via JS -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- OS List View -->
                <div id="os-view" class="view hidden p-6">
                    <div class="max-w-7xl mx-auto">
                        <div class="flex flex-col md:flex-row md:items-center justify-between mb-8">
                            <div>
                                <h2 class="text-2xl font-bold text-white mb-2">Ordens de Servi√ßo</h2>
                                <p class="text-gray-400">Gerencie todas as ordens de servi√ßo</p>
                            </div>
                            <div class="flex gap-3 mt-4 md:mt-0">
                                <button onclick="exportOS()"
                                    class="px-4 py-2 border border-gray-700 text-gray-400 hover:text-white hover:border-gray-600 rounded-lg transition flex items-center gap-2">
                                    <i data-lucide="download" class="w-4 h-4"></i> Exportar
                                </button>
                                <button onclick="createNewOS()"
                                    class="px-4 py-2 bg-gradient-to-r from-blue-500 to-blue-600 text-white font-bold rounded-lg hover:from-blue-400 hover:to-blue-500 transition flex items-center gap-2">
                                    <i data-lucide="plus" class="w-4 h-4"></i> Nova OS
                                </button>
                            </div>
                        </div>

                        <!-- Filters -->
                        <div class="glass rounded-xl p-4 mb-6">
                            <div class="flex flex-col md:flex-row md:items-center gap-4">
                                <div class="flex-1">
                                    <div class="relative">
                                        <input type="text" id="os-search"
                                            placeholder="Buscar OS, cliente, equipamento..."
                                            class="w-full bg-gray-800 border border-gray-700 rounded-lg py-2.5 pl-10 pr-4 text-white placeholder-gray-500 focus:outline-none focus:border-blue-500">
                                        <i data-lucide="search"
                                            class="absolute left-3 top-2.5 w-4 h-4 text-gray-500"></i>
                                    </div>
                                </div>
                                <div class="flex flex-wrap gap-2">
                                    <select id="os-status-filter" onchange="filterOS()"
                                        class="bg-gray-800 border border-gray-700 rounded-lg px-3 py-2 text-white text-sm focus:outline-none focus:border-blue-500">
                                        <option value="">Todos status</option>
                                        <option value="aberto">Aberto</option>
                                        <option value="analise">Em An√°lise</option>
                                        <option value="aprovado">Aprovado</option>
                                        <option value="execucao">Em Execu√ß√£o</option>
                                        <option value="aguardando">Aguardando Pe√ßa</option>
                                        <option value="concluido">Conclu√≠do</option>
                                        <option value="entregue">Entregue</option>
                                        <option value="cancelado">Cancelado</option>
                                    </select>
                                    <select id="os-priority-filter" onchange="filterOS()"
                                        class="bg-gray-800 border border-gray-700 rounded-lg px-3 py-2 text-white text-sm focus:outline-none focus:border-blue-500">
                                        <option value="">Todas prioridades</option>
                                        <option value="baixa">Baixa</option>
                                        <option value="media">M√©dia</option>
                                        <option value="alta">Alta</option>
                                        <option value="urgente">Urgente</option>
                                    </select>
                                    <select id="os-technician-filter" onchange="filterOS()"
                                        class="bg-gray-800 border border-gray-700 rounded-lg px-3 py-2 text-white text-sm focus:outline-none focus:border-blue-500">
                                        <option value="">Todos t√©cnicos</option>
                                        <!-- Technicians injected via JS -->
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- OS Grid -->
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8" id="os-grid">
                            <!-- OS cards injected via JS -->
                        </div>

                        <!-- Empty State -->
                        <div id="os-empty" class="hidden py-16 text-center">
                            <div
                                class="w-24 h-24 mx-auto mb-6 bg-gray-800 rounded-2xl flex items-center justify-center">
                                <i data-lucide="clipboard-list" class="w-12 h-12 text-gray-600"></i>
                            </div>
                            <h4 class="text-xl font-bold text-white mb-2">Nenhuma OS encontrada</h4>
                            <p class="text-gray-500 max-w-md mx-auto">Comece criando uma nova ordem de servi√ßo</p>
                            <button onclick="createNewOS()"
                                class="mt-6 px-6 py-3 bg-gradient-to-r from-blue-500 to-blue-600 text-white font-bold rounded-lg hover:from-blue-400 hover:to-blue-500 transition">
                                Criar Primeira OS
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Kanban View -->
                <div id="kanban-view" class="view hidden p-6">
                    <div class="max-w-7xl mx-auto">
                        <div class="flex flex-col md:flex-row md:items-center justify-between mb-8">
                            <div>
                                <h2 class="text-2xl font-bold text-white mb-2">Kanban de OS</h2>
                                <p class="text-gray-400">Visualize e organize por status</p>
                            </div>
                            <div class="flex gap-3 mt-4 md:mt-0">
                                <button onclick="refreshKanban()"
                                    class="px-4 py-2 border border-gray-700 text-gray-400 hover:text-white hover:border-gray-600 rounded-lg transition flex items-center gap-2">
                                    <i data-lucide="refresh-cw" class="w-4 h-4"></i> Atualizar
                                </button>
                                <button onclick="printKanban()"
                                    class="px-4 py-2 bg-gradient-to-r from-blue-500 to-blue-600 text-white font-bold rounded-lg hover:from-blue-400 hover:to-blue-500 transition flex items-center gap-2">
                                    <i data-lucide="printer" class="w-4 h-4"></i> Imprimir
                                </button>
                            </div>
                        </div>

                        <!-- Kanban Board -->
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                            <!-- Columns injected via JS -->
                        </div>
                    </div>
                </div>

                <!-- Calendar View -->
                <div id="calendar-view" class="view hidden p-6">
                    <div class="max-w-7xl mx-auto">
                        <div class="flex flex-col md:flex-row md:items-center justify-between mb-8">
                            <div>
                                <h2 class="text-2xl font-bold text-white mb-2">Calend√°rio de Servi√ßos</h2>
                                <p class="text-gray-400">Agende e visualize compromissos</p>
                            </div>
                            <div class="flex gap-3 mt-4 md:mt-0">
                                <button onclick="prevMonth()"
                                    class="px-4 py-2 border border-gray-700 text-gray-400 hover:text-white hover:border-gray-600 rounded-lg transition">
                                    <i data-lucide="chevron-left" class="w-4 h-4"></i>
                                </button>
                                <button onclick="today()"
                                    class="px-4 py-2 border border-gray-700 text-gray-400 hover:text-white hover:border-gray-600 rounded-lg transition">
                                    Hoje
                                </button>
                                <button onclick="nextMonth()"
                                    class="px-4 py-2 border border-gray-700 text-gray-400 hover:text-white hover:border-gray-600 rounded-lg transition">
                                    <i data-lucide="chevron-right" class="w-4 h-4"></i>
                                </button>
                            </div>
                        </div>

                        <!-- Calendar -->
                        <div class="glass rounded-xl p-6 mb-6">
                            <div class="mb-6">
                                <h3 id="calendar-month" class="text-xl font-bold text-white text-center">Janeiro 2024
                                </h3>
                            </div>
                            <div class="grid grid-cols-7 gap-2">
                                <!-- Calendar header -->
                                <div class="text-center text-sm font-bold text-gray-500 p-2">Dom</div>
                                <div class="text-center text-sm font-bold text-gray-500 p-2">Seg</div>
                                <div class="text-center text-sm font-bold text-gray-500 p-2">Ter</div>
                                <div class="text-center text-sm font-bold text-gray-500 p-2">Qua</div>
                                <div class="text-center text-sm font-bold text-gray-500 p-2">Qui</div>
                                <div class="text-center text-sm font-bold text-gray-500 p-2">Sex</div>
                                <div class="text-center text-sm font-bold text-gray-500 p-2">S√°b</div>

                                <!-- Calendar days injected via JS -->
                            </div>
                        </div>

                        <!-- Appointments -->
                        <div>
                            <h3 class="text-xl font-bold text-white mb-4">Compromissos de Hoje</h3>
                            <div id="today-appointments" class="space-y-4">
                                <!-- Appointments injected via JS -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Clients View -->
                <div id="clients-view" class="view hidden p-6">
                    <div class="max-w-7xl mx-auto">
                        <div class="flex flex-col md:flex-row md:items-center justify-between mb-8">
                            <div>
                                <h2 class="text-2xl font-bold text-white mb-2">Gest√£o de Clientes</h2>
                                <p class="text-gray-400">Gerencie seu cadastro de clientes</p>
                            </div>
                            <div class="flex gap-3 mt-4 md:mt-0">
                                <button onclick="exportClients()"
                                    class="px-4 py-2 border border-gray-700 text-gray-400 hover:text-white hover:border-gray-600 rounded-lg transition flex items-center gap-2">
                                    <i data-lucide="download" class="w-4 h-4"></i> Exportar
                                </button>
                                <button onclick="addNewClient()"
                                    class="px-4 py-2 bg-gradient-to-r from-blue-500 to-blue-600 text-white font-bold rounded-lg hover:from-blue-400 hover:to-blue-500 transition flex items-center gap-2">
                                    <i data-lucide="user-plus" class="w-4 h-4"></i> Novo Cliente
                                </button>
                            </div>
                        </div>

                        <!-- Clients Grid -->
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8" id="clients-grid">
                            <!-- Clients injected via JS -->
                        </div>

                        <!-- Clients Table -->
                        <div class="glass rounded-xl overflow-hidden">
                            <div class="p-4 border-b border-gray-800 flex flex-col md:flex-row md:items-center gap-4">
                                <div class="flex-1">
                                    <div class="relative">
                                        <input type="text" id="client-search" placeholder="Buscar clientes..."
                                            class="w-full bg-gray-800 border border-gray-700 rounded-lg py-2.5 pl-10 pr-4 text-white placeholder-gray-500 focus:outline-none focus:border-blue-500">
                                        <i data-lucide="search"
                                            class="absolute left-3 top-2.5 w-4 h-4 text-gray-500"></i>
                                    </div>
                                </div>
                                <div class="flex gap-2">
                                    <select id="client-sort" onchange="sortClients()"
                                        class="bg-gray-800 border border-gray-700 rounded-lg px-3 py-2 text-white text-sm focus:outline-none focus:border-blue-500">
                                        <option value="recent">Mais recentes</option>
                                        <option value="name">Nome A-Z</option>
                                        <option value="os">Mais OS</option>
                                        <option value="value">Maior valor</option>
                                    </select>
                                </div>
                            </div>
                            <div class="overflow-x-auto">
                                <table class="w-full">
                                    <thead class="bg-gray-900/50">
                                        <tr>
                                            <th class="text-left p-4 text-gray-400 text-sm font-medium">Cliente</th>
                                            <th class="text-left p-4 text-gray-400 text-sm font-medium">Contato</th>
                                            <th class="text-left p-4 text-gray-400 text-sm font-medium">Total OS</th>
                                            <th class="text-left p-4 text-gray-400 text-sm font-medium">Valor Total</th>
                                            <th class="text-left p-4 text-gray-400 text-sm font-medium">√öltima OS</th>
                                            <th class="text-left p-4 text-gray-400 text-sm font-medium">A√ß√µes</th>
                                        </tr>
                                    </thead>
                                    <tbody id="clients-table-body" class="divide-y divide-gray-800">
                                        <!-- Clients injected via JS -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Technicians View -->
                <div id="technicians-view" class="view hidden p-6">
                    <div class="max-w-7xl mx-auto">
                        <div class="flex flex-col md:flex-row md:items-center justify-between mb-8">
                            <div>
                                <h2 class="text-2xl font-bold text-white mb-2">Gest√£o de T√©cnicos</h2>
                                <p class="text-gray-400">Gerencie sua equipe t√©cnica</p>
                            </div>
                            <button onclick="addNewTechnician()"
                                class="mt-4 md:mt-0 px-4 py-2 bg-gradient-to-r from-blue-500 to-blue-600 text-white font-bold rounded-lg hover:from-blue-400 hover:to-blue-500 transition flex items-center gap-2">
                                <i data-lucide="user-plus" class="w-4 h-4"></i> Novo T√©cnico
                            </button>
                        </div>

                        <!-- Technicians Grid -->
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                            <!-- Technicians injected via JS -->
                        </div>

                        <!-- Performance -->
                        <div class="glass rounded-xl p-6 mb-8">
                            <h3 class="text-xl font-bold text-white mb-6">Desempenho da Equipe</h3>
                            <div class="overflow-x-auto">
                                <table class="w-full">
                                    <thead class="bg-gray-900/50">
                                        <tr>
                                            <th class="text-left p-3 text-gray-400 text-sm font-medium">T√©cnico</th>
                                            <th class="text-left p-3 text-gray-400 text-sm font-medium">OS Ativas</th>
                                            <th class="text-left p-3 text-gray-400 text-sm font-medium">Conclu√≠das</th>
                                            <th class="text-left p-3 text-gray-400 text-sm font-medium">Tempo M√©dio</th>
                                            <th class="text-left p-3 text-gray-400 text-sm font-medium">Satisfa√ß√£o</th>
                                            <th class="text-left p-3 text-gray-400 text-sm font-medium">Status</th>
                                            <th class="text-left p-3 text-gray-400 text-sm font-medium">A√ß√µes</th>
                                        </tr>
                                    </thead>
                                    <tbody id="tech-performance">
                                        <!-- Performance data injected via JS -->
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Schedule -->
                        <div class="glass rounded-xl p-6">
                            <h3 class="text-xl font-bold text-white mb-6">Escala de Trabalho</h3>
                            <div id="tech-schedule" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-7 gap-4">
                                <!-- Schedule injected via JS -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Equipment View -->
                <div id="equipment-view" class="view hidden p-6">
                    <div class="max-w-7xl mx-auto">
                        <div class="flex flex-col md:flex-row md:items-center justify-between mb-8">
                            <div>
                                <h2 class="text-2xl font-bold text-white mb-2">Gest√£o de Equipamentos</h2>
                                <p class="text-gray-400">Cadastro e hist√≥rico de equipamentos</p>
                            </div>
                            <div class="flex gap-3 mt-4 md:mt-0">
                                <button onclick="importEquipment()"
                                    class="px-4 py-2 border border-gray-700 text-gray-400 hover:text-white hover:border-gray-600 rounded-lg transition flex items-center gap-2">
                                    <i data-lucide="upload" class="w-4 h-4"></i> Importar
                                </button>
                                <button onclick="addNewEquipment()"
                                    class="px-4 py-2 bg-gradient-to-r from-blue-500 to-blue-600 text-white font-bold rounded-lg hover:from-blue-400 hover:to-blue-500 transition flex items-center gap-2">
                                    <i data-lucide="plus" class="w-4 h-4"></i> Novo Equipamento
                                </button>
                            </div>
                        </div>

                        <!-- Equipment Stats -->
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                            <div class="glass p-6 rounded-2xl">
                                <div class="flex items-center justify-between mb-4">
                                    <div class="p-3 bg-blue-500/10 rounded-lg">
                                        <i data-lucide="cpu" class="w-6 h-6 text-blue-500"></i>
                                    </div>
                                </div>
                                <h3 class="text-3xl font-bold text-white mb-2" id="equipment-total">0</h3>
                                <p class="text-gray-400">Equipamentos cadastrados</p>
                            </div>

                            <div class="glass p-6 rounded-2xl">
                                <div class="flex items-center justify-between mb-4">
                                    <div class="p-3 bg-green-500/10 rounded-lg">
                                        <i data-lucide="check-circle" class="w-6 h-6 text-green-500"></i>
                                    </div>
                                </div>
                                <h3 class="text-3xl font-bold text-white mb-2" id="equipment-active">0</h3>
                                <p class="text-gray-400">Em garantia</p>
                            </div>

                            <div class="glass p-6 rounded-2xl">
                                <div class="flex items-center justify-between mb-4">
                                    <div class="p-3 bg-amber-500/10 rounded-lg">
                                        <i data-lucide="alert-triangle" class="w-6 h-6 text-amber-500"></i>
                                    </div>
                                </div>
                                <h3 class="text-3xl font-bold text-white mb-2" id="equipment-warranty">0</h3>
                                <p class="text-gray-400">Fora da garantia</p>
                            </div>

                            <div class="glass p-6 rounded-2xl">
                                <div class="flex items-center justify-between mb-4">
                                    <div class="p-3 bg-red-500/10 rounded-lg">
                                        <i data-lucide="x-circle" class="w-6 h-6 text-red-500"></i>
                                    </div>
                                </div>
                                <h3 class="text-3xl font-bold text-white mb-2" id="equipment-inactive">0</h3>
                                <p class="text-gray-400">Irrepar√°veis</p>
                            </div>
                        </div>

                        <!-- Equipment Grid -->
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8" id="equipment-grid">
                            <!-- Equipment cards injected via JS -->
                        </div>

                        <!-- Equipment Table -->
                        <div class="glass rounded-xl overflow-hidden">
                            <div class="p-4 border-b border-gray-800 flex flex-col md:flex-row md:items-center gap-4">
                                <div class="flex-1">
                                    <div class="relative">
                                        <input type="text" id="equipment-search" placeholder="Buscar equipamentos..."
                                            class="w-full bg-gray-800 border border-gray-700 rounded-lg py-2.5 pl-10 pr-4 text-white placeholder-gray-500 focus:outline-none focus:border-blue-500">
                                        <i data-lucide="search"
                                            class="absolute left-3 top-2.5 w-4 h-4 text-gray-500"></i>
                                    </div>
                                </div>
                                <div class="flex gap-2">
                                    <select id="equipment-type-filter" onchange="filterEquipment()"
                                        class="bg-gray-800 border border-gray-700 rounded-lg px-3 py-2 text-white text-sm focus:outline-none focus:border-blue-500">
                                        <option value="">Todos tipos</option>
                                        <option value="notebook">Notebook</option>
                                        <option value="desktop">Desktop</option>
                                        <option value="celular">Celular</option>
                                        <option value="tablet">Tablet</option>
                                        <option value="impressora">Impressora</option>
                                        <option value="outro">Outro</option>
                                    </select>
                                    <select id="equipment-status-filter" onchange="filterEquipment()"
                                        class="bg-gray-800 border border-gray-700 rounded-lg px-3 py-2 text-white text-sm focus:outline-none focus:border-blue-500">
                                        <option value="">Todos status</option>
                                        <option value="ativo">Ativo</option>
                                        <option value="garantia">Garantia</option>
                                        <option value="inativo">Inativo</option>
                                    </select>
                                </div>
                            </div>
                            <div class="overflow-x-auto">
                                <table class="w-full">
                                    <thead class="bg-gray-900/50">
                                        <tr>
                                            <th class="text-left p-4 text-gray-400 text-sm font-medium">Equipamento</th>
                                            <th class="text-left p-4 text-gray-400 text-sm font-medium">Cliente</th>
                                            <th class="text-left p-4 text-gray-400 text-sm font-medium">Marca/Modelo
                                            </th>
                                            <th class="text-left p-4 text-gray-400 text-sm font-medium">N¬∞ S√©rie</th>
                                            <th class="text-left p-4 text-gray-400 text-sm font-medium">OS</th>
                                            <th class="text-left p-4 text-gray-400 text-sm font-medium">Status</th>
                                            <th class="text-left p-4 text-gray-400 text-sm font-medium">A√ß√µes</th>
                                        </tr>
                                    </thead>
                                    <tbody id="equipment-table-body" class="divide-y divide-gray-800">
                                        <!-- Equipment injected via JS -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Stock View -->
                <div id="stock-view" class="view hidden p-6">
                    <div class="max-w-7xl mx-auto">
                        <div class="flex flex-col md:flex-row md:items-center justify-between mb-8">
                            <div>
                                <h2 class="text-2xl font-bold text-white mb-2">Controle de Estoque</h2>
                                <p class="text-gray-400">Pe√ßas, componentes e materiais</p>
                            </div>
                            <div class="flex gap-3 mt-4 md:mt-0">
                                <button onclick="exportStock()"
                                    class="px-4 py-2 border border-gray-700 text-gray-400 hover:text-white hover:border-gray-600 rounded-lg transition flex items-center gap-2">
                                    <i data-lucide="download" class="w-4 h-4"></i> Exportar
                                </button>
                                <button onclick="addStockItem()"
                                    class="px-4 py-2 bg-gradient-to-r from-blue-500 to-blue-600 text-white font-bold rounded-lg hover:from-blue-400 hover:to-blue-500 transition flex items-center gap-2">
                                    <i data-lucide="plus" class="w-4 h-4"></i> Nova Pe√ßa
                                </button>
                            </div>
                        </div>

                        <!-- Stock Alerts -->
                        <div class="mb-8">
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                                <div class="glass p-6 rounded-2xl border-l-4 border-red-500">
                                    <div class="flex items-center justify-between mb-4">
                                        <div>
                                            <h3 class="text-lg font-bold text-white">Estoque Baixo</h3>
                                            <p class="text-sm text-gray-500">Itens abaixo do m√≠nimo</p>
                                        </div>
                                        <div class="p-3 bg-red-500/10 rounded-lg">
                                            <i data-lucide="alert-triangle" class="w-6 h-6 text-red-500"></i>
                                        </div>
                                    </div>
                                    <div id="low-stock-items" class="space-y-2">
                                        <!-- Low stock items injected via JS -->
                                    </div>
                                </div>

                                <div class="glass p-6 rounded-2xl border-l-4 border-amber-500">
                                    <div class="flex items-center justify-between mb-4">
                                        <div>
                                            <h3 class="text-lg font-bold text-white">Pedidos Pendentes</h3>
                                            <p class="text-sm text-gray-500">Aguardando recebimento</p>
                                        </div>
                                        <div class="p-3 bg-amber-500/10 rounded-lg">
                                            <i data-lucide="package" class="w-6 h-6 text-amber-500"></i>
                                        </div>
                                    </div>
                                    <div id="pending-orders" class="space-y-2">
                                        <!-- Pending orders injected via JS -->
                                    </div>
                                </div>

                                <div class="glass p-6 rounded-2xl border-l-4 border-green-500">
                                    <div class="flex items-center justify-between mb-4">
                                        <div>
                                            <h3 class="text-lg font-bold text-white">Valor em Estoque</h3>
                                            <p class="text-sm text-gray-500">Total investido</p>
                                        </div>
                                        <div class="p-3 bg-green-500/10 rounded-lg">
                                            <i data-lucide="dollar-sign" class="w-6 h-6 text-green-500"></i>
                                        </div>
                                    </div>
                                    <h3 id="stock-value" class="text-3xl font-bold text-white">R$ 0,00</h3>
                                </div>
                            </div>
                        </div>

                        <!-- Stock Grid -->
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8" id="stock-grid">
                            <!-- Stock items injected via JS -->
                        </div>

                        <!-- Stock Table -->
                        <div class="glass rounded-xl overflow-hidden">
                            <div class="p-4 border-b border-gray-800 flex flex-col md:flex-row md:items-center gap-4">
                                <div class="flex-1">
                                    <div class="relative">
                                        <input type="text" id="stock-search" placeholder="Buscar pe√ßas..."
                                            class="w-full bg-gray-800 border border-gray-700 rounded-lg py-2.5 pl-10 pr-4 text-white placeholder-gray-500 focus:outline-none focus:border-blue-500">
                                        <i data-lucide="search"
                                            class="absolute left-3 top-2.5 w-4 h-4 text-gray-500"></i>
                                    </div>
                                </div>
                                <div class="flex gap-2">
                                    <select id="stock-category-filter" onchange="filterStock()"
                                        class="bg-gray-800 border border-gray-700 rounded-lg px-3 py-2 text-white text-sm focus:outline-none focus:border-blue-500">
                                        <option value="">Todas categorias</option>
                                        <option value="hardware">Hardware</option>
                                        <option value="periferico">Perif√©rico</option>
                                        <option value="componente">Componente</option>
                                        <option value="consumivel">Consum√≠vel</option>
                                        <option value="ferramenta">Ferramenta</option>
                                    </select>
                                    <select id="stock-status-filter" onchange="filterStock()"
                                        class="bg-gray-800 border border-gray-700 rounded-lg px-3 py-2 text-white text-sm focus:outline-none focus:border-blue-500">
                                        <option value="">Todos status</option>
                                        <option value="disponivel">Dispon√≠vel</option>
                                        <option value="baixo">Estoque Baixo</option>
                                        <option value="esgotado">Esgotado</option>
                                    </select>
                                </div>
                            </div>
                            <div class="overflow-x-auto">
                                <table class="w-full">
                                    <thead class="bg-gray-900/50">
                                        <tr>
                                            <th class="text-left p-4 text-gray-400 text-sm font-medium">Pe√ßa</th>
                                            <th class="text-left p-4 text-gray-400 text-sm font-medium">C√≥digo</th>
                                            <th class="text-left p-4 text-gray-400 text-sm font-medium">Categoria</th>
                                            <th class="text-left p-4 text-gray-400 text-sm font-medium">Estoque</th>
                                            <th class="text-left p-4 text-gray-400 text-sm font-medium">M√≠nimo</th>
                                            <th class="text-left p-4 text-gray-400 text-sm font-medium">Valor Unit.</th>
                                            <th class="text-left p-4 text-gray-400 text-sm font-medium">Total</th>
                                            <th class="text-left p-4 text-gray-400 text-sm font-medium">A√ß√µes</th>
                                        </tr>
                                    </thead>
                                    <tbody id="stock-table-body" class="divide-y divide-gray-800">
                                        <!-- Stock items injected via JS -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Reports View -->
                <div id="reports-view" class="view hidden p-6">
                    <div class="max-w-7xl mx-auto">
                        <div class="flex flex-col md:flex-row md:items-center justify-between mb-8">
                            <div>
                                <h2 class="text-2xl font-bold text-white mb-2">Relat√≥rios e Analytics</h2>
                                <p class="text-gray-400">Estat√≠sticas e insights do seu neg√≥cio</p>
                            </div>
                            <div class="flex gap-3 mt-4 md:mt-0">
                                <select id="reports-period" onchange="updateReports()"
                                    class="bg-gray-800 border border-gray-700 rounded-lg px-3 py-2 text-white text-sm focus:outline-none focus:border-blue-500">
                                    <option value="today">Hoje</option>
                                    <option value="week">Esta semana</option>
                                    <option value="month" selected>Este m√™s</option>
                                    <option value="quarter">Este trimestre</option>
                                    <option value="year">Este ano</option>
                                </select>
                                <button onclick="printReports()"
                                    class="px-4 py-2 bg-gradient-to-r from-blue-500 to-blue-600 text-white font-bold rounded-lg hover:from-blue-400 hover:to-blue-500 transition flex items-center gap-2">
                                    <i data-lucide="printer" class="w-4 h-4"></i> Imprimir
                                </button>
                            </div>
                        </div>

                        <!-- Reports Summary -->
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                            <div class="glass p-6 rounded-2xl">
                                <div class="flex items-center justify-between mb-4">
                                    <div class="p-3 bg-blue-500/10 rounded-lg">
                                        <i data-lucide="clipboard-list" class="w-6 h-6 text-blue-500"></i>
                                    </div>
                                </div>
                                <h3 class="text-3xl font-bold text-white mb-2" id="report-total-os">0</h3>
                                <p class="text-gray-400">Total de OS</p>
                            </div>

                            <div class="glass p-6 rounded-2xl">
                                <div class="flex items-center justify-between mb-4">
                                    <div class="p-3 bg-green-500/10 rounded-lg">
                                        <i data-lucide="dollar-sign" class="w-6 h-6 text-green-500"></i>
                                    </div>
                                </div>
                                <h3 class="text-3xl font-bold text-white mb-2" id="report-revenue">R$ 0</h3>
                                <p class="text-gray-400">Faturamento</p>
                            </div>

                            <div class="glass p-6 rounded-2xl">
                                <div class="flex items-center justify-between mb-4">
                                    <div class="p-3 bg-amber-500/10 rounded-lg">
                                        <i data-lucide="trending-up" class="w-6 h-6 text-amber-500"></i>
                                    </div>
                                </div>
                                <h3 class="text-3xl font-bold text-white mb-2" id="report-growth">0%</h3>
                                <p class="text-gray-400">Crescimento</p>
                            </div>

                            <div class="glass p-6 rounded-2xl">
                                <div class="flex items-center justify-between mb-4">
                                    <div class="p-3 bg-purple-500/10 rounded-lg">
                                        <i data-lucide="clock" class="w-6 h-6 text-purple-500"></i>
                                    </div>
                                </div>
                                <h3 class="text-3xl font-bold text-white mb-2" id="report-avg-time">0h</h3>
                                <p class="text-gray-400">Tempo m√©dio/OS</p>
                            </div>
                        </div>

                        <!-- Charts -->
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                            <!-- OS Status Chart -->
                            <div class="glass rounded-xl p-6">
                                <h3 class="text-xl font-bold text-white mb-6">Distribui√ß√£o por Status</h3>
                                <div id="status-chart" class="h-64 flex items-center justify-center">
                                    <!-- Chart injected via JS -->
                                </div>
                            </div>

                            <!-- Revenue Chart -->
                            <div class="glass rounded-xl p-6">
                                <h3 class="text-xl font-bold text-white mb-6">Faturamento Mensal</h3>
                                <div id="revenue-chart" class="h-64">
                                    <!-- Chart injected via JS -->
                                </div>
                            </div>
                        </div>

                        <!-- Top Lists -->
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                            <!-- Top Clients -->
                            <div class="glass rounded-xl p-6">
                                <h3 class="text-xl font-bold text-white mb-6">Top Clientes</h3>
                                <div id="top-clients" class="space-y-4">
                                    <!-- Top clients injected via JS -->
                                </div>
                            </div>

                            <!-- Top Technicians -->
                            <div class="glass rounded-xl p-6">
                                <h3 class="text-xl font-bold text-white mb-6">Top T√©cnicos</h3>
                                <div id="top-technicians" class="space-y-4">
                                    <!-- Top technicians injected via JS -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Billing View -->
                <div id="billing-view" class="view hidden p-6">
                    <div class="max-w-7xl mx-auto">
                        <div class="flex flex-col md:flex-row md:items-center justify-between mb-8">
                            <div>
                                <h2 class="text-2xl font-bold text-white mb-2">Controle Financeiro</h2>
                                <p class="text-gray-400">Faturamento, despesas e fluxo de caixa</p>
                            </div>
                            <div class="flex gap-3 mt-4 md:mt-0">
                                <button onclick="exportFinancial()"
                                    class="px-4 py-2 border border-gray-700 text-gray-400 hover:text-white hover:border-gray-600 rounded-lg transition flex items-center gap-2">
                                    <i data-lucide="download" class="w-4 h-4"></i> Exportar
                                </button>
                                <button onclick="addPayment()"
                                    class="px-4 py-2 bg-gradient-to-r from-blue-500 to-blue-600 text-white font-bold rounded-lg hover:from-blue-400 hover:to-blue-500 transition flex items-center gap-2">
                                    <i data-lucide="plus" class="w-4 h-4"></i> Novo Pagamento
                                </button>
                            </div>
                        </div>

                        <!-- Financial Summary -->
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                            <div class="glass p-6 rounded-2xl border-l-4 border-green-500">
                                <div class="flex items-center justify-between mb-4">
                                    <div>
                                        <h3 class="text-lg font-bold text-white">Receitas</h3>
                                        <p class="text-sm text-gray-500">Este m√™s</p>
                                    </div>
                                    <div class="p-3 bg-green-500/10 rounded-lg">
                                        <i data-lucide="trending-up" class="w-6 h-6 text-green-500"></i>
                                    </div>
                                </div>
                                <h3 id="income-total" class="text-3xl font-bold text-white">R$ 0,00</h3>
                            </div>

                            <div class="glass p-6 rounded-2xl border-l-4 border-red-500">
                                <div class="flex items-center justify-between mb-4">
                                    <div>
                                        <h3 class="text-lg font-bold text-white">Despesas</h3>
                                        <p class="text-sm text-gray-500">Este m√™s</p>
                                    </div>
                                    <div class="p-3 bg-red-500/10 rounded-lg">
                                        <i data-lucide="trending-down" class="w-6 h-6 text-red-500"></i>
                                    </div>
                                </div>
                                <h3 id="expenses-total" class="text-3xl font-bold text-white">R$ 0,00</h3>
                            </div>

                            <div class="glass p-6 rounded-2xl border-l-4 border-blue-500">
                                <div class="flex items-center justify-between mb-4">
                                    <div>
                                        <h3 class="text-lg font-bold text-white">Saldo</h3>
                                        <p class="text-sm text-gray-500">Dispon√≠vel</p>
                                    </div>
                                    <div class="p-3 bg-blue-500/10 rounded-lg">
                                        <i data-lucide="dollar-sign" class="w-6 h-6 text-blue-500"></i>
                                    </div>
                                </div>
                                <h3 id="balance-total" class="text-3xl font-bold text-white">R$ 0,00</h3>
                            </div>

                            <div class="glass p-6 rounded-2xl border-l-4 border-amber-500">
                                <div class="flex items-center justify-between mb-4">
                                    <div>
                                        <h3 class="text-lg font-bold text-white">Pendentes</h3>
                                        <p class="text-sm text-gray-500">A receber</p>
                                    </div>
                                    <div class="p-3 bg-amber-500/10 rounded-lg">
                                        <i data-lucide="clock" class="w-6 h-6 text-amber-500"></i>
                                    </div>
                                </div>
                                <h3 id="pending-total" class="text-3xl font-bold text-white">R$ 0,00</h3>
                            </div>
                        </div>

                        <!-- Billing Table -->
                        <div class="glass rounded-xl overflow-hidden mb-8">
                            <div class="p-4 border-b border-gray-800 flex flex-col md:flex-row md:items-center gap-4">
                                <div class="flex-1">
                                    <div class="relative">
                                        <input type="text" id="billing-search" placeholder="Buscar pagamentos..."
                                            class="w-full bg-gray-800 border border-gray-700 rounded-lg py-2.5 pl-10 pr-4 text-white placeholder-gray-500 focus:outline-none focus:border-blue-500">
                                        <i data-lucide="search"
                                            class="absolute left-3 top-2.5 w-4 h-4 text-gray-500"></i>
                                    </div>
                                </div>
                                <div class="flex gap-2">
                                    <select id="billing-type-filter" onchange="filterBilling()"
                                        class="bg-gray-800 border border-gray-700 rounded-lg px-3 py-2 text-white text-sm focus:outline-none focus:border-blue-500">
                                        <option value="">Todos tipos</option>
                                        <option value="receita">Receita</option>
                                        <option value="despesa">Despesa</option>
                                    </select>
                                    <select id="billing-status-filter" onchange="filterBilling()"
                                        class="bg-gray-800 border border-gray-700 rounded-lg px-3 py-2 text-white text-sm focus:outline-none focus:border-blue-500">
                                        <option value="">Todos status</option>
                                        <option value="pago">Pago</option>
                                        <option value="pendente">Pendente</option>
                                        <option value="atrasado">Atrasado</option>
                                    </select>
                                </div>
                            </div>
                            <div class="overflow-x-auto">
                                <table class="w-full">
                                    <thead class="bg-gray-900/50">
                                        <tr>
                                            <th class="text-left p-4 text-gray-400 text-sm font-medium">Descri√ß√£o</th>
                                            <th class="text-left p-4 text-gray-400 text-sm font-medium">
                                                Cliente/Fornecedor</th>
                                            <th class="text-left p-4 text-gray-400 text-sm font-medium">Tipo</th>
                                            <th class="text-left p-4 text-gray-400 text-sm font-medium">Valor</th>
                                            <th class="text-left p-4 text-gray-400 text-sm font-medium">Vencimento</th>
                                            <th class="text-left p-4 text-gray-400 text-sm font-medium">Status</th>
                                            <th class="text-left p-4 text-gray-400 text-sm font-medium">A√ß√µes</th>
                                        </tr>
                                    </thead>
                                    <tbody id="billing-table-body" class="divide-y divide-gray-800">
                                        <!-- Billing items injected via JS -->
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Charts -->
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                            <!-- Cash Flow -->
                            <div class="glass rounded-xl p-6">
                                <h3 class="text-xl font-bold text-white mb-6">Fluxo de Caixa</h3>
                                <div id="cashflow-chart" class="h-64">
                                    <!-- Chart injected via JS -->
                                </div>
                            </div>

                            <!-- Payment Methods -->
                            <div class="glass rounded-xl p-6">
                                <h3 class="text-xl font-bold text-white mb-6">Formas de Pagamento</h3>
                                <div id="payment-methods" class="space-y-4">
                                    <!-- Payment methods injected via JS -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Settings View -->
                <div id="settings-view" class="view hidden p-6">
                    <div class="max-w-4xl mx-auto">
                        <h2 class="text-2xl font-bold text-white mb-8">Configura√ß√µes do Sistema</h2>

                        <div class="space-y-8">
                            <!-- Company Settings -->
                            <div class="glass rounded-xl p-6">
                                <h3 class="text-xl font-bold text-white mb-6">Dados da Empresa</h3>
                                <div class="space-y-4">
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div>
                                            <label class="block text-sm text-gray-400 mb-2">Nome da Empresa</label>
                                            <input type="text" id="company-name" value="Assist√™ncia T√©cnica Exemplo"
                                                class="w-full bg-gray-800 border border-gray-700 rounded-lg p-3 text-white focus:outline-none focus:border-blue-500">
                                        </div>
                                        <div>
                                            <label class="block text-sm text-gray-400 mb-2">CNPJ</label>
                                            <input type="text" id="company-cnpj" value="00.000.000/0001-00"
                                                class="w-full bg-gray-800 border border-gray-700 rounded-lg p-3 text-white focus:outline-none focus:border-blue-500">
                                        </div>
                                    </div>
                                    <div>
                                        <label class="block text-sm text-gray-400 mb-2">Endere√ßo</label>
                                        <input type="text" id="company-address" value="Rua Exemplo, 123 - Centro"
                                            class="w-full bg-gray-800 border border-gray-700 rounded-lg p-3 text-white focus:outline-none focus:border-blue-500">
                                    </div>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div>
                                            <label class="block text-sm text-gray-400 mb-2">Telefone</label>
                                            <input type="tel" id="company-phone" value="(11) 99999-9999"
                                                class="w-full bg-gray-800 border border-gray-700 rounded-lg p-3 text-white focus:outline-none focus:border-blue-500">
                                        </div>
                                        <div>
                                            <label class="block text-sm text-gray-400 mb-2">WhatsApp</label>
                                            <input type="tel" id="company-whatsapp" value="(11) 99999-9999"
                                                class="w-full bg-gray-800 border border-gray-700 rounded-lg p-3 text-white focus:outline-none focus:border-blue-500">
                                        </div>
                                    </div>
                                    <div>
                                        <label class="block text-sm text-gray-400 mb-2">E-mail</label>
                                        <input type="email" id="company-email" value="contato@assistencia.com"
                                            class="w-full bg-gray-800 border border-gray-700 rounded-lg p-3 text-white focus:outline-none focus:border-blue-500">
                                    </div>
                                    <button onclick="saveCompanySettings()"
                                        class="w-full md:w-auto px-6 py-3 bg-gradient-to-r from-blue-500 to-blue-600 text-white font-bold rounded-lg hover:from-blue-400 hover:to-blue-500 transition">
                                        Salvar Dados
                                    </button>
                                </div>
                            </div>

                            <!-- OS Settings -->
                            <div class="glass rounded-xl p-6">
                                <h3 class="text-xl font-bold text-white mb-6">Configura√ß√µes de OS</h3>
                                <div class="space-y-4">
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div>
                                            <label class="block text-sm text-gray-400 mb-2">Pr√≥ximo N√∫mero OS</label>
                                            <input type="number" id="next-os-number" value="1001"
                                                class="w-full bg-gray-800 border border-gray-700 rounded-lg p-3 text-white focus:outline-none focus:border-blue-500">
                                        </div>
                                        <div>
                                            <label class="block text-sm text-gray-400 mb-2">Prazo Padr√£o (dias)</label>
                                            <input type="number" id="default-deadline" value="7"
                                                class="w-full bg-gray-800 border border-gray-700 rounded-lg p-3 text-white focus:outline-none focus:border-blue-500">
                                        </div>
                                    </div>
                                    <div>
                                        <label class="block text-sm text-gray-400 mb-2">Termos e Condi√ß√µes</label>
                                        <textarea id="terms-conditions" rows="4"
                                            class="w-full bg-gray-800 border border-gray-700 rounded-lg p-3 text-white focus:outline-none focus:border-blue-500 resize-none">
Este equipamento ser√° avaliado e ser√° fornecido or√ßamento para autoriza√ß√£o do servi√ßo. Pe√ßas substitu√≠das ser√£o devolvidas se solicitado no ato do or√ßamento. Garantia de 90 dias para m√£o de obra e pe√ßas novas. N√£o nos responsabilizamos por dados perdidos.
                                        </textarea>
                                    </div>
                                    <div class="flex items-center gap-2">
                                        <input type="checkbox" id="auto-email" checked
                                            class="rounded border-gray-700 bg-gray-800">
                                        <label for="auto-email" class="text-sm text-gray-400">Enviar e-mail autom√°tico
                                            ao cliente</label>
                                    </div>
                                    <button onclick="saveOSSettings()"
                                        class="w-full md:w-auto px-6 py-3 bg-gradient-to-r from-blue-500 to-blue-600 text-white font-bold rounded-lg hover:from-blue-400 hover:to-blue-500 transition">
                                        Salvar Configura√ß√µes
                                    </button>
                                </div>
                            </div>

                            <!-- Financial Settings -->
                            <div class="glass rounded-xl p-6">
                                <h3 class="text-xl font-bold text-white mb-6">Configura√ß√µes Financeiras</h3>
                                <div class="space-y-4">
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div>
                                            <label class="block text-sm text-gray-400 mb-2">Valor Hora T√©cnica
                                                (R$)</label>
                                            <input type="number" step="0.01" id="hourly-rate" value="80.00"
                                                class="w-full bg-gray-800 border border-gray-700 rounded-lg p-3 text-white focus:outline-none focus:border-blue-500">
                                        </div>
                                        <div>
                                            <label class="block text-sm text-gray-400 mb-2">Margem Pe√ßas (%)</label>
                                            <input type="number" step="0.01" id="parts-margin" value="30.00"
                                                class="w-full bg-gray-800 border border-gray-700 rounded-lg p-3 text-white focus:outline-none focus:border-blue-500">
                                        </div>
                                    </div>
                                    <div>
                                        <label class="block text-sm text-gray-400 mb-2">Formas de Pagamento</label>
                                        <div class="flex flex-wrap gap-3 mt-2">
                                            <label class="flex items-center gap-2">
                                                <input type="checkbox" checked
                                                    class="rounded border-gray-700 bg-gray-800">
                                                <span class="text-sm text-gray-400">Dinheiro</span>
                                            </label>
                                            <label class="flex items-center gap-2">
                                                <input type="checkbox" checked
                                                    class="rounded border-gray-700 bg-gray-800">
                                                <span class="text-sm text-gray-400">Cart√£o Cr√©dito</span>
                                            </label>
                                            <label class="flex items-center gap-2">
                                                <input type="checkbox" checked
                                                    class="rounded border-gray-700 bg-gray-800">
                                                <span class="text-sm text-gray-400">Cart√£o D√©bito</span>
                                            </label>
                                            <label class="flex items-center gap-2">
                                                <input type="checkbox" checked
                                                    class="rounded border-gray-700 bg-gray-800">
                                                <span class="text-sm text-gray-400">PIX</span>
                                            </label>
                                            <label class="flex items-center gap-2">
                                                <input type="checkbox" class="rounded border-gray-700 bg-gray-800">
                                                <span class="text-sm text-gray-400">Boleto</span>
                                            </label>
                                        </div>
                                    </div>
                                    <button onclick="saveFinancialSettings()"
                                        class="w-full md:w-auto px-6 py-3 bg-gradient-to-r from-blue-500 to-blue-600 text-white font-bold rounded-lg hover:from-blue-400 hover:to-blue-500 transition">
                                        Salvar Configura√ß√µes
                                    </button>
                                </div>
                            </div>

                            <!-- System Settings -->
                            <div class="glass rounded-xl p-6">
                                <h3 class="text-xl font-bold text-white mb-6">Configura√ß√µes do Sistema</h3>
                                <div class="space-y-4">
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <p class="text-white font-medium">Modo Escuro</p>
                                            <p class="text-sm text-gray-500">Interface escura para melhor visibilidade
                                            </p>
                                        </div>
                                        <label class="relative inline-flex items-center cursor-pointer">
                                            <input type="checkbox" checked class="sr-only peer">
                                            <div
                                                class="w-12 h-6 bg-gray-700 rounded-full peer peer-checked:bg-blue-500 transition">
                                                <div
                                                    class="absolute top-1 left-1 w-4 h-4 bg-white rounded-full transition-transform peer-checked:translate-x-6">
                                                </div>
                                            </div>
                                        </label>
                                    </div>
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <p class="text-white font-medium">Notifica√ß√µes por Som</p>
                                            <p class="text-sm text-gray-500">Emitir som para novas OS</p>
                                        </div>
                                        <label class="relative inline-flex items-center cursor-pointer">
                                            <input type="checkbox" checked class="sr-only peer">
                                            <div
                                                class="w-12 h-6 bg-gray-700 rounded-full peer peer-checked:bg-blue-500 transition">
                                                <div
                                                    class="absolute top-1 left-1 w-4 h-4 bg-white rounded-full transition-transform peer-checked:translate-x-6">
                                                </div>
                                            </div>
                                        </label>
                                    </div>
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <p class="text-white font-medium">Backup Autom√°tico</p>
                                            <p class="text-sm text-gray-500">Salvar dados automaticamente</p>
                                        </div>
                                        <label class="relative inline-flex items-center cursor-pointer">
                                            <input type="checkbox" checked class="sr-only peer">
                                            <div
                                                class="w-12 h-6 bg-gray-700 rounded-full peer peer-checked:bg-blue-500 transition">
                                                <div
                                                    class="absolute top-1 left-1 w-4 h-4 bg-white rounded-full transition-transform peer-checked:translate-x-6">
                                                </div>
                                            </div>
                                        </label>
                                    </div>
                                    <div class="grid grid-cols-2 gap-4 mt-6">
                                        <button onclick="backupData()"
                                            class="px-4 py-3 bg-blue-500/20 text-blue-500 hover:bg-blue-500/30 rounded-lg transition flex items-center justify-center gap-2">
                                            <i data-lucide="download" class="w-4 h-4"></i> Backup
                                        </button>
                                        <label
                                            class="px-4 py-3 bg-gray-800 text-gray-400 hover:text-white hover:bg-gray-700 rounded-lg transition flex items-center justify-center gap-2 cursor-pointer">
                                            <i data-lucide="upload" class="w-4 h-4"></i> Restaurar
                                            <input type="file" onchange="restoreData(this)" class="hidden"
                                                accept=".json">
                                        </label>
                                    </div>
                                    <div class="pt-4 border-t border-gray-800">
                                        <button onclick="clearAllData()"
                                            class="px-4 py-2 border border-red-500/30 text-red-500 hover:text-red-400 hover:border-red-500 rounded-lg transition">
                                            Limpar Todos os Dados
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Help View -->
                <div id="help-view" class="view hidden p-6">
                    <div class="max-w-4xl mx-auto">
                        <h2 class="text-2xl font-bold text-white mb-8">Ajuda & Suporte</h2>

                        <div class="space-y-6">
                            <!-- FAQ -->
                            <div class="glass rounded-xl p-6">
                                <h3 class="text-xl font-bold text-white mb-6">Perguntas Frequentes</h3>
                                <div class="space-y-4">
                                    <div class="faq-item">
                                        <button onclick="toggleFAQ(this)"
                                            class="w-full text-left flex items-center justify-between p-4 bg-gray-800/50 rounded-lg hover:bg-gray-800 transition">
                                            <span class="font-medium text-white">Como criar uma nova OS?</span>
                                            <i data-lucide="chevron-down" class="w-5 h-5 text-gray-500"></i>
                                        </button>
                                        <div class="faq-answer hidden p-4 text-gray-400">
                                            <p>Clique no bot√£o "Nova OS" na barra lateral ou no dashboard. Preencha os
                                                dados do cliente, equipamento e defeito relatado. O sistema gerar√°
                                                automaticamente um n√∫mero de OS sequencial.</p>
                                        </div>
                                    </div>

                                    <div class="faq-item">
                                        <button onclick="toggleFAQ(this)"
                                            class="w-full text-left flex items-center justify-between p-4 bg-gray-800/50 rounded-lg hover:bg-gray-800 transition">
                                            <span class="font-medium text-white">Como gerar um or√ßamento?</span>
                                            <i data-lucide="chevron-down" class="w-5 h-5 text-gray-500"></i>
                                        </button>
                                        <div class="faq-answer hidden p-4 text-gray-400">
                                            <p>Na OS, v√° para a aba "Or√ßamento" e adicione as pe√ßas necess√°rias e horas
                                                t√©cnicas. O sistema calcula automaticamente o valor total. Voc√™ pode
                                                imprimir ou enviar por e-mail.</p>
                                        </div>
                                    </div>

                                    <div class="faq-item">
                                        <button onclick="toggleFAQ(this)"
                                            class="w-full text-left flex items-center justify-between p-4 bg-gray-800/50 rounded-lg hover:bg-gray-800 transition">
                                            <span class="font-medium text-white">Como usar o scanner de QR Code?</span>
                                            <i data-lucide="chevron-down" class="w-5 h-5 text-gray-500"></i>
                                        </button>
                                        <div class="faq-answer hidden p-4 text-gray-400">
                                            <p>Clique no bot√£o "Scanner QR" na barra lateral. Aponte a c√¢mera para o
                                                c√≥digo do equipamento ou cliente. O sistema identificar√° automaticamente
                                                e preencher√° os dados.</p>
                                        </div>
                                    </div>

                                    <div class="faq-item">
                                        <button onclick="toggleFAQ(this)"
                                            class="w-full text-left flex items-center justify-between p-4 bg-gray-800/50 rounded-lg hover:bg-gray-800 transition">
                                            <span class="font-medium text-white">Como imprimir uma OS?</span>
                                            <i data-lucide="chevron-down" class="w-5 h-5 text-gray-500"></i>
                                        </button>
                                        <div class="faq-answer hidden p-4 text-gray-400">
                                            <p>Abra a OS desejada e clique no bot√£o "Imprimir" no canto superior
                                                direito. O sistema gerar√° um documento profissional pronto para
                                                impress√£o.</p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Support -->
                            <div class="glass rounded-xl p-6">
                                <h3 class="text-xl font-bold text-white mb-6">Suporte T√©cnico</h3>
                                <div class="space-y-4">
                                    <p class="text-gray-400">Precisa de ajuda adicional? Entre em contato com nossa
                                        equipe:</p>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <a href="mailto:suporte@osmanager.com"
                                            class="p-4 bg-gray-800/50 rounded-lg hover:bg-gray-800 transition flex items-center gap-3">
                                            <div
                                                class="w-10 h-10 bg-blue-500/10 rounded-lg flex items-center justify-center">
                                                <i data-lucide="mail" class="w-5 h-5 text-blue-500"></i>
                                            </div>
                                            <div>
                                                <p class="font-medium text-white">E-mail</p>
                                                <p class="text-sm text-gray-500">suporte@osmanager.com</p>
                                            </div>
                                        </a>
                                        <a href="https://wa.me/5511999999999" target="_blank"
                                            class="p-4 bg-gray-800/50 rounded-lg hover:bg-gray-800 transition flex items-center gap-3">
                                            <div
                                                class="w-10 h-10 bg-green-500/10 rounded-lg flex items-center justify-center">
                                                <i data-lucide="message-circle" class="w-5 h-5 text-green-500"></i>
                                            </div>
                                            <div>
                                                <p class="font-medium text-white">WhatsApp</p>
                                                <p class="text-sm text-gray-500">(11) 99999-9999</p>
                                            </div>
                                        </a>
                                    </div>
                                </div>
                            </div>

                            <!-- Documentation -->
                            <div class="glass rounded-xl p-6">
                                <h3 class="text-xl font-bold text-white mb-6">Documenta√ß√£o</h3>
                                <div class="space-y-3">
                                    <a href="#"
                                        class="flex items-center gap-3 p-3 bg-gray-800/50 rounded-lg hover:bg-gray-800 transition">
                                        <i data-lucide="file-text" class="w-5 h-5 text-blue-500"></i>
                                        <div>
                                            <p class="font-medium text-white">Manual do Usu√°rio</p>
                                            <p class="text-sm text-gray-500">Guia completo do sistema</p>
                                        </div>
                                    </a>
                                    <a href="#"
                                        class="flex items-center gap-3 p-3 bg-gray-800/50 rounded-lg hover:bg-gray-800 transition">
                                        <i data-lucide="video" class="w-5 h-5 text-blue-500"></i>
                                        <div>
                                            <p class="font-medium text-white">V√≠deos Tutoriais</p>
                                            <p class="text-sm text-gray-500">Passo a passo em v√≠deo</p>
                                        </div>
                                    </a>
                                    <a href="#"
                                        class="flex items-center gap-3 p-3 bg-gray-800/50 rounded-lg hover:bg-gray-800 transition">
                                        <i data-lucide="download" class="w-5 h-5 text-blue-500"></i>
                                        <div>
                                            <p class="font-medium text-white">Modelos para Download</p>
                                            <p class="text-sm text-gray-500">Formul√°rios e documentos</p>
                                        </div>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Bottom Navigation (Mobile) -->
        <div id="mobile-nav" class="md:hidden fixed bottom-0 left-0 right-0 glass border-t border-gray-800 p-2 z-20">
            <div class="flex justify-around">
                <button onclick="switchView('dashboard')" class="mobile-nav-btn active">
                    <i data-lucide="layout-dashboard" class="w-5 h-5"></i>
                    <span class="text-xs mt-1">Dashboard</span>
                </button>
                <button onclick="switchView('os')" class="mobile-nav-btn">
                    <i data-lucide="clipboard-list" class="w-5 h-5"></i>
                    <span class="text-xs mt-1">OS</span>
                </button>
                <button onclick="createNewOS()" class="mobile-nav-btn">
                    <div
                        class="w-12 h-12 bg-gradient-to-br from-blue-500 to-blue-600 rounded-full flex items-center justify-center -mt-6 shadow-lg">
                        <i data-lucide="plus" class="w-6 h-6 text-white"></i>
                    </div>
                </button>
                <button onclick="switchView('clients')" class="mobile-nav-btn">
                    <i data-lucide="users" class="w-5 h-5"></i>
                    <span class="text-xs mt-1">Clientes</span>
                </button>
                <button onclick="switchView('calendar')" class="mobile-nav-btn">
                    <i data-lucide="calendar" class="w-5 h-5"></i>
                    <span class="text-xs mt-1">Agenda</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Modals -->

    <!-- New OS Modal -->
    <div id="new-os-modal" class="fixed inset-0 bg-black/80 hidden z-50 flex items-center justify-center p-4">
        <div class="bg-gray-900 border border-gray-800 rounded-2xl w-full max-w-4xl max-h-[90vh] overflow-hidden">
            <div class="p-6 border-b border-gray-800 flex justify-between items-center">
                <h3 class="text-xl font-bold text-white">Nova Ordem de Servi√ßo</h3>
                <button onclick="closeModal('new-os-modal')" class="text-gray-500 hover:text-white">
                    <i data-lucide="x" class="w-5 h-5"></i>
                </button>
            </div>
            <div class="p-6 overflow-y-auto max-h-[calc(90vh-120px)]">
                <form id="new-os-form" class="space-y-6">
                    <!-- Client Section -->
                    <div>
                        <h4 class="font-bold text-white mb-4 flex items-center gap-2">
                            <i data-lucide="user" class="w-5 h-5 text-blue-500"></i>
                            Dados do Cliente
                        </h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm text-gray-400 mb-2">Cliente</label>
                                <select
                                    class="w-full bg-gray-800 border border-gray-700 rounded-lg p-3 text-white focus:outline-none focus:border-blue-500">
                                    <option value="">Selecionar cliente</option>
                                    <option value="new">+ Novo Cliente</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm text-gray-400 mb-2">Telefone</label>
                                <input type="tel" placeholder="(11) 99999-9999"
                                    class="w-full bg-gray-800 border border-gray-700 rounded-lg p-3 text-white focus:outline-none focus:border-blue-500">
                            </div>
                        </div>
                    </div>

                    <!-- Equipment Section -->
                    <div>
                        <h4 class="font-bold text-white mb-4 flex items-center gap-2">
                            <i data-lucide="cpu" class="w-5 h-5 text-blue-500"></i>
                            Equipamento
                        </h4>
                        <div class="space-y-4">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm text-gray-400 mb-2">Tipo</label>
                                    <select
                                        class="w-full bg-gray-800 border border-gray-700 rounded-lg p-3 text-white focus:outline-none focus:border-blue-500">
                                        <option value="">Selecionar tipo</option>
                                        <option value="notebook">Notebook</option>
                                        <option value="desktop">Desktop</option>
                                        <option value="celular">Celular</option>
                                        <option value="tablet">Tablet</option>
                                        <option value="impressora">Impressora</option>
                                        <option value="outro">Outro</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm text-gray-400 mb-2">Marca/Modelo</label>
                                    <input type="text" placeholder="Ex: Dell Inspiron 15"
                                        class="w-full bg-gray-800 border border-gray-700 rounded-lg p-3 text-white focus:outline-none focus:border-blue-500">
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm text-gray-400 mb-2">N√∫mero de S√©rie</label>
                                <div class="flex gap-2">
                                    <input type="text" placeholder="SN123456789"
                                        class="flex-1 bg-gray-800 border border-gray-700 rounded-lg p-3 text-white focus:outline-none focus:border-blue-500">
                                    <button type="button" onclick="scanQR('serial')"
                                        class="px-4 bg-blue-500 text-white rounded-lg hover:bg-blue-600">
                                        <i data-lucide="qrcode" class="w-5 h-5"></i>
                                    </button>
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm text-gray-400 mb-2">Acess√≥rios/Anexos</label>
                                <textarea rows="2" placeholder="Carregador, bateria, capa..."
                                    class="w-full bg-gray-800 border border-gray-700 rounded-lg p-3 text-white focus:outline-none focus:border-blue-500"></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- Problem Section -->
                    <div>
                        <h4 class="font-bold text-white mb-4 flex items-center gap-2">
                            <i data-lucide="alert-triangle" class="w-5 h-5 text-blue-500"></i>
                            Defeito Relatado
                        </h4>
                        <div>
                            <textarea rows="4" placeholder="Descreva o problema relatado pelo cliente..."
                                class="w-full bg-gray-800 border border-gray-700 rounded-lg p-3 text-white focus:outline-none focus:border-blue-500"></textarea>
                        </div>
                    </div>

                    <!-- Priority Section -->
                    <div>
                        <h4 class="font-bold text-white mb-4 flex items-center gap-2">
                            <i data-lucide="alert-circle" class="w-5 h-5 text-blue-500"></i>
                            Prioridade e Prazo
                        </h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm text-gray-400 mb-2">Prioridade</label>
                                <select
                                    class="w-full bg-gray-800 border border-gray-700 rounded-lg p-3 text-white focus:outline-none focus:border-blue-500">
                                    <option value="baixa">Baixa</option>
                                    <option value="media">M√©dia</option>
                                    <option value="alta">Alta</option>
                                    <option value="urgente">Urgente</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm text-gray-400 mb-2">Prazo Estimado</label>
                                <input type="date"
                                    class="w-full bg-gray-800 border border-gray-700 rounded-lg p-3 text-white focus:outline-none focus:border-blue-500">
                            </div>
                        </div>
                    </div>

                    <!-- Technician Section -->
                    <div>
                        <h4 class="font-bold text-white mb-4 flex items-center gap-2">
                            <i data-lucide="user-cog" class="w-5 h-5 text-blue-500"></i>
                            T√©cnico Respons√°vel
                        </h4>
                        <div>
                            <select
                                class="w-full bg-gray-800 border border-gray-700 rounded-lg p-3 text-white focus:outline-none focus:border-blue-500">
                                <option value="">Selecionar t√©cnico</option>
                                <option value="tec1">Jo√£o Silva</option>
                                <option value="tec2">Maria Santos</option>
                            </select>
                        </div>
                    </div>
                </form>
            </div>
            <div class="p-6 border-t border-gray-800 flex justify-end gap-3">
                <button onclick="closeModal('new-os-modal')"
                    class="px-4 py-2 border border-gray-700 text-gray-400 hover:text-white hover:border-gray-600 rounded-lg transition">
                    Cancelar
                </button>
                <button type="submit" form="new-os-form"
                    class="px-6 py-2 bg-gradient-to-r from-blue-500 to-blue-600 text-white font-bold rounded-lg hover:from-blue-400 hover:to-blue-500 transition">
                    Criar OS
                </button>
            </div>
        </div>
    </div>

    <!-- OS Details Modal -->
    <div id="os-details-modal" class="fixed inset-0 bg-black/80 hidden z-50 flex items-center justify-center p-4">
        <!-- Modal content injected via JS -->
    </div>

    <!-- QR Scanner Modal -->
    <div id="qr-scanner-modal" class="fixed inset-0 bg-black/80 hidden z-50 flex items-center justify-center p-4">
        <div class="bg-gray-900 border border-gray-800 rounded-2xl w-full max-w-md overflow-hidden">
            <div class="p-6 border-b border-gray-800">
                <h3 class="text-xl font-bold text-white">Scanner QR Code</h3>
                <p class="text-sm text-gray-400 mt-1">Aponte para o c√≥digo do equipamento ou cliente</p>
            </div>
            <div class="p-6">
                <div id="qr-reader" class="w-full h-64 bg-black rounded-lg flex items-center justify-center">
                    <p class="text-gray-500">Scanner inicializando...</p>
                </div>
                <div class="mt-6 text-center">
                    <p class="text-sm text-gray-400">Ou insira o c√≥digo manualmente:</p>
                    <input type="text" id="manual-qr-code" placeholder="C√≥digo do equipamento"
                        class="w-full mt-2 bg-gray-800 border border-gray-700 rounded-lg p-3 text-white text-center font-mono">
                </div>
            </div>
            <div class="p-6 border-t border-gray-800 flex justify-between gap-3">
                <button onclick="closeModal('qr-scanner-modal')"
                    class="px-4 py-2 border border-gray-700 text-gray-400 hover:text-white hover:border-gray-600 rounded-lg transition">
                    Cancelar
                </button>
                <button onclick="processQRCode()"
                    class="px-6 py-2 bg-gradient-to-r from-blue-500 to-blue-600 text-white font-bold rounded-lg hover:from-blue-400 hover:to-blue-500 transition">
                    Confirmar
                </button>
            </div>
        </div>
    </div>

    <!-- Signature Modal -->
    <div id="signature-modal" class="fixed inset-0 bg-black/80 hidden z-50 flex items-center justify-center p-4">
        <div class="bg-gray-900 border border-gray-800 rounded-2xl w-full max-w-md overflow-hidden">
            <div class="p-6 border-b border-gray-800">
                <h3 class="text-xl font-bold text-white">Assinatura Digital</h3>
                <p class="text-sm text-gray-400 mt-1">Assine para aprova√ß√£o do or√ßamento</p>
            </div>
            <div class="p-6">
                <div class="signature-pad w-full h-48 mb-4"></div>
                <div class="flex justify-between items-center">
                    <button onclick="clearSignature()" class="px-4 py-2 text-gray-400 hover:text-white">
                        Limpar
                    </button>
                    <div class="text-sm text-gray-500">
                        Assinatura do cliente
                    </div>
                </div>
            </div>
            <div class="p-6 border-t border-gray-800 flex justify-between gap-3">
                <button onclick="closeModal('signature-modal')"
                    class="px-4 py-2 border border-gray-700 text-gray-400 hover:text-white hover:border-gray-600 rounded-lg transition">
                    Cancelar
                </button>
                <button onclick="saveSignature()"
                    class="px-6 py-2 bg-gradient-to-r from-blue-500 to-blue-600 text-white font-bold rounded-lg hover:from-blue-400 hover:to-blue-500 transition">
                    Salvar Assinatura
                </button>
            </div>
        </div>
    </div>

    <!-- Notifications Panel -->
    <div id="notifications-panel"
        class="fixed inset-y-0 right-0 w-80 bg-gray-900 border-l border-gray-800 transform translate-x-full transition-transform z-40">
        <div class="p-6 border-b border-gray-800">
            <div class="flex items-center justify-between">
                <h3 class="font-bold text-white flex items-center gap-2">
                    <i data-lucide="bell" class="w-5 h-5 text-blue-500"></i>
                    Notifica√ß√µes
                </h3>
                <button onclick="toggleNotifications()" class="text-gray-500 hover:text-white">
                    <i data-lucide="x" class="w-5 h-5"></i>
                </button>
            </div>
        </div>
        <div id="notifications-list" class="p-4 space-y-4 overflow-y-auto h-[calc(100vh-120px)]">
            <!-- Notifications injected via JS -->
        </div>
    </div>

    <!-- PWA Install Instructions -->
    <div id="install-instructions" class="fixed inset-0 bg-black/90 hidden z-50 flex items-center justify-center p-4">
        <div class="bg-gray-900 border border-gray-800 rounded-2xl w-full max-w-md p-6">
            <div class="text-center mb-6">
                <div
                    class="w-16 h-16 mx-auto mb-4 bg-gradient-to-br from-blue-500 to-blue-600 rounded-2xl flex items-center justify-center">
                    <i data-lucide="download" class="w-8 h-8 text-white"></i>
                </div>
                <h3 class="text-xl font-bold text-white mb-2">Instalar OS Manager</h3>
                <p class="text-gray-400">Para instalar o aplicativo:</p>
            </div>
            <div class="space-y-4 mb-6">
                <div class="flex items-start gap-3">
                    <div class="w-8 h-8 bg-blue-500/10 rounded-lg flex items-center justify-center shrink-0">
                        <span class="text-blue-500 font-bold">1</span>
                    </div>
                    <div>
                        <p class="text-white font-medium">No iOS</p>
                        <p class="text-sm text-gray-500">Toque no √≠cone de compartilhar e selecione "Adicionar √† Tela de
                            In√≠cio"</p>
                    </div>
                </div>
                <div class="flex items-start gap-3">
                    <div class="w-8 h-8 bg-blue-500/10 rounded-lg flex items-center justify-center shrink-0">
                        <span class="text-blue-500 font-bold">2</span>
                    </div>
                    <div>
                        <p class="text-white font-medium">No Android</p>
                        <p class="text-sm text-gray-500">Toque no menu (tr√™s pontos) e selecione "Instalar aplicativo"
                        </p>
                    </div>
                </div>
                <div class="flex items-start gap-3">
                    <div class="w-8 h-8 bg-blue-500/10 rounded-lg flex items-center justify-center shrink-0">
                        <span class="text-blue-500 font-bold">3</span>
                    </div>
                    <div>
                        <p class="text-white font-medium">No Computador</p>
                        <p class="text-sm text-gray-500">Clique no √≠cone de instala√ß√£o na barra de endere√ßos</p>
                    </div>
                </div>
            </div>
            <button onclick="closeModal('install-instructions')"
                class="w-full px-6 py-3 bg-gradient-to-r from-blue-500 to-blue-600 text-white font-bold rounded-lg hover:from-blue-400 hover:to-blue-500 transition">
                Entendi
            </button>
        </div>
    </div>

    <!-- Main Application Script -->
    <script>
        // --- PWA FUNCTIONALITY ---
        let deferredPrompt;

        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            setTimeout(() => {
                document.getElementById('install-prompt').classList.add('show');
            }, 3000);
        });

        function installPWA() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        console.log('PWA installed');
                    }
                    deferredPrompt = null;
                });
            }
            document.getElementById('install-prompt').classList.remove('show');
        }

        function dismissInstallPrompt() {
            document.getElementById('install-prompt').classList.remove('show');
        }

        function showInstallInstructions() {
            document.getElementById('install-instructions').classList.remove('hidden');
        }

        // Register Service Worker for PWA
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('service-worker.js')
                    .then(registration => {
                        console.log('ServiceWorker registered: ', registration);
                    })
                    .catch(error => {
                        console.log('ServiceWorker registration failed: ', error);
                    });
            });
        }

        // Offline detection
        window.addEventListener('online', updateOnlineStatus);
        window.addEventListener('offline', updateOnlineStatus);

        function updateOnlineStatus() {
            const offlineStatus = document.getElementById('offline-status');
            if (!navigator.onLine) {
                offlineStatus.classList.remove('hidden');
                showNotification('Voc√™ est√° offline. Algumas funcionalidades podem n√£o estar dispon√≠veis.', 'warning');
            } else {
                offlineStatus.classList.add('hidden');
            }
        }

        // --- APP STATE MANAGEMENT ---
        const appState = {
            currentView: 'dashboard',
            osList: [],
            clients: [],
            technicians: [],
            equipment: [],
            stock: [],
            notifications: [],
            settings: {},
            currentOS: null,
            isSidebarOpen: false,
            isNotificationsOpen: false,
            isUserMenuOpen: false,
            calendarDate: new Date()
        };

        // Sample data for demonstration
        const sampleData = {
            osList: [
                {
                    id: 'OS-2024-001',
                    client: {
                        id: 'CLI-001',
                        name: 'Jo√£o Silva',
                        phone: '(11) 99999-9999',
                        email: 'joao@email.com'
                    },
                    equipment: {
                        type: 'notebook',
                        brand: 'Dell',
                        model: 'Inspiron 15',
                        serial: 'SN123456789',
                        accessories: 'Carregador original'
                    },
                    problem: 'N√£o liga, luz do carregador pisca',
                    diagnosis: 'Placa-m√£e com problema no circuito de alimenta√ß√£o',
                    status: 'execucao',
                    priority: 'alta',
                    technician: { id: 'TEC-001', name: 'Carlos Santos' },
                    createdAt: new Date().toISOString(),
                    deadline: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString(),
                    budget: {
                        parts: [
                            { name: 'Placa-m√£e Dell Inspiron 15', quantity: 1, price: 450.00 }
                        ],
                        labor: 2.5, // hours
                        laborRate: 80.00,
                        total: 650.00
                    },
                    timeline: [
                        { status: 'aberto', date: new Date().toISOString(), user: 'Sistema' },
                        { status: 'analise', date: new Date().toISOString(), user: 'Carlos Santos' },
                        { status: 'aprovado', date: new Date().toISOString(), user: 'Jo√£o Silva' }
                    ]
                }
            ],
            clients: [
                {
                    id: 'CLI-001',
                    name: 'Jo√£o Silva',
                    phone: '(11) 99999-9999',
                    email: 'joao@email.com',
                    address: 'Rua A, 123 - Centro',
                    totalOS: 5,
                    totalSpent: 2450.00,
                    lastOS: new Date().toISOString()
                }
            ],
            technicians: [
                {
                    id: 'TEC-001',
                    name: 'Carlos Santos',
                    phone: '(11) 98888-8888',
                    email: 'carlos@tecnico.com',
                    specialty: ['notebook', 'desktop'],
                    status: 'ativo',
                    rating: 4.8,
                    osCount: 124,
                    hourlyRate: 80.00
                }
            ],
            equipment: [
                {
                    id: 'EQP-001',
                    type: 'notebook',
                    brand: 'Dell',
                    model: 'Inspiron 15',
                    serial: 'SN123456789',
                    clientId: 'CLI-001',
                    purchaseDate: '2022-03-15',
                    warrantyUntil: '2024-03-15',
                    osHistory: ['OS-2024-001']
                }
            ],
            stock: [
                {
                    id: 'STK-001',
                    name: 'Placa-m√£e Dell Inspiron 15',
                    code: 'PM-DELL-15',
                    category: 'hardware',
                    quantity: 3,
                    minQuantity: 2,
                    unitPrice: 450.00,
                    supplier: 'Fornecedor Tech'
                }
            ],
            settings: {
                company: {
                    name: 'Assist√™ncia T√©cnica Exemplo',
                    cnpj: '00.000.000/0001-00',
                    address: 'Rua Exemplo, 123 - Centro',
                    phone: '(11) 99999-9999',
                    whatsapp: '(11) 99999-9999',
                    email: 'contato@assistencia.com'
                },
                os: {
                    nextNumber: 1001,
                    defaultDeadline: 7,
                    terms: 'Termos e condi√ß√µes padr√£o...',
                    autoEmail: true
                },
                financial: {
                    hourlyRate: 80.00,
                    partsMargin: 30.00,
                    paymentMethods: ['dinheiro', 'cartao', 'pix']
                }
            }
        };

        // --- INITIALIZATION ---
        document.addEventListener('DOMContentLoaded', () => {
            // Load saved data
            loadAppData();

            // Initialize time
            updateTime();
            setInterval(updateTime, 60000);

            // Initialize views
            initializeDashboard();
            initializeOSView();
            initializeKanban();
            initializeCalendar();
            initializeClients();
            initializeTechnicians();
            initializeEquipment();
            initializeStock();
            initializeReports();
            initializeBilling();

            // Setup event listeners
            setupEventListeners();

            // Initialize icons
            lucide.createIcons();

            // Hide loading overlay
            setTimeout(() => {
                document.getElementById('loading').style.display = 'none';
                document.getElementById('app').classList.remove('hidden');

                // Show welcome notification
                showNotification('Sistema de OS inicializado com sucesso!', 'success');
            }, 1000);
        });

        function updateTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });
            document.getElementById('current-time').textContent = timeString;
        }

        function loadAppData() {
            const saved = localStorage.getItem('os_manager_data');
            if (saved) {
                try {
                    const data = JSON.parse(saved);
                    appState.osList = data.osList || sampleData.osList;
                    appState.clients = data.clients || sampleData.clients;
                    appState.technicians = data.technicians || sampleData.technicians;
                    appState.equipment = data.equipment || sampleData.equipment;
                    appState.stock = data.stock || sampleData.stock;
                    appState.settings = data.settings || sampleData.settings;
                    appState.notifications = data.notifications || [];
                } catch (e) {
                    console.error('Error loading app data:', e);
                    loadSampleData();
                }
            } else {
                loadSampleData();
            }
        }

        function loadSampleData() {
            appState.osList = [...sampleData.osList];
            appState.clients = [...sampleData.clients];
            appState.technicians = [...sampleData.technicians];
            appState.equipment = [...sampleData.equipment];
            appState.stock = [...sampleData.stock];
            appState.settings = { ...sampleData.settings };
            appState.notifications = [
                {
                    id: 1,
                    type: 'new_os',
                    message: 'Nova OS recebida: OS-2024-001',
                    time: 'h√° 5 minutos',
                    read: false,
                    osId: 'OS-2024-001'
                },
                {
                    id: 2,
                    type: 'os_update',
                    message: 'OS OS-2024-001 mudou para "Em Execu√ß√£o"',
                    time: 'h√° 3 minutos',
                    read: false,
                    osId: 'OS-2024-001'
                },
                {
                    id: 3,
                    type: 'stock_alert',
                    message: 'Estoque baixo: Placa-m√£e Dell Inspiron 15',
                    time: 'h√° 1 hora',
                    read: true,
                    stockId: 'STK-001'
                }
            ];
        }

        function saveAppData() {
            const data = {
                osList: appState.osList,
                clients: appState.clients,
                technicians: appState.technicians,
                equipment: appState.equipment,
                stock: appState.stock,
                settings: appState.settings,
                notifications: appState.notifications
            };
            localStorage.setItem('os_manager_data', JSON.stringify(data));
        }

        // --- VIEW MANAGEMENT ---
        function switchView(viewName) {
            // Hide all views
            document.querySelectorAll('.view').forEach(view => {
                view.classList.remove('active');
                view.classList.add('hidden');
            });

            // Remove active class from sidebar buttons
            document.querySelectorAll('.sidebar-btn').forEach(btn => {
                btn.classList.remove('active');
            });

            document.querySelectorAll('.mobile-nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });

            // Show selected view
            const view = document.getElementById(`${viewName}-view`);
            view.classList.remove('hidden');
            view.classList.add('active');

            // Update active sidebar button
            document.querySelector(`.sidebar-btn[onclick*="${viewName}"]`)?.classList.add('active');
            document.querySelector(`.mobile-nav-btn[onclick*="${viewName}"]`)?.classList.add('active');

            // Update current view
            appState.currentView = viewName;

            // Close sidebar on mobile
            if (window.innerWidth < 768) {
                toggleSidebar();
            }
        }

        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            appState.isSidebarOpen = !appState.isSidebarOpen;

            if (appState.isSidebarOpen) {
                sidebar.classList.remove('hidden');
                sidebar.classList.add('flex');
            } else {
                sidebar.classList.add('hidden');
                sidebar.classList.remove('flex');
            }
        }

        function toggleSearch() {
            const searchBar = document.getElementById('search-bar');
            searchBar.classList.toggle('hidden');
            if (!searchBar.classList.contains('hidden')) {
                document.getElementById('search-input').focus();
            }
        }

        function clearSearch() {
            document.getElementById('search-input').value = '';
            // Implement search clearing logic based on current view
        }

        function toggleNotifications() {
            const panel = document.getElementById('notifications-panel');
            appState.isNotificationsOpen = !appState.isNotificationsOpen;

            if (appState.isNotificationsOpen) {
                panel.classList.remove('translate-x-full');
                updateNotifications();
            } else {
                panel.classList.add('translate-x-full');
            }
        }

        function toggleUserMenu() {
            const menu = document.getElementById('user-menu');
            appState.isUserMenuOpen = !appState.isUserMenuOpen;
            menu.classList.toggle('hidden');
        }

        // Close menus when clicking outside
        document.addEventListener('click', (e) => {
            if (!e.target.closest('#user-menu') && !e.target.closest('[onclick="toggleUserMenu()"]')) {
                document.getElementById('user-menu').classList.add('hidden');
                appState.isUserMenuOpen = false;
            }

            if (!e.target.closest('#notifications-panel') && !e.target.closest('[onclick="toggleNotifications()"]')) {
                document.getElementById('notifications-panel').classList.add('translate-x-full');
                appState.isNotificationsOpen = false;
            }
        });

        // --- DASHBOARD FUNCTIONS ---
        function initializeDashboard() {
            updateDashboardStats();
            updateRecentOS();
            updateActivityTimeline();
        }

        function updateDashboardStats() {
            const today = new Date().toDateString();
            const todayOS = appState.osList.filter(os =>
                new Date(os.createdAt).toDateString() === today
            );

            const openOS = appState.osList.filter(os =>
                ['aberto', 'analise', 'aprovado', 'execucao'].includes(os.status)
            );

            const urgentOS = appState.osList.filter(os =>
                ['alta', 'urgente'].includes(os.priority)
            );

            const completedOS = appState.osList.filter(os =>
                ['concluido', 'entregue'].includes(os.status)
            );

            const totalRevenue = appState.osList.reduce((sum, os) =>
                sum + (os.budget?.total || 0), 0
            );

            // Update stats
            document.getElementById('dashboard-os-hoje').textContent = todayOS.length;
            document.getElementById('dashboard-concluidas').textContent = completedOS.length;
            document.getElementById('stat-os-abertas').textContent = openOS.length;
            document.getElementById('stat-os-urgentes').textContent = urgentOS.length;
            document.getElementById('stat-faturamento').textContent = `R$ ${totalRevenue.toFixed(2)}`;
            document.getElementById('stat-satisfacao').textContent = '4.8';

            // Update top bar stats
            document.getElementById('stats-abertas').textContent = openOS.length;
            document.getElementById('stats-execucao').textContent = appState.osList.filter(os => os.status === 'execucao').length;
            document.getElementById('stats-atrasadas').textContent = appState.osList.filter(os =>
                new Date(os.deadline) < new Date() &&
                !['concluido', 'entregue', 'cancelado'].includes(os.status)
            ).length;

            // Update OS count
            document.getElementById('os-count').textContent = appState.osList.length;
        }

        function updateRecentOS() {
            const container = document.getElementById('recent-os');
            const recentOS = [...appState.osList]
                .sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt))
                .slice(0, 5);

            container.innerHTML = '';
            recentOS.forEach(os => {
                const osEl = document.createElement('div');
                osEl.className = `os-card ${os.status} glass rounded-xl p-4 cursor-pointer`;
                osEl.onclick = () => showOSDetails(os.id);

                const statusText = {
                    'aberto': 'Aberto',
                    'analise': 'An√°lise',
                    'aprovado': 'Aprovado',
                    'execucao': 'Execu√ß√£o',
                    'aguardando': 'Aguardando',
                    'concluido': 'Conclu√≠do',
                    'entregue': 'Entregue',
                    'cancelado': 'Cancelado'
                }[os.status];

                const priorityText = {
                    'baixa': 'Baixa',
                    'media': 'M√©dia',
                    'alta': 'Alta',
                    'urgente': 'Urgente'
                }[os.priority];

                osEl.innerHTML = `
                    <div class="flex items-start justify-between mb-3">
                        <div>
                            <h4 class="font-bold text-white">${os.id}</h4>
                            <p class="text-sm text-gray-500">${os.client.name}</p>
                        </div>
                        <span class="px-3 py-1 rounded-full text-xs font-bold status-${os.status}">
                            ${statusText}
                        </span>
                    </div>
                    <div class="mb-3">
                        <p class="text-sm text-gray-300 truncate">${os.equipment.brand} ${os.equipment.model}</p>
                        <p class="text-xs text-gray-500">${os.problem.substring(0, 60)}...</p>
                    </div>
                    <div class="flex items-center justify-between">
                        <div class="flex items-center gap-2">
                            <span class="px-2 py-1 rounded text-xs font-bold priority-${os.priority}">
                                ${priorityText}
                            </span>
                            <span class="text-xs text-gray-500">
                                <i data-lucide="user" class="w-3 h-3 inline"></i> ${os.technician?.name || '‚Äî'}
                            </span>
                        </div>
                        <div class="text-sm text-gray-400">
                            ${formatDate(os.createdAt)}
                        </div>
                    </div>
                `;

                container.appendChild(osEl);
            });

            lucide.createIcons();
        }

        function updateActivityTimeline() {
            const container = document.getElementById('activity-timeline');
            const activities = [
                { type: 'os_created', user: 'Carlos Santos', os: 'OS-2024-001', time: 'h√° 5 min' },
                { type: 'os_updated', user: 'Jo√£o Silva', os: 'OS-2024-001', time: 'h√° 4 min' },
                { type: 'budget_approved', user: 'Maria Santos', os: 'OS-2024-000', time: 'h√° 2 horas' },
                { type: 'os_completed', user: 'Carlos Santos', os: 'OS-2024-099', time: 'h√° 1 dia' }
            ];

            container.innerHTML = '';
            activities.forEach(activity => {
                const activityEl = document.createElement('div');
                activityEl.className = 'timeline-step';

                const icon = {
                    'os_created': 'plus-circle',
                    'os_updated': 'refresh-cw',
                    'budget_approved': 'check-circle',
                    'os_completed': 'clipboard-check'
                }[activity.type];

                const color = {
                    'os_created': 'text-blue-500',
                    'os_updated': 'text-purple-500',
                    'budget_approved': 'text-green-500',
                    'os_completed': 'text-green-500'
                }[activity.type];

                activityEl.innerHTML = `
                    <div class="flex items-start gap-3">
                        <div class="w-8 h-8 ${color} rounded-lg flex items-center justify-center shrink-0">
                            <i data-lucide="${icon}" class="w-5 h-5"></i>
                        </div>
                        <div class="flex-1">
                            <p class="text-sm text-white">
                                <span class="font-medium">${activity.user}</span>
                                ${activity.type === 'os_created' ? 'criou a OS' :
                        activity.type === 'os_updated' ? 'atualizou a OS' :
                            activity.type === 'budget_approved' ? 'aprovou o or√ßamento da OS' :
                                'concluiu a OS'}
                                <span class="font-mono">${activity.os}</span>
                            </p>
                            <p class="text-xs text-gray-500 mt-1">${activity.time}</p>
                        </div>
                    </div>
                `;
                container.appendChild(activityEl);
            });

            lucide.createIcons();
        }

        // --- OS MANAGEMENT ---
        function initializeOSView() {
            updateOSGrid();
            updateOSFilters();
        }

        function createNewOS() {
            document.getElementById('new-os-modal').classList.remove('hidden');
        }

        function updateOSGrid() {
            const container = document.getElementById('os-grid');
            const emptyState = document.getElementById('os-empty');

            container.innerHTML = '';

            if (appState.osList.length === 0) {
                emptyState.classList.remove('hidden');
                return;
            }

            emptyState.classList.add('hidden');

            appState.osList.forEach(os => {
                const osEl = document.createElement('div');
                osEl.className = `os-card ${os.status} glass rounded-xl p-5 cursor-pointer`;
                osEl.onclick = () => showOSDetails(os.id);

                const statusText = {
                    'aberto': 'Aberto',
                    'analise': 'An√°lise',
                    'aprovado': 'Aprovado',
                    'execucao': 'Execu√ß√£o',
                    'aguardando': 'Aguardando',
                    'concluido': 'Conclu√≠do',
                    'entregue': 'Entregue',
                    'cancelado': 'Cancelado'
                }[os.status];

                const priorityText = {
                    'baixa': 'Baixa',
                    'media': 'M√©dia',
                    'alta': 'Alta',
                    'urgente': 'Urgente'
                }[os.priority];

                // Calculate days until deadline
                const deadline = new Date(os.deadline);
                const today = new Date();
                const diffTime = deadline - today;
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

                osEl.innerHTML = `
                    <div class="flex items-start justify-between mb-4">
                        <div>
                            <h4 class="font-bold text-white text-lg">${os.id}</h4>
                            <p class="text-sm text-gray-500">${os.client.name}</p>
                        </div>
                        <span class="px-3 py-1 rounded-full text-xs font-bold status-${os.status}">
                            ${statusText}
                        </span>
                    </div>
                    
                    <div class="mb-4">
                        <div class="flex items-center gap-2 mb-2">
                            <i data-lucide="cpu" class="w-4 h-4 text-gray-500"></i>
                            <span class="text-sm text-gray-300">${os.equipment.brand} ${os.equipment.model}</span>
                        </div>
                        <p class="text-sm text-gray-400 line-clamp-2">${os.problem}</p>
                    </div>
                    
                    <div class="space-y-3">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center gap-2">
                                <span class="px-2 py-1 rounded text-xs font-bold priority-${os.priority}">
                                    ${priorityText}
                                </span>
                                <span class="text-xs text-gray-500">
                                    <i data-lucide="user" class="w-3 h-3 inline"></i> ${os.technician?.name || '‚Äî'}
                                </span>
                            </div>
                            <span class="text-sm font-bold ${diffDays < 0 ? 'text-red-500' : diffDays <= 2 ? 'text-amber-500' : 'text-green-500'}">
                                ${diffDays < 0 ? 'Atrasada' : `${diffDays}d`}
                            </span>
                        </div>
                        
                        <div class="flex items-center justify-between text-sm">
                            <span class="text-gray-500">Criada em ${formatDate(os.createdAt)}</span>
                            ${os.budget?.total ? `
                                <span class="font-bold text-green-500">R$ ${os.budget.total.toFixed(2)}</span>
                            ` : ''}
                        </div>
                        
                        <div class="flex gap-2 pt-3 border-t border-gray-800">
                            <button onclick="event.stopPropagation(); changeOSStatus('${os.id}')" 
                                    class="flex-1 px-3 py-2 bg-blue-500/20 text-blue-500 hover:bg-blue-500/30 rounded-lg text-sm transition">
                                Alterar Status
                            </button>
                            <button onclick="event.stopPropagation(); printOS('${os.id}')" 
                                    class="flex-1 px-3 py-2 bg-gray-700 text-gray-400 hover:text-white hover:bg-gray-600 rounded-lg text-sm transition">
                                Imprimir
                            </button>
                        </div>
                    </div>
                `;

                container.appendChild(osEl);
            });

            lucide.createIcons();
        }

        function updateOSFilters() {
            const techFilter = document.getElementById('os-technician-filter');
            techFilter.innerHTML = '<option value="">Todos t√©cnicos</option>';

            appState.technicians.forEach(tech => {
                const option = document.createElement('option');
                option.value = tech.id;
                option.textContent = tech.name;
                techFilter.appendChild(option);
            });
        }

        function filterOS() {
            // Implement OS filtering logic
            updateOSGrid();
        }

        function showOSDetails(osId) {
            const os = appState.osList.find(o => o.id === osId);
            if (!os) return;

            appState.currentOS = os;

            const modal = document.getElementById('os-details-modal');
            modal.innerHTML = `
                <div class="bg-gray-900 border border-gray-800 rounded-2xl w-full max-w-6xl max-h-[90vh] overflow-hidden">
                    <div class="p-6 border-b border-gray-800 flex justify-between items-center">
                        <div>
                            <h3 class="text-xl font-bold text-white">${os.id}</h3>
                            <p class="text-sm text-gray-400">Criada em ${formatDateTime(os.createdAt)}</p>
                        </div>
                        <div class="flex items-center gap-3">
                            <button onclick="printOS('${os.id}')" class="p-2 text-gray-400 hover:text-white hover:bg-gray-800 rounded-lg">
                                <i data-lucide="printer" class="w-5 h-5"></i>
                            </button>
                            <button onclick="closeModal('os-details-modal')" class="p-2 text-gray-400 hover:text-white hover:bg-gray-800 rounded-lg">
                                <i data-lucide="x" class="w-5 h-5"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="p-6 overflow-y-auto max-h-[calc(90vh-200px)]">
                        <!-- Tabs -->
                        <div class="flex border-b border-gray-800 mb-6">
                            <button onclick="switchOSTab('info')" class="os-tab active px-4 py-2 font-medium text-white border-b-2 border-blue-500">
                                Informa√ß√µes
                            </button>
                            <button onclick="switchOSTab('budget')" class="os-tab px-4 py-2 font-medium text-gray-400 hover:text-white">
                                Or√ßamento
                            </button>
                            <button onclick="switchOSTab('timeline')" class="os-tab px-4 py-2 font-medium text-gray-400 hover:text-white">
                                Linha do Tempo
                            </button>
                            <button onclick="switchOSTab('photos')" class="os-tab px-4 py-2 font-medium text-gray-400 hover:text-white">
                                Fotos
                            </button>
                        </div>
                        
                        <!-- Info Tab -->
                        <div id="os-info-tab" class="space-y-6">
                            <!-- Client Info -->
                            <div>
                                <h4 class="font-bold text-white mb-3 flex items-center gap-2">
                                    <i data-lucide="user" class="w-5 h-5 text-blue-500"></i>
                                    Dados do Cliente
                                </h4>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div class="bg-gray-800/50 rounded-lg p-4">
                                        <p class="text-sm text-gray-400">Nome</p>
                                        <p class="text-white font-medium">${os.client.name}</p>
                                    </div>
                                    <div class="bg-gray-800/50 rounded-lg p-4">
                                        <p class="text-sm text-gray-400">Telefone</p>
                                        <p class="text-white font-medium">${os.client.phone}</p>
                                    </div>
                                    <div class="bg-gray-800/50 rounded-lg p-4">
                                        <p class="text-sm text-gray-400">E-mail</p>
                                        <p class="text-white font-medium">${os.client.email || '‚Äî'}</p>
                                    </div>
                                    <div class="bg-gray-800/50 rounded-lg p-4">
                                        <p class="text-sm text-gray-400">Endere√ßo</p>
                                        <p class="text-white font-medium">${os.client.address || '‚Äî'}</p>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Equipment Info -->
                            <div>
                                <h4 class="font-bold text-white mb-3 flex items-center gap-2">
                                    <i data-lucide="cpu" class="w-5 h-5 text-blue-500"></i>
                                    Equipamento
                                </h4>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div class="bg-gray-800/50 rounded-lg p-4">
                                        <p class="text-sm text-gray-400">Tipo</p>
                                        <p class="text-white font-medium capitalize">${os.equipment.type}</p>
                                    </div>
                                    <div class="bg-gray-800/50 rounded-lg p-4">
                                        <p class="text-sm text-gray-400">Marca/Modelo</p>
                                        <p class="text-white font-medium">${os.equipment.brand} ${os.equipment.model}</p>
                                    </div>
                                    <div class="bg-gray-800/50 rounded-lg p-4">
                                        <p class="text-sm text-gray-400">N√∫mero de S√©rie</p>
                                        <p class="text-white font-medium font-mono">${os.equipment.serial}</p>
                                    </div>
                                    <div class="bg-gray-800/50 rounded-lg p-4">
                                        <p class="text-sm text-gray-400">Acess√≥rios</p>
                                        <p class="text-white font-medium">${os.equipment.accessories || 'Nenhum'}</p>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Problem & Status -->
                            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                <div>
                                    <h4 class="font-bold text-white mb-3 flex items-center gap-2">
                                        <i data-lucide="alert-triangle" class="w-5 h-5 text-blue-500"></i>
                                        Defeito Relatado
                                    </h4>
                                    <div class="bg-gray-800/50 rounded-lg p-4">
                                        <p class="text-white">${os.problem}</p>
                                    </div>
                                </div>
                                
                                <div>
                                    <h4 class="font-bold text-white mb-3 flex items-center gap-2">
                                        <i data-lucide="activity" class="w-5 h-5 text-blue-500"></i>
                                        Status Atual
                                    </h4>
                                    <div class="bg-gray-800/50 rounded-lg p-4">
                                        <div class="flex items-center justify-between mb-4">
                                            <span class="px-3 py-1 rounded-full text-sm font-bold status-${os.status}">
                                                ${os.status}
                                            </span>
                                            <button onclick="changeOSStatus('${os.id}')" class="px-3 py-1.5 bg-blue-500/20 text-blue-500 rounded-lg text-sm hover:bg-blue-500/30">
                                                Alterar Status
                                            </button>
                                        </div>
                                        <div class="space-y-2">
                                            <div class="flex justify-between">
                                                <span class="text-gray-400">Prioridade:</span>
                                                <span class="text-white font-medium">${os.priority}</span>
                                            </div>
                                            <div class="flex justify-between">
                                                <span class="text-gray-400">T√©cnico:</span>
                                                <span class="text-white">${os.technician?.name || '‚Äî'}</span>
                                            </div>
                                            <div class="flex justify-between">
                                                <span class="text-gray-400">Prazo:</span>
                                                <span class="text-white ${new Date(os.deadline) < new Date() ? 'text-red-500' : ''}">
                                                    ${formatDate(os.deadline)}
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Diagnosis -->
                            ${os.diagnosis ? `
                                <div>
                                    <h4 class="font-bold text-white mb-3 flex items-center gap-2">
                                        <i data-lucide="search" class="w-5 h-5 text-blue-500"></i>
                                        Diagn√≥stico T√©cnico
                                    </h4>
                                    <div class="bg-gray-800/50 rounded-lg p-4">
                                        <p class="text-white">${os.diagnosis}</p>
                                    </div>
                                </div>
                            ` : ''}
                        </div>
                        
                        <!-- Budget Tab (hidden by default) -->
                        <div id="os-budget-tab" class="space-y-6 hidden">
                            <!-- Budget content would go here -->
                        </div>
                        
                        <!-- Timeline Tab (hidden by default) -->
                        <div id="os-timeline-tab" class="space-y-6 hidden">
                            <!-- Timeline content would go here -->
                        </div>
                        
                        <!-- Photos Tab (hidden by default) -->
                        <div id="os-photos-tab" class="space-y-6 hidden">
                            <!-- Photos content would go here -->
                        </div>
                    </div>
                    
                    <div class="p-6 border-t border-gray-800 flex justify-between gap-3">
                        <div class="flex gap-3">
                            <button onclick="sendOSEmail('${os.id}')" class="px-4 py-2 border border-gray-700 text-gray-400 hover:text-white hover:border-gray-600 rounded-lg transition flex items-center gap-2">
                                <i data-lucide="mail" class="w-4 h-4"></i> E-mail
                            </button>
                            <button onclick="sendOSWhatsApp('${os.id}')" class="px-4 py-2 border border-gray-700 text-gray-400 hover:text-white hover:border-gray-600 rounded-lg transition flex items-center gap-2">
                                <i data-lucide="message-circle" class="w-4 h-4"></i> WhatsApp
                            </button>
                        </div>
                        <div class="flex gap-3">
                            <button onclick="closeModal('os-details-modal')" class="px-4 py-2 border border-gray-700 text-gray-400 hover:text-white hover:border-gray-600 rounded-lg transition">
                                Fechar
                            </button>
                            <button onclick="editOS('${os.id}')" class="px-6 py-2 bg-gradient-to-r from-blue-500 to-blue-600 text-white font-bold rounded-lg hover:from-blue-400 hover:to-blue-500 transition">
                                Editar OS
                            </button>
                        </div>
                    </div>
                </div>
            `;

            modal.classList.remove('hidden');
            lucide.createIcons();
        }

        function switchOSTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('[id$="-tab"]').forEach(tab => {
                tab.classList.add('hidden');
            });

            // Remove active class from all tabs
            document.querySelectorAll('.os-tab').forEach(tab => {
                tab.classList.remove('active', 'text-white', 'border-blue-500');
                tab.classList.add('text-gray-400');
            });

            // Show selected tab
            document.getElementById(`os-${tabName}-tab`).classList.remove('hidden');

            // Activate tab button
            event.target.classList.add('active', 'text-white', 'border-blue-500');
            event.target.classList.remove('text-gray-400');
        }

        function changeOSStatus(osId) {
            const os = appState.osList.find(o => o.id === osId);
            if (!os) return;

            const statuses = ['aberto', 'analise', 'aprovado', 'execucao', 'aguardando', 'concluido', 'entregue', 'cancelado'];
            const currentIndex = statuses.indexOf(os.status);
            const nextIndex = (currentIndex + 1) % statuses.length;

            os.status = statuses[nextIndex];

            // Add to timeline
            os.timeline.push({
                status: os.status,
                date: new Date().toISOString(),
                user: 'Usu√°rio Atual'
            });

            saveAppData();
            updateOSGrid();
            updateRecentOS();
            updateDashboardStats();

            showNotification(`Status da OS ${osId} alterado para ${os.status}`, 'success');
        }

        // --- KANBAN FUNCTIONS ---
        function initializeKanban() {
            updateKanbanBoard();
        }

        function updateKanbanBoard() {
            const container = document.querySelector('#kanban-view .grid');
            const statuses = [
                { id: 'aberto', name: 'Aberto', color: 'blue' },
                { id: 'analise', name: 'An√°lise', color: 'purple' },
                { id: 'aprovado', name: 'Aprovado', color: 'green' },
                { id: 'execucao', name: 'Em Execu√ß√£o', color: 'amber' }
            ];

            container.innerHTML = '';

            statuses.forEach(status => {
                const columnOS = appState.osList.filter(os => os.status === status.id);

                const column = document.createElement('div');
                column.className = 'kanban-column p-4';

                column.innerHTML = `
                    <div class="mb-4">
                        <h3 class="font-bold text-white flex items-center gap-2">
                            <span class="w-3 h-3 rounded-full bg-${status.color}-500"></span>
                            ${status.name}
                            <span class="ml-auto bg-gray-800 text-gray-400 text-xs font-bold px-2 py-1 rounded">
                                ${columnOS.length}
                            </span>
                        </h3>
                    </div>
                    
                    <div class="space-y-3" id="kanban-${status.id}">
                        ${columnOS.length === 0 ? `
                            <div class="text-center py-8 text-gray-500">
                                <i data-lucide="inbox" class="w-8 h-8 mx-auto mb-2"></i>
                                <p class="text-sm">Nenhuma OS</p>
                            </div>
                        ` : ''}
                    </div>
                `;

                container.appendChild(column);

                // Add OS cards to column
                const columnContainer = document.getElementById(`kanban-${status.id}`);
                columnOS.forEach(os => {
                    const card = document.createElement('div');
                    card.className = 'os-card glass rounded-lg p-3 cursor-pointer draggable';
                    card.draggable = true;
                    card.dataset.osId = os.id;
                    card.ondragstart = (e) => e.dataTransfer.setData('text/plain', os.id);

                    card.innerHTML = `
                        <div class="mb-2">
                            <h4 class="font-bold text-white text-sm">${os.id}</h4>
                            <p class="text-xs text-gray-400 truncate">${os.client.name}</p>
                        </div>
                        <div class="flex items-center justify-between">
                            <span class="px-2 py-0.5 rounded text-xs priority-${os.priority}">
                                ${os.priority}
                            </span>
                            <span class="text-xs text-gray-500">
                                ${formatDate(os.createdAt)}
                            </span>
                        </div>
                    `;

                    card.onclick = () => showOSDetails(os.id);
                    columnContainer.appendChild(card);
                });
            });

            // Make columns drop targets
            document.querySelectorAll('.kanban-column').forEach(column => {
                column.ondragover = (e) => e.preventDefault();
                column.ondrop = (e) => {
                    e.preventDefault();
                    const osId = e.dataTransfer.getData('text/plain');
                    const newStatus = column.querySelector('h3').textContent.trim().toLowerCase();

                    // Update OS status
                    const os = appState.osList.find(o => o.id === osId);
                    if (os) {
                        const statusMap = {
                            'aberto': 'aberto',
                            'an√°lise': 'analise',
                            'aprovado': 'aprovado',
                            'em execu√ß√£o': 'execucao'
                        };

                        os.status = statusMap[newStatus];
                        saveAppData();
                        updateKanbanBoard();
                        showNotification(`OS ${osId} movida para ${newStatus}`, 'success');
                    }
                };
            });

            lucide.createIcons();
        }

        function refreshKanban() {
            updateKanbanBoard();
            showNotification('Kanban atualizado', 'info');
        }

        // --- CALENDAR FUNCTIONS ---
        function initializeCalendar() {
            updateCalendar();
            updateTodayAppointments();
        }

        function updateCalendar() {
            const monthYear = document.getElementById('calendar-month');
            const daysContainer = document.querySelector('#calendar-view .grid-cols-7');

            const month = appState.calendarDate.getMonth();
            const year = appState.calendarDate.getFullYear();

            // Update month/year display
            const monthNames = ['Janeiro', 'Fevereiro', 'Mar√ßo', 'Abril', 'Maio', 'Junho',
                'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'];
            monthYear.textContent = `${monthNames[month]} ${year}`;

            // Clear days container (skip first 7 header cells)
            const days = Array.from(daysContainer.children).slice(7);
            days.forEach(day => day.remove());

            // Get first day of month
            const firstDay = new Date(year, month, 1).getDay();

            // Get days in month
            const daysInMonth = new Date(year, month + 1, 0).getDate();

            // Add empty cells for days before first day
            for (let i = 0; i < firstDay; i++) {
                const emptyCell = document.createElement('div');
                emptyCell.className = 'h-24';
                daysContainer.appendChild(emptyCell);
            }

            // Add days
            const today = new Date();
            for (let day = 1; day <= daysInMonth; day++) {
                const dayCell = document.createElement('div');
                dayCell.className = 'h-24 p-2 border border-gray-800 rounded-lg';

                // Check if today
                const isToday = today.getDate() === day &&
                    today.getMonth() === month &&
                    today.getFullYear() === year;

                // Check for OS on this day
                const osOnDay = appState.osList.filter(os => {
                    const osDate = new Date(os.createdAt);
                    return osDate.getDate() === day &&
                        osDate.getMonth() === month &&
                        osDate.getFullYear() === year;
                });

                dayCell.innerHTML = `
                    <div class="flex justify-between items-start mb-1">
                        <span class="text-sm font-medium ${isToday ? 'bg-blue-500 text-white px-2 py-1 rounded-full' : 'text-gray-300'}">
                            ${day}
                        </span>
                        ${osOnDay.length > 0 ? `
                            <span class="text-xs bg-blue-500/20 text-blue-500 px-1.5 py-0.5 rounded">
                                ${osOnDay.length}
                            </span>
                        ` : ''}
                    </div>
                    <div class="space-y-1">
                        ${osOnDay.slice(0, 2).map(os => `
                            <div class="text-xs p-1 bg-gray-800 rounded truncate" title="${os.id} - ${os.client.name}">
                                ${os.id}
                            </div>
                        `).join('')}
                        ${osOnDay.length > 2 ? `
                            <div class="text-xs text-gray-500 text-center">+${osOnDay.length - 2} mais</div>
                        ` : ''}
                    </div>
                `;

                dayCell.onclick = () => showDayOS(day, month, year);
                daysContainer.appendChild(dayCell);
            }
        }

        function updateTodayAppointments() {
            const container = document.getElementById('today-appointments');
            const today = new Date();
            const todayOS = appState.osList.filter(os => {
                const osDate = new Date(os.createdAt);
                return osDate.getDate() === today.getDate() &&
                    osDate.getMonth() === today.getMonth() &&
                    osDate.getFullYear() === today.getFullYear();
            });

            container.innerHTML = '';

            if (todayOS.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        <i data-lucide="calendar" class="w-8 h-8 mx-auto mb-2"></i>
                        <p>Nenhum compromisso hoje</p>
                    </div>
                `;
                return;
            }

            todayOS.forEach(os => {
                const appointment = document.createElement('div');
                appointment.className = 'glass rounded-lg p-4';

                appointment.innerHTML = `
                    <div class="flex items-start justify-between mb-2">
                        <div>
                            <h4 class="font-bold text-white">${os.id}</h4>
                            <p class="text-sm text-gray-500">${os.client.name}</p>
                        </div>
                        <span class="px-2 py-1 rounded text-xs status-${os.status}">
                            ${os.status}
                        </span>
                    </div>
                    <div class="text-sm text-gray-400 mb-3">
                        ${os.problem.substring(0, 80)}...
                    </div>
                    <div class="flex items-center justify-between">
                        <span class="text-sm text-gray-500">
                            <i data-lucide="clock" class="w-3 h-3 inline"></i>
                            ${formatTime(os.createdAt)}
                        </span>
                        <button onclick="showOSDetails('${os.id}')" class="text-blue-500 hover:text-blue-400 text-sm">
                            Ver detalhes
                        </button>
                    </div>
                `;

                container.appendChild(appointment);
            });

            lucide.createIcons();
        }

        function prevMonth() {
            appState.calendarDate.setMonth(appState.calendarDate.getMonth() - 1);
            updateCalendar();
        }

        function nextMonth() {
            appState.calendarDate.setMonth(appState.calendarDate.getMonth() + 1);
            updateCalendar();
        }

        function today() {
            appState.calendarDate = new Date();
            updateCalendar();
            updateTodayAppointments();
        }

        // --- CLIENT MANAGEMENT ---
        function initializeClients() {
            updateClientsGrid();
            updateClientsTable();

            // Update client count
            document.getElementById('client-count').textContent = appState.clients.length;
        }

        function addNewClient() {
            // Implementation for adding new client
            showNotification('Funcionalidade de novo cliente em desenvolvimento', 'info');
        }

        function updateClientsGrid() {
            const container = document.getElementById('clients-grid');
            const topClients = [...appState.clients]
                .sort((a, b) => b.totalOS - a.totalOS)
                .slice(0, 4);

            container.innerHTML = '';
            topClients.forEach(client => {
                const clientEl = document.createElement('div');
                clientEl.className = 'glass rounded-xl p-5';

                clientEl.innerHTML = `
                    <div class="flex items-start justify-between mb-4">
                        <div class="flex items-center gap-3">
                            <div class="w-12 h-12 bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl flex items-center justify-center">
                                <span class="font-bold text-white text-lg">${client.name.charAt(0)}</span>
                            </div>
                            <div>
                                <h4 class="font-bold text-white">${client.name}</h4>
                                <p class="text-sm text-gray-500">${client.phone}</p>
                            </div>
                        </div>
                    </div>
                    <div class="space-y-3">
                        <div class="flex justify-between text-sm">
                            <span class="text-gray-500">Total de OS</span>
                            <span class="text-white font-bold">${client.totalOS}</span>
                        </div>
                        <div class="flex justify-between text-sm">
                            <span class="text-gray-500">Valor Total</span>
                            <span class="text-white font-bold">R$ ${client.totalSpent.toFixed(2)}</span>
                        </div>
                        <div class="flex justify-between text-sm">
                            <span class="text-gray-500">√öltima OS</span>
                            <span class="text-white">${formatDate(client.lastOS)}</span>
                        </div>
                    </div>
                    <div class="mt-6 pt-4 border-t border-gray-800">
                        <button onclick="viewClientDetails('${client.id}')" class="w-full px-4 py-2 bg-blue-500/20 text-blue-500 hover:bg-blue-500/30 rounded-lg text-sm transition">
                            Ver Detalhes
                        </button>
                    </div>
                `;

                container.appendChild(clientEl);
            });

            lucide.createIcons();
        }

        function updateClientsTable() {
            const tbody = document.getElementById('clients-table-body');
            tbody.innerHTML = '';

            appState.clients.forEach(client => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-900/50 transition';

                row.innerHTML = `
                    <td class="p-4">
                        <div class="flex items-center gap-3">
                            <div class="w-8 h-8 bg-gradient-to-br from-blue-500 to-blue-600 rounded-lg flex items-center justify-center">
                                <span class="font-bold text-white text-sm">${client.name.charAt(0)}</span>
                            </div>
                            <div>
                                <p class="font-medium text-white">${client.name}</p>
                                <p class="text-sm text-gray-500">${client.email}</p>
                            </div>
                        </div>
                    </td>
                    <td class="p-4">
                        <div>
                            <p class="text-white">${client.phone}</p>
                            <p class="text-sm text-gray-500">${client.address}</p>
                        </div>
                    </td>
                    <td class="p-4">
                        <span class="font-bold text-white">${client.totalOS}</span>
                    </td>
                    <td class="p-4">
                        <span class="font-bold text-white">R$ ${client.totalSpent.toFixed(2)}</span>
                    </td>
                    <td class="p-4">
                        <span class="text-sm text-gray-400">${formatDate(client.lastOS)}</span>
                    </td>
                    <td class="p-4">
                        <div class="flex items-center gap-2">
                            <button onclick="viewClientDetails('${client.id}')" class="p-1.5 text-gray-400 hover:text-white hover:bg-gray-800 rounded-lg transition">
                                <i data-lucide="eye" class="w-4 h-4"></i>
                            </button>
                            <button onclick="messageClient('${client.id}')" class="p-1.5 text-gray-400 hover:text-white hover:bg-gray-800 rounded-lg transition">
                                <i data-lucide="message-circle" class="w-4 h-4"></i>
                            </button>
                            <button onclick="editClient('${client.id}')" class="p-1.5 text-gray-400 hover:text-white hover:bg-gray-800 rounded-lg transition">
                                <i data-lucide="edit" class="w-4 h-4"></i>
                            </button>
                        </div>
                    </td>
                `;

                tbody.appendChild(row);
            });

            lucide.createIcons();
        }

        // --- TECHNICIAN MANAGEMENT ---
        function initializeTechnicians() {
            updateTechniciansGrid();
            updateTechPerformance();
            updateTechSchedule();

            // Update tech count
            document.getElementById('tech-count').textContent = appState.technicians.length;
        }

        function addNewTechnician() {
            // Implementation for adding new technician
            showNotification('Funcionalidade de novo t√©cnico em desenvolvimento', 'info');
        }

        function updateTechniciansGrid() {
            const container = document.querySelector('#technicians-view .grid');
            container.innerHTML = '';

            appState.technicians.forEach(tech => {
                const techEl = document.createElement('div');
                techEl.className = 'glass rounded-xl p-5';

                techEl.innerHTML = `
                    <div class="flex items-start justify-between mb-4">
                        <div class="flex items-center gap-3">
                            <div class="w-12 h-12 bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl flex items-center justify-center">
                                <span class="font-bold text-white text-lg">${tech.name.charAt(0)}</span>
                            </div>
                            <div>
                                <h4 class="font-bold text-white">${tech.name}</h4>
                                <p class="text-sm text-gray-500">${tech.phone}</p>
                            </div>
                        </div>
                        <span class="px-2.5 py-1 rounded-full text-xs font-bold ${tech.status === 'ativo' ? 'bg-green-500/20 text-green-500' : 'bg-gray-500/20 text-gray-500'}">
                            ${tech.status === 'ativo' ? 'Ativo' : 'Inativo'}
                        </span>
                    </div>
                    <div class="space-y-3">
                        <div class="flex justify-between text-sm">
                            <span class="text-gray-500">Especialidade</span>
                            <span class="text-white">${tech.specialty.join(', ')}</span>
                        </div>
                        <div class="flex justify-between text-sm">
                            <span class="text-gray-500">OS Conclu√≠das</span>
                            <span class="text-white font-bold">${tech.osCount}</span>
                        </div>
                        <div class="flex justify-between text-sm">
                            <span class="text-gray-500">Avalia√ß√£o</span>
                            <span class="text-white flex items-center gap-1">
                                <i data-lucide="star" class="w-3 h-3 text-amber-500 fill-amber-500"></i>
                                ${tech.rating.toFixed(1)}
                            </span>
                        </div>
                    </div>
                    <div class="mt-6 pt-4 border-t border-gray-800 flex gap-2">
                        <button onclick="editTechnician('${tech.id}')" class="flex-1 px-3 py-2 border border-gray-700 text-gray-400 hover:text-white hover:border-gray-600 rounded-lg text-sm transition">
                            Editar
                        </button>
                        <button onclick="viewTechStats('${tech.id}')" class="flex-1 px-3 py-2 bg-blue-500/20 text-blue-500 hover:bg-blue-500/30 rounded-lg text-sm transition">
                            Estat√≠sticas
                        </button>
                    </div>
                `;

                container.appendChild(techEl);
            });

            lucide.createIcons();
        }

        function updateTechPerformance() {
            const tbody = document.getElementById('tech-performance');
            tbody.innerHTML = '';

            appState.technicians.forEach(tech => {
                // Calculate performance metrics
                const activeOS = appState.osList.filter(os =>
                    os.technician?.id === tech.id &&
                    ['execucao', 'aguardando'].includes(os.status)
                ).length;

                const completedOS = appState.osList.filter(os =>
                    os.technician?.id === tech.id &&
                    ['concluido', 'entregue'].includes(os.status)
                ).length;

                const row = document.createElement('tr');

                row.innerHTML = `
                    <td class="p-3">
                        <div class="flex items-center gap-3">
                            <div class="w-8 h-8 bg-gradient-to-br from-blue-500 to-blue-600 rounded-lg flex items-center justify-center">
                                <span class="font-bold text-white text-sm">${tech.name.charAt(0)}</span>
                            </div>
                            <span class="text-white">${tech.name}</span>
                        </div>
                    </td>
                    <td class="p-3">
                        <span class="text-white font-bold">${activeOS}</span>
                    </td>
                    <td class="p-3">
                        <span class="text-white font-bold">${completedOS}</span>
                    </td>
                    <td class="p-3">
                        <span class="text-white">2h 30m</span>
                    </td>
                    <td class="p-3">
                        <span class="text-white flex items-center gap-1">
                            <i data-lucide="star" class="w-3 h-3 text-amber-500 fill-amber-500"></i>
                            ${tech.rating.toFixed(1)}
                        </span>
                    </td>
                    <td class="p-3">
                        <span class="px-2.5 py-1 rounded-full text-xs font-bold ${tech.status === 'ativo' ? 'bg-green-500/20 text-green-500' : 'bg-gray-500/20 text-gray-500'}">
                            ${tech.status === 'ativo' ? 'Ativo' : 'Inativo'}
                        </span>
                    </td>
                    <td class="p-3">
                        <div class="flex gap-2">
                            <button onclick="editTechnician('${tech.id}')" class="p-1.5 text-gray-400 hover:text-white hover:bg-gray-800 rounded-lg">
                                <i data-lucide="edit" class="w-4 h-4"></i>
                            </button>
                            <button onclick="messageTechnician('${tech.id}')" class="p-1.5 text-gray-400 hover:text-white hover:bg-gray-800 rounded-lg">
                                <i data-lucide="message-circle" class="w-4 h-4"></i>
                            </button>
                        </div>
                    </td>
                `;

                tbody.appendChild(row);
            });

            lucide.createIcons();
        }

        function updateTechSchedule() {
            const container = document.getElementById('tech-schedule');
            const days = ['Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'S√°b', 'Dom'];

            container.innerHTML = '';
            days.forEach(day => {
                const dayEl = document.createElement('div');
                dayEl.className = 'glass rounded-lg p-4';

                // Simulate schedule
                const techsToday = appState.technicians.slice(0, Math.min(2, appState.technicians.length));

                dayEl.innerHTML = `
                    <h4 class="font-bold text-white mb-3">${day}</h4>
                    <div class="space-y-2">
                        ${techsToday.map(tech => `
                            <div class="text-sm p-2 bg-gray-800/50 rounded">
                                <p class="text-white font-medium">${tech.name}</p>
                                <p class="text-xs text-gray-500">08:00 - 18:00</p>
                            </div>
                        `).join('')}
                        ${techsToday.length === 0 ? `
                            <p class="text-sm text-gray-500 text-center py-2">Folga</p>
                        ` : ''}
                    </div>
                `;

                container.appendChild(dayEl);
            });
        }

        // --- EQUIPMENT MANAGEMENT ---
        function initializeEquipment() {
            updateEquipmentStats();
            updateEquipmentGrid();
            updateEquipmentTable();
        }

        function addNewEquipment() {
            // Implementation for adding new equipment
            showNotification('Funcionalidade de novo equipamento em desenvolvimento', 'info');
        }

        function updateEquipmentStats() {
            document.getElementById('equipment-total').textContent = appState.equipment.length;
            document.getElementById('equipment-active').textContent = appState.equipment.filter(e =>
                new Date(e.warrantyUntil) > new Date()
            ).length;
            document.getElementById('equipment-warranty').textContent = appState.equipment.filter(e =>
                new Date(e.warrantyUntil) <= new Date()
            ).length;
            document.getElementById('equipment-inactive').textContent = 0; // Would need inactive status field
        }

        function updateEquipmentGrid() {
            const container = document.getElementById('equipment-grid');
            const recentEquipment = [...appState.equipment].slice(0, 6);

            container.innerHTML = '';
            recentEquipment.forEach(equipment => {
                const client = appState.clients.find(c => c.id === equipment.clientId);

                const eqEl = document.createElement('div');
                eqEl.className = 'glass rounded-xl p-5';

                const isUnderWarranty = new Date(equipment.warrantyUntil) > new Date();

                eqEl.innerHTML = `
                    <div class="flex items-start justify-between mb-4">
                        <div>
                            <h4 class="font-bold text-white">${equipment.brand} ${equipment.model}</h4>
                            <p class="text-sm text-gray-500 capitalize">${equipment.type}</p>
                        </div>
                        ${isUnderWarranty ? `
                            <span class="px-2 py-1 bg-green-500/20 text-green-500 text-xs font-bold rounded-full">
                                Garantia
                            </span>
                        ` : ''}
                    </div>
                    <div class="space-y-3 mb-4">
                        <div class="flex justify-between text-sm">
                            <span class="text-gray-500">Cliente</span>
                            <span class="text-white">${client?.name || '‚Äî'}</span>
                        </div>
                        <div class="flex justify-between text-sm">
                            <span class="text-gray-500">N¬∞ S√©rie</span>
                            <span class="text-white font-mono">${equipment.serial}</span>
                        </div>
                        <div class="flex justify-between text-sm">
                            <span class="text-gray-500">Garantia at√©</span>
                            <span class="text-white ${isUnderWarranty ? 'text-green-500' : 'text-red-500'}">
                                ${formatDate(equipment.warrantyUntil)}
                            </span>
                        </div>
                    </div>
                    <div class="pt-4 border-t border-gray-800">
                        <button onclick="viewEquipmentHistory('${equipment.id}')" class="w-full px-4 py-2 bg-blue-500/20 text-blue-500 hover:bg-blue-500/30 rounded-lg text-sm transition">
                            Ver Hist√≥rico
                        </button>
                    </div>
                `;

                container.appendChild(eqEl);
            });

            lucide.createIcons();
        }

        function updateEquipmentTable() {
            const tbody = document.getElementById('equipment-table-body');
            tbody.innerHTML = '';

            appState.equipment.forEach(equipment => {
                const client = appState.clients.find(c => c.id === equipment.clientId);
                const osCount = equipment.osHistory?.length || 0;
                const isUnderWarranty = new Date(equipment.warrantyUntil) > new Date();

                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-900/50 transition';

                row.innerHTML = `
                    <td class="p-4">
                        <div class="flex items-center gap-3">
                            <div class="w-8 h-8 bg-gradient-to-br from-blue-500 to-blue-600 rounded-lg flex items-center justify-center">
                                <i data-lucide="cpu" class="w-4 h-4 text-white"></i>
                            </div>
                            <div>
                                <p class="font-medium text-white">${equipment.brand} ${equipment.model}</p>
                                <p class="text-sm text-gray-500 capitalize">${equipment.type}</p>
                            </div>
                        </div>
                    </td>
                    <td class="p-4">
                        <span class="text-white">${client?.name || '‚Äî'}</span>
                    </td>
                    <td class="p-4">
                        <span class="text-white">${equipment.brand}/${equipment.model}</span>
                    </td>
                    <td class="p-4">
                        <span class="font-mono text-white">${equipment.serial}</span>
                    </td>
                    <td class="p-4">
                        <span class="text-white font-bold">${osCount}</span>
                    </td>
                    <td class="p-4">
                        <span class="px-2.5 py-1 rounded-full text-xs font-bold ${isUnderWarranty ? 'bg-green-500/20 text-green-500' : 'bg-gray-500/20 text-gray-500'}">
                            ${isUnderWarranty ? 'Garantia' : 'Sem garantia'}
                        </span>
                    </td>
                    <td class="p-4">
                        <div class="flex items-center gap-2">
                            <button onclick="viewEquipmentDetails('${equipment.id}')" class="p-1.5 text-gray-400 hover:text-white hover:bg-gray-800 rounded-lg transition">
                                <i data-lucide="eye" class="w-4 h-4"></i>
                            </button>
                            <button onclick="editEquipment('${equipment.id}')" class="p-1.5 text-gray-400 hover:text-white hover:bg-gray-800 rounded-lg transition">
                                <i data-lucide="edit" class="w-4 h-4"></i>
                            </button>
                        </div>
                    </td>
                `;

                tbody.appendChild(row);
            });

            lucide.createIcons();
        }

        // --- STOCK MANAGEMENT ---
        function initializeStock() {
            updateStockAlerts();
            updateStockGrid();
            updateStockTable();
        }

        function addStockItem() {
            // Implementation for adding stock item
            showNotification('Funcionalidade de nova pe√ßa em desenvolvimento', 'info');
        }

        function updateStockAlerts() {
            const lowStockContainer = document.getElementById('low-stock-items');
            const pendingOrdersContainer = document.getElementById('pending-orders');
            const stockValueElement = document.getElementById('stock-value');

            // Low stock items
            const lowStock = appState.stock.filter(item => item.quantity <= item.minQuantity);
            lowStockContainer.innerHTML = lowStock.length === 0 ?
                '<p class="text-sm text-gray-500">Nenhum item com estoque baixo</p>' :
                lowStock.map(item => `
                    <div class="flex justify-between items-center">
                        <span class="text-sm text-white truncate">${item.name}</span>
                        <span class="text-sm text-red-500 font-bold">${item.quantity}</span>
                    </div>
                `).join('');

            // Pending orders (simulated)
            pendingOrdersContainer.innerHTML = `
                <div class="flex justify-between items-center">
                    <span class="text-sm text-white truncate">Processadores Intel i7</span>
                    <span class="text-sm text-amber-500">Aguardando</span>
                </div>
                <div class="flex justify-between items-center">
                    <span class="text-sm text-white truncate">Mem√≥rias DDR4 8GB</span>
                    <span class="text-sm text-amber-500">Aguardando</span>
                </div>
            `;

            // Stock value
            const totalValue = appState.stock.reduce((sum, item) =>
                sum + (item.quantity * item.unitPrice), 0
            );
            stockValueElement.textContent = `R$ ${totalValue.toFixed(2)}`;
        }

        function updateStockGrid() {
            const container = document.getElementById('stock-grid');
            const lowStock = appState.stock.filter(item => item.quantity <= item.minQuantity).slice(0, 4);

            container.innerHTML = '';
            lowStock.forEach(item => {
                const stockEl = document.createElement('div');
                stockEl.className = 'glass rounded-xl p-5 border-l-4 border-red-500';

                stockEl.innerHTML = `
                    <div class="flex items-start justify-between mb-4">
                        <div>
                            <h4 class="font-bold text-white">${item.name}</h4>
                            <p class="text-sm text-gray-500">${item.code}</p>
                        </div>
                        <div class="p-2 bg-red-500/10 rounded-lg">
                            <i data-lucide="alert-triangle" class="w-5 h-5 text-red-500"></i>
                        </div>
                    </div>
                    <div class="space-y-3">
                        <div class="flex justify-between text-sm">
                            <span class="text-gray-500">Estoque</span>
                            <span class="text-white font-bold ${item.quantity === 0 ? 'text-red-500' : 'text-amber-500'}">
                                ${item.quantity}
                            </span>
                        </div>
                        <div class="flex justify-between text-sm">
                            <span class="text-gray-500">M√≠nimo</span>
                            <span class="text-white">${item.minQuantity}</span>
                        </div>
                        <div class="flex justify-between text-sm">
                            <span class="text-gray-500">Valor Unit.</span>
                            <span class="text-white">R$ ${item.unitPrice.toFixed(2)}</span>
                        </div>
                    </div>
                    <div class="mt-6 pt-4 border-t border-gray-800">
                        <button onclick="orderStockItem('${item.id}')" class="w-full px-4 py-2 bg-red-500/20 text-red-500 hover:bg-red-500/30 rounded-lg text-sm transition">
                            Solicitar Compra
                        </button>
                    </div>
                `;

                container.appendChild(stockEl);
            });

            // Fill with regular items if not enough low stock items
            if (lowStock.length < 4) {
                const regularItems = appState.stock
                    .filter(item => item.quantity > item.minQuantity)
                    .slice(0, 4 - lowStock.length);

                regularItems.forEach(item => {
                    const stockEl = document.createElement('div');
                    stockEl.className = 'glass rounded-xl p-5';

                    stockEl.innerHTML = `
                        <div class="flex items-start justify-between mb-4">
                            <div>
                                <h4 class="font-bold text-white">${item.name}</h4>
                                <p class="text-sm text-gray-500">${item.code}</p>
                            </div>
                            <div class="p-2 bg-green-500/10 rounded-lg">
                                <i data-lucide="check-circle" class="w-5 h-5 text-green-500"></i>
                            </div>
                        </div>
                        <div class="space-y-3">
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-500">Estoque</span>
                                <span class="text-white font-bold text-green-500">
                                    ${item.quantity}
                                </span>
                            </div>
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-500">M√≠nimo</span>
                                <span class="text-white">${item.minQuantity}</span>
                            </div>
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-500">Valor Unit.</span>
                                <span class="text-white">R$ ${item.unitPrice.toFixed(2)}</span>
                            </div>
                        </div>
                        <div class="mt-6 pt-4 border-t border-gray-800">
                            <button onclick="viewStockItem('${item.id}')" class="w-full px-4 py-2 bg-blue-500/20 text-blue-500 hover:bg-blue-500/30 rounded-lg text-sm transition">
                                Ver Detalhes
                            </button>
                        </div>
                    `;

                    container.appendChild(stockEl);
                });
            }

            lucide.createIcons();
        }

        function updateStockTable() {
            const tbody = document.getElementById('stock-table-body');
            tbody.innerHTML = '';

            appState.stock.forEach(item => {
                const totalValue = item.quantity * item.unitPrice;
                const isLowStock = item.quantity <= item.minQuantity;

                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-900/50 transition';

                row.innerHTML = `
                    <td class="p-4">
                        <div class="flex items-center gap-3">
                            <div class="w-8 h-8 bg-gradient-to-br from-blue-500 to-blue-600 rounded-lg flex items-center justify-center">
                                <i data-lucide="package" class="w-4 h-4 text-white"></i>
                            </div>
                            <div>
                                <p class="font-medium text-white">${item.name}</p>
                                <p class="text-sm text-gray-500">${item.supplier}</p>
                            </div>
                        </div>
                    </td>
                    <td class="p-4">
                        <span class="font-mono text-white">${item.code}</span>
                    </td>
                    <td class="p-4">
                        <span class="text-white capitalize">${item.category}</span>
                    </td>
                    <td class="p-4">
                        <span class="font-bold text-white ${isLowStock ? 'text-red-500' : 'text-green-500'}">
                            ${item.quantity}
                        </span>
                    </td>
                    <td class="p-4">
                        <span class="text-white">${item.minQuantity}</span>
                    </td>
                    <td class="p-4">
                        <span class="text-white">R$ ${item.unitPrice.toFixed(2)}</span>
                    </td>
                    <td class="p-4">
                        <span class="font-bold text-white">R$ ${totalValue.toFixed(2)}</span>
                    </td>
                    <td class="p-4">
                        <div class="flex items-center gap-2">
                            <button onclick="useStockItem('${item.id}')" class="p-1.5 text-gray-400 hover:text-white hover:bg-gray-800 rounded-lg transition">
                                <i data-lucide="package-minus" class="w-4 h-4"></i>
                            </button>
                            <button onclick="addStockItemQuantity('${item.id}')" class="p-1.5 text-gray-400 hover:text-white hover:bg-gray-800 rounded-lg transition">
                                <i data-lucide="package-plus" class="w-4 h-4"></i>
                            </button>
                            <button onclick="editStockItem('${item.id}')" class="p-1.5 text-gray-400 hover:text-white hover:bg-gray-800 rounded-lg transition">
                                <i data-lucide="edit" class="w-4 h-4"></i>
                            </button>
                        </div>
                    </td>
                `;

                tbody.appendChild(row);
            });

            lucide.createIcons();
        }

        // --- REPORTS FUNCTIONS ---
        function initializeReports() {
            updateReports();
        }

        function updateReports() {
            const period = document.getElementById('reports-period').value;

            // Calculate reports based on period
            const totalOS = appState.osList.length;
            const totalRevenue = appState.osList.reduce((sum, os) => sum + (os.budget?.total || 0), 0);

            document.getElementById('report-total-os').textContent = totalOS;
            document.getElementById('report-revenue').textContent = `R$ ${totalRevenue.toFixed(2)}`;
            document.getElementById('report-growth').textContent = '15%'; // Simulated
            document.getElementById('report-avg-time').textContent = '2h 30m'; // Simulated

            updateStatusChart();
            updateRevenueChart();
            updateTopClients();
            updateTopTechnicians();
        }

        function updateStatusChart() {
            const container = document.getElementById('status-chart');

            // Count OS by status
            const statusCount = {
                'aberto': 0,
                'analise': 0,
                'aprovado': 0,
                'execucao': 0,
                'aguardando': 0,
                'concluido': 0,
                'entregue': 0,
                'cancelado': 0
            };

            appState.osList.forEach(os => {
                statusCount[os.status]++;
            });

            // Create simple chart with divs
            container.innerHTML = `
                <div class="w-full h-full flex items-end gap-1">
                    ${Object.entries(statusCount).map(([status, count]) => {
                const height = (count / Math.max(...Object.values(statusCount))) * 100;
                return `
                            <div class="flex-1 flex flex-col items-center">
                                <div class="w-full status-${status} rounded-t" style="height: ${height}%"></div>
                                <span class="text-xs text-gray-500 mt-1">${status.charAt(0).toUpperCase()}</span>
                            </div>
                        `;
            }).join('')}
                </div>
            `;
        }

        function updateRevenueChart() {
            const container = document.getElementById('revenue-chart');

            // Simulated monthly revenue
            const months = ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun', 'Jul', 'Ago', 'Set', 'Out', 'Nov', 'Dez'];
            const revenue = months.map(() => Math.floor(Math.random() * 10000) + 1000);
            const maxRevenue = Math.max(...revenue);

            container.innerHTML = `
                <div class="w-full h-full flex items-end gap-2 px-4">
                    ${revenue.map((value, index) => {
                const height = (value / maxRevenue) * 80;
                return `
                            <div class="flex-1 flex flex-col items-center group">
                                <div class="w-full bg-gradient-to-t from-blue-500/30 to-blue-500/10 rounded-t-lg relative group-hover:from-blue-500 group-hover:to-blue-600 transition-all" style="height: ${height}%">
                                    <div class="absolute -top-8 left-1/2 transform -translate-x-1/2 bg-black text-white text-xs px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap">
                                        R$ ${value.toFixed(2)}
                                    </div>
                                </div>
                                <span class="text-xs text-gray-500 mt-2">${months[index]}</span>
                            </div>
                        `;
            }).join('')}
                </div>
            `;
        }

        function updateTopClients() {
            const container = document.getElementById('top-clients');
            const topClients = [...appState.clients]
                .sort((a, b) => b.totalSpent - a.totalSpent)
                .slice(0, 5);

            container.innerHTML = '';
            topClients.forEach((client, index) => {
                const clientEl = document.createElement('div');
                clientEl.className = 'flex items-center justify-between';

                clientEl.innerHTML = `
                    <div class="flex items-center gap-3">
                        <div class="w-8 h-8 bg-gradient-to-br from-blue-500 to-blue-600 rounded-lg flex items-center justify-center">
                            <span class="text-white font-bold text-sm">${client.name.charAt(0)}</span>
                        </div>
                        <div>
                            <p class="font-medium text-white">${client.name}</p>
                            <p class="text-xs text-gray-500">${client.totalOS} OS</p>
                        </div>
                    </div>
                    <span class="font-bold text-white">R$ ${client.totalSpent.toFixed(2)}</span>
                `;
                container.appendChild(clientEl);
            });
        }

        function updateTopTechnicians() {
            const container = document.getElementById('top-technicians');
            const topTechs = [...appState.technicians]
                .sort((a, b) => b.osCount - a.osCount)
                .slice(0, 5);

            container.innerHTML = '';
            topTechs.forEach(tech => {
                const techEl = document.createElement('div');
                techEl.className = 'flex items-center justify-between';

                techEl.innerHTML = `
                    <div class="flex items-center gap-3">
                        <div class="w-8 h-8 bg-gradient-to-br from-blue-500 to-blue-600 rounded-lg flex items-center justify-center">
                            <span class="text-white font-bold text-sm">${tech.name.charAt(0)}</span>
                        </div>
                        <div>
                            <p class="font-medium text-white">${tech.name}</p>
                            <p class="text-xs text-gray-500">${tech.osCount} OS</p>
                        </div>
                    </div>
                    <span class="flex items-center gap-1 text-amber-500">
                        <i data-lucide="star" class="w-3 h-3 fill-amber-500"></i>
                        ${tech.rating.toFixed(1)}
                    </span>
                `;
                container.appendChild(techEl);
            });

            lucide.createIcons();
        }

        // --- BILLING FUNCTIONS ---
        function initializeBilling() {
            updateBillingSummary();
            updateBillingTable();
        }

        function addPayment() {
            // Implementation for adding payment
            showNotification('Funcionalidade de novo pagamento em desenvolvimento', 'info');
        }

        function updateBillingSummary() {
            // Simulated financial data
            const income = appState.osList.reduce((sum, os) => sum + (os.budget?.total || 0), 0);
            const expenses = 1500.00; // Simulated
            const pending = 750.00; // Simulated

            document.getElementById('income-total').textContent = `R$ ${income.toFixed(2)}`;
            document.getElementById('expenses-total').textContent = `R$ ${expenses.toFixed(2)}`;
            document.getElementById('balance-total').textContent = `R$ ${(income - expenses).toFixed(2)}`;
            document.getElementById('pending-total').textContent = `R$ ${pending.toFixed(2)}`;
        }

        function updateBillingTable() {
            const tbody = document.getElementById('billing-table-body');

            // Simulated billing data
            const billingItems = [
                { desc: 'OS-2024-001', client: 'Jo√£o Silva', type: 'receita', value: 650.00, due: '2024-01-15', status: 'pago' },
                { desc: 'OS-2024-002', client: 'Maria Santos', type: 'receita', value: 320.00, due: '2024-01-20', status: 'pendente' },
                { desc: 'Compra de pe√ßas', client: 'Fornecedor Tech', type: 'despesa', value: 450.00, due: '2024-01-10', status: 'pago' },
                { desc: 'Aluguel', client: 'Imobili√°ria', type: 'despesa', value: 1200.00, due: '2024-01-05', status: 'pago' }
            ];

            tbody.innerHTML = '';
            billingItems.forEach(item => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-900/50 transition';

                const statusColor = item.status === 'pago' ? 'green' :
                    item.status === 'pendente' ? 'amber' : 'red';

                row.innerHTML = `
                    <td class="p-4">
                        <span class="text-white">${item.desc}</span>
                    </td>
                    <td class="p-4">
                        <span class="text-white">${item.client}</span>
                    </td>
                    <td class="p-4">
                        <span class="text-white capitalize">${item.type}</span>
                    </td>
                    <td class="p-4">
                        <span class="font-bold ${item.type === 'receita' ? 'text-green-500' : 'text-red-500'}">
                            R$ ${item.value.toFixed(2)}
                        </span>
                    </td>
                    <td class="p-4">
                        <span class="text-white">${formatDate(item.due)}</span>
                    </td>
                    <td class="p-4">
                        <span class="px-2.5 py-1 rounded-full text-xs font-bold bg-${statusColor}-500/20 text-${statusColor}-500">
                            ${item.status}
                        </span>
                    </td>
                    <td class="p-4">
                        <div class="flex items-center gap-2">
                            <button class="p-1.5 text-gray-400 hover:text-white hover:bg-gray-800 rounded-lg transition">
                                <i data-lucide="eye" class="w-4 h-4"></i>
                            </button>
                            <button class="p-1.5 text-gray-400 hover:text-white hover:bg-gray-800 rounded-lg transition">
                                <i data-lucide="edit" class="w-4 h-4"></i>
                            </button>
                        </div>
                    </td>
                `;

                tbody.appendChild(row);
            });

            lucide.createIcons();
        }

        // --- UTILITY FUNCTIONS ---
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('pt-BR');
        }

        function formatTime(dateString) {
            const date = new Date(dateString);
            return date.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });
        }

        function formatDateTime(dateString) {
            const date = new Date(dateString);
            return date.toLocaleString('pt-BR');
        }

        function showNotification(message, type = 'info') {
            // Create notification element
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 px-4 py-3 rounded-lg shadow-lg z-50 notification-slide ${type === 'success' ? 'bg-gradient-to-r from-green-500 to-emerald-600' : type === 'warning' ? 'bg-gradient-to-r from-amber-500 to-orange-600' : type === 'error' ? 'bg-gradient-to-r from-red-500 to-pink-600' : 'bg-gradient-to-r from-blue-500 to-blue-600'} text-white`;

            notification.innerHTML = `
                <div class="flex items-center gap-3">
                    <i data-lucide="${type === 'success' ? 'check-circle' : type === 'warning' ? 'alert-triangle' : type === 'error' ? 'x-circle' : 'info'}" class="w-5 h-5"></i>
                    <span>${message}</span>
                </div>
            `;

            document.body.appendChild(notification);
            lucide.createIcons();

            // Auto remove
            setTimeout(() => {
                notification.style.opacity = '0';
                notification.style.transform = 'translateX(100%)';
                setTimeout(() => notification.remove(), 300);
            }, 5000);
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.add('hidden');
        }

        function openSettings() {
            switchView('settings');
            toggleUserMenu();
        }

        function logout() {
            if (confirm('Tem certeza que deseja sair?')) {
                window.location.reload();
            }
        }

        function printOS(osId = null) {
            if (osId) {
                // Print specific OS
                showNotification(`Imprimindo OS ${osId}`, 'info');
            } else {
                // Print current view
                window.print();
            }
        }

        function printReports() {
            window.print();
        }

        function openQRScanner() {
            document.getElementById('qr-scanner-modal').classList.remove('hidden');
        }

        function processQRCode() {
            const code = document.getElementById('manual-qr-code').value;
            if (code) {
                showNotification(`C√≥digo processado: ${code}`, 'success');
                closeModal('qr-scanner-modal');
            }
        }

        function openSignature() {
            document.getElementById('signature-modal').classList.remove('hidden');
        }

        function clearSignature() {
            // Implementation for clearing signature pad
        }

        function saveSignature() {
            showNotification('Assinatura salva com sucesso', 'success');
            closeModal('signature-modal');
        }

        function toggleFAQ(button) {
            const answer = button.nextElementSibling;
            const icon = button.querySelector('i');

            answer.classList.toggle('hidden');
            if (answer.classList.contains('hidden')) {
                icon.setAttribute('data-lucide', 'chevron-down');
            } else {
                icon.setAttribute('data-lucide', 'chevron-up');
            }
            lucide.createIcons();
        }

        function backupData() {
            const data = {
                osList: appState.osList,
                clients: appState.clients,
                technicians: appState.technicians,
                equipment: appState.equipment,
                stock: appState.stock,
                settings: appState.settings,
                notifications: appState.notifications,
                version: '1.0.0',
                exported: new Date().toISOString()
            };

            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `backup_os_manager_${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            showNotification('Backup realizado com sucesso!', 'success');
        }

        function restoreData(input) {
            const file = input.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const data = JSON.parse(e.target.result);

                    // Validate backup structure
                    if (!data.osList) {
                        throw new Error('Formato de backup inv√°lido');
                    }

                    // Restore data
                    appState.osList = data.osList || [];
                    appState.clients = data.clients || [];
                    appState.technicians = data.technicians || [];
                    appState.equipment = data.equipment || [];
                    appState.stock = data.stock || [];
                    appState.settings = data.settings || {};
                    appState.notifications = data.notifications || [];

                    saveAppData();

                    // Refresh all views
                    initializeDashboard();
                    initializeOSView();
                    initializeKanban();
                    initializeCalendar();
                    initializeClients();
                    initializeTechnicians();
                    initializeEquipment();
                    initializeStock();
                    initializeReports();
                    initializeBilling();

                    showNotification('Dados restaurados com sucesso!', 'success');
                } catch (err) {
                    console.error(err);
                    showNotification('Erro ao restaurar backup. Verifique o arquivo.', 'error');
                }
            };
            reader.readAsText(file);
        }

        function clearAllData() {
            if (confirm('Tem certeza que deseja limpar todos os dados? Esta a√ß√£o n√£o pode ser desfeita.')) {
                localStorage.removeItem('os_manager_data');
                window.location.reload();
            }
        }

        function saveCompanySettings() {
            const settings = appState.settings.company;
            settings.name = document.getElementById('company-name').value;
            settings.cnpj = document.getElementById('company-cnpj').value;
            settings.address = document.getElementById('company-address').value;
            settings.phone = document.getElementById('company-phone').value;
            settings.whatsapp = document.getElementById('company-whatsapp').value;
            settings.email = document.getElementById('company-email').value;

            saveAppData();
            showNotification('Dados da empresa salvos', 'success');
        }

        function saveOSSettings() {
            const settings = appState.settings.os;
            settings.nextNumber = parseInt(document.getElementById('next-os-number').value);
            settings.defaultDeadline = parseInt(document.getElementById('default-deadline').value);
            settings.terms = document.getElementById('terms-conditions').value;
            settings.autoEmail = document.getElementById('auto-email').checked;

            saveAppData();
            showNotification('Configura√ß√µes de OS salvas', 'success');
        }

        function saveFinancialSettings() {
            const settings = appState.settings.financial;
            settings.hourlyRate = parseFloat(document.getElementById('hourly-rate').value);
            settings.partsMargin = parseFloat(document.getElementById('parts-margin').value);

            saveAppData();
            showNotification('Configura√ß√µes financeiras salvas', 'success');
        }

        // --- EVENT LISTENERS SETUP ---
        function setupEventListeners() {
            // Update offline status on load
            updateOnlineStatus();

            // Handle form submissions
            document.getElementById('new-os-form')?.addEventListener('submit', (e) => {
                e.preventDefault();

                // Generate new OS ID
                const nextNumber = appState.settings.os.nextNumber;
                const newOSId = `OS-${new Date().getFullYear()}-${String(nextNumber).padStart(3, '0')}`;

                // Create new OS
                const newOS = {
                    id: newOSId,
                    client: {
                        id: 'CLI-NEW',
                        name: 'Novo Cliente',
                        phone: '(11) 99999-9999'
                    },
                    equipment: {
                        type: 'notebook',
                        brand: 'Marca',
                        model: 'Modelo',
                        serial: 'SN000000000',
                        accessories: 'Nenhum'
                    },
                    problem: 'Problema n√£o especificado',
                    status: 'aberto',
                    priority: 'media',
                    technician: { id: 'TEC-001', name: 'T√©cnico Principal' },
                    createdAt: new Date().toISOString(),
                    deadline: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString(),
                    timeline: [
                        { status: 'aberto', date: new Date().toISOString(), user: 'Sistema' }
                    ]
                };

                appState.osList.unshift(newOS);
                appState.settings.os.nextNumber = nextNumber + 1;
                saveAppData();

                // Update views
                updateOSGrid();
                updateDashboardStats();
                updateRecentOS();
                updateKanbanBoard();

                closeModal('new-os-modal');
                showNotification(`OS ${newOSId} criada com sucesso!`, 'success');
            });

            // Handle search input
            document.getElementById('search-input')?.addEventListener('input', (e) => {
                const searchTerm = e.target.value.toLowerCase();
                // Implement search functionality based on current view
            });

            // Handle OS search
            document.getElementById('os-search')?.addEventListener('input', (e) => {
                const searchTerm = e.target.value.toLowerCase();
                // Filter OS grid
                const osCards = document.querySelectorAll('#os-grid .os-card');

                osCards.forEach(card => {
                    const osId = card.querySelector('h4').textContent.toLowerCase();
                    const clientName = card.querySelector('.text-gray-500').textContent.toLowerCase();
                    const equipment = card.querySelector('.text-gray-300').textContent.toLowerCase();
                    const problem = card.querySelector('.text-gray-400')?.textContent.toLowerCase() || '';

                    const matches = osId.includes(searchTerm) ||
                        clientName.includes(searchTerm) ||
                        equipment.includes(searchTerm) ||
                        problem.includes(searchTerm);

                    card.style.display = matches ? 'block' : 'none';
                });
            });
        }

        // Add CSS for sidebar and mobile nav
        const style = document.createElement('style');
        style.textContent = `
            .sidebar-btn {
                display: flex;
                align-items: center;
                gap: 12px;
                padding: 12px 16px;
                border-radius: 12px;
                width: 100%;
                text-align: left;
                transition: all 0.2s;
                color: #9CA3AF;
                font-weight: 500;
            }
            
            .sidebar-btn:hover {
                background: rgba(255, 255, 255, 0.05);
                color: #FFFFFF;
            }
            
            .sidebar-btn.active {
                background: linear-gradient(135deg, rgba(59, 130, 246, 0.2) 0%, rgba(37, 99, 235, 0.2) 100%);
                color: #3B82F6;
                border-left: 4px solid #3B82F6;
            }
            
            .sidebar-badge {
                background: #EF4444;
                color: white;
                font-size: 11px;
                font-weight: bold;
                padding: 2px 6px;
                border-radius: 9999px;
                margin-left: auto;
            }
            
            .mobile-nav-btn {
                display: flex;
                flex-direction: column;
                align-items: center;
                padding: 8px;
                color: #9CA3AF;
                flex: 1;
            }
            
            .mobile-nav-btn.active {
                color: #3B82F6;
            }
            
            .status-aberto { color: white; background: linear-gradient(135deg, #3B82F6 0%, #1D4ED8 100%); }
            .status-analise { color: white; background: linear-gradient(135deg, #8B5CF6 0%, #7C3AED 100%); }
            .status-aprovado { color: white; background: linear-gradient(135deg, #10B981 0%, #059669 100%); }
            .status-execucao { color: white; background: linear-gradient(135deg, #F59E0B 0%, #D97706 100%); }
            .status-aguardando { color: white; background: linear-gradient(135deg, #EC4899 0%, #DB2777 100%); }
            .status-concluido { color: white; background: linear-gradient(135deg, #6B7280 0%, #4B5563 100%); }
            .status-entregue { color: white; background: linear-gradient(135deg, #10B981 0%, #059669 100%); }
            .status-cancelado { color: white; background: linear-gradient(135deg, #EF4444 0%, #DC2626 100%); }
            
            .priority-baixa { color: white; background: linear-gradient(135deg, #10B981 0%, #059669 100%); }
            .priority-media { color: white; background: linear-gradient(135deg, #F59E0B 0%, #D97706 100%); }
            .priority-alta { color: white; background: linear-gradient(135deg, #EF4444 0%, #DC2626 100%); }
            .priority-urgente { color: white; background: linear-gradient(135deg, #8B5CF6 0%, #7C3AED 100%); }
            
            .line-clamp-2 {
                display: -webkit-box;
                -webkit-line-clamp: 2;
                -webkit-box-orient: vertical;
                overflow: hidden;
            }
            
            .draggable {
                cursor: grab;
            }
            
            .draggable:active {
                cursor: grabbing;
            }
        `;
        document.head.appendChild(style);
    </script>

    <!-- Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            // Create a simple service worker
            const swContent = `
                self.addEventListener('install', (event) => {
                    event.waitUntil(
                        caches.open('os-manager-v1').then((cache) => {
                            return cache.addAll([
                                '/',
                                '/index.html',
                                '/manifest.json'
                            ]);
                        })
                    );
                });
                
                self.addEventListener('fetch', (event) => {
                    event.respondWith(
                        caches.match(event.request).then((response) => {
                            return response || fetch(event.request);
                        })
                    );
                });
            `;

            // Create and register service worker
            const blob = new Blob([swContent], { type: 'application/javascript' });
            const swUrl = URL.createObjectURL(blob);

            navigator.serviceWorker.register(swUrl)
                .then(() => console.log('Service Worker registered'))
                .catch(error => console.log('Service Worker registration failed:', error));
        }
    </script>
</body>

</html>