<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Plena Delivery | Sistema de Gest√£o</title>

    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#18181B">
    <meta name="description" content="Sistema completo de delivery para restaurantes e estabelecimentos">
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/svg+xml"
        href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üöö</text></svg>">
    <link rel="apple-touch-icon" href="/icons/icon-192.png">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        plena: {
                            primary: '#10B981',    // Green for Delivery
                            secondary: '#3B82F6',  // Blue
                            accent: '#8B5CF6',     // Purple
                            warning: '#F59E0B',    // Amber
                            danger: '#EF4444',     // Red
                            dark: '#18181B',
                            darker: '#09090B',
                            light: '#F4F4F5'
                        }
                    },
                    fontFamily: {
                        brand: ['Oswald', 'sans-serif'],
                        sans: ['Inter', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace']
                    },
                    animation: {
                        'slide-in': 'slideIn 0.3s ease-out',
                        'slide-up': 'slideUp 0.3s ease-out',
                        'fade-in': 'fadeIn 0.5s ease-out',
                        'pulse-subtle': 'pulseSubtle 2s infinite',
                        'bounce-subtle': 'bounceSubtle 0.6s infinite',
                        'spin-slow': 'spin 3s linear infinite'
                    },
                    keyframes: {
                        slideIn: {
                            '0%': { transform: 'translateX(-100%)' },
                            '100%': { transform: 'translateX(0)' }
                        },
                        slideUp: {
                            '0%': { transform: 'translateY(100%)' },
                            '100%': { transform: 'translateY(0)' }
                        },
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' }
                        },
                        pulseSubtle: {
                            '0%, 100%': { opacity: '1' },
                            '50%': { opacity: '0.8' }
                        },
                        bounceSubtle: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-5px)' }
                        }
                    }
                }
            }
        }
    </script>

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>

    <!-- Google Fonts -->
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Oswald:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap"
        rel="stylesheet">

    <!-- MapLibre (for maps) -->
    <script src='https://unpkg.com/maplibre-gl@latest/dist/maplibre-gl.js'></script>
    <link href='https://unpkg.com/maplibre-gl@latest/dist/maplibre-gl.css' rel='stylesheet' />

    <!-- QR Code Library -->
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>

    <style>
        :root {
            --plena-primary: #10B981;
            --plena-dark: #18181B;
            --plena-darker: #09090B;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #09090B 0%, #18181B 100%);
            color: #F4F4F5;
        }

        /* PWA Install Prompt */
        #install-prompt {
            transform: translateY(100%);
            transition: transform 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        #install-prompt.show {
            transform: translateY(0);
        }

        /* Order Status Colors */
        .status-pending {
            background: linear-gradient(135deg, #F59E0B 0%, #D97706 100%);
        }

        .status-preparing {
            background: linear-gradient(135deg, #3B82F6 0%, #1D4ED8 100%);
        }

        .status-ready {
            background: linear-gradient(135deg, #8B5CF6 0%, #7C3AED 100%);
        }

        .status-onway {
            background: linear-gradient(135deg, #10B981 0%, #059669 100%);
        }

        .status-delivered {
            background: linear-gradient(135deg, #6B7280 0%, #4B5563 100%);
        }

        .status-cancelled {
            background: linear-gradient(135deg, #EF4444 0%, #DC2626 100%);
        }

        /* Order Card Glow */
        .order-card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border-left: 4px solid transparent;
        }

        .order-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.5);
        }

        .order-card.pending {
            border-left-color: #F59E0B;
        }

        .order-card.preparing {
            border-left-color: #3B82F6;
        }

        .order-card.ready {
            border-left-color: #8B5CF6;
        }

        .order-card.onway {
            border-left-color: #10B981;
        }

        .order-card.delivered {
            border-left-color: #6B7280;
        }

        .order-card.cancelled {
            border-left-color: #EF4444;
        }

        /* Map Container */
        #map {
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.5);
        }

        /* Driver Marker Animation */
        .driver-marker {
            animation: bounceSubtle 0.6s infinite;
        }

        /* Statistics Cards */
        .stat-card {
            background: linear-gradient(135deg, rgba(24, 24, 27, 0.8) 0%, rgba(9, 9, 11, 0.8) 100%);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Print Styles */
        @media print {
            .no-print {
                display: none !important;
            }

            body {
                background: white !important;
                color: black !important;
            }
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #27272A;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: #10B981;
            border-radius: 4px;
        }

        /* Loading Spinner */
        .spinner {
            border: 3px solid rgba(16, 185, 129, 0.3);
            border-top: 3px solid #10B981;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        /* Notification Badge */
        .notification-badge {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.5;
            }
        }
    </style>
</head>

<body class="flex flex-col h-screen overflow-hidden">

    <!-- Install Prompt -->
    <div id="install-prompt"
        class="fixed bottom-0 left-0 right-0 bg-gradient-to-r from-plena-dark to-plena-darker border-t border-zinc-800 p-4 z-50 shadow-2xl">
        <div class="max-w-7xl mx-auto flex items-center justify-between">
            <div class="flex items-center gap-3">
                <div
                    class="w-10 h-10 bg-gradient-to-br from-green-500 to-emerald-600 rounded-xl flex items-center justify-center">
                    <i data-lucide="package" class="w-5 h-5 text-white"></i>
                </div>
                <div>
                    <p class="font-bold text-white">Instalar Plena Delivery</p>
                    <p class="text-sm text-zinc-400">Tenha acesso r√°pido ao sistema</p>
                </div>
            </div>
            <div class="flex gap-2">
                <button onclick="dismissInstallPrompt()" class="px-4 py-2 text-zinc-400 hover:text-white">
                    Agora n√£o
                </button>
                <button onclick="installPWA()"
                    class="px-4 py-2 bg-gradient-to-r from-green-500 to-emerald-600 text-white font-bold rounded-lg hover:from-green-400 hover:to-emerald-500 transition">
                    Instalar
                </button>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loading" class="fixed inset-0 bg-plena-darker flex flex-col items-center justify-center z-50">
        <div class="spinner w-12 h-12 mb-4"></div>
        <p class="text-zinc-400">Carregando sistema de delivery...</p>
    </div>

    <!-- Main App Container -->
    <div id="app" class="flex flex-col h-full hidden">

        <!-- Top Bar -->
        <div class="bg-plena-dark border-b border-zinc-800 p-4 shrink-0">
            <div class="max-w-7xl mx-auto flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <div
                        class="w-10 h-10 bg-gradient-to-br from-green-500 to-emerald-600 rounded-xl flex items-center justify-center shadow-lg shadow-green-500/20">
                        <i data-lucide="package" class="w-5 h-5 text-white"></i>
                    </div>
                    <div>
                        <h1 class="font-brand font-bold text-xl text-white">Plena<span
                                class="text-green-500">Delivery</span></h1>
                        <p class="text-xs text-zinc-500 -mt-1" id="current-time">--:--</p>
                    </div>
                </div>

                <div class="flex items-center gap-4">
                    <!-- Notifications -->
                    <div class="relative">
                        <button onclick="toggleNotifications()"
                            class="p-2 text-zinc-400 hover:text-white hover:bg-zinc-800 rounded-lg transition relative">
                            <i data-lucide="bell" class="w-5 h-5"></i>
                            <span id="notification-count"
                                class="absolute -top-1 -right-1 bg-red-500 text-white text-xs w-5 h-5 rounded-full flex items-center justify-center hidden">0</span>
                        </button>
                    </div>

                    <!-- User Menu -->
                    <div class="relative">
                        <button onclick="toggleUserMenu()"
                            class="flex items-center gap-2 p-2 text-zinc-400 hover:text-white hover:bg-zinc-800 rounded-lg transition">
                            <div
                                class="w-8 h-8 bg-gradient-to-br from-green-500 to-emerald-600 rounded-full flex items-center justify-center">
                                <span class="font-bold text-white text-sm">AD</span>
                            </div>
                            <span class="hidden md:inline text-sm">Admin</span>
                            <i data-lucide="chevron-down" class="w-4 h-4 hidden md:inline"></i>
                        </button>

                        <!-- User Dropdown -->
                        <div id="user-menu"
                            class="absolute right-0 top-full mt-2 w-48 bg-plena-dark border border-zinc-800 rounded-xl shadow-2xl hidden z-40">
                            <div class="p-4 border-b border-zinc-800">
                                <p class="font-bold text-white">Administrador</p>
                                <p class="text-xs text-zinc-500">admin@plenadelivery.com</p>
                            </div>
                            <div class="p-2">
                                <button onclick="openSettings()"
                                    class="w-full text-left px-4 py-2 text-zinc-400 hover:text-white hover:bg-zinc-800 rounded-lg transition flex items-center gap-2">
                                    <i data-lucide="settings" class="w-4 h-4"></i> Configura√ß√µes
                                </button>
                                <button onclick="logout()"
                                    class="w-full text-left px-4 py-2 text-zinc-400 hover:text-white hover:bg-zinc-800 rounded-lg transition flex items-center gap-2">
                                    <i data-lucide="log-out" class="w-4 h-4"></i> Sair
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="flex flex-1 overflow-hidden">

            <!-- Sidebar -->
            <div id="sidebar" class="w-64 bg-plena-dark border-r border-zinc-800 hidden md:flex flex-col">
                <div class="p-6 border-b border-zinc-800">
                    <h2 class="font-bold text-white text-lg">Painel de Controle</h2>
                    <p class="text-sm text-zinc-500 mt-1">Gest√£o completa de delivery</p>
                </div>

                <nav class="flex-1 p-4 space-y-1 overflow-y-auto">
                    <button onclick="switchView('dashboard')" class="sidebar-btn active">
                        <i data-lucide="layout-dashboard" class="w-5 h-5"></i>
                        <span>Dashboard</span>
                    </button>

                    <button onclick="switchView('orders')" class="sidebar-btn">
                        <i data-lucide="package" class="w-5 h-5"></i>
                        <span>Pedidos</span>
                        <span id="order-count" class="sidebar-badge">0</span>
                    </button>

                    <button onclick="switchView('map')" class="sidebar-btn">
                        <i data-lucide="map" class="w-5 h-5"></i>
                        <span>Mapa de Entregas</span>
                    </button>

                    <button onclick="switchView('drivers')" class="sidebar-btn">
                        <i data-lucide="users" class="w-5 h-5"></i>
                        <span>Entregadores</span>
                        <span id="driver-count" class="sidebar-badge">0</span>
                    </button>

                    <button onclick="switchView('clients')" class="sidebar-btn">
                        <i data-lucide="user-circle" class="w-5 h-5"></i>
                        <span>Clientes</span>
                        <span id="client-count" class="sidebar-badge">0</span>
                    </button>

                    <button onclick="switchView('analytics')" class="sidebar-btn">
                        <i data-lucide="bar-chart-3" class="w-5 h-5"></i>
                        <span>Analytics</span>
                    </button>

                    <button onclick="switchView('menu')" class="sidebar-btn">
                        <i data-lucide="utensils" class="w-5 h-5"></i>
                        <span>Card√°pio</span>
                    </button>

                    <div class="pt-6">
                        <p class="text-xs text-zinc-500 uppercase font-bold px-4 mb-2">Configura√ß√µes</p>
                        <button onclick="switchView('settings')" class="sidebar-btn">
                            <i data-lucide="settings" class="w-5 h-5"></i>
                            <span>Configura√ß√µes</span>
                        </button>
                        <button onclick="switchView('help')" class="sidebar-btn">
                            <i data-lucide="help-circle" class="w-5 h-5"></i>
                            <span>Ajuda</span>
                        </button>
                    </div>
                </nav>

                <!-- Offline Status -->
                <div id="offline-status" class="hidden p-4 border-t border-zinc-800">
                    <div class="flex items-center gap-2 text-amber-500">
                        <i data-lucide="wifi-off" class="w-4 h-4"></i>
                        <span class="text-sm font-medium">Modo Offline</span>
                    </div>
                </div>
            </div>

            <!-- Mobile Menu Button -->
            <button id="mobile-menu-btn" onclick="toggleSidebar()"
                class="md:hidden fixed bottom-4 right-4 z-30 w-14 h-14 bg-gradient-to-br from-green-500 to-emerald-600 text-white rounded-full shadow-2xl flex items-center justify-center">
                <i data-lucide="menu" class="w-6 h-6"></i>
            </button>

            <!-- Content Area -->
            <div class="flex-1 overflow-y-auto">

                <!-- Dashboard View -->
                <div id="dashboard-view" class="view active p-6">
                    <div class="max-w-7xl mx-auto">
                        <!-- Stats Header -->
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                            <div class="stat-card p-6 rounded-2xl">
                                <div class="flex items-center justify-between mb-4">
                                    <div class="p-3 bg-green-500/10 rounded-lg">
                                        <i data-lucide="package" class="w-6 h-6 text-green-500"></i>
                                    </div>
                                    <span class="text-sm text-zinc-500">Hoje</span>
                                </div>
                                <h3 class="text-3xl font-bold text-white mb-2" id="stat-orders-today">0</h3>
                                <p class="text-zinc-400">Pedidos realizados</p>
                            </div>

                            <div class="stat-card p-6 rounded-2xl">
                                <div class="flex items-center justify-between mb-4">
                                    <div class="p-3 bg-blue-500/10 rounded-lg">
                                        <i data-lucide="clock" class="w-6 h-6 text-blue-500"></i>
                                    </div>
                                    <span class="text-sm text-zinc-500">Em andamento</span>
                                </div>
                                <h3 class="text-3xl font-bold text-white mb-2" id="stat-orders-active">0</h3>
                                <p class="text-zinc-400">Pedidos ativos</p>
                            </div>

                            <div class="stat-card p-6 rounded-2xl">
                                <div class="flex items-center justify-between mb-4">
                                    <div class="p-3 bg-purple-500/10 rounded-lg">
                                        <i data-lucide="dollar-sign" class="w-6 h-6 text-purple-500"></i>
                                    </div>
                                    <span class="text-sm text-zinc-500">Hoje</span>
                                </div>
                                <h3 class="text-3xl font-bold text-white mb-2" id="stat-revenue-today">R$ 0</h3>
                                <p class="text-zinc-400">Faturamento</p>
                            </div>

                            <div class="stat-card p-6 rounded-2xl">
                                <div class="flex items-center justify-between mb-4">
                                    <div class="p-3 bg-amber-500/10 rounded-lg">
                                        <i data-lucide="user-check" class="w-6 h-6 text-amber-500"></i>
                                    </div>
                                    <span class="text-sm text-zinc-500">Online</span>
                                </div>
                                <h3 class="text-3xl font-bold text-white mb-2" id="stat-drivers-online">0</h3>
                                <p class="text-zinc-400">Entregadores</p>
                            </div>
                        </div>

                        <!-- Quick Actions -->
                        <div class="mb-8">
                            <h2 class="text-xl font-bold text-white mb-4">A√ß√µes R√°pidas</h2>
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                                <button onclick="createNewOrder()"
                                    class="bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-400 hover:to-emerald-500 text-white p-4 rounded-xl flex flex-col items-center justify-center gap-2 transition">
                                    <i data-lucide="plus-circle" class="w-8 h-8"></i>
                                    <span class="font-medium">Novo Pedido</span>
                                </button>
                                <button onclick="switchView('orders')"
                                    class="bg-gradient-to-r from-blue-500 to-indigo-600 hover:from-blue-400 hover:to-indigo-500 text-white p-4 rounded-xl flex flex-col items-center justify-center gap-2 transition">
                                    <i data-lucide="list-checks" class="w-8 h-8"></i>
                                    <span class="font-medium">Ver Pedidos</span>
                                </button>
                                <button onclick="printReports()"
                                    class="bg-gradient-to-r from-purple-500 to-pink-600 hover:from-purple-400 hover:to-pink-500 text-white p-4 rounded-xl flex flex-col items-center justify-center gap-2 transition">
                                    <i data-lucide="printer" class="w-8 h-8"></i>
                                    <span class="font-medium">Relat√≥rios</span>
                                </button>
                                <button onclick="openScanner()"
                                    class="bg-gradient-to-r from-amber-500 to-orange-600 hover:from-amber-400 hover:to-orange-500 text-white p-4 rounded-xl flex flex-col items-center justify-center gap-2 transition">
                                    <i data-lucide="qrcode" class="w-8 h-8"></i>
                                    <span class="font-medium">QR Code</span>
                                </button>
                            </div>
                        </div>

                        <!-- Recent Orders & Activity -->
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                            <!-- Recent Orders -->
                            <div>
                                <div class="flex items-center justify-between mb-4">
                                    <h2 class="text-xl font-bold text-white">Pedidos Recentes</h2>
                                    <button onclick="switchView('orders')"
                                        class="text-green-500 hover:text-green-400 text-sm font-medium flex items-center gap-1">
                                        Ver todos <i data-lucide="chevron-right" class="w-4 h-4"></i>
                                    </button>
                                </div>
                                <div id="recent-orders" class="space-y-4">
                                    <!-- Orders injected via JS -->
                                </div>
                            </div>

                            <!-- Activity Feed -->
                            <div>
                                <h2 class="text-xl font-bold text-white mb-4">Atividade Recente</h2>
                                <div id="activity-feed" class="space-y-4">
                                    <!-- Activities injected via JS -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Orders View -->
                <div id="orders-view" class="view hidden p-6">
                    <div class="max-w-7xl mx-auto">
                        <div class="flex flex-col md:flex-row md:items-center justify-between mb-8">
                            <div>
                                <h2 class="text-2xl font-bold text-white mb-2">Gest√£o de Pedidos</h2>
                                <p class="text-zinc-400">Controle todos os pedidos do delivery</p>
                            </div>
                            <div class="flex gap-3 mt-4 md:mt-0">
                                <button onclick="exportOrders()"
                                    class="px-4 py-2 border border-zinc-700 text-zinc-400 hover:text-white hover:border-zinc-600 rounded-lg transition flex items-center gap-2">
                                    <i data-lucide="download" class="w-4 h-4"></i> Exportar
                                </button>
                                <button onclick="createNewOrder()"
                                    class="px-4 py-2 bg-gradient-to-r from-green-500 to-emerald-600 text-white font-bold rounded-lg hover:from-green-400 hover:to-emerald-500 transition flex items-center gap-2">
                                    <i data-lucide="plus" class="w-4 h-4"></i> Novo Pedido
                                </button>
                            </div>
                        </div>

                        <!-- Filters -->
                        <div class="bg-plena-dark border border-zinc-800 rounded-xl p-4 mb-6">
                            <div class="flex flex-col md:flex-row md:items-center gap-4">
                                <div class="flex-1">
                                    <div class="relative">
                                        <input type="text" id="order-search" placeholder="Buscar pedidos..."
                                            class="w-full bg-zinc-900 border border-zinc-700 rounded-lg py-2.5 pl-10 pr-4 text-white placeholder-zinc-500 focus:outline-none focus:border-green-500">
                                        <i data-lucide="search"
                                            class="absolute left-3 top-2.5 w-4 h-4 text-zinc-500"></i>
                                    </div>
                                </div>
                                <div class="flex flex-wrap gap-2">
                                    <select id="order-status-filter" onchange="filterOrders()"
                                        class="bg-zinc-900 border border-zinc-700 rounded-lg px-3 py-2 text-white text-sm focus:outline-none focus:border-green-500">
                                        <option value="">Todos os status</option>
                                        <option value="pending">Pendente</option>
                                        <option value="confirmed">Confirmado</option>
                                        <option value="preparing">Preparando</option>
                                        <option value="ready">Pronto</option>
                                        <option value="onway">A caminho</option>
                                        <option value="delivered">Entregue</option>
                                        <option value="cancelled">Cancelado</option>
                                    </select>
                                    <select id="order-date-filter" onchange="filterOrders()"
                                        class="bg-zinc-900 border border-zinc-700 rounded-lg px-3 py-2 text-white text-sm focus:outline-none focus:border-green-500">
                                        <option value="today">Hoje</option>
                                        <option value="yesterday">Ontem</option>
                                        <option value="week">Esta semana</option>
                                        <option value="month">Este m√™s</option>
                                        <option value="all">Todos</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- Orders Table -->
                        <div class="bg-plena-dark border border-zinc-800 rounded-xl overflow-hidden">
                            <div class="overflow-x-auto">
                                <table class="w-full">
                                    <thead class="bg-zinc-900/50">
                                        <tr>
                                            <th class="text-left p-4 text-zinc-400 text-sm font-medium">ID</th>
                                            <th class="text-left p-4 text-zinc-400 text-sm font-medium">Cliente</th>
                                            <th class="text-left p-4 text-zinc-400 text-sm font-medium">Valor</th>
                                            <th class="text-left p-4 text-zinc-400 text-sm font-medium">Status</th>
                                            <th class="text-left p-4 text-zinc-400 text-sm font-medium">Entregador</th>
                                            <th class="text-left p-4 text-zinc-400 text-sm font-medium">Hor√°rio</th>
                                            <th class="text-left p-4 text-zinc-400 text-sm font-medium">A√ß√µes</th>
                                        </tr>
                                    </thead>
                                    <tbody id="orders-table-body" class="divide-y divide-zinc-800">
                                        <!-- Orders injected via JS -->
                                    </tbody>
                                </table>
                            </div>

                            <!-- Empty State -->
                            <div id="orders-empty" class="hidden p-12 text-center">
                                <div
                                    class="w-20 h-20 mx-auto mb-4 bg-zinc-800 rounded-2xl flex items-center justify-center">
                                    <i data-lucide="package" class="w-10 h-10 text-zinc-600"></i>
                                </div>
                                <h3 class="text-xl font-bold text-white mb-2">Nenhum pedido encontrado</h3>
                                <p class="text-zinc-500 mb-6">Comece criando um novo pedido</p>
                                <button onclick="createNewOrder()"
                                    class="px-6 py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white font-bold rounded-lg hover:from-green-400 hover:to-emerald-500 transition">
                                    Criar Primeiro Pedido
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Map View -->
                <div id="map-view" class="view hidden p-6">
                    <div class="max-w-7xl mx-auto">
                        <div class="flex flex-col md:flex-row md:items-center justify-between mb-6">
                            <div>
                                <h2 class="text-2xl font-bold text-white mb-2">Mapa de Entregas</h2>
                                <p class="text-zinc-400">Acompanhe entregadores em tempo real</p>
                            </div>
                            <div class="flex gap-3 mt-4 md:mt-0">
                                <button onclick="refreshMap()"
                                    class="px-4 py-2 border border-zinc-700 text-zinc-400 hover:text-white hover:border-zinc-600 rounded-lg transition flex items-center gap-2">
                                    <i data-lucide="refresh-ccw" class="w-4 h-4"></i> Atualizar
                                </button>
                                <button onclick="centerMap()"
                                    class="px-4 py-2 bg-gradient-to-r from-green-500 to-emerald-600 text-white font-bold rounded-lg hover:from-green-400 hover:to-emerald-500 transition flex items-center gap-2">
                                    <i data-lucide="navigation" class="w-4 h-4"></i> Centralizar
                                </button>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                            <!-- Map Container -->
                            <div class="lg:col-span-2">
                                <div id="map" class="h-[500px] w-full"></div>
                            </div>

                            <!-- Delivery Info -->
                            <div class="space-y-6">
                                <!-- Active Deliveries -->
                                <div class="bg-plena-dark border border-zinc-800 rounded-xl p-5">
                                    <h3 class="font-bold text-white mb-4 flex items-center gap-2">
                                        <i data-lucide="truck" class="w-5 h-5 text-green-500"></i>
                                        Entregas Ativas
                                    </h3>
                                    <div id="active-deliveries" class="space-y-3">
                                        <!-- Active deliveries injected via JS -->
                                    </div>
                                </div>

                                <!-- Statistics -->
                                <div class="bg-plena-dark border border-zinc-800 rounded-xl p-5">
                                    <h3 class="font-bold text-white mb-4">Estat√≠sticas do Dia</h3>
                                    <div class="space-y-3">
                                        <div class="flex justify-between items-center">
                                            <span class="text-zinc-400">Entregas conclu√≠das</span>
                                            <span class="font-bold text-white" id="stat-deliveries-done">0</span>
                                        </div>
                                        <div class="flex justify-between items-center">
                                            <span class="text-zinc-400">Tempo m√©dio</span>
                                            <span class="font-bold text-white" id="stat-avg-time">0min</span>
                                        </div>
                                        <div class="flex justify-between items-center">
                                            <span class="text-zinc-400">Dist√¢ncia total</span>
                                            <span class="font-bold text-white" id="stat-total-distance">0km</span>
                                        </div>
                                    </div>
                                </div>

                                <!-- Driver List -->
                                <div class="bg-plena-dark border border-zinc-800 rounded-xl p-5">
                                    <h3 class="font-bold text-white mb-4">Entregadores Online</h3>
                                    <div id="online-drivers" class="space-y-3">
                                        <!-- Drivers injected via JS -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Drivers View -->
                <div id="drivers-view" class="view hidden p-6">
                    <div class="max-w-7xl mx-auto">
                        <div class="flex flex-col md:flex-row md:items-center justify-between mb-8">
                            <div>
                                <h2 class="text-2xl font-bold text-white mb-2">Gest√£o de Entregadores</h2>
                                <p class="text-zinc-400">Gerencie sua equipe de entregadores</p>
                            </div>
                            <button onclick="addNewDriver()"
                                class="mt-4 md:mt-0 px-4 py-2 bg-gradient-to-r from-green-500 to-emerald-600 text-white font-bold rounded-lg hover:from-green-400 hover:to-emerald-500 transition flex items-center gap-2">
                                <i data-lucide="user-plus" class="w-4 h-4"></i> Novo Entregador
                            </button>
                        </div>

                        <!-- Drivers Grid -->
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
                            <!-- Drivers injected via JS -->
                        </div>

                        <!-- Performance -->
                        <div class="bg-plena-dark border border-zinc-800 rounded-xl p-6">
                            <h3 class="text-xl font-bold text-white mb-6">Desempenho da Equipe</h3>
                            <div class="overflow-x-auto">
                                <table class="w-full">
                                    <thead class="bg-zinc-900/50">
                                        <tr>
                                            <th class="text-left p-3 text-zinc-400 text-sm font-medium">Entregador</th>
                                            <th class="text-left p-3 text-zinc-400 text-sm font-medium">Entregas</th>
                                            <th class="text-left p-3 text-zinc-400 text-sm font-medium">Avalia√ß√£o</th>
                                            <th class="text-left p-3 text-zinc-400 text-sm font-medium">Tempo M√©dio</th>
                                            <th class="text-left p-3 text-zinc-400 text-sm font-medium">Status</th>
                                            <th class="text-left p-3 text-zinc-400 text-sm font-medium">A√ß√µes</th>
                                        </tr>
                                    </thead>
                                    <tbody id="drivers-performance">
                                        <!-- Performance data injected via JS -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Clients View -->
                <div id="clients-view" class="view hidden p-6">
                    <div class="max-w-7xl mx-auto">
                        <div class="flex flex-col md:flex-row md:items-center justify-between mb-8">
                            <div>
                                <h2 class="text-2xl font-bold text-white mb-2">Gest√£o de Clientes</h2>
                                <p class="text-zinc-400">Gerencie seus clientes e hist√≥rico</p>
                            </div>
                            <div class="flex gap-3 mt-4 md:mt-0">
                                <button onclick="exportClients()"
                                    class="px-4 py-2 border border-zinc-700 text-zinc-400 hover:text-white hover:border-zinc-600 rounded-lg transition flex items-center gap-2">
                                    <i data-lucide="download" class="w-4 h-4"></i> Exportar
                                </button>
                                <button onclick="importClients()"
                                    class="px-4 py-2 border border-zinc-700 text-zinc-400 hover:text-white hover:border-zinc-600 rounded-lg transition flex items-center gap-2">
                                    <i data-lucide="upload" class="w-4 h-4"></i> Importar
                                </button>
                            </div>
                        </div>

                        <!-- Clients Grid -->
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                            <!-- Clients injected via JS -->
                        </div>

                        <!-- Clients Table -->
                        <div class="bg-plena-dark border border-zinc-800 rounded-xl overflow-hidden">
                            <div class="p-4 border-b border-zinc-800 flex flex-col md:flex-row md:items-center gap-4">
                                <div class="flex-1">
                                    <div class="relative">
                                        <input type="text" id="client-search" placeholder="Buscar clientes..."
                                            class="w-full bg-zinc-900 border border-zinc-700 rounded-lg py-2.5 pl-10 pr-4 text-white placeholder-zinc-500 focus:outline-none focus:border-green-500">
                                        <i data-lucide="search"
                                            class="absolute left-3 top-2.5 w-4 h-4 text-zinc-500"></i>
                                    </div>
                                </div>
                                <div class="flex gap-2">
                                    <select id="client-sort" onchange="sortClients()"
                                        class="bg-zinc-900 border border-zinc-700 rounded-lg px-3 py-2 text-white text-sm focus:outline-none focus:border-green-500">
                                        <option value="recent">Mais recentes</option>
                                        <option value="orders">Mais pedidos</option>
                                        <option value="spent">Maior gasto</option>
                                        <option value="name">Nome A-Z</option>
                                    </select>
                                </div>
                            </div>
                            <div class="overflow-x-auto">
                                <table class="w-full">
                                    <thead class="bg-zinc-900/50">
                                        <tr>
                                            <th class="text-left p-4 text-zinc-400 text-sm font-medium">Cliente</th>
                                            <th class="text-left p-4 text-zinc-400 text-sm font-medium">Contato</th>
                                            <th class="text-left p-4 text-zinc-400 text-sm font-medium">Total Pedidos
                                            </th>
                                            <th class="text-left p-4 text-zinc-400 text-sm font-medium">Valor Gasto</th>
                                            <th class="text-left p-4 text-zinc-400 text-sm font-medium">√öltimo Pedido
                                            </th>
                                            <th class="text-left p-4 text-zinc-400 text-sm font-medium">A√ß√µes</th>
                                        </tr>
                                    </thead>
                                    <tbody id="clients-table-body" class="divide-y divide-zinc-800">
                                        <!-- Clients injected via JS -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Analytics View -->
                <div id="analytics-view" class="view hidden p-6">
                    <div class="max-w-7xl mx-auto">
                        <div class="flex flex-col md:flex-row md:items-center justify-between mb-8">
                            <div>
                                <h2 class="text-2xl font-bold text-white mb-2">Analytics & Relat√≥rios</h2>
                                <p class="text-zinc-400">Estat√≠sticas detalhadas do seu neg√≥cio</p>
                            </div>
                            <div class="flex gap-3 mt-4 md:mt-0">
                                <select id="analytics-period" onchange="updateAnalytics()"
                                    class="bg-zinc-900 border border-zinc-700 rounded-lg px-3 py-2 text-white text-sm focus:outline-none focus:border-green-500">
                                    <option value="today">Hoje</option>
                                    <option value="week">Esta semana</option>
                                    <option value="month" selected>Este m√™s</option>
                                    <option value="quarter">Este trimestre</option>
                                    <option value="year">Este ano</option>
                                </select>
                                <button onclick="printAnalytics()"
                                    class="px-4 py-2 bg-gradient-to-r from-green-500 to-emerald-600 text-white font-bold rounded-lg hover:from-green-400 hover:to-emerald-500 transition flex items-center gap-2">
                                    <i data-lucide="printer" class="w-4 h-4"></i> Imprimir
                                </button>
                            </div>
                        </div>

                        <!-- Revenue Chart -->
                        <div class="bg-plena-dark border border-zinc-800 rounded-xl p-6 mb-8">
                            <h3 class="text-xl font-bold text-white mb-6">Faturamento</h3>
                            <div class="h-64 flex items-end gap-2" id="revenue-chart">
                                <!-- Chart bars injected via JS -->
                            </div>
                        </div>

                        <!-- Analytics Grid -->
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                            <div class="stat-card p-6 rounded-2xl">
                                <div class="flex items-center justify-between mb-4">
                                    <div class="p-3 bg-green-500/10 rounded-lg">
                                        <i data-lucide="trending-up" class="w-6 h-6 text-green-500"></i>
                                    </div>
                                </div>
                                <h3 class="text-3xl font-bold text-white mb-2" id="analytics-total-revenue">R$ 0</h3>
                                <p class="text-zinc-400">Faturamento total</p>
                            </div>

                            <div class="stat-card p-6 rounded-2xl">
                                <div class="flex items-center justify-between mb-4">
                                    <div class="p-3 bg-blue-500/10 rounded-lg">
                                        <i data-lucide="shopping-bag" class="w-6 h-6 text-blue-500"></i>
                                    </div>
                                </div>
                                <h3 class="text-3xl font-bold text-white mb-2" id="analytics-total-orders">0</h3>
                                <p class="text-zinc-400">Total de pedidos</p>
                            </div>

                            <div class="stat-card p-6 rounded-2xl">
                                <div class="flex items-center justify-between mb-4">
                                    <div class="p-3 bg-purple-500/10 rounded-lg">
                                        <i data-lucide="users" class="w-6 h-6 text-purple-500"></i>
                                    </div>
                                </div>
                                <h3 class="text-3xl font-bold text-white mb-2" id="analytics-new-clients">0</h3>
                                <p class="text-zinc-400">Novos clientes</p>
                            </div>

                            <div class="stat-card p-6 rounded-2xl">
                                <div class="flex items-center justify-between mb-4">
                                    <div class="p-3 bg-amber-500/10 rounded-lg">
                                        <i data-lucide="star" class="w-6 h-6 text-amber-500"></i>
                                    </div>
                                </div>
                                <h3 class="text-3xl font-bold text-white mb-2" id="analytics-avg-rating">0.0</h3>
                                <p class="text-zinc-400">Avalia√ß√£o m√©dia</p>
                            </div>
                        </div>

                        <!-- Top Items -->
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                            <div class="bg-plena-dark border border-zinc-800 rounded-xl p-6">
                                <h3 class="text-xl font-bold text-white mb-6">Itens Mais Vendidos</h3>
                                <div id="top-items" class="space-y-4">
                                    <!-- Top items injected via JS -->
                                </div>
                            </div>

                            <div class="bg-plena-dark border border-zinc-800 rounded-xl p-6">
                                <h3 class="text-xl font-bold text-white mb-6">Hor√°rios de Pico</h3>
                                <div id="peak-hours" class="space-y-4">
                                    <!-- Peak hours injected via JS -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Menu View -->
                <div id="menu-view" class="view hidden p-6">
                    <div class="max-w-7xl mx-auto">
                        <div class="flex flex-col md:flex-row md:items-center justify-between mb-8">
                            <div>
                                <h2 class="text-2xl font-bold text-white mb-2">Card√°pio Digital</h2>
                                <p class="text-zinc-400">Gerencie os produtos do seu estabelecimento</p>
                            </div>
                            <div class="flex gap-3 mt-4 md:mt-0">
                                <button onclick="exportMenu()"
                                    class="px-4 py-2 border border-zinc-700 text-zinc-400 hover:text-white hover:border-zinc-600 rounded-lg transition flex items-center gap-2">
                                    <i data-lucide="download" class="w-4 h-4"></i> Exportar
                                </button>
                                <button onclick="addMenuItem()"
                                    class="px-4 py-2 bg-gradient-to-r from-green-500 to-emerald-600 text-white font-bold rounded-lg hover:from-green-400 hover:to-emerald-500 transition flex items-center gap-2">
                                    <i data-lucide="plus" class="w-4 h-4"></i> Novo Item
                                </button>
                            </div>
                        </div>

                        <!-- Menu Categories -->
                        <div class="mb-8">
                            <div class="flex overflow-x-auto gap-2 pb-4">
                                <button onclick="filterMenuByCategory('all')"
                                    class="category-filter active">Todos</button>
                                <!-- Categories injected via JS -->
                            </div>
                        </div>

                        <!-- Menu Grid -->
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="menu-grid">
                            <!-- Menu items injected via JS -->
                        </div>
                    </div>
                </div>

                <!-- Settings View -->
                <div id="settings-view" class="view hidden p-6">
                    <div class="max-w-4xl mx-auto">
                        <h2 class="text-2xl font-bold text-white mb-8">Configura√ß√µes</h2>

                        <div class="space-y-8">
                            <!-- Business Settings -->
                            <div class="bg-plena-dark border border-zinc-800 rounded-xl p-6">
                                <h3 class="text-xl font-bold text-white mb-6">Configura√ß√µes do Neg√≥cio</h3>
                                <div class="space-y-4">
                                    <div>
                                        <label class="block text-sm text-zinc-400 mb-2">Nome do Estabelecimento</label>
                                        <input type="text" id="business-name" value="Restaurante Exemplo"
                                            class="w-full bg-zinc-900 border border-zinc-700 rounded-lg p-3 text-white focus:outline-none focus:border-green-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm text-zinc-400 mb-2">CNPJ</label>
                                        <input type="text" id="business-cnpj" value="00.000.000/0001-00"
                                            class="w-full bg-zinc-900 border border-zinc-700 rounded-lg p-3 text-white focus:outline-none focus:border-green-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm text-zinc-400 mb-2">Endere√ßo</label>
                                        <input type="text" id="business-address" value="Rua Exemplo, 123"
                                            class="w-full bg-zinc-900 border border-zinc-700 rounded-lg p-3 text-white focus:outline-none focus:border-green-500">
                                    </div>
                                    <div class="grid grid-cols-2 gap-4">
                                        <div>
                                            <label class="block text-sm text-zinc-400 mb-2">Telefone</label>
                                            <input type="tel" id="business-phone" value="(11) 99999-9999"
                                                class="w-full bg-zinc-900 border border-zinc-700 rounded-lg p-3 text-white focus:outline-none focus:border-green-500">
                                        </div>
                                        <div>
                                            <label class="block text-sm text-zinc-400 mb-2">WhatsApp</label>
                                            <input type="tel" id="business-whatsapp" value="(11) 99999-9999"
                                                class="w-full bg-zinc-900 border border-zinc-700 rounded-lg p-3 text-white focus:outline-none focus:border-green-500">
                                        </div>
                                    </div>
                                    <button onclick="saveBusinessSettings()"
                                        class="w-full md:w-auto px-6 py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white font-bold rounded-lg hover:from-green-400 hover:to-emerald-500 transition">
                                        Salvar Configura√ß√µes
                                    </button>
                                </div>
                            </div>

                            <!-- Delivery Settings -->
                            <div class="bg-plena-dark border border-zinc-800 rounded-xl p-6">
                                <h3 class="text-xl font-bold text-white mb-6">Configura√ß√µes de Delivery</h3>
                                <div class="space-y-4">
                                    <div class="grid grid-cols-2 gap-4">
                                        <div>
                                            <label class="block text-sm text-zinc-400 mb-2">Taxa de Entrega (R$)</label>
                                            <input type="number" step="0.01" id="delivery-fee" value="5.00"
                                                class="w-full bg-zinc-900 border border-zinc-700 rounded-lg p-3 text-white focus:outline-none focus:border-green-500">
                                        </div>
                                        <div>
                                            <label class="block text-sm text-zinc-400 mb-2">Raio de Entrega (km)</label>
                                            <input type="number" id="delivery-radius" value="10"
                                                class="w-full bg-zinc-900 border border-zinc-700 rounded-lg p-3 text-white focus:outline-none focus:border-green-500">
                                        </div>
                                    </div>
                                    <div>
                                        <label class="block text-sm text-zinc-400 mb-2">Tempo M√©dio de Entrega
                                            (min)</label>
                                        <input type="number" id="delivery-time" value="45"
                                            class="w-full bg-zinc-900 border border-zinc-700 rounded-lg p-3 text-white focus:outline-none focus:border-green-500">
                                    </div>
                                    <div class="flex items-center gap-2">
                                        <input type="checkbox" id="delivery-active" checked
                                            class="rounded border-zinc-700 bg-zinc-900">
                                        <label for="delivery-active" class="text-sm text-zinc-400">Delivery
                                            ativo</label>
                                    </div>
                                    <button onclick="saveDeliverySettings()"
                                        class="w-full md:w-auto px-6 py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white font-bold rounded-lg hover:from-green-400 hover:to-emerald-500 transition">
                                        Salvar Configura√ß√µes
                                    </button>
                                </div>
                            </div>

                            <!-- Payment Settings -->
                            <div class="bg-plena-dark border border-zinc-800 rounded-xl p-6">
                                <h3 class="text-xl font-bold text-white mb-6">Configura√ß√µes de Pagamento</h3>
                                <div class="space-y-4">
                                    <div class="space-y-2">
                                        <label class="block text-sm text-zinc-400">Formas de Pagamento Aceitas</label>
                                        <div class="flex flex-wrap gap-3">
                                            <label class="flex items-center gap-2">
                                                <input type="checkbox" checked
                                                    class="rounded border-zinc-700 bg-zinc-900">
                                                <span class="text-sm text-zinc-400">Dinheiro</span>
                                            </label>
                                            <label class="flex items-center gap-2">
                                                <input type="checkbox" checked
                                                    class="rounded border-zinc-700 bg-zinc-900">
                                                <span class="text-sm text-zinc-400">Cart√£o de Cr√©dito</span>
                                            </label>
                                            <label class="flex items-center gap-2">
                                                <input type="checkbox" checked
                                                    class="rounded border-zinc-700 bg-zinc-900">
                                                <span class="text-sm text-zinc-400">Cart√£o de D√©bito</span>
                                            </label>
                                            <label class="flex items-center gap-2">
                                                <input type="checkbox" checked
                                                    class="rounded border-zinc-700 bg-zinc-900">
                                                <span class="text-sm text-zinc-400">PIX</span>
                                            </label>
                                            <label class="flex items-center gap-2">
                                                <input type="checkbox" class="rounded border-zinc-700 bg-zinc-900">
                                                <span class="text-sm text-zinc-400">Vale Refei√ß√£o</span>
                                            </label>
                                        </div>
                                    </div>
                                    <div>
                                        <label class="block text-sm text-zinc-400 mb-2">Taxa do Cart√£o (%)</label>
                                        <input type="number" step="0.01" id="card-fee" value="2.99"
                                            class="w-full bg-zinc-900 border border-zinc-700 rounded-lg p-3 text-white focus:outline-none focus:border-green-500">
                                    </div>
                                    <button onclick="savePaymentSettings()"
                                        class="w-full md:w-auto px-6 py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white font-bold rounded-lg hover:from-green-400 hover:to-emerald-500 transition">
                                        Salvar Configura√ß√µes
                                    </button>
                                </div>
                            </div>

                            <!-- System Settings -->
                            <div class="bg-plena-dark border border-zinc-800 rounded-xl p-6">
                                <h3 class="text-xl font-bold text-white mb-6">Configura√ß√µes do Sistema</h3>
                                <div class="space-y-4">
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <p class="text-white font-medium">Modo Escuro</p>
                                            <p class="text-sm text-zinc-500">Interface escura para melhor visibilidade
                                            </p>
                                        </div>
                                        <label class="relative inline-flex items-center cursor-pointer">
                                            <input type="checkbox" checked class="sr-only peer">
                                            <div
                                                class="w-12 h-6 bg-zinc-700 rounded-full peer peer-checked:bg-green-500 transition">
                                                <div
                                                    class="absolute top-1 left-1 w-4 h-4 bg-white rounded-full transition-transform peer-checked:translate-x-6">
                                                </div>
                                            </div>
                                        </label>
                                    </div>
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <p class="text-white font-medium">Notifica√ß√µes por Som</p>
                                            <p class="text-sm text-zinc-500">Emitir som para novos pedidos</p>
                                        </div>
                                        <label class="relative inline-flex items-center cursor-pointer">
                                            <input type="checkbox" checked class="sr-only peer">
                                            <div
                                                class="w-12 h-6 bg-zinc-700 rounded-full peer peer-checked:bg-green-500 transition">
                                                <div
                                                    class="absolute top-1 left-1 w-4 h-4 bg-white rounded-full transition-transform peer-checked:translate-x-6">
                                                </div>
                                            </div>
                                        </label>
                                    </div>
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <p class="text-white font-medium">Backup Autom√°tico</p>
                                            <p class="text-sm text-zinc-500">Salvar dados automaticamente</p>
                                        </div>
                                        <label class="relative inline-flex items-center cursor-pointer">
                                            <input type="checkbox" checked class="sr-only peer">
                                            <div
                                                class="w-12 h-6 bg-zinc-700 rounded-full peer peer-checked:bg-green-500 transition">
                                                <div
                                                    class="absolute top-1 left-1 w-4 h-4 bg-white rounded-full transition-transform peer-checked:translate-x-6">
                                                </div>
                                            </div>
                                        </label>
                                    </div>
                                    <div class="pt-4 border-t border-zinc-800">
                                        <button onclick="clearAllData()"
                                            class="px-4 py-2 border border-red-500/30 text-red-500 hover:text-red-400 hover:border-red-500 rounded-lg transition">
                                            Limpar Todos os Dados
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Help View -->
                <div id="help-view" class="view hidden p-6">
                    <div class="max-w-4xl mx-auto">
                        <h2 class="text-2xl font-bold text-white mb-8">Ajuda & Suporte</h2>

                        <div class="space-y-6">
                            <!-- FAQ -->
                            <div class="bg-plena-dark border border-zinc-800 rounded-xl p-6">
                                <h3 class="text-xl font-bold text-white mb-6">Perguntas Frequentes</h3>
                                <div class="space-y-4">
                                    <div class="faq-item">
                                        <button onclick="toggleFAQ(this)"
                                            class="w-full text-left flex items-center justify-between p-4 bg-zinc-900/50 rounded-lg hover:bg-zinc-800 transition">
                                            <span class="font-medium text-white">Como adicionar um novo
                                                entregador?</span>
                                            <i data-lucide="chevron-down" class="w-5 h-5 text-zinc-500"></i>
                                        </button>
                                        <div class="faq-answer hidden p-4 text-zinc-400">
                                            <p>V√° para a se√ß√£o "Entregadores" e clique no bot√£o "Novo Entregador".
                                                Preencha os dados necess√°rios e salve. O entregador receber√° um link
                                                para baixar o aplicativo de entregador.</p>
                                        </div>
                                    </div>

                                    <div class="faq-item">
                                        <button onclick="toggleFAQ(this)"
                                            class="w-full text-left flex items-center justify-between p-4 bg-zinc-900/50 rounded-lg hover:bg-zinc-800 transition">
                                            <span class="font-medium text-white">Como mudar o status de um
                                                pedido?</span>
                                            <i data-lucide="chevron-down" class="w-5 h-5 text-zinc-500"></i>
                                        </button>
                                        <div class="faq-answer hidden p-4 text-zinc-400">
                                            <p>Na lista de pedidos, clique no menu de a√ß√µes (tr√™s pontos) ao lado do
                                                pedido e selecione "Mudar Status". Escolha o novo status e confirme.</p>
                                        </div>
                                    </div>

                                    <div class="faq-item">
                                        <button onclick="toggleFAQ(this)"
                                            class="w-full text-left flex items-center justify-between p-4 bg-zinc-900/50 rounded-lg hover:bg-zinc-800 transition">
                                            <span class="font-medium text-white">Como gerar relat√≥rios?</span>
                                            <i data-lucide="chevron-down" class="w-5 h-5 text-zinc-500"></i>
                                        </button>
                                        <div class="faq-answer hidden p-4 text-zinc-400">
                                            <p>V√° para a se√ß√£o "Analytics" e selecione o per√≠odo desejado. Use o bot√£o
                                                "Imprimir" para gerar um relat√≥rio completo ou exporte os dados em CSV.
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Support -->
                            <div class="bg-plena-dark border border-zinc-800 rounded-xl p-6">
                                <h3 class="text-xl font-bold text-white mb-6">Suporte T√©cnico</h3>
                                <div class="space-y-4">
                                    <p class="text-zinc-400">Precisa de ajuda adicional? Entre em contato com nossa
                                        equipe de suporte:</p>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <a href="mailto:suporte@plenadelivery.com"
                                            class="p-4 bg-zinc-900/50 rounded-lg hover:bg-zinc-800 transition flex items-center gap-3">
                                            <div
                                                class="w-10 h-10 bg-green-500/10 rounded-lg flex items-center justify-center">
                                                <i data-lucide="mail" class="w-5 h-5 text-green-500"></i>
                                            </div>
                                            <div>
                                                <p class="font-medium text-white">E-mail</p>
                                                <p class="text-sm text-zinc-500">suporte@plenadelivery.com</p>
                                            </div>
                                        </a>
                                        <a href="https://wa.me/5511999999999" target="_blank"
                                            class="p-4 bg-zinc-900/50 rounded-lg hover:bg-zinc-800 transition flex items-center gap-3">
                                            <div
                                                class="w-10 h-10 bg-green-500/10 rounded-lg flex items-center justify-center">
                                                <i data-lucide="message-circle" class="w-5 h-5 text-green-500"></i>
                                            </div>
                                            <div>
                                                <p class="font-medium text-white">WhatsApp</p>
                                                <p class="text-sm text-zinc-500">(11) 99999-9999</p>
                                            </div>
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Bottom Navigation (Mobile) -->
        <div id="mobile-nav"
            class="md:hidden fixed bottom-0 left-0 right-0 bg-plena-dark border-t border-zinc-800 p-2 z-20">
            <div class="flex justify-around">
                <button onclick="switchView('dashboard')" class="mobile-nav-btn active">
                    <i data-lucide="layout-dashboard" class="w-5 h-5"></i>
                    <span class="text-xs mt-1">Dashboard</span>
                </button>
                <button onclick="switchView('orders')" class="mobile-nav-btn">
                    <i data-lucide="package" class="w-5 h-5"></i>
                    <span class="text-xs mt-1">Pedidos</span>
                </button>
                <button onclick="switchView('map')" class="mobile-nav-btn">
                    <i data-lucide="map" class="w-5 h-5"></i>
                    <span class="text-xs mt-1">Mapa</span>
                </button>
                <button onclick="switchView('drivers')" class="mobile-nav-btn">
                    <i data-lucide="users" class="w-5 h-5"></i>
                    <span class="text-xs mt-1">Entregadores</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Modals -->

    <!-- New Order Modal -->
    <div id="new-order-modal" class="fixed inset-0 bg-black/80 hidden z-50 flex items-center justify-center p-4">
        <div class="bg-plena-dark border border-zinc-800 rounded-2xl w-full max-w-2xl max-h-[90vh] overflow-hidden">
            <div class="p-6 border-b border-zinc-800 flex justify-between items-center">
                <h3 class="text-xl font-bold text-white">Novo Pedido</h3>
                <button onclick="closeModal('new-order-modal')" class="text-zinc-500 hover:text-white">
                    <i data-lucide="x" class="w-5 h-5"></i>
                </button>
            </div>
            <div class="p-6 overflow-y-auto max-h-[calc(90vh-120px)]">
                <form id="new-order-form" class="space-y-6">
                    <!-- Form fields injected via JS -->
                </form>
            </div>
            <div class="p-6 border-t border-zinc-800 flex justify-end gap-3">
                <button onclick="closeModal('new-order-modal')"
                    class="px-4 py-2 border border-zinc-700 text-zinc-400 hover:text-white hover:border-zinc-600 rounded-lg transition">
                    Cancelar
                </button>
                <button type="submit" form="new-order-form"
                    class="px-6 py-2 bg-gradient-to-r from-green-500 to-emerald-600 text-white font-bold rounded-lg hover:from-green-400 hover:to-emerald-500 transition">
                    Criar Pedido
                </button>
            </div>
        </div>
    </div>

    <!-- Order Details Modal -->
    <div id="order-details-modal" class="fixed inset-0 bg-black/80 hidden z-50 flex items-center justify-center p-4">
        <!-- Modal content injected via JS -->
    </div>

    <!-- Notifications Panel -->
    <div id="notifications-panel"
        class="fixed inset-y-0 right-0 w-80 bg-plena-dark border-l border-zinc-800 transform translate-x-full transition-transform z-40">
        <div class="p-6 border-b border-zinc-800">
            <div class="flex items-center justify-between">
                <h3 class="font-bold text-white flex items-center gap-2">
                    <i data-lucide="bell" class="w-5 h-5 text-green-500"></i>
                    Notifica√ß√µes
                </h3>
                <button onclick="toggleNotifications()" class="text-zinc-500 hover:text-white">
                    <i data-lucide="x" class="w-5 h-5"></i>
                </button>
            </div>
        </div>
        <div id="notifications-list" class="p-4 space-y-4 overflow-y-auto h-[calc(100vh-120px)]">
            <!-- Notifications injected via JS -->
        </div>
    </div>

    <!-- QR Code Scanner Modal -->
    <div id="qr-scanner-modal" class="fixed inset-0 bg-black/80 hidden z-50 flex items-center justify-center p-4">
        <div class="bg-plena-dark border border-zinc-800 rounded-2xl w-full max-w-md overflow-hidden">
            <div class="p-6 border-b border-zinc-800">
                <h3 class="text-xl font-bold text-white">Scanner QR Code</h3>
                <p class="text-sm text-zinc-400 mt-1">Aponte para o c√≥digo do cliente</p>
            </div>
            <div class="p-6">
                <div id="qr-scanner" class="w-full h-64 bg-black rounded-lg flex items-center justify-center">
                    <p class="text-zinc-500">Scanner inicializando...</p>
                </div>
                <div class="mt-6 text-center">
                    <p class="text-sm text-zinc-400">Ou insira o c√≥digo manualmente:</p>
                    <input type="text" id="manual-qr-code" placeholder="C√≥digo do cliente"
                        class="w-full mt-2 bg-zinc-900 border border-zinc-700 rounded-lg p-3 text-white text-center font-mono">
                </div>
            </div>
            <div class="p-6 border-t border-zinc-800 flex justify-between gap-3">
                <button onclick="closeModal('qr-scanner-modal')"
                    class="px-4 py-2 border border-zinc-700 text-zinc-400 hover:text-white hover:border-zinc-600 rounded-lg transition">
                    Cancelar
                </button>
                <button onclick="processQRCode()"
                    class="px-6 py-2 bg-gradient-to-r from-green-500 to-emerald-600 text-white font-bold rounded-lg hover:from-green-400 hover:to-emerald-500 transition">
                    Confirmar
                </button>
            </div>
        </div>
    </div>

    <!-- PWA Install Instructions -->
    <div id="install-instructions" class="fixed inset-0 bg-black/90 hidden z-50 flex items-center justify-center p-4">
        <div class="bg-plena-dark border border-zinc-800 rounded-2xl w-full max-w-md p-6">
            <div class="text-center mb-6">
                <div
                    class="w-16 h-16 mx-auto mb-4 bg-gradient-to-br from-green-500 to-emerald-600 rounded-2xl flex items-center justify-center">
                    <i data-lucide="download" class="w-8 h-8 text-white"></i>
                </div>
                <h3 class="text-xl font-bold text-white mb-2">Instalar Aplicativo</h3>
                <p class="text-zinc-400">Para instalar o aplicativo:</p>
            </div>
            <div class="space-y-4 mb-6">
                <div class="flex items-start gap-3">
                    <div class="w-8 h-8 bg-green-500/10 rounded-lg flex items-center justify-center shrink-0">
                        <span class="text-green-500 font-bold">1</span>
                    </div>
                    <div>
                        <p class="text-white font-medium">No iOS</p>
                        <p class="text-sm text-zinc-500">Toque no √≠cone de compartilhar e selecione "Adicionar √† Tela de
                            In√≠cio"</p>
                    </div>
                </div>
                <div class="flex items-start gap-3">
                    <div class="w-8 h-8 bg-green-500/10 rounded-lg flex items-center justify-center shrink-0">
                        <span class="text-green-500 font-bold">2</span>
                    </div>
                    <div>
                        <p class="text-white font-medium">No Android</p>
                        <p class="text-sm text-zinc-500">Toque no menu (tr√™s pontos) e selecione "Instalar aplicativo"
                        </p>
                    </div>
                </div>
                <div class="flex items-start gap-3">
                    <div class="w-8 h-8 bg-green-500/10 rounded-lg flex items-center justify-center shrink-0">
                        <span class="text-green-500 font-bold">3</span>
                    </div>
                    <div>
                        <p class="text-white font-medium">No Computador</p>
                        <p class="text-sm text-zinc-500">Clique no √≠cone de instala√ß√£o na barra de endere√ßos</p>
                    </div>
                </div>
            </div>
            <button onclick="closeModal('install-instructions')"
                class="w-full px-6 py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white font-bold rounded-lg hover:from-green-400 hover:to-emerald-500 transition">
                Entendi
            </button>
        </div>
    </div>

    <!-- Service Worker & PWA Setup -->
    <script>
        // --- PWA FUNCTIONALITY ---
        let deferredPrompt;

        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            setTimeout(() => {
                document.getElementById('install-prompt').classList.add('show');
            }, 3000);
        });

        function installPWA() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        console.log('PWA installed');
                    }
                    deferredPrompt = null;
                });
            }
            document.getElementById('install-prompt').classList.remove('show');
        }

        function dismissInstallPrompt() {
            document.getElementById('install-prompt').classList.remove('show');
        }

        function showInstallInstructions() {
            document.getElementById('install-instructions').classList.remove('hidden');
        }

        // Register Service Worker for PWA
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('service-worker.js')
                    .then(registration => {
                        console.log('ServiceWorker registered: ', registration);
                    })
                    .catch(error => {
                        console.log('ServiceWorker registration failed: ', error);
                    });
            });
        }

        // Offline detection
        window.addEventListener('online', updateOnlineStatus);
        window.addEventListener('offline', updateOnlineStatus);

        function updateOnlineStatus() {
            const offlineStatus = document.getElementById('offline-status');
            if (!navigator.onLine) {
                offlineStatus.classList.remove('hidden');
                showNotification('Voc√™ est√° offline. Algumas funcionalidades podem n√£o estar dispon√≠veis.', 'warning');
            } else {
                offlineStatus.classList.add('hidden');
            }
        }

        // --- APP STATE MANAGEMENT ---
        const appState = {
            currentView: 'dashboard',
            orders: [],
            drivers: [],
            clients: [],
            menuItems: [],
            notifications: [],
            settings: {},
            currentOrder: null,
            map: null,
            mapMarkers: [],
            isSidebarOpen: false,
            isNotificationsOpen: false,
            isUserMenuOpen: false
        };

        // Sample data
        const sampleData = {
            orders: [
                {
                    id: 'ORD-001',
                    client: { name: 'Jo√£o Silva', phone: '(11) 99999-9999', address: 'Rua A, 123' },
                    items: [
                        { name: 'X-Burger Premium', quantity: 2, price: 32.90 },
                        { name: 'Coca-Cola 600ml', quantity: 2, price: 8.90 }
                    ],
                    total: 83.60,
                    status: 'preparing',
                    driver: { name: 'Carlos Santos', id: 'DRV-001' },
                    createdAt: new Date().toISOString(),
                    estimatedDelivery: new Date(Date.now() + 45 * 60000).toISOString(),
                    notes: 'Sem cebola, por favor'
                }
            ],
            drivers: [
                {
                    id: 'DRV-001',
                    name: 'Carlos Santos',
                    phone: '(11) 98888-8888',
                    vehicle: 'Moto Honda CG 160',
                    plate: 'ABC-1234',
                    status: 'online',
                    rating: 4.8,
                    deliveries: 124,
                    location: { lat: -23.5505, lng: -46.6333 }
                }
            ],
            clients: [
                {
                    id: 'CLI-001',
                    name: 'Jo√£o Silva',
                    phone: '(11) 99999-9999',
                    email: 'joao@email.com',
                    address: 'Rua A, 123 - Centro',
                    totalOrders: 12,
                    totalSpent: 856.40,
                    lastOrder: new Date().toISOString()
                }
            ],
            menuItems: [
                {
                    id: 'MEN-001',
                    name: 'X-Burger Premium',
                    category: 'lanches',
                    price: 32.90,
                    description: 'P√£o brioche artesanal, blend 180g de angus',
                    available: true,
                    popular: true
                }
            ],
            settings: {
                business: {
                    name: 'Restaurante Exemplo',
                    cnpj: '00.000.000/0001-00',
                    address: 'Rua Exemplo, 123',
                    phone: '(11) 99999-9999',
                    whatsapp: '(11) 99999-9999'
                },
                delivery: {
                    fee: 5.00,
                    radius: 10,
                    time: 45,
                    active: true
                },
                payment: {
                    methods: ['dinheiro', 'cartao', 'pix'],
                    cardFee: 2.99
                }
            }
        };

        // --- INITIALIZATION ---
        document.addEventListener('DOMContentLoaded', () => {
            // Load saved data
            loadAppData();

            // Initialize time
            updateTime();
            setInterval(updateTime, 60000);

            // Initialize views
            initializeDashboard();
            initializeOrders();
            initializeMap();
            initializeDrivers();
            initializeClients();
            initializeAnalytics();
            initializeMenu();

            // Setup event listeners
            setupEventListeners();

            // Initialize icons
            lucide.createIcons();

            // Hide loading overlay
            setTimeout(() => {
                document.getElementById('loading').style.display = 'none';
                document.getElementById('app').classList.remove('hidden');

                // Show welcome notification
                showNotification('Sistema de Delivery inicializado com sucesso!', 'success');
            }, 1000);
        });

        function updateTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });
            document.getElementById('current-time').textContent = timeString;
        }

        function loadAppData() {
            const saved = localStorage.getItem('plena_delivery_data');
            if (saved) {
                try {
                    const data = JSON.parse(saved);
                    appState.orders = data.orders || sampleData.orders;
                    appState.drivers = data.drivers || sampleData.drivers;
                    appState.clients = data.clients || sampleData.clients;
                    appState.menuItems = data.menuItems || sampleData.menuItems;
                    appState.settings = data.settings || sampleData.settings;
                    appState.notifications = data.notifications || [];
                } catch (e) {
                    console.error('Error loading app data:', e);
                    loadSampleData();
                }
            } else {
                loadSampleData();
            }
        }

        function loadSampleData() {
            appState.orders = [...sampleData.orders];
            appState.drivers = [...sampleData.drivers];
            appState.clients = [...sampleData.clients];
            appState.menuItems = [...sampleData.menuItems];
            appState.settings = { ...sampleData.settings };
            appState.notifications = [
                { id: 1, type: 'new_order', message: 'Novo pedido recebido: ORD-001', time: 'h√° 5 minutos', read: false },
                { id: 2, type: 'driver_assigned', message: 'Entregador atribu√≠do ao pedido ORD-001', time: 'h√° 3 minutos', read: false }
            ];
        }

        function saveAppData() {
            const data = {
                orders: appState.orders,
                drivers: appState.drivers,
                clients: appState.clients,
                menuItems: appState.menuItems,
                settings: appState.settings,
                notifications: appState.notifications
            };
            localStorage.setItem('plena_delivery_data', JSON.stringify(data));
        }

        // --- VIEW MANAGEMENT ---
        function switchView(viewName) {
            // Hide all views
            document.querySelectorAll('.view').forEach(view => {
                view.classList.remove('active');
                view.classList.add('hidden');
            });

            // Remove active class from sidebar buttons
            document.querySelectorAll('.sidebar-btn').forEach(btn => {
                btn.classList.remove('active');
            });

            document.querySelectorAll('.mobile-nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });

            // Show selected view
            const view = document.getElementById(`${viewName}-view`);
            view.classList.remove('hidden');
            view.classList.add('active');

            // Update active sidebar button
            document.querySelector(`.sidebar-btn[onclick*="${viewName}"]`)?.classList.add('active');
            document.querySelector(`.mobile-nav-btn[onclick*="${viewName}"]`)?.classList.add('active');

            // Update current view
            appState.currentView = viewName;

            // Close sidebar on mobile
            if (window.innerWidth < 768) {
                toggleSidebar();
            }

            // Specific view initializations
            if (viewName === 'map' && appState.map) {
                setTimeout(() => appState.map.resize(), 100);
            }
        }

        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            appState.isSidebarOpen = !appState.isSidebarOpen;

            if (appState.isSidebarOpen) {
                sidebar.classList.remove('hidden');
                sidebar.classList.add('flex');
            } else {
                sidebar.classList.add('hidden');
                sidebar.classList.remove('flex');
            }
        }

        function toggleNotifications() {
            const panel = document.getElementById('notifications-panel');
            appState.isNotificationsOpen = !appState.isNotificationsOpen;

            if (appState.isNotificationsOpen) {
                panel.classList.remove('translate-x-full');
                updateNotifications();
            } else {
                panel.classList.add('translate-x-full');
            }
        }

        function toggleUserMenu() {
            const menu = document.getElementById('user-menu');
            appState.isUserMenuOpen = !appState.isUserMenuOpen;
            menu.classList.toggle('hidden');
        }

        // Close menus when clicking outside
        document.addEventListener('click', (e) => {
            if (!e.target.closest('#user-menu') && !e.target.closest('[onclick="toggleUserMenu()"]')) {
                document.getElementById('user-menu').classList.add('hidden');
                appState.isUserMenuOpen = false;
            }
        });

        // --- DASHBOARD FUNCTIONS ---
        function initializeDashboard() {
            updateDashboardStats();
            updateRecentOrders();
            updateActivityFeed();
        }

        function updateDashboardStats() {
            const today = new Date().toDateString();
            const todayOrders = appState.orders.filter(order =>
                new Date(order.createdAt).toDateString() === today
            );

            const activeOrders = appState.orders.filter(order =>
                ['pending', 'confirmed', 'preparing', 'ready', 'onway'].includes(order.status)
            );

            const todayRevenue = todayOrders.reduce((sum, order) => sum + order.total, 0);
            const onlineDrivers = appState.drivers.filter(driver => driver.status === 'online').length;

            document.getElementById('stat-orders-today').textContent = todayOrders.length;
            document.getElementById('stat-orders-active').textContent = activeOrders.length;
            document.getElementById('stat-revenue-today').textContent = `R$ ${todayRevenue.toFixed(2)}`;
            document.getElementById('stat-drivers-online').textContent = onlineDrivers;
        }

        function updateRecentOrders() {
            const container = document.getElementById('recent-orders');
            const recentOrders = [...appState.orders]
                .sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt))
                .slice(0, 5);

            container.innerHTML = '';
            recentOrders.forEach(order => {
                const orderEl = document.createElement('div');
                orderEl.className = `order-card ${order.status} bg-plena-dark border border-zinc-800 rounded-xl p-4`;

                const statusText = {
                    pending: 'Pendente',
                    confirmed: 'Confirmado',
                    preparing: 'Preparando',
                    ready: 'Pronto',
                    onway: 'A caminho',
                    delivered: 'Entregue',
                    cancelled: 'Cancelado'
                }[order.status];

                orderEl.innerHTML = `
                    <div class="flex items-start justify-between mb-3">
                        <div>
                            <h4 class="font-bold text-white">${order.id}</h4>
                            <p class="text-sm text-zinc-500">${order.client.name}</p>
                        </div>
                        <span class="px-3 py-1 rounded-full text-xs font-bold text-white ${order.status}-badge">
                            ${statusText}
                        </span>
                    </div>
                    <div class="flex items-center justify-between">
                        <div class="text-sm text-zinc-400">
                            <i data-lucide="clock" class="w-3 h-3 inline mr-1"></i>
                            ${formatTime(order.createdAt)}
                        </div>
                        <div class="font-bold text-white">
                            R$ ${order.total.toFixed(2)}
                        </div>
                    </div>
                `;

                orderEl.addEventListener('click', () => showOrderDetails(order.id));
                container.appendChild(orderEl);
            });

            // Update order count
            document.getElementById('order-count').textContent = appState.orders.length;
            lucide.createIcons();
        }

        function updateActivityFeed() {
            const container = document.getElementById('activity-feed');
            const activities = [
                { type: 'new_order', message: 'Novo pedido ORD-001 recebido', time: 'h√° 5 min' },
                { type: 'driver_assigned', message: 'Carlos Santos aceitou a entrega', time: 'h√° 4 min' },
                { type: 'order_update', message: 'Pedido ORD-001 est√° sendo preparado', time: 'h√° 3 min' },
                { type: 'payment', message: 'Pagamento confirmado para ORD-001', time: 'h√° 2 min' }
            ];

            container.innerHTML = '';
            activities.forEach(activity => {
                const activityEl = document.createElement('div');
                activityEl.className = 'flex items-start gap-3 p-3 bg-zinc-900/50 rounded-lg';

                const icon = {
                    new_order: 'package',
                    driver_assigned: 'user-check',
                    order_update: 'refresh-cw',
                    payment: 'dollar-sign'
                }[activity.type];

                activityEl.innerHTML = `
                    <div class="w-8 h-8 bg-green-500/10 rounded-lg flex items-center justify-center shrink-0">
                        <i data-lucide="${icon}" class="w-4 h-4 text-green-500"></i>
                    </div>
                    <div class="flex-1">
                        <p class="text-sm text-white">${activity.message}</p>
                        <p class="text-xs text-zinc-500 mt-1">${activity.time}</p>
                    </div>
                `;
                container.appendChild(activityEl);
            });

            lucide.createIcons();
        }

        // --- ORDER MANAGEMENT ---
        function initializeOrders() {
            updateOrdersTable();
        }

        function createNewOrder() {
            const modal = document.getElementById('new-order-modal');
            const form = document.getElementById('new-order-form');

            form.innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm text-zinc-400 mb-2">Cliente</label>
                        <select class="w-full bg-zinc-900 border border-zinc-700 rounded-lg p-3 text-white focus:outline-none focus:border-green-500">
                            <option value="">Selecionar cliente</option>
                            ${appState.clients.map(client =>
                `<option value="${client.id}">${client.name} - ${client.phone}</option>`
            ).join('')}
                            <option value="new">+ Novo Cliente</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm text-zinc-400 mb-2">Telefone</label>
                        <input type="tel" placeholder="(11) 99999-9999"
                               class="w-full bg-zinc-900 border border-zinc-700 rounded-lg p-3 text-white focus:outline-none focus:border-green-500">
                    </div>
                </div>
                <div>
                    <label class="block text-sm text-zinc-400 mb-2">Endere√ßo de Entrega</label>
                    <textarea rows="2" placeholder="Rua, n√∫mero, bairro, complemento..."
                              class="w-full bg-zinc-900 border border-zinc-700 rounded-lg p-3 text-white focus:outline-none focus:border-green-500"></textarea>
                </div>
                <div>
                    <label class="block text-sm text-zinc-400 mb-2">Itens do Pedido</label>
                    <div class="space-y-2">
                        <div class="flex gap-2">
                            <select class="flex-1 bg-zinc-900 border border-zinc-700 rounded-lg p-3 text-white focus:outline-none focus:border-green-500">
                                <option value="">Selecionar item</option>
                                ${appState.menuItems.map(item =>
                `<option value="${item.id}">${item.name} - R$ ${item.price.toFixed(2)}</option>`
            ).join('')}
                            </select>
                            <input type="number" min="1" value="1" placeholder="Qtd"
                                   class="w-24 bg-zinc-900 border border-zinc-700 rounded-lg p-3 text-white focus:outline-none focus:border-green-500">
                            <button type="button" onclick="addOrderItem(this)" class="px-4 bg-green-500 text-white rounded-lg hover:bg-green-600">
                                <i data-lucide="plus" class="w-4 h-4"></i>
                            </button>
                        </div>
                    </div>
                    <div id="order-items-list" class="mt-4 space-y-2"></div>
                </div>
                <div>
                    <label class="block text-sm text-zinc-400 mb-2">Observa√ß√µes</label>
                    <textarea rows="2" placeholder="Instru√ß√µes especiais..."
                              class="w-full bg-zinc-900 border border-zinc-700 rounded-lg p-3 text-white focus:outline-none focus:border-green-500"></textarea>
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm text-zinc-400 mb-2">Forma de Pagamento</label>
                        <select class="w-full bg-zinc-900 border border-zinc-700 rounded-lg p-3 text-white focus:outline-none focus:border-green-500">
                            <option value="cash">Dinheiro</option>
                            <option value="card">Cart√£o</option>
                            <option value="pix">PIX</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm text-zinc-400 mb-2">Troco para</label>
                        <input type="number" step="0.01" placeholder="R$ 0,00"
                               class="w-full bg-zinc-900 border border-zinc-700 rounded-lg p-3 text-white focus:outline-none focus:border-green-500">
                    </div>
                </div>
            `;

            modal.classList.remove('hidden');
            lucide.createIcons();
        }

        function addOrderItem(button) {
            // Implementation for adding items to order
            console.log('Add item functionality');
        }

        function updateOrdersTable() {
            const tbody = document.getElementById('orders-table-body');
            const emptyState = document.getElementById('orders-empty');

            tbody.innerHTML = '';

            if (appState.orders.length === 0) {
                emptyState.classList.remove('hidden');
                return;
            }

            emptyState.classList.add('hidden');

            appState.orders.forEach(order => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-zinc-900/50 transition';

                const statusText = {
                    pending: 'Pendente',
                    confirmed: 'Confirmado',
                    preparing: 'Preparando',
                    ready: 'Pronto',
                    onway: 'A caminho',
                    delivered: 'Entregue',
                    cancelled: 'Cancelado'
                }[order.status];

                row.innerHTML = `
                    <td class="p-4">
                        <span class="font-mono font-bold text-white">${order.id}</span>
                    </td>
                    <td class="p-4">
                        <div>
                            <p class="font-medium text-white">${order.client.name}</p>
                            <p class="text-sm text-zinc-500">${order.client.phone}</p>
                        </div>
                    </td>
                    <td class="p-4">
                        <span class="font-bold text-white">R$ ${order.total.toFixed(2)}</span>
                    </td>
                    <td class="p-4">
                        <span class="px-3 py-1 rounded-full text-xs font-bold ${order.status}-badge">
                            ${statusText}
                        </span>
                    </td>
                    <td class="p-4">
                        <span class="text-zinc-300">${order.driver?.name || '‚Äî'}</span>
                    </td>
                    <td class="p-4">
                        <span class="text-sm text-zinc-400">${formatTime(order.createdAt)}</span>
                    </td>
                    <td class="p-4">
                        <div class="flex items-center gap-2">
                            <button onclick="showOrderDetails('${order.id}')" class="p-1.5 text-zinc-400 hover:text-white hover:bg-zinc-800 rounded-lg transition">
                                <i data-lucide="eye" class="w-4 h-4"></i>
                            </button>
                            <button onclick="editOrder('${order.id}')" class="p-1.5 text-zinc-400 hover:text-white hover:bg-zinc-800 rounded-lg transition">
                                <i data-lucide="edit" class="w-4 h-4"></i>
                            </button>
                            <button onclick="changeOrderStatus('${order.id}')" class="p-1.5 text-zinc-400 hover:text-white hover:bg-zinc-800 rounded-lg transition">
                                <i data-lucide="refresh-cw" class="w-4 h-4"></i>
                            </button>
                        </div>
                    </td>
                `;

                tbody.appendChild(row);
            });

            lucide.createIcons();
        }

        function showOrderDetails(orderId) {
            const order = appState.orders.find(o => o.id === orderId);
            if (!order) return;

            const modal = document.getElementById('order-details-modal');
            modal.innerHTML = `
                <div class="bg-plena-dark border border-zinc-800 rounded-2xl w-full max-w-2xl max-h-[90vh] overflow-hidden">
                    <div class="p-6 border-b border-zinc-800 flex justify-between items-center">
                        <div>
                            <h3 class="text-xl font-bold text-white">Pedido ${order.id}</h3>
                            <p class="text-sm text-zinc-400">${formatDateTime(order.createdAt)}</p>
                        </div>
                        <button onclick="closeModal('order-details-modal')" class="text-zinc-500 hover:text-white">
                            <i data-lucide="x" class="w-5 h-5"></i>
                        </button>
                    </div>
                    <div class="p-6 overflow-y-auto max-h-[calc(90vh-200px)] space-y-6">
                        <!-- Client Info -->
                        <div>
                            <h4 class="font-bold text-white mb-3 flex items-center gap-2">
                                <i data-lucide="user" class="w-4 h-4 text-green-500"></i>
                                Informa√ß√µes do Cliente
                            </h4>
                            <div class="bg-zinc-900/50 rounded-lg p-4 space-y-2">
                                <div class="flex justify-between">
                                    <span class="text-zinc-400">Nome:</span>
                                    <span class="text-white font-medium">${order.client.name}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-zinc-400">Telefone:</span>
                                    <span class="text-white font-medium">${order.client.phone}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-zinc-400">Endere√ßo:</span>
                                    <span class="text-white font-medium text-right">${order.client.address}</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Order Items -->
                        <div>
                            <h4 class="font-bold text-white mb-3 flex items-center gap-2">
                                <i data-lucide="package" class="w-4 h-4 text-green-500"></i>
                                Itens do Pedido
                            </h4>
                            <div class="bg-zinc-900/50 rounded-lg p-4">
                                <div class="space-y-3">
                                    ${order.items.map(item => `
                                        <div class="flex justify-between items-center">
                                            <div>
                                                <p class="text-white font-medium">${item.quantity}x ${item.name}</p>
                                            </div>
                                            <p class="font-bold text-white">R$ ${(item.price * item.quantity).toFixed(2)}</p>
                                        </div>
                                    `).join('')}
                                </div>
                                <div class="border-t border-zinc-800 mt-4 pt-4">
                                    <div class="flex justify-between">
                                        <span class="text-zinc-400">Subtotal:</span>
                                        <span class="text-white">R$ ${(order.total - 5).toFixed(2)}</span>
                                    </div>
                                    <div class="flex justify-between mt-2">
                                        <span class="text-zinc-400">Taxa de entrega:</span>
                                        <span class="text-white">R$ 5.00</span>
                                    </div>
                                    <div class="flex justify-between mt-2 pt-2 border-t border-zinc-800">
                                        <span class="text-white font-bold">Total:</span>
                                        <span class="font-bold text-green-500">R$ ${order.total.toFixed(2)}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Order Status -->
                        <div>
                            <h4 class="font-bold text-white mb-3 flex items-center gap-2">
                                <i data-lucide="activity" class="w-4 h-4 text-green-500"></i>
                                Status do Pedido
                            </h4>
                            <div class="bg-zinc-900/50 rounded-lg p-4">
                                <div class="flex items-center justify-between mb-4">
                                    <span class="px-4 py-2 rounded-full text-sm font-bold ${order.status}-badge">
                                        ${order.status}
                                    </span>
                                    <button onclick="changeOrderStatus('${order.id}')" class="px-3 py-1.5 bg-green-500/20 text-green-500 rounded-lg text-sm hover:bg-green-500/30">
                                        Alterar Status
                                    </button>
                                </div>
                                <div class="space-y-2">
                                    <div class="flex justify-between">
                                        <span class="text-zinc-400">Criado em:</span>
                                        <span class="text-white">${formatTime(order.createdAt)}</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-zinc-400">Estimativa de entrega:</span>
                                        <span class="text-white">${formatTime(order.estimatedDelivery)}</span>
                                    </div>
                                    ${order.driver ? `
                                        <div class="flex justify-between">
                                            <span class="text-zinc-400">Entregador:</span>
                                            <span class="text-white">${order.driver.name}</span>
                                        </div>
                                    ` : ''}
                                </div>
                            </div>
                        </div>
                        
                        <!-- Notes -->
                        ${order.notes ? `
                            <div>
                                <h4 class="font-bold text-white mb-3 flex items-center gap-2">
                                    <i data-lucide="message-square" class="w-4 h-4 text-green-500"></i>
                                    Observa√ß√µes
                                </h4>
                                <div class="bg-zinc-900/50 rounded-lg p-4">
                                    <p class="text-white">${order.notes}</p>
                                </div>
                            </div>
                        ` : ''}
                    </div>
                    <div class="p-6 border-t border-zinc-800 flex justify-between gap-3">
                        <button onclick="printOrder('${order.id}')" class="px-4 py-2 border border-zinc-700 text-zinc-400 hover:text-white hover:border-zinc-600 rounded-lg transition flex items-center gap-2">
                            <i data-lucide="printer" class="w-4 h-4"></i> Imprimir
                        </button>
                        <div class="flex gap-3">
                            <button onclick="closeModal('order-details-modal')" class="px-4 py-2 border border-zinc-700 text-zinc-400 hover:text-white hover:border-zinc-600 rounded-lg transition">
                                Fechar
                            </button>
                            <button onclick="editOrder('${order.id}')" class="px-6 py-2 bg-gradient-to-r from-green-500 to-emerald-600 text-white font-bold rounded-lg hover:from-green-400 hover:to-emerald-500 transition">
                                Editar Pedido
                            </button>
                        </div>
                    </div>
                </div>
            `;

            modal.classList.remove('hidden');
            lucide.createIcons();
        }

        function changeOrderStatus(orderId) {
            const order = appState.orders.find(o => o.id === orderId);
            if (!order) return;

            const statuses = ['pending', 'confirmed', 'preparing', 'ready', 'onway', 'delivered', 'cancelled'];
            const currentIndex = statuses.indexOf(order.status);
            const nextIndex = (currentIndex + 1) % statuses.length;

            order.status = statuses[nextIndex];
            saveAppData();
            updateOrdersTable();
            updateRecentOrders();
            updateDashboardStats();

            showNotification(`Status do pedido ${orderId} alterado para ${order.status}`, 'success');
        }

        // --- MAP FUNCTIONALITY ---
        function initializeMap() {
            // Initialize map with default coordinates (S√£o Paulo)
            appState.map = new maplibregl.Map({
                container: 'map',
                style: 'https://demotiles.maplibre.org/style.json',
                center: [-46.6333, -23.5505],
                zoom: 12
            });

            // Add navigation controls
            appState.map.addControl(new maplibregl.NavigationControl());

            // Update drivers on map
            updateMapMarkers();
        }

        function updateMapMarkers() {
            // Clear existing markers
            appState.mapMarkers.forEach(marker => marker.remove());
            appState.mapMarkers = [];

            // Add markers for each driver
            appState.drivers.forEach(driver => {
                if (driver.location && driver.status === 'online') {
                    const marker = new maplibregl.Marker({
                        color: '#10B981',
                        className: 'driver-marker'
                    })
                        .setLngLat([driver.location.lng, driver.location.lat])
                        .setPopup(new maplibregl.Popup().setHTML(`
                        <div class="p-2">
                            <h4 class="font-bold text-black">${driver.name}</h4>
                            <p class="text-sm text-gray-600">${driver.vehicle}</p>
                            <p class="text-xs text-gray-500">${driver.plate}</p>
                        </div>
                    `))
                        .addTo(appState.map);

                    appState.mapMarkers.push(marker);
                }
            });

            // Update active deliveries list
            updateActiveDeliveries();
        }

        function refreshMap() {
            updateMapMarkers();
            showNotification('Mapa atualizado', 'info');
        }

        function centerMap() {
            if (appState.drivers.length > 0) {
                const firstDriver = appState.drivers[0];
                appState.map.flyTo({
                    center: [firstDriver.location.lng, firstDriver.location.lat],
                    zoom: 14
                });
            }
        }

        function updateActiveDeliveries() {
            const container = document.getElementById('active-deliveries');
            const activeOrders = appState.orders.filter(order =>
                ['onway'].includes(order.status)
            );

            container.innerHTML = '';
            activeOrders.forEach(order => {
                const deliveryEl = document.createElement('div');
                deliveryEl.className = 'flex items-start gap-3 p-3 bg-zinc-900/50 rounded-lg';

                deliveryEl.innerHTML = `
                    <div class="w-8 h-8 bg-green-500/10 rounded-lg flex items-center justify-center shrink-0">
                        <i data-lucide="package" class="w-4 h-4 text-green-500"></i>
                    </div>
                    <div class="flex-1">
                        <div class="flex justify-between items-start">
                            <div>
                                <p class="font-medium text-white">${order.id}</p>
                                <p class="text-sm text-zinc-500">${order.client.name}</p>
                            </div>
                            <span class="text-xs text-green-500">A caminho</span>
                        </div>
                        <div class="flex items-center gap-2 mt-2 text-xs text-zinc-500">
                            <i data-lucide="clock" class="w-3 h-3"></i>
                            <span>Entrega estimada: ${formatTime(order.estimatedDelivery)}</span>
                        </div>
                    </div>
                `;
                container.appendChild(deliveryEl);
            });

            // Update statistics
            const today = new Date().toDateString();
            const todayDeliveries = appState.orders.filter(order =>
                order.status === 'delivered' &&
                new Date(order.createdAt).toDateString() === today
            );

            document.getElementById('stat-deliveries-done').textContent = todayDeliveries.length;
            document.getElementById('stat-avg-time').textContent = '45min';
            document.getElementById('stat-total-distance').textContent = '12.5km';

            lucide.createIcons();
        }

        // --- DRIVER MANAGEMENT ---
        function initializeDrivers() {
            updateDriversGrid();
            updateOnlineDrivers();
            updateDriverPerformance();

            // Update driver count
            document.getElementById('driver-count').textContent = appState.drivers.length;
        }

        function addNewDriver() {
            const newDriver = {
                id: `DRV-${String(appState.drivers.length + 1).padStart(3, '0')}`,
                name: 'Novo Entregador',
                phone: '(11) 99999-9999',
                vehicle: 'Ve√≠culo n√£o informado',
                plate: 'ABC-0000',
                status: 'offline',
                rating: 0,
                deliveries: 0,
                location: null
            };

            appState.drivers.push(newDriver);
            saveAppData();
            initializeDrivers();
            updateMapMarkers();

            showNotification('Novo entregador adicionado', 'success');
        }

        function updateDriversGrid() {
            const container = document.querySelector('#drivers-view .grid');
            container.innerHTML = '';

            appState.drivers.forEach(driver => {
                const driverEl = document.createElement('div');
                driverEl.className = 'bg-plena-dark border border-zinc-800 rounded-xl p-5';

                driverEl.innerHTML = `
                    <div class="flex items-start justify-between mb-4">
                        <div class="flex items-center gap-3">
                            <div class="w-12 h-12 bg-gradient-to-br from-green-500 to-emerald-600 rounded-xl flex items-center justify-center">
                                <span class="font-bold text-white text-lg">${driver.name.charAt(0)}</span>
                            </div>
                            <div>
                                <h4 class="font-bold text-white">${driver.name}</h4>
                                <p class="text-sm text-zinc-500">${driver.phone}</p>
                            </div>
                        </div>
                        <span class="px-2.5 py-1 rounded-full text-xs font-bold ${driver.status === 'online' ? 'bg-green-500/20 text-green-500' : 'bg-zinc-500/20 text-zinc-500'}">
                            ${driver.status === 'online' ? 'Online' : 'Offline'}
                        </span>
                    </div>
                    <div class="space-y-3">
                        <div class="flex justify-between text-sm">
                            <span class="text-zinc-500">Ve√≠culo</span>
                            <span class="text-white">${driver.vehicle}</span>
                        </div>
                        <div class="flex justify-between text-sm">
                            <span class="text-zinc-500">Placa</span>
                            <span class="text-white font-mono">${driver.plate}</span>
                        </div>
                        <div class="flex justify-between text-sm">
                            <span class="text-zinc-500">Avalia√ß√£o</span>
                            <span class="text-white flex items-center gap-1">
                                <i data-lucide="star" class="w-3 h-3 text-amber-500 fill-amber-500"></i>
                                ${driver.rating.toFixed(1)}
                            </span>
                        </div>
                    </div>
                    <div class="mt-6 pt-4 border-t border-zinc-800 flex gap-2">
                        <button onclick="editDriver('${driver.id}')" class="flex-1 px-3 py-2 border border-zinc-700 text-zinc-400 hover:text-white hover:border-zinc-600 rounded-lg text-sm transition">
                            Editar
                        </button>
                        <button onclick="viewDriverStats('${driver.id}')" class="flex-1 px-3 py-2 bg-green-500/20 text-green-500 hover:bg-green-500/30 rounded-lg text-sm transition">
                            Estat√≠sticas
                        </button>
                    </div>
                `;

                container.appendChild(driverEl);
            });

            lucide.createIcons();
        }

        function updateOnlineDrivers() {
            const container = document.getElementById('online-drivers');
            const onlineDrivers = appState.drivers.filter(driver => driver.status === 'online');

            container.innerHTML = '';
            onlineDrivers.forEach(driver => {
                const driverEl = document.createElement('div');
                driverEl.className = 'flex items-center gap-3 p-3 bg-zinc-900/50 rounded-lg';

                driverEl.innerHTML = `
                    <div class="w-10 h-10 bg-gradient-to-br from-green-500 to-emerald-600 rounded-xl flex items-center justify-center">
                        <span class="font-bold text-white">${driver.name.charAt(0)}</span>
                    </div>
                    <div class="flex-1">
                        <p class="font-medium text-white">${driver.name}</p>
                        <p class="text-sm text-zinc-500">${driver.vehicle}</p>
                    </div>
                    <div class="text-right">
                        <div class="text-xs text-green-500 font-medium">Online</div>
                        <div class="text-xs text-zinc-500">${driver.deliveries} entregas</div>
                    </div>
                `;
                container.appendChild(driverEl);
            });
        }

        function updateDriverPerformance() {
            const tbody = document.getElementById('drivers-performance');
            tbody.innerHTML = '';

            appState.drivers.forEach(driver => {
                const row = document.createElement('tr');

                row.innerHTML = `
                    <td class="p-3">
                        <div class="flex items-center gap-3">
                            <div class="w-8 h-8 bg-gradient-to-br from-green-500 to-emerald-600 rounded-lg flex items-center justify-center">
                                <span class="font-bold text-white text-sm">${driver.name.charAt(0)}</span>
                            </div>
                            <span class="text-white">${driver.name}</span>
                        </div>
                    </td>
                    <td class="p-3">
                        <span class="text-white font-bold">${driver.deliveries}</span>
                    </td>
                    <td class="p-3">
                        <span class="text-white flex items-center gap-1">
                            <i data-lucide="star" class="w-3 h-3 text-amber-500 fill-amber-500"></i>
                            ${driver.rating.toFixed(1)}
                        </span>
                    </td>
                    <td class="p-3">
                        <span class="text-white">45min</span>
                    </td>
                    <td class="p-3">
                        <span class="px-2.5 py-1 rounded-full text-xs font-bold ${driver.status === 'online' ? 'bg-green-500/20 text-green-500' : 'bg-zinc-500/20 text-zinc-500'}">
                            ${driver.status === 'online' ? 'Online' : 'Offline'}
                        </span>
                    </td>
                    <td class="p-3">
                        <div class="flex gap-2">
                            <button onclick="editDriver('${driver.id}')" class="p-1.5 text-zinc-400 hover:text-white hover:bg-zinc-800 rounded-lg">
                                <i data-lucide="edit" class="w-4 h-4"></i>
                            </button>
                            <button onclick="messageDriver('${driver.id}')" class="p-1.5 text-zinc-400 hover:text-white hover:bg-zinc-800 rounded-lg">
                                <i data-lucide="message-circle" class="w-4 h-4"></i>
                            </button>
                        </div>
                    </td>
                `;

                tbody.appendChild(row);
            });

            lucide.createIcons();
        }

        // --- CLIENT MANAGEMENT ---
        function initializeClients() {
            updateClientsGrid();
            updateClientsTable();

            // Update client count
            document.getElementById('client-count').textContent = appState.clients.length;
        }

        function updateClientsGrid() {
            const container = document.querySelector('#clients-view .grid');
            const topClients = [...appState.clients]
                .sort((a, b) => b.totalSpent - a.totalSpent)
                .slice(0, 4);

            container.innerHTML = '';
            topClients.forEach(client => {
                const clientEl = document.createElement('div');
                clientEl.className = 'bg-plena-dark border border-zinc-800 rounded-xl p-5';

                clientEl.innerHTML = `
                    <div class="flex items-start justify-between mb-4">
                        <div class="flex items-center gap-3">
                            <div class="w-12 h-12 bg-gradient-to-br from-green-500 to-emerald-600 rounded-xl flex items-center justify-center">
                                <span class="font-bold text-white text-lg">${client.name.charAt(0)}</span>
                            </div>
                            <div>
                                <h4 class="font-bold text-white">${client.name}</h4>
                                <p class="text-sm text-zinc-500">${client.phone}</p>
                            </div>
                        </div>
                    </div>
                    <div class="space-y-3">
                        <div class="flex justify-between text-sm">
                            <span class="text-zinc-500">Total de Pedidos</span>
                            <span class="text-white font-bold">${client.totalOrders}</span>
                        </div>
                        <div class="flex justify-between text-sm">
                            <span class="text-zinc-500">Valor Gasto</span>
                            <span class="text-white font-bold">R$ ${client.totalSpent.toFixed(2)}</span>
                        </div>
                        <div class="flex justify-between text-sm">
                            <span class="text-zinc-500">√öltimo Pedido</span>
                            <span class="text-white">${formatDate(client.lastOrder)}</span>
                        </div>
                    </div>
                    <div class="mt-6 pt-4 border-t border-zinc-800">
                        <button onclick="viewClientDetails('${client.id}')" class="w-full px-4 py-2 bg-green-500/20 text-green-500 hover:bg-green-500/30 rounded-lg text-sm transition">
                            Ver Detalhes
                        </button>
                    </div>
                `;

                container.appendChild(clientEl);
            });

            lucide.createIcons();
        }

        function updateClientsTable() {
            const tbody = document.getElementById('clients-table-body');
            tbody.innerHTML = '';

            appState.clients.forEach(client => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-zinc-900/50 transition';

                row.innerHTML = `
                    <td class="p-4">
                        <div class="flex items-center gap-3">
                            <div class="w-8 h-8 bg-gradient-to-br from-green-500 to-emerald-600 rounded-lg flex items-center justify-center">
                                <span class="font-bold text-white text-sm">${client.name.charAt(0)}</span>
                            </div>
                            <div>
                                <p class="font-medium text-white">${client.name}</p>
                                <p class="text-sm text-zinc-500">${client.email}</p>
                            </div>
                        </div>
                    </td>
                    <td class="p-4">
                        <div>
                            <p class="text-white">${client.phone}</p>
                            <p class="text-sm text-zinc-500">${client.address}</p>
                        </div>
                    </td>
                    <td class="p-4">
                        <span class="font-bold text-white">${client.totalOrders}</span>
                    </td>
                    <td class="p-4">
                        <span class="font-bold text-white">R$ ${client.totalSpent.toFixed(2)}</span>
                    </td>
                    <td class="p-4">
                        <span class="text-sm text-zinc-400">${formatDate(client.lastOrder)}</span>
                    </td>
                    <td class="p-4">
                        <div class="flex items-center gap-2">
                            <button onclick="viewClientDetails('${client.id}')" class="p-1.5 text-zinc-400 hover:text-white hover:bg-zinc-800 rounded-lg transition">
                                <i data-lucide="eye" class="w-4 h-4"></i>
                            </button>
                            <button onclick="messageClient('${client.id}')" class="p-1.5 text-zinc-400 hover:text-white hover:bg-zinc-800 rounded-lg transition">
                                <i data-lucide="message-circle" class="w-4 h-4"></i>
                            </button>
                            <button onclick="editClient('${client.id}')" class="p-1.5 text-zinc-400 hover:text-white hover:bg-zinc-800 rounded-lg transition">
                                <i data-lucide="edit" class="w-4 h-4"></i>
                            </button>
                        </div>
                    </td>
                `;

                tbody.appendChild(row);
            });

            lucide.createIcons();
        }

        // --- ANALYTICS FUNCTIONS ---
        function initializeAnalytics() {
            updateAnalytics();
        }

        function updateAnalytics() {
            const period = document.getElementById('analytics-period').value;

            // Calculate analytics based on period
            const totalRevenue = appState.orders.reduce((sum, order) => sum + order.total, 0);
            const totalOrders = appState.orders.length;
            const newClients = appState.clients.length;
            const avgRating = 4.5; // This would come from actual ratings

            document.getElementById('analytics-total-revenue').textContent = `R$ ${totalRevenue.toFixed(2)}`;
            document.getElementById('analytics-total-orders').textContent = totalOrders;
            document.getElementById('analytics-new-clients').textContent = newClients;
            document.getElementById('analytics-avg-rating').textContent = avgRating.toFixed(1);

            updateRevenueChart();
            updateTopItems();
            updatePeakHours();
        }

        function updateRevenueChart() {
            const chart = document.getElementById('revenue-chart');
            const days = ['Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'S√°b', 'Dom'];

            chart.innerHTML = '';
            days.forEach((day, index) => {
                const height = 20 + Math.random() * 80;
                const bar = document.createElement('div');
                bar.className = 'flex flex-col items-center flex-1';

                bar.innerHTML = `
                    <div class="w-full bg-gradient-to-t from-green-500/30 to-green-500/10 rounded-t-lg relative group" style="height: ${height}%">
                        <div class="absolute inset-0 bg-gradient-to-t from-green-500 to-emerald-500 rounded-t-lg opacity-0 group-hover:opacity-100 transition-opacity"></div>
                        <div class="absolute -top-8 left-1/2 transform -translate-x-1/2 bg-black text-white text-xs px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap">
                            R$ ${(Math.random() * 1000).toFixed(2)}
                        </div>
                    </div>
                    <span class="text-xs text-zinc-500 mt-2">${day}</span>
                `;

                chart.appendChild(bar);
            });
        }

        function updateTopItems() {
            const container = document.getElementById('top-items');
            const items = [
                { name: 'X-Burger Premium', sales: 124, revenue: 4083.60 },
                { name: 'Coca-Cola 600ml', sales: 98, revenue: 872.20 },
                { name: 'Batata Frita', sales: 76, revenue: 1208.40 },
                { name: 'Milkshake', sales: 45, revenue: 850.50 }
            ];

            container.innerHTML = '';
            items.forEach((item, index) => {
                const itemEl = document.createElement('div');
                itemEl.className = 'flex items-center justify-between';

                itemEl.innerHTML = `
                    <div class="flex items-center gap-3">
                        <div class="w-8 h-8 bg-gradient-to-br from-green-500 to-emerald-600 rounded-lg flex items-center justify-center">
                            <span class="text-white font-bold text-sm">${index + 1}</span>
                        </div>
                        <div>
                            <p class="font-medium text-white">${item.name}</p>
                            <p class="text-xs text-zinc-500">${item.sales} vendas</p>
                        </div>
                    </div>
                    <span class="font-bold text-white">R$ ${item.revenue.toFixed(2)}</span>
                `;
                container.appendChild(itemEl);
            });
        }

        function updatePeakHours() {
            const container = document.getElementById('peak-hours');
            const hours = [
                { hour: '12:00', orders: 45 },
                { hour: '13:00', orders: 68 },
                { hour: '19:00', orders: 52 },
                { hour: '20:00', orders: 48 }
            ];

            container.innerHTML = '';
            hours.forEach(hour => {
                const hourEl = document.createElement('div');
                hourEl.className = 'space-y-2';

                hourEl.innerHTML = `
                    <div class="flex justify-between text-sm">
                        <span class="text-zinc-300">${hour.hour}</span>
                        <span class="text-white">${hour.orders} pedidos</span>
                    </div>
                    <div class="h-2 bg-zinc-800 rounded-full overflow-hidden">
                        <div class="h-full bg-gradient-to-r from-green-500 to-emerald-500 rounded-full" 
                             style="width: ${(hour.orders / 68) * 100}%"></div>
                    </div>
                `;
                container.appendChild(hourEl);
            });
        }

        // --- MENU MANAGEMENT ---
        function initializeMenu() {
            updateMenuCategories();
            updateMenuGrid();
        }

        function addMenuItem() {
            const newItem = {
                id: `MEN-${String(appState.menuItems.length + 1).padStart(3, '0')}`,
                name: 'Novo Item',
                category: 'lanches',
                price: 0.00,
                description: 'Descri√ß√£o do item',
                available: true,
                popular: false
            };

            appState.menuItems.push(newItem);
            saveAppData();
            initializeMenu();

            showNotification('Novo item adicionado ao card√°pio', 'success');
        }

        function filterMenuByCategory(category) {
            const buttons = document.querySelectorAll('.category-filter');
            buttons.forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            // Filter logic here
        }

        function updateMenuCategories() {
            const categories = ['Todos', 'Lanches', 'Bebidas', 'Acompanhamentos', 'Sobremesas', 'Combos'];
            const container = document.querySelector('.flex.overflow-x-auto');

            container.innerHTML = '';
            categories.forEach(category => {
                const button = document.createElement('button');
                button.textContent = category;
                button.className = `category-filter px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition ${category === 'Todos' ? 'active bg-gradient-to-r from-green-500 to-emerald-600 text-black' : 'bg-zinc-900 text-zinc-400 hover:text-white hover:bg-zinc-800'}`;
                button.onclick = () => filterMenuByCategory(category.toLowerCase());
                container.appendChild(button);
            });
        }

        function updateMenuGrid() {
            const container = document.getElementById('menu-grid');
            container.innerHTML = '';

            appState.menuItems.forEach(item => {
                const itemEl = document.createElement('div');
                itemEl.className = 'bg-plena-dark border border-zinc-800 rounded-xl p-5';

                itemEl.innerHTML = `
                    <div class="flex items-start justify-between mb-4">
                        <div>
                            <h4 class="font-bold text-white text-lg">${item.name}</h4>
                            <p class="text-sm text-zinc-500 capitalize">${item.category}</p>
                        </div>
                        ${item.popular ? `
                            <span class="px-2 py-1 bg-amber-500/20 text-amber-500 text-xs font-bold rounded-full">
                                Popular
                            </span>
                        ` : ''}
                    </div>
                    <p class="text-zinc-400 text-sm mb-4">${item.description}</p>
                    <div class="flex items-center justify-between">
                        <span class="font-bold text-green-500 text-lg">R$ ${item.price.toFixed(2)}</span>
                        <div class="flex gap-2">
                            <button onclick="editMenuItem('${item.id}')" class="p-1.5 text-zinc-400 hover:text-white hover:bg-zinc-800 rounded-lg">
                                <i data-lucide="edit" class="w-4 h-4"></i>
                            </button>
                            <button onclick="toggleMenuItem('${item.id}')" class="p-1.5 ${item.available ? 'text-green-500 hover:bg-green-500/20' : 'text-red-500 hover:bg-red-500/20'} rounded-lg">
                                <i data-lucide="${item.available ? 'check-circle' : 'x-circle'}" class="w-4 h-4"></i>
                            </button>
                        </div>
                    </div>
                `;

                container.appendChild(itemEl);
            });

            lucide.createIcons();
        }

        // --- SETTINGS FUNCTIONS ---
        function saveBusinessSettings() {
            const settings = appState.settings.business;
            settings.name = document.getElementById('business-name').value;
            settings.cnpj = document.getElementById('business-cnpj').value;
            settings.address = document.getElementById('business-address').value;
            settings.phone = document.getElementById('business-phone').value;
            settings.whatsapp = document.getElementById('business-whatsapp').value;

            saveAppData();
            showNotification('Configura√ß√µes do neg√≥cio salvas', 'success');
        }

        function saveDeliverySettings() {
            const settings = appState.settings.delivery;
            settings.fee = parseFloat(document.getElementById('delivery-fee').value);
            settings.radius = parseInt(document.getElementById('delivery-radius').value);
            settings.time = parseInt(document.getElementById('delivery-time').value);
            settings.active = document.getElementById('delivery-active').checked;

            saveAppData();
            showNotification('Configura√ß√µes de delivery salvas', 'success');
        }

        function savePaymentSettings() {
            const settings = appState.settings.payment;
            settings.cardFee = parseFloat(document.getElementById('card-fee').value);

            saveAppData();
            showNotification('Configura√ß√µes de pagamento salvas', 'success');
        }

        // --- NOTIFICATION SYSTEM ---
        function updateNotifications() {
            const container = document.getElementById('notifications-list');
            const count = appState.notifications.filter(n => !n.read).length;

            container.innerHTML = '';
            appState.notifications.forEach(notification => {
                const notifEl = document.createElement('div');
                notifEl.className = `p-3 bg-zinc-900/50 rounded-lg ${notification.read ? 'opacity-75' : ''}`;

                notifEl.innerHTML = `
                    <div class="flex items-start gap-3">
                        <div class="w-8 h-8 ${notification.type === 'new_order' ? 'bg-green-500/10' : 'bg-blue-500/10'} rounded-lg flex items-center justify-center shrink-0">
                            <i data-lucide="${notification.type === 'new_order' ? 'package' : 'bell'}" class="w-4 h-4 ${notification.type === 'new_order' ? 'text-green-500' : 'text-blue-500'}"></i>
                        </div>
                        <div class="flex-1">
                            <p class="text-sm text-white">${notification.message}</p>
                            <p class="text-xs text-zinc-500 mt-1">${notification.time}</p>
                        </div>
                        ${!notification.read ? `
                            <button onclick="markNotificationRead(${notification.id})" class="text-zinc-500 hover:text-white">
                                <i data-lucide="circle" class="w-3 h-3"></i>
                            </button>
                        ` : ''}
                    </div>
                `;
                container.appendChild(notifEl);
            });

            // Update notification badge
            const badge = document.getElementById('notification-count');
            if (count > 0) {
                badge.classList.remove('hidden');
                badge.textContent = count;
            } else {
                badge.classList.add('hidden');
            }

            lucide.createIcons();
        }

        function markNotificationRead(id) {
            const notification = appState.notifications.find(n => n.id === id);
            if (notification) {
                notification.read = true;
                saveAppData();
                updateNotifications();
            }
        }

        // --- UTILITY FUNCTIONS ---
        function formatTime(dateString) {
            const date = new Date(dateString);
            return date.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('pt-BR');
        }

        function formatDateTime(dateString) {
            const date = new Date(dateString);
            return date.toLocaleString('pt-BR');
        }

        function showNotification(message, type = 'info') {
            // Create notification element
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 px-4 py-3 rounded-lg shadow-lg z-50 animate-slide-in ${type === 'success' ? 'bg-gradient-to-r from-green-500 to-emerald-600' : type === 'warning' ? 'bg-gradient-to-r from-amber-500 to-orange-600' : 'bg-gradient-to-r from-blue-500 to-indigo-600'} text-white`;

            notification.innerHTML = `
                <div class="flex items-center gap-3">
                    <i data-lucide="${type === 'success' ? 'check-circle' : type === 'warning' ? 'alert-triangle' : 'info'}" class="w-5 h-5"></i>
                    <span>${message}</span>
                </div>
            `;

            document.body.appendChild(notification);
            lucide.createIcons();

            // Auto remove
            setTimeout(() => {
                notification.remove();
            }, 5000);
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.add('hidden');
        }

        function openSettings() {
            switchView('settings');
            toggleUserMenu();
        }

        function logout() {
            if (confirm('Tem certeza que deseja sair?')) {
                window.location.reload();
            }
        }

        function printReports() {
            window.print();
        }

        function openScanner() {
            document.getElementById('qr-scanner-modal').classList.remove('hidden');
        }

        function processQRCode() {
            const code = document.getElementById('manual-qr-code').value;
            if (code) {
                // Process QR code
                showNotification(`C√≥digo processado: ${code}`, 'success');
                closeModal('qr-scanner-modal');
            }
        }

        function toggleFAQ(button) {
            const answer = button.nextElementSibling;
            const icon = button.querySelector('i');

            answer.classList.toggle('hidden');
            if (answer.classList.contains('hidden')) {
                icon.setAttribute('data-lucide', 'chevron-down');
            } else {
                icon.setAttribute('data-lucide', 'chevron-up');
            }
            lucide.createIcons();
        }

        function clearAllData() {
            if (confirm('Tem certeza que deseja limpar todos os dados? Esta a√ß√£o n√£o pode ser desfeita.')) {
                localStorage.removeItem('plena_delivery_data');
                window.location.reload();
            }
        }

        // --- EVENT LISTENERS SETUP ---
        function setupEventListeners() {
            // Update offline status on load
            updateOnlineStatus();

            // Close notifications panel when clicking outside
            document.addEventListener('click', (e) => {
                if (!e.target.closest('#notifications-panel') && !e.target.closest('[onclick="toggleNotifications()"]')) {
                    document.getElementById('notifications-panel').classList.add('translate-x-full');
                    appState.isNotificationsOpen = false;
                }
            });

            // Handle form submissions
            document.getElementById('new-order-form')?.addEventListener('submit', (e) => {
                e.preventDefault();
                // Handle new order creation
                closeModal('new-order-modal');
                showNotification('Pedido criado com sucesso!', 'success');
            });
        }

        // Add CSS for status badges
        const style = document.createElement('style');
        style.textContent = `
            .pending-badge { background: linear-gradient(135deg, #F59E0B 0%, #D97706 100%); }
            .confirmed-badge { background: linear-gradient(135deg, #3B82F6 0%, #1D4ED8 100%); }
            .preparing-badge { background: linear-gradient(135deg, #8B5CF6 0%, #7C3AED 100%); }
            .ready-badge { background: linear-gradient(135deg, #10B981 0%, #059669 100%); }
            .onway-badge { background: linear-gradient(135deg, #10B981 0%, #059669 100%); }
            .delivered-badge { background: linear-gradient(135deg, #6B7280 0%, #4B5563 100%); }
            .cancelled-badge { background: linear-gradient(135deg, #EF4444 0%, #DC2626 100%); }
            
            .sidebar-btn {
                display: flex;
                align-items: center;
                gap: 12px;
                padding: 12px 16px;
                border-radius: 12px;
                width: 100%;
                text-align: left;
                transition: all 0.2s;
                color: #71717A;
                font-weight: 500;
            }
            
            .sidebar-btn:hover {
                background: rgba(255, 255, 255, 0.05);
                color: #FFFFFF;
            }
            
            .sidebar-btn.active {
                background: linear-gradient(135deg, rgba(16, 185, 129, 0.2) 0%, rgba(5, 150, 105, 0.2) 100%);
                color: #10B981;
                border-left: 4px solid #10B981;
            }
            
            .sidebar-badge {
                background: #EF4444;
                color: white;
                font-size: 11px;
                font-weight: bold;
                padding: 2px 6px;
                border-radius: 9999px;
                margin-left: auto;
            }
            
            .mobile-nav-btn {
                display: flex;
                flex-direction: column;
                align-items: center;
                padding: 8px;
                color: #71717A;
                flex: 1;
            }
            
            .mobile-nav-btn.active {
                color: #10B981;
            }
            
            .category-filter {
                padding: 8px 16px;
                border-radius: 9999px;
                font-size: 14px;
                font-weight: 500;
                transition: all 0.2s;
            }
        `;
        document.head.appendChild(style);
    </script>

    <!-- Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            // Create a simple service worker
            const swContent = `
                self.addEventListener('install', (event) => {
                    event.waitUntil(
                        caches.open('plena-delivery-v1').then((cache) => {
                            return cache.addAll([
                                '/',
                                '/index.html',
                                '/manifest.json'
                            ]);
                        })
                    );
                });
                
                self.addEventListener('fetch', (event) => {
                    event.respondWith(
                        caches.match(event.request).then((response) => {
                            return response || fetch(event.request);
                        })
                    );
                });
            `;

            // Create and register service worker
            const blob = new Blob([swContent], { type: 'application/javascript' });
            const swUrl = URL.createObjectURL(blob);

            navigator.serviceWorker.register(swUrl)
                .then(() => console.log('Service Worker registered'))
                .catch(error => console.log('Service Worker registration failed:', error));
        }
    </script>
</body>

</html>