<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Plena Assistência - Gestão Profissional com Estoque</title>

    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#2563EB">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Plena Assistência">
    <link rel="manifest"
        href='data:application/manifest+json,{"name":"Plena Assistência","short_name":"Plena","start_url":".","display":"standalone","background_color":"#F3F4F6","theme_color":"#2563EB","icons":[{"src":"https://unpkg.com/lucide-static@0.16.29/icons/wrench.svg","sizes":"192x192","type":"image/svg+xml"}]}'>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        plena: {
                            blue: '#2563EB',
                            dark: '#1e40af',
                            black: '#1a1a1a',
                            green: '#10B981',
                            red: '#EF4444',
                            yellow: '#F59E0B',
                            purple: '#8B5CF6',
                            orange: '#F97316'
                        },
                    },
                    animation: {
                        'pulse-slow': 'pulse 3s infinite',
                        'slide-in': 'slideIn 0.3s ease-out',
                    }
                }
            }
        }
    </script>

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@0.378.0/dist/umd/lucide.js"></script>

    <style>
        /* CSS Padronizado */
        :root {
            --plena-blue: #2563EB;
            --plena-dark: #1e40af;
            --plena-black: #1a1a1a;
            --plena-green: #10B981;
            --plena-red: #EF4444;
            --plena-yellow: #F59E0B;
            --plena-purple: #8B5CF6;
            --plena-orange: #F97316;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background-color: #F3F4F6;
            -webkit-tap-highlight-color: transparent;
        }

        .hide {
            display: none !important;
        }

        .fade-in {
            animation: fadeIn 0.3s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(5px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideIn {
            from {
                transform: translateX(-10px);
                opacity: 0;
            }

            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* Gráfico CSS */
        .chart-container {
            display: flex;
            align-items: flex-end;
            justify-content: space-between;
            height: 180px;
            gap: 2%;
        }

        .bar-group {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            height: 100%;
            position: relative;
        }

        .bar-wrapper {
            display: flex;
            align-items: flex-end;
            justify-content: center;
            gap: 2px;
            height: 100%;
            width: 100%;
        }

        .bar {
            width: 45%;
            border-radius: 6px 6px 0 0;
            transition: height 0.5s ease;
            min-height: 2px;
            position: relative;
            cursor: pointer;
        }

        .bar:hover::after {
            content: attr(data-value);
            position: absolute;
            top: -30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            white-space: nowrap;
            z-index: 10;
        }

        /* Modal Backdrop */
        .modal-backdrop {
            background-color: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(4px);
            animation: fadeIn 0.2s ease;
        }

        /* Sidebar Mobile */
        @media (max-width: 1024px) {
            .sidebar {
                transform: translateX(-100%);
                position: fixed;
                z-index: 50;
                height: 100vh;
                width: 280px;
            }

            .sidebar.open {
                transform: translateX(0);
            }
        }

        @media (min-width: 1025px) {
            .sidebar {
                width: 280px;
                position: fixed;
                height: 100vh;
            }

            .main-content {
                margin-left: 280px;
            }
        }

        /* Card Hover Effects */
        .card-hover {
            transition: all 0.3s ease;
        }

        .card-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        /* Badges */
        .badge {
            display: inline-flex;
            align-items: center;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .badge-success {
            background-color: #DCFCE7;
            color: #166534;
        }

        .badge-warning {
            background-color: #FEF3C7;
            color: #92400E;
        }

        .badge-danger {
            background-color: #FEE2E2;
            color: #991B1B;
        }

        .badge-info {
            background-color: #DBEAFE;
            color: #1E40AF;
        }

        /* Status Colors */
        .status-received {
            background-color: #F3F4F6;
            color: #374151;
        }

        .status-analyzing {
            background-color: #DBEAFE;
            color: #1E40AF;
        }

        .status-waiting {
            background-color: #FEF3C7;
            color: #92400E;
        }

        .status-ready {
            background-color: #D1FAE5;
            color: #065F46;
        }

        .status-delivered {
            background-color: #E5E7EB;
            color: #4B5563;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #a1a1a1;
        }

        /* Print Styles */
        @media print {

            .sidebar,
            .no-print,
            header,
            button,
            .fab-container,
            .hidden-print {
                display: none !important;
            }

            .main-content {
                margin: 0 !important;
                padding: 0 !important;
                width: 100% !important;
            }

            body {
                background: white !important;
                color: black !important;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }

            .view-section {
                padding: 0 !important;
                display: block !important;
            }

            .view-section.hide {
                display: none !important;
            }

            .fixed.inset-0:not(.hidden) {
                position: absolute !important;
                overflow: visible !important;
                z-index: 9999 !important;
                background: white !important;
            }

            .fixed.inset-0:not(.hidden)>div {
                box-shadow: none !important;
                border: none !important;
                max-width: 100% !important;
                width: 100% !important;
                margin: 0 !important;
                padding: 0 !important;
            }

            .modal-backdrop {
                background-color: transparent !important;
                backdrop-filter: none !important;
            }
        }

        /* Tutorial Steps */
        .step-number {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 12px;
            flex-shrink: 0;
        }

        /* Checklist */
        .checklist-item {
            transition: all 0.2s ease;
        }

        .checklist-item.completed {
            opacity: 0.7;
            text-decoration: line-through;
        }

        /* Code-like examples */
        .code-block {
            background: #1a1a1a;
            color: #f8f8f2;
            padding: 12px 16px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            overflow-x: auto;
            margin: 8px 0;
        }

        /* Progress bar */
        .progress-bar {
            height: 6px;
            border-radius: 3px;
            background: #e5e7eb;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #2563EB, #1e40af);
            transition: width 0.5s ease;
        }

        /* Estoque Specific */
        .stock-low {
            background-color: #FEF3C7 !important;
            border-left: 4px solid #F59E0B !important;
        }

        .stock-critical {
            background-color: #FEE2E2 !important;
            border-left: 4px solid #EF4444 !important;
        }

        .stock-ok {
            background-color: #DCFCE7 !important;
            border-left: 4px solid #10B981 !important;
        }

        .stock-movement-in {
            color: #10B981;
            font-weight: bold;
        }

        .stock-movement-out {
            color: #EF4444;
            font-weight: bold;
        }

        .stock-movement-adjust {
            color: #F59E0B;
            font-weight: bold;
        }
    </style>
    <link rel="manifest" href="manifest.json">
    <script src="https://unpkg.com/lucide@latest"></script>
</head>

<body class="text-gray-800 antialiased">

    <!-- Overlay para sidebar mobile -->
    <div id="overlay" class="fixed inset-0 bg-black/50 hidden z-40 transition-opacity" onclick="toggleSidebar()"></div>

    <!-- Sidebar -->
    <aside id="sidebar"
        class="sidebar bg-plena-black text-white transition-transform duration-300 flex flex-col shadow-2xl">
        <div class="h-20 flex items-center px-6 bg-gradient-to-r from-plena-blue to-plena-dark">
            <i data-lucide="wrench" class="w-8 h-8 mr-3"></i>
            <div>
                <h1 class="text-xl font-bold tracking-tight">PLENA ASSISTÊNCIA</h1>
                <p class="text-xs text-white/90 font-medium">Gestão Completa com Estoque</p>
            </div>
        </div>

        <nav class="p-4 space-y-2 flex-1 overflow-y-auto">
            <button onclick="router('dashboard')"
                class="nav-item w-full flex items-center px-4 py-3 rounded-xl hover:bg-white/10 transition-all group active-nav"
                id="nav-dashboard">
                <i data-lucide="wrench" class="w-5 h-5 mr-3 text-gray-400 group-hover:text-white"></i>
                Dashboard
            </button>
            <button onclick="router('orders')"
                class="nav-item w-full flex items-center px-4 py-3 rounded-xl hover:bg-white/10 transition-all group"
                id="nav-orders">
                <i data-lucide="clipboard-list" class="w-5 h-5 mr-3 text-gray-400 group-hover:text-white"></i>
                Ordens de Serviço
            </button>
            <button onclick="router('clients')"
                class="nav-item w-full flex items-center px-4 py-3 rounded-xl hover:bg-white/10 transition-all group"
                id="nav-clients">
                <i data-lucide="users" class="w-5 h-5 mr-3 text-gray-400 group-hover:text-white"></i>
                Clientes
            </button>
            <button onclick="router('inventory')"
                class="nav-item w-full flex items-center px-4 py-3 rounded-xl hover:bg-white/10 transition-all group"
                id="nav-inventory">
                <i data-lucide="package" class="w-5 h-5 mr-3 text-gray-400 group-hover:text-white"></i>
                Estoque
            </button>
            <button onclick="router('transactions')"
                class="nav-item w-full flex items-center px-4 py-3 rounded-xl hover:bg-white/10 transition-all group"
                id="nav-transactions">
                <i data-lucide="wallet" class="w-5 h-5 mr-3 text-gray-400 group-hover:text-white"></i>
                Fluxo de Caixa
            </button>
            <button onclick="router('reports')"
                class="nav-item w-full flex items-center px-4 py-3 rounded-xl hover:bg-white/10 transition-all group"
                id="nav-reports">
                <i data-lucide="bar-chart-3" class="w-5 h-5 mr-3 text-gray-400 group-hover:text-white"></i>
                Relatórios
            </button>
            <button onclick="router('settings')"
                class="nav-item w-full flex items-center px-4 py-3 rounded-xl hover:bg-white/10 transition-all group"
                id="nav-settings">
                <i data-lucide="settings" class="w-5 h-5 mr-3 text-gray-400 group-hover:text-white"></i>
                Configurações
            </button>

            <button onclick="router('instructions')"
                class="nav-item w-full flex items-center px-4 py-3 rounded-xl hover:bg-white/10 transition-all group"
                id="nav-instructions">
                <i data-lucide="book-open" class="w-5 h-5 mr-3 text-gray-400 group-hover:text-white"></i>
                Manual de Uso
            </button>
            <button onclick="router('about')"
                class="nav-item w-full flex items-center px-4 py-3 rounded-xl hover:bg-white/10 transition-all group"
                id="nav-about">
                <i data-lucide="info" class="w-5 h-5 mr-3 text-gray-400 group-hover:text-white"></i>
                Sobre a Plena
            </button>
        </nav>

        <div class="p-6 border-t border-white/10 text-center">
            <p class="text-xs text-gray-500">Todos os Direitos Reservados &copy; 2026</p>
            <a href="https://www.plenaaplicativos.com.br" target="_blank"
                class="text-[10px] text-gray-600 hover:text-plena-blue transition-colors mt-1 block decoration-0">
                Plena Soluções Digitais LTDA
            </a>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content min-h-screen flex flex-col">
        <!-- Header -->
        <header
            class="bg-white h-20 flex items-center justify-between px-4 lg:px-8 sticky top-0 z-30 shadow-sm border-b border-gray-100">
            <div class="flex items-center gap-4">
                <button onclick="toggleSidebar()" class="lg:hidden p-2 hover:bg-gray-100 rounded-lg text-gray-600">
                    <i data-lucide="menu" class="w-6 h-6"></i>
                </button>
                <h2 id="page-title" class="text-xl font-bold text-gray-800 hidden sm:block">Dashboard</h2>
            </div>

            <div class="flex items-center gap-2 sm:gap-3">
                <div class="relative group">
                    <div
                        class="absolute -inset-1 bg-plena-green/20 rounded-lg blur opacity-0 group-hover:opacity-100 transition duration-300">
                    </div>
                    <button onclick="openClosingModal()"
                        class="relative flex items-center px-4 py-2.5 bg-gray-800 text-white rounded-lg text-sm font-medium hover:bg-black transition-all shadow-sm active:scale-95">
                        <i data-lucide="check-circle-2" class="w-4 h-4 mr-2"></i>
                        <span>Fechar Caixa</span>
                    </button>
                </div>

                <div class="relative group">
                    <div
                        class="absolute -inset-1 bg-plena-blue/20 rounded-lg blur opacity-0 group-hover:opacity-100 transition duration-300">
                    </div>
                    <button onclick="openOrderModal()"
                        class="relative flex items-center px-4 py-2.5 bg-plena-blue text-white rounded-lg text-sm font-bold hover:bg-plena-dark transition-all shadow-lg shadow-blue-200 active:scale-95">
                        <i data-lucide="plus" class="w-5 h-5 mr-2"></i>
                        <span>Nova O.S.</span>
                    </button>
                </div>
            </div>
        </header>

        <!-- Content Area -->
        <div class="p-4 lg:p-8 flex-1 overflow-y-auto">

            <!-- Dashboard View -->
            <section id="view-dashboard" class="view-section fade-in">
                <!-- Stats Cards -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100 card-hover">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-1">Em Andamento
                                </p>
                                <h3 id="dash-active" class="text-3xl font-bold text-plena-blue">0</h3>
                                <p class="text-xs text-gray-500 mt-1">OS ativas</p>
                            </div>
                            <div class="w-12 h-12 rounded-full bg-plena-blue/10 flex items-center justify-center">
                                <i data-lucide="clock" class="w-6 h-6 text-plena-blue"></i>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100 card-hover">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-1">Prontos</p>
                                <h3 id="dash-ready" class="text-3xl font-bold text-green-600">0</h3>
                                <p class="text-xs text-gray-500 mt-1">Aguardando retirada</p>
                            </div>
                            <div class="w-12 h-12 rounded-full bg-green-100 flex items-center justify-center">
                                <i data-lucide="check-circle" class="w-6 h-6 text-green-600"></i>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100 card-hover">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-1">Baixo Estoque
                                </p>
                                <h3 id="dash-low-stock" class="text-3xl font-bold text-red-600">0</h3>
                                <p class="text-xs text-gray-500 mt-1">Produtos críticos</p>
                            </div>
                            <div class="w-12 h-12 rounded-full bg-red-100 flex items-center justify-center">
                                <i data-lucide="alert-triangle" class="w-6 h-6 text-red-600"></i>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100 card-hover">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-1">Faturamento</p>
                                <h3 id="dash-revenue" class="text-2xl font-bold text-gray-900">R$ 0,00</h3>
                                <p class="text-xs text-gray-500 mt-1">Mês atual</p>
                            </div>
                            <div class="w-12 h-12 rounded-full bg-yellow-100 flex items-center justify-center">
                                <i data-lucide="dollar-sign" class="w-6 h-6 text-yellow-600"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Charts and OS Status -->
                <div class="grid grid-cols-1 xl:grid-cols-3 gap-6 mb-8">
                    <div class="xl:col-span-2 bg-white p-6 rounded-2xl shadow-sm border border-gray-100">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="font-bold text-gray-800">Distribuição por Status</h3>
                        </div>
                        <div id="chart-area" class="chart-container"></div>
                    </div>

                    <!-- Quick Actions -->
                    <div class="space-y-6">
                        <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100">
                            <h3 class="font-bold text-gray-800 mb-4 flex items-center">
                                <i data-lucide="zap" class="w-4 h-4 mr-2 text-plena-blue"></i>
                                Ações Rápidas
                            </h3>
                            <div class="space-y-3">
                                <button onclick="router('orders')"
                                    class="w-full flex items-center justify-between p-3 bg-blue-50 hover:bg-blue-100 rounded-lg transition-colors">
                                    <span class="text-sm font-medium text-blue-700">Ver todas as O.S.</span>
                                    <i data-lucide="arrow-right" class="w-4 h-4 text-blue-500"></i>
                                </button>
                                <button onclick="openProductModal()"
                                    class="w-full flex items-center justify-between p-3 bg-green-50 hover:bg-green-100 rounded-lg transition-colors">
                                    <span class="text-sm font-medium text-green-700">Cadastrar Produto</span>
                                    <i data-lucide="package-plus" class="w-4 h-4 text-green-500"></i>
                                </button>
                                <button onclick="router('reports')"
                                    class="w-full flex items-center justify-between p-3 bg-purple-50 hover:bg-purple-100 rounded-lg transition-colors">
                                    <span class="text-sm font-medium text-purple-700">Gerar Relatório</span>
                                    <i data-lucide="file-bar-chart" class="w-4 h-4 text-purple-500"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Recent Orders & Low Stock -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- Recent Orders -->
                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="font-bold text-gray-800">Ordens de Serviço Recentes</h3>
                            <button onclick="router('orders')"
                                class="text-sm text-plena-blue hover:text-plena-dark font-medium">
                                Ver todas →
                            </button>
                        </div>
                        <div id="recent-orders" class="space-y-3">
                            <!-- Dynamic content -->
                        </div>
                    </div>

                    <!-- Low Stock Alerts -->
                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="font-bold text-gray-800">Alerta de Baixo Estoque</h3>
                            <button onclick="router('inventory')"
                                class="text-sm text-red-600 hover:text-red-800 font-medium">
                                Ver estoque →
                            </button>
                        </div>
                        <div id="low-stock-alerts" class="space-y-3">
                            <!-- Dynamic content -->
                        </div>
                    </div>
                </div>
            </section>

            <!-- Orders View -->
            <section id="view-orders" class="view-section hide fade-in">
                <div class="mb-6 flex flex-col sm:flex-row sm:items-center justify-between gap-4">
                    <div>
                        <h2 class="text-xl font-bold text-gray-800">Ordens de Serviço</h2>
                        <p class="text-sm text-gray-600">Gerencie todas as ordens de serviço</p>
                    </div>
                    <div class="flex items-center gap-3">
                        <button onclick="exportOrdersCSV()"
                            class="flex items-center gap-2 px-4 py-2 bg-green-100 text-green-700 rounded-lg text-sm font-medium hover:bg-green-200 transition-colors">
                            <i data-lucide="download" class="w-4 h-4"></i>
                            Exportar CSV
                        </button>
                        <button onclick="printOrderList()"
                            class="flex items-center gap-2 px-4 py-2 bg-blue-100 text-blue-700 rounded-lg text-sm font-medium hover:bg-blue-200 transition-colors">
                            <i data-lucide="printer" class="w-4 h-4"></i>
                            Imprimir Lista
                        </button>
                    </div>
                </div>

                <!-- Filters -->
                <div class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden mb-6">
                    <div class="p-4 bg-gray-50 grid grid-cols-1 md:grid-cols-4 gap-3 border-b border-gray-200">
                        <div class="relative">
                            <i data-lucide="search" class="absolute left-3 top-3 w-4 h-4 text-gray-400"></i>
                            <input type="text" id="search-order" onkeyup="renderOrders()" placeholder="Buscar..."
                                class="w-full pl-10 pr-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-plena-blue outline-none text-sm">
                        </div>
                        <div>
                            <input type="date" id="filter-start" onchange="renderOrders()"
                                class="w-full border p-2 rounded-lg text-sm bg-white">
                        </div>
                        <div>
                            <input type="date" id="filter-end" onchange="renderOrders()"
                                class="w-full border p-2 rounded-lg text-sm bg-white">
                        </div>
                        <div class="flex gap-2">
                            <select id="filter-status" onchange="renderOrders()"
                                class="flex-1 px-4 py-2 rounded-lg border border-gray-300 text-sm bg-white outline-none">
                                <option value="all">Todos Status</option>
                                <option value="received">Recebido</option>
                                <option value="analyzing">Em Análise</option>
                                <option value="waiting_parts">Aguardando Peça</option>
                                <option value="ready">Pronto</option>
                                <option value="delivered">Entregue</option>
                            </select>
                            <button onclick="clearFilters()"
                                class="px-3 py-2 bg-gray-200 hover:bg-gray-300 rounded-lg text-sm transition-colors">
                                <i data-lucide="x" class="w-4 h-4"></i>
                            </button>
                        </div>
                    </div>

                    <!-- Orders Table -->
                    <div class="overflow-x-auto">
                        <table class="w-full text-left">
                            <thead class="bg-gray-50 text-gray-500 text-xs uppercase">
                                <tr>
                                    <th class="px-6 py-3">Nº O.S.</th>
                                    <th class="px-6 py-3">Cliente</th>
                                    <th class="px-6 py-3">Equipamento</th>
                                    <th class="px-6 py-3">Status</th>
                                    <th class="px-6 py-3">Data Entrada</th>
                                    <th class="px-6 py-3 text-right">Valor</th>
                                    <th class="px-6 py-3 text-center">Ações</th>
                                </tr>
                            </thead>
                            <tbody id="orders-table-body" class="divide-y divide-gray-100 text-sm"></tbody>
                        </table>
                    </div>
                    <div id="empty-msg" class="hidden p-8 text-center text-gray-400">
                        <i data-lucide="clipboard-list" class="w-12 h-12 mx-auto mb-4 text-gray-300"></i>
                        <p>Nenhuma ordem de serviço encontrada.</p>
                    </div>
                </div>

                <!-- Summary -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                    <div class="bg-blue-50 p-4 rounded-xl border border-blue-100">
                        <p class="text-xs text-gray-500 uppercase font-bold mb-1">Em Andamento</p>
                        <p id="filter-active" class="text-lg font-bold text-blue-700">0</p>
                    </div>
                    <div class="bg-yellow-50 p-4 rounded-xl border border-yellow-100">
                        <p class="text-xs text-gray-500 uppercase font-bold mb-1">Aguardando</p>
                        <p id="filter-waiting" class="text-lg font-bold text-yellow-700">0</p>
                    </div>
                    <div class="bg-green-50 p-4 rounded-xl border border-green-100">
                        <p class="text-xs text-gray-500 uppercase font-bold mb-1">Prontos</p>
                        <p id="filter-ready" class="text-lg font-bold text-green-700">0</p>
                    </div>
                    <div class="bg-purple-50 p-4 rounded-xl border border-purple-100">
                        <p class="text-xs text-gray-500 uppercase font-bold mb-1">Total O.S.</p>
                        <p id="filter-total" class="text-lg font-bold text-purple-700">0</p>
                    </div>
                </div>
            </section>

            <!-- Clients View -->
            <section id="view-clients" class="view-section hide fade-in">
                <div class="mb-6 flex flex-col sm:flex-row sm:items-center justify-between gap-4">
                    <div>
                        <h2 class="text-xl font-bold text-gray-800">Clientes</h2>
                        <p class="text-sm text-gray-600">Gerencie seu cadastro de clientes</p>
                    </div>
                    <div class="flex items-center gap-3">
                        <button onclick="openClientModal()"
                            class="flex items-center gap-2 px-4 py-2 bg-plena-blue text-white rounded-lg text-sm font-bold hover:bg-plena-dark transition-colors">
                            <i data-lucide="user-plus" class="w-4 h-4"></i>
                            Novo Cliente
                        </button>
                    </div>
                </div>

                <!-- Clients Table -->
                <div class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden mb-6">
                    <div class="p-4 bg-gray-50 border-b border-gray-200">
                        <div class="relative">
                            <i data-lucide="search" class="absolute left-3 top-3 w-4 h-4 text-gray-400"></i>
                            <input type="text" id="search-client" onkeyup="renderClients()"
                                placeholder="Buscar cliente..."
                                class="w-full pl-10 pr-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-plena-blue outline-none text-sm">
                        </div>
                    </div>

                    <div class="overflow-x-auto">
                        <table class="w-full text-left">
                            <thead class="bg-gray-50 text-gray-500 text-xs uppercase">
                                <tr>
                                    <th class="px-6 py-3">Cliente</th>
                                    <th class="px-6 py-3">Contato</th>
                                    <th class="px-6 py-3">Total O.S.</th>
                                    <th class="px-6 py-3">Última O.S.</th>
                                    <th class="px-6 py-3 text-center">Ações</th>
                                </tr>
                            </thead>
                            <tbody id="clients-table-body" class="divide-y divide-gray-100 text-sm"></tbody>
                        </table>
                    </div>
                    <div id="empty-clients-msg" class="hidden p-8 text-center text-gray-400">
                        <i data-lucide="users" class="w-12 h-12 mx-auto mb-4 text-gray-300"></i>
                        <p>Nenhum cliente cadastrado.</p>
                    </div>
                </div>
            </section>

            <!-- Inventory View -->
            <section id="view-inventory" class="view-section hide fade-in">
                <div class="mb-6 flex flex-col sm:flex-row sm:items-center justify-between gap-4">
                    <div>
                        <h2 class="text-xl font-bold text-gray-800">Controle de Estoque</h2>
                        <p class="text-sm text-gray-600">Gerencie produtos, peças e materiais</p>
                    </div>
                    <div class="flex items-center gap-3">
                        <button onclick="openProductModal()"
                            class="flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg text-sm font-bold hover:bg-green-700 transition-colors">
                            <i data-lucide="package-plus" class="w-4 h-4"></i>
                            Novo Produto
                        </button>
                        <button onclick="openMovementModal()"
                            class="flex items-center gap-2 px-4 py-2 bg-plena-blue text-white rounded-lg text-sm font-bold hover:bg-plena-dark transition-colors">
                            <i data-lucide="move" class="w-4 h-4"></i>
                            Movimentação
                        </button>
                    </div>
                </div>

                <!-- Inventory Stats -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-1">Total Produtos
                                </p>
                                <h3 id="inv-total" class="text-3xl font-bold text-plena-blue">0</h3>
                                <p class="text-xs text-gray-500 mt-1">Itens cadastrados</p>
                            </div>
                            <div class="w-12 h-12 rounded-full bg-plena-blue/10 flex items-center justify-center">
                                <i data-lucide="package" class="w-6 h-6 text-plena-blue"></i>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-1">Valor Total</p>
                                <h3 id="inv-value" class="text-2xl font-bold text-green-600">R$ 0,00</h3>
                                <p class="text-xs text-gray-500 mt-1">Em estoque</p>
                            </div>
                            <div class="w-12 h-12 rounded-full bg-green-100 flex items-center justify-center">
                                <i data-lucide="dollar-sign" class="w-6 h-6 text-green-600"></i>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-1">Baixo Estoque
                                </p>
                                <h3 id="inv-low" class="text-3xl font-bold text-red-600">0</h3>
                                <p class="text-xs text-gray-500 mt-1">Atenção necessária</p>
                            </div>
                            <div class="w-12 h-12 rounded-full bg-red-100 flex items-center justify-center">
                                <i data-lucide="alert-triangle" class="w-6 h-6 text-red-600"></i>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-1">Categorias</p>
                                <h3 id="inv-categories" class="text-3xl font-bold text-purple-600">0</h3>
                                <p class="text-xs text-gray-500 mt-1">Tipos de produtos</p>
                            </div>
                            <div class="w-12 h-12 rounded-full bg-purple-100 flex items-center justify-center">
                                <i data-lucide="tags" class="w-6 h-6 text-purple-600"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Inventory Table -->
                <div class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden mb-6">
                    <div class="p-4 bg-gray-50 border-b border-gray-200">
                        <div class="flex flex-col md:flex-row gap-3">
                            <div class="relative flex-1">
                                <i data-lucide="search" class="absolute left-3 top-3 w-4 h-4 text-gray-400"></i>
                                <input type="text" id="search-inventory" onkeyup="renderInventory()"
                                    placeholder="Buscar produto..."
                                    class="w-full pl-10 pr-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-plena-blue outline-none text-sm">
                            </div>
                            <div class="flex gap-2">
                                <select id="filter-category" onchange="renderInventory()"
                                    class="px-4 py-2 rounded-lg border border-gray-300 text-sm bg-white outline-none">
                                    <option value="all">Todas Categorias</option>
                                    <!-- Categories will be populated dynamically -->
                                </select>
                                <select id="filter-stock" onchange="renderInventory()"
                                    class="px-4 py-2 rounded-lg border border-gray-300 text-sm bg-white outline-none">
                                    <option value="all">Todo Estoque</option>
                                    <option value="low">Baixo Estoque</option>
                                    <option value="critical">Estoque Crítico</option>
                                    <option value="out">Sem Estoque</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="overflow-x-auto">
                        <table class="w-full text-left">
                            <thead class="bg-gray-50 text-gray-500 text-xs uppercase">
                                <tr>
                                    <th class="px-6 py-3">Código</th>
                                    <th class="px-6 py-3">Produto</th>
                                    <th class="px-6 py-3">Categoria</th>
                                    <th class="px-6 py-3 text-center">Estoque Atual</th>
                                    <th class="px-6 py-3 text-center">Mínimo</th>
                                    <th class="px-6 py-3 text-right">Custo</th>
                                    <th class="px-6 py-3 text-right">Venda</th>
                                    <th class="px-6 py-3 text-center">Ações</th>
                                </tr>
                            </thead>
                            <tbody id="inventory-table-body" class="divide-y divide-gray-100 text-sm"></tbody>
                        </table>
                    </div>
                    <div id="empty-inventory-msg" class="hidden p-8 text-center text-gray-400">
                        <i data-lucide="package" class="w-12 h-12 mx-auto mb-4 text-gray-300"></i>
                        <p>Nenhum produto cadastrado.</p>
                    </div>
                </div>

                <!-- Movement History -->
                <div class="mt-8">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">Histórico de Movimentações</h3>
                    <div class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden">
                        <div class="p-4 bg-gray-50 border-b border-gray-200">
                            <div class="flex flex-col md:flex-row gap-3">
                                <div>
                                    <input type="date" id="movement-start" onchange="renderMovements()"
                                        class="w-full border p-2 rounded-lg text-sm bg-white">
                                </div>
                                <div>
                                    <input type="date" id="movement-end" onchange="renderMovements()"
                                        class="w-full border p-2 rounded-lg text-sm bg-white">
                                </div>
                                <div class="flex gap-2">
                                    <select id="movement-type" onchange="renderMovements()"
                                        class="px-4 py-2 rounded-lg border border-gray-300 text-sm bg-white outline-none">
                                        <option value="all">Todas Movimentações</option>
                                        <option value="in">Entradas</option>
                                        <option value="out">Saídas</option>
                                        <option value="adjust">Ajustes</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="overflow-x-auto">
                            <table class="w-full text-left">
                                <thead class="bg-gray-50 text-gray-500 text-xs uppercase">
                                    <tr>
                                        <th class="px-6 py-3">Data</th>
                                        <th class="px-6 py-3">Produto</th>
                                        <th class="px-6 py-3">Tipo</th>
                                        <th class="px-6 py-3 text-center">Quantidade</th>
                                        <th class="px-6 py-3">Motivo</th>
                                        <th class="px-6 py-3 text-right">Valor Total</th>
                                    </tr>
                                </thead>
                                <tbody id="movements-table-body" class="divide-y divide-gray-100 text-sm"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Transactions View -->
            <section id="view-transactions" class="view-section hide fade-in">
                <div class="mb-6 flex flex-col sm:flex-row sm:items-center justify-between gap-4">
                    <div>
                        <h2 class="text-xl font-bold text-gray-800">Fluxo de Caixa</h2>
                        <p class="text-sm text-gray-600">Controle financeiro da assistência</p>
                    </div>
                    <div class="flex items-center gap-3">
                        <button onclick="openTransactionModal()"
                            class="flex items-center gap-2 px-4 py-2 bg-plena-blue text-white rounded-lg text-sm font-bold hover:bg-plena-dark transition-colors">
                            <i data-lucide="plus" class="w-4 h-4"></i>
                            Novo Lançamento
                        </button>
                    </div>
                </div>

                <!-- Stats Cards -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-1">Saldo Total</p>
                                <h3 id="cash-balance" class="text-3xl font-bold text-gray-900">R$ 0,00</h3>
                                <p class="text-xs text-gray-500 mt-1">Disponível</p>
                            </div>
                            <div class="w-12 h-12 rounded-full bg-plena-blue/10 flex items-center justify-center">
                                <i data-lucide="wallet" class="w-6 h-6 text-plena-blue"></i>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-1">Entradas (Mês)
                                </p>
                                <h3 id="cash-income" class="text-2xl font-bold text-green-600">+R$ 0,00</h3>
                                <p class="text-xs text-gray-500 mt-1">Receitas do mês</p>
                            </div>
                            <div class="w-12 h-12 rounded-full bg-green-100 flex items-center justify-center">
                                <i data-lucide="trending-up" class="w-6 h-6 text-green-600"></i>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-1">Saídas (Mês)
                                </p>
                                <h3 id="cash-expense" class="text-2xl font-bold text-red-600">-R$ 0,00</h3>
                                <p class="text-xs text-gray-500 mt-1">Despesas do mês</p>
                            </div>
                            <div class="w-12 h-12 rounded-full bg-red-100 flex items-center justify-center">
                                <i data-lucide="trending-down" class="w-6 h-6 text-red-600"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Transactions Table -->
                <div class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden">
                    <div class="p-4 bg-gray-50 grid grid-cols-1 md:grid-cols-3 gap-3 border-b border-gray-200">
                        <div>
                            <input type="date" id="cash-start" onchange="renderTransactions()"
                                class="w-full border p-2 rounded-lg text-sm bg-white">
                        </div>
                        <div>
                            <input type="date" id="cash-end" onchange="renderTransactions()"
                                class="w-full border p-2 rounded-lg text-sm bg-white">
                        </div>
                        <div class="flex gap-2">
                            <select id="cash-type" onchange="renderTransactions()"
                                class="flex-1 px-4 py-2 rounded-lg border border-gray-300 text-sm bg-white outline-none">
                                <option value="all">Todos</option>
                                <option value="income">Entradas</option>
                                <option value="expense">Saídas</option>
                            </select>
                        </div>
                    </div>

                    <div class="overflow-x-auto">
                        <table class="w-full text-left">
                            <thead class="bg-gray-50 text-gray-500 text-xs uppercase">
                                <tr>
                                    <th class="px-6 py-3">Data</th>
                                    <th class="px-6 py-3">Descrição</th>
                                    <th class="px-6 py-3">Categoria</th>
                                    <th class="px-6 py-3 text-right">Valor</th>
                                    <th class="px-6 py-3 text-center">Ações</th>
                                </tr>
                            </thead>
                            <tbody id="trans-table-body" class="divide-y divide-gray-100 text-sm"></tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Reports View -->
            <section id="view-reports" class="view-section hide fade-in">
                <div class="mb-6">
                    <h2 class="text-xl font-bold text-gray-800 mb-2">Relatórios da Assistência</h2>
                    <p class="text-sm text-gray-600">Gere relatórios detalhados para análise</p>
                </div>

                <!-- Report Cards -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
                    <button onclick="generateMonthlyReport()"
                        class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100 card-hover text-left">
                        <div class="w-12 h-12 rounded-full bg-blue-100 flex items-center justify-center mb-4">
                            <i data-lucide="wrench" class="w-6 h-6 text-plena-blue"></i>
                        </div>
                        <h3 class="font-bold text-gray-800 mb-2">Relatório Mensal</h3>
                        <p class="text-sm text-gray-600">Resumo completo do mês atual</p>
                    </button>

                    <button onclick="generateInventoryReport()"
                        class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100 card-hover text-left">
                        <div class="w-12 h-12 rounded-full bg-orange-100 flex items-center justify-center mb-4">
                            <i data-lucide="package" class="w-6 h-6 text-plena-orange"></i>
                        </div>
                        <h3 class="font-bold text-gray-800 mb-2">Estoque</h3>
                        <p class="text-sm text-gray-600">Análise de produtos e valores</p>
                    </button>

                    <button onclick="generateFinancialReport()"
                        class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100 card-hover text-left">
                        <div class="w-12 h-12 rounded-full bg-purple-100 flex items-center justify-center mb-4">
                            <i data-lucide="dollar-sign" class="w-6 h-6 text-purple-600"></i>
                        </div>
                        <h3 class="font-bold text-gray-800 mb-2">Financeiro</h3>
                        <p class="text-sm text-gray-600">Faturamento e despesas</p>
                    </button>
                </div>

                <!-- Report Results -->
                <div id="report-result" class="hide bg-white p-6 rounded-2xl shadow-sm border border-gray-100">
                    <div id="report-content"></div>
                </div>
            </section>

            <!-- Settings View -->
            <section id="view-settings" class="view-section hide fade-in">
                <div class="mb-6">
                    <h2 class="text-xl font-bold text-gray-800 mb-2">Configurações do Sistema</h2>
                    <p class="text-sm text-gray-600">Personalize e gerencie suas preferências</p>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- Company Settings -->
                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100">
                        <h3 class="font-bold text-gray-800 mb-6 flex items-center">
                            <i data-lucide="building" class="w-5 h-5 mr-2 text-plena-blue"></i>
                            Configurações da Empresa
                        </h3>

                        <div class="space-y-4">
                            <div>
                                <label class="text-xs font-bold text-gray-500 uppercase">Nome da Assistência</label>
                                <input type="text" id="company-name" placeholder="Sua Assistência Técnica"
                                    class="w-full border p-2 rounded-lg text-sm">
                            </div>
                            <div>
                                <label class="text-xs font-bold text-gray-500 uppercase">CNPJ / CPF</label>
                                <input type="text" id="company-doc" placeholder="00.000.000/0000-00"
                                    class="w-full border p-2 rounded-lg text-sm">
                            </div>
                            <div>
                                <label class="text-xs font-bold text-gray-500 uppercase">Telefone para Contato</label>
                                <input type="text" id="company-phone" placeholder="(00) 00000-0000"
                                    class="w-full border p-2 rounded-lg text-sm">
                            </div>
                            <div>
                                <label class="text-xs font-bold text-gray-500 uppercase">Endereço</label>
                                <input type="text" id="company-address" placeholder="Endereço completo"
                                    class="w-full border p-2 rounded-lg text-sm">
                            </div>
                            <button onclick="saveCompanySettings()"
                                class="w-full bg-plena-blue text-white py-3 rounded-lg text-sm font-bold hover:bg-plena-dark transition-colors mt-4">
                                Salvar Configurações
                            </button>
                        </div>
                    </div>

                    <!-- Data Management -->
                    <div class="space-y-6">
                        <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100">
                            <h3 class="font-bold text-gray-800 mb-4 flex items-center">
                                <i data-lucide="shield-alert" class="w-5 h-5 mr-2 text-plena-blue"></i>
                                Segurança de Dados
                            </h3>

                            <div class="bg-blue-50 border border-blue-200 p-4 rounded-lg text-sm text-blue-800 mb-6">
                                <p class="font-bold mb-2">⚠️ Importante</p>
                                <p>Seus dados ficam salvos 100% no navegador. Faça backup regularmente para evitar
                                    perdas!</p>
                            </div>

                            <div class="space-y-3">
                                <button onclick="downloadBackup()"
                                    class="w-full border border-gray-300 py-3 rounded-lg text-sm font-medium hover:bg-gray-50 flex justify-center items-center gap-2">
                                    <i data-lucide="download" class="w-4 h-4"></i>
                                    Baixar Backup Completo (.json)
                                </button>

                                <div class="relative">
                                    <button
                                        class="w-full bg-gray-800 text-white py-3 rounded-lg text-sm font-medium flex justify-center items-center gap-2">
                                        <i data-lucide="upload" class="w-4 h-4"></i>
                                        Restaurar Backup
                                    </button>
                                    <input type="file" onchange="restoreBackup(this)" accept=".json"
                                        class="absolute inset-0 opacity-0 cursor-pointer">
                                </div>
                            </div>
                        </div>

                        <!-- Danger Zone -->
                        <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100">
                            <h3 class="font-bold text-gray-800 mb-4 flex items-center text-red-600">
                                <i data-lucide="alert-triangle" class="w-5 h-5 mr-2"></i>
                                Zona de Perigo
                            </h3>

                            <div class="bg-red-50 p-4 rounded-lg border border-red-100 mb-4">
                                <p class="text-sm text-red-600"><strong>Atenção:</strong> Estas ações são irreversíveis.
                                </p>
                            </div>

                            <div class="grid grid-cols-2 gap-3">
                                <button onclick="clearOldOrders()"
                                    class="py-2.5 border border-red-300 text-red-600 rounded-lg text-sm hover:bg-red-50 transition-colors">
                                    Limpar O.S. Antigas
                                </button>
                                <button onclick="factoryReset()"
                                    class="py-2.5 bg-red-600 text-white rounded-lg text-sm hover:bg-red-700 transition-colors">
                                    Resetar Sistema
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Instructions View - MANUAL COMPLETO -->
            <section id="view-instructions" class="view-section hide fade-in">
                <div class="max-w-6xl mx-auto pb-12">
                    <!-- Cabeçalho Hero -->
                    <div class="text-center mb-10 pt-4">
                        <div
                            class="inline-flex items-center justify-center p-4 bg-gradient-to-r from-plena-blue to-plena-dark rounded-2xl mb-4 shadow-lg">
                            <i data-lucide="wrench" class="w-12 h-12 text-white"></i>
                        </div>
                        <h1 class="text-3xl font-bold text-gray-800 mb-2">Manual Completo de Uso</h1>
                        <p class="text-gray-600 text-lg max-w-2xl mx-auto">Guia passo a passo para gestores de
                            assistência técnica</p>
                        <div class="mt-4 flex flex-wrap justify-center gap-2">
                            <span class="px-3 py-1 bg-green-100 text-green-700 rounded-full text-xs font-bold">✓ Para
                                Iniciantes</span>
                            <span class="px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-xs font-bold">📱 Mobile e
                                Desktop</span>
                            <span class="px-3 py-1 bg-purple-100 text-plena-blue rounded-full text-xs font-bold">⚡
                                Rápido e Prático</span>
                        </div>
                    </div>

                    <!-- Seção 1: Instalação -->
                    <div id="instalacao" class="bg-white border border-gray-200 rounded-2xl p-6 shadow-sm mb-8">
                        <div class="flex items-center justify-between mb-6">
                            <div class="flex items-center">
                                <div class="step-number bg-gradient-to-r from-plena-blue to-plena-dark text-white">1
                                </div>
                                <h3 class="text-xl font-bold text-gray-800">Instalação do Sistema</h3>
                            </div>
                        </div>

                        <div class="bg-gray-900 rounded-2xl p-6 text-white shadow-lg mb-6">
                            <h4 class="font-bold text-lg mb-4 flex items-center">
                                <i data-lucide="download" class="w-5 h-5 mr-2 text-green-400"></i>
                                Torne o App Disponível OFFLINE
                            </h4>
                            <p class="text-gray-300 mb-4">Instale no celular para usar sem internet, igual um app
                                normal:</p>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 text-sm">
                                <div class="bg-white/10 p-4 rounded-xl border border-white/10">
                                    <div class="font-bold text-white mb-3 flex items-center">
                                        <div
                                            class="w-8 h-8 rounded-full bg-blue-600 flex items-center justify-center mr-2">
                                            <i data-lucide="smartphone" class="w-4 h-4"></i>
                                        </div>
                                        Android (Chrome)
                                    </div>
                                    <ol class="list-decimal pl-5 space-y-3 text-gray-300">
                                        <li class="flex items-start">
                                            <span class="mr-2">1.</span>
                                            <div>
                                                <strong>Abra esta página no Chrome</strong>
                                                <p class="text-xs text-gray-400">Não use outros navegadores</p>
                                            </div>
                                        </li>
                                        <li class="flex items-start">
                                            <span class="mr-2">2.</span>
                                            <div>
                                                <strong>Toque nos 3 pontinhos ☰</strong>
                                                <p class="text-xs text-gray-400">Canto superior direito</p>
                                            </div>
                                        </li>
                                        <li class="flex items-start">
                                            <span class="mr-2">3.</span>
                                            <div>
                                                <strong>Toque em "Instalar app" ou "Adicionar à tela inicial"</strong>
                                            </div>
                                        </li>
                                        <li class="flex items-start">
                                            <span class="mr-2">4.</span>
                                            <div>
                                                <strong>Pronto! O ícone aparecerá na sua tela inicial</strong>
                                            </div>
                                        </li>
                                    </ol>
                                </div>
                                <div class="bg-white/10 p-4 rounded-xl border border-white/10">
                                    <div class="font-bold text-white mb-3 flex items-center">
                                        <div
                                            class="w-8 h-8 rounded-full bg-gray-800 flex items-center justify-center mr-2">
                                            <i data-lucide="apple" class="w-4 h-4"></i>
                                        </div>
                                        iPhone (Safari)
                                    </div>
                                    <ol class="list-decimal pl-5 space-y-3 text-gray-300">
                                        <li class="flex items-start">
                                            <span class="mr-2">1.</span>
                                            <div>
                                                <strong>Abra esta página no Safari</strong>
                                                <p class="text-xs text-gray-400">Não use Chrome no iPhone</p>
                                            </div>
                                        </li>
                                        <li class="flex items-start">
                                            <span class="mr-2">2.</span>
                                            <div>
                                                <strong>Toque no ícone de compartilhar</strong>
                                                <p class="text-xs text-gray-400">É o quadrado com seta para cima</p>
                                            </div>
                                        </li>
                                        <li class="flex items-start">
                                            <span class="mr-2">3.</span>
                                            <div>
                                                <strong>Role para baixo e toque em "Adicionar à Tela de Início"</strong>
                                            </div>
                                        </li>
                                        <li class="flex items-start">
                                            <span class="mr-2">4.</span>
                                            <div>
                                                <strong>Toque "Adicionar" no canto superior direito</strong>
                                            </div>
                                        </li>
                                    </ol>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Seção 2: Controle de Estoque -->
                    <div id="controle-estoque" class="bg-white border border-gray-200 rounded-2xl p-6 shadow-sm mb-8">
                        <div class="flex items-center justify-between mb-6">
                            <div class="flex items-center">
                                <div class="step-number bg-gradient-to-r from-plena-blue to-plena-dark text-white">2
                                </div>
                                <h3 class="text-xl font-bold text-gray-800">Controle de Estoque - Guia Completo</h3>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                            <div class="bg-blue-50 p-5 rounded-xl border border-blue-100">
                                <h4 class="font-bold text-blue-700 mb-3 flex items-center">
                                    <i data-lucide="package" class="w-5 h-5 mr-2"></i>
                                    PASSO 1: Cadastrar Produtos
                                </h4>
                                <ol class="space-y-3 text-sm">
                                    <li class="flex items-start">
                                        <div
                                            class="w-6 h-6 rounded-full bg-blue-100 text-blue-700 flex items-center justify-center mr-2 text-xs font-bold">
                                            A</div>
                                        <div>
                                            <strong>Clique em "Estoque" no menu</strong>
                                            <p class="text-gray-600 text-xs">Ícone de caixa</p>
                                        </div>
                                    </li>
                                    <li class="flex items-start">
                                        <div
                                            class="w-6 h-6 rounded-full bg-blue-100 text-blue-700 flex items-center justify-center mr-2 text-xs font-bold">
                                            B</div>
                                        <div>
                                            <strong>Clique em "Novo Produto"</strong>
                                            <p class="text-gray-600 text-xs">Botão verde</p>
                                        </div>
                                    </li>
                                    <li class="flex items-start">
                                        <div
                                            class="w-6 h-6 rounded-full bg-blue-100 text-blue-700 flex items-center justify-center mr-2 text-xs font-bold">
                                            C</div>
                                        <div>
                                            <strong>Preencha os dados:</strong>
                                            <div class="code-block mt-1 text-xs">
                                                Nome: "Tela iPhone 12"<br>
                                                Categoria: "Telas"<br>
                                                Estoque Mínimo: 3<br>
                                                Custo: R$ 150,00<br>
                                                Venda: R$ 300,00
                                            </div>
                                        </div>
                                    </li>
                                </ol>
                            </div>

                            <div class="bg-green-50 p-5 rounded-xl border border-green-100">
                                <h4 class="font-bold text-green-700 mb-3 flex items-center">
                                    <i data-lucide="move" class="w-5 h-5 mr-2"></i>
                                    PASSO 2: Movimentações
                                </h4>
                                <ol class="space-y-3 text-sm">
                                    <li class="flex items-start">
                                        <div
                                            class="w-6 h-6 rounded-full bg-green-100 text-green-700 flex items-center justify-center mr-2 text-xs font-bold">
                                            A</div>
                                        <div>
                                            <strong>Clique em "Movimentação"</strong>
                                            <p class="text-gray-600 text-xs">Botão azul no estoque</p>
                                        </div>
                                    </li>
                                    <li class="flex items-start">
                                        <div
                                            class="w-6 h-6 rounded-full bg-green-100 text-green-700 flex items-center justify-center mr-2 text-xs font-bold">
                                            B</div>
                                        <div>
                                            <strong>Selecione o tipo:</strong>
                                            <ul class="list-disc pl-5 mt-1 text-xs">
                                                <li>Entrada (compra)</li>
                                                <li>Saída (uso em O.S.)</li>
                                                <li>Ajuste (correção)</li>
                                            </ul>
                                        </div>
                                    </li>
                                    <li class="flex items-start">
                                        <div
                                            class="w-6 h-6 rounded-full bg-green-100 text-green-700 flex items-center justify-center mr-2 text-xs font-bold">
                                            C</div>
                                        <div>
                                            <strong>Registre o motivo:</strong>
                                            <p class="text-gray-600 text-xs">Ex: "Compra fornecedor X", "Uso O.S. #123"
                                            </p>
                                        </div>
                                    </li>
                                </ol>
                            </div>
                        </div>

                        <div class="bg-yellow-50 p-5 rounded-xl border border-yellow-100 mb-6">
                            <h4 class="font-bold text-yellow-700 mb-3 flex items-center">
                                <i data-lucide="alert-triangle" class="w-5 h-5 mr-2"></i>
                                DICAS IMPORTANTES DE ESTOQUE
                            </h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                                <div>
                                    <p class="font-bold text-gray-800 mb-1">📊 Estoque Mínimo</p>
                                    <p class="text-gray-600">Configure sempre um estoque mínimo para cada produto. O
                                        sistema alertará quando estiver baixo.</p>
                                </div>
                                <div>
                                    <p class="font-bold text-gray-800 mb-1">💰 Margem de Lucro</p>
                                    <p class="text-gray-600">Calcule preço de venda com base no custo + mão de obra +
                                        lucro desejado.</p>
                                </div>
                                <div>
                                    <p class="font-bold text-gray-800 mb-1">🔗 Integração com O.S.</p>
                                    <p class="text-gray-600">Ao criar uma O.S., você pode debitar peças automaticamente
                                        do estoque.</p>
                                </div>
                                <div>
                                    <p class="font-bold text-gray-800 mb-1">📈 Relatórios</p>
                                    <p class="text-gray-600">Acompanhe giro de estoque e produtos mais vendidos nos
                                        relatórios.</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Seção 3: Integração O.S. + Estoque -->
                    <div id="integracao-os-estoque"
                        class="bg-white border border-gray-200 rounded-2xl p-6 shadow-sm mb-8">
                        <div class="flex items-center justify-between mb-6">
                            <div class="flex items-center">
                                <div class="step-number bg-gradient-to-r from-plena-blue to-plena-dark text-white">3
                                </div>
                                <h3 class="text-xl font-bold text-gray-800">Integração O.S. + Estoque</h3>
                            </div>
                        </div>

                        <div
                            class="bg-gradient-to-r from-blue-50 to-purple-50 p-6 rounded-xl border border-blue-200 mb-6">
                            <h4 class="font-bold text-gray-800 mb-3 flex items-center">
                                <i data-lucide="link" class="w-5 h-5 mr-2 text-plena-blue"></i>
                                Fluxo Integrado de Trabalho
                            </h4>
                            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 text-sm">
                                <div class="bg-white p-4 rounded-lg text-center">
                                    <div
                                        class="w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center mx-auto mb-2">
                                        <span class="font-bold text-blue-700">1</span>
                                    </div>
                                    <p class="font-bold text-gray-800">Cadastro</p>
                                    <p class="text-gray-600">Produtos no estoque com preços</p>
                                </div>
                                <div class="bg-white p-4 rounded-lg text-center">
                                    <div
                                        class="w-10 h-10 rounded-full bg-green-100 flex items-center justify-center mx-auto mb-2">
                                        <span class="font-bold text-green-700">2</span>
                                    </div>
                                    <p class="font-bold text-gray-800">O.S.</p>
                                    <p class="text-gray-600">Seleciona peças usadas</p>
                                </div>
                                <div class="bg-white p-4 rounded-lg text-center">
                                    <div
                                        class="w-10 h-10 rounded-full bg-yellow-100 flex items-center justify-center mx-auto mb-2">
                                        <span class="font-bold text-yellow-700">3</span>
                                    </div>
                                    <p class="font-bold text-gray-800">Automático</p>
                                    <p class="text-gray-600">Estoque é debitado</p>
                                </div>
                                <div class="bg-white p-4 rounded-lg text-center">
                                    <div
                                        class="w-10 h-10 rounded-full bg-purple-100 flex items-center justify-center mx-auto mb-2">
                                        <span class="font-bold text-purple-700">4</span>
                                    </div>
                                    <p class="font-bold text-gray-800">Relatório</p>
                                    <p class="text-gray-600">Custo real calculado</p>
                                </div>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="bg-white p-4 rounded-xl border border-gray-200">
                                <h5 class="font-bold text-gray-800 mb-2">Como usar peças do estoque na O.S.</h5>
                                <ol class="list-decimal pl-5 space-y-2 text-sm text-gray-600">
                                    <li>Crie a Ordem de Serviço normalmente</li>
                                    <li>Na seção "Peças", clique em "Adicionar do Estoque"</li>
                                    <li>Selecione o produto e a quantidade</li>
                                    <li>O sistema calcula automaticamente o valor</li>
                                    <li>Ao salvar, o estoque é atualizado</li>
                                </ol>
                            </div>
                            <div class="bg-white p-4 rounded-xl border border-gray-200">
                                <h5 class="font-bold text-gray-800 mb-2">Benefícios da Integração</h5>
                                <ul class="list-disc pl-5 space-y-2 text-sm text-gray-600">
                                    <li>Controle preciso do estoque</li>
                                    <li>Cálculo automático de custos</li>
                                    <li>Alertas de reposição</li>
                                    <li>Histórico completo de movimentações</li>
                                    <li>Margem de lucro real</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- Seção 4: Backup e Segurança -->
                    <div id="backup" class="bg-white border border-gray-200 rounded-2xl p-6 shadow-sm mb-8">
                        <div class="flex items-center justify-between mb-6">
                            <div class="flex items-center">
                                <div class="step-number bg-gradient-to-r from-plena-blue to-plena-dark text-white">4
                                </div>
                                <h3 class="text-xl font-bold text-gray-800">Backup e Segurança dos Dados</h3>
                            </div>
                        </div>

                        <div class="bg-red-50 border-l-4 border-red-500 p-6 rounded-r-xl mb-6">
                            <h4 class="font-bold text-red-800 mb-3 flex items-center">
                                <i data-lucide="alert-octagon" class="w-5 h-5 mr-2"></i>
                                ATENÇÃO: Leia com Cuidado!
                            </h4>
                            <div class="text-sm text-red-800 space-y-2">
                                <p>📱 <strong>Seus dados ficam APENAS no seu celular/computador.</strong></p>
                                <p>🔄 <strong>Se você perder o aparelho ou limpar o navegador, perderá TODOS os
                                        dados.</strong></p>
                                <p>💾 <strong>O backup é SUA responsabilidade.</strong> Faça SEMPRE!</p>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <div class="bg-green-50 p-5 rounded-xl border border-green-200">
                                <h4 class="font-bold text-gray-800 mb-4 flex items-center">
                                    <i data-lucide="download" class="w-5 h-5 mr-2 text-green-600"></i>
                                    Como Fazer Backup
                                </h4>
                                <ol class="space-y-3 text-sm">
                                    <li class="flex items-start">
                                        <div
                                            class="w-6 h-6 rounded-full bg-green-100 text-green-700 flex items-center justify-center mr-2 text-xs font-bold mt-0.5">
                                            1</div>
                                        <div>
                                            <strong>Acesse Configurações</strong>
                                            <p class="text-gray-600 text-xs">Menu lateral → Engrenagem</p>
                                        </div>
                                    </li>
                                    <li class="flex items-start">
                                        <div
                                            class="w-6 h-6 rounded-full bg-green-100 text-green-700 flex items-center justify-center mr-2 text-xs font-bold mt-0.5">
                                            2</div>
                                        <div>
                                            <strong>Clique "Baixar Backup (.json)"</strong>
                                            <p class="text-gray-600 text-xs">Na seção "Segurança de Dados"</p>
                                        </div>
                                    </li>
                                    <li class="flex items-start">
                                        <div
                                            class="w-6 h-6 rounded-full bg-green-100 text-green-700 flex items-center justify-center mr-2 text-xs font-bold mt-0.5">
                                            3</div>
                                        <div>
                                            <strong>Salve em 2 Lugares</strong>
                                            <p class="text-gray-600 text-xs">Google Drive + WhatsApp (para você mesmo)
                                            </p>
                                        </div>
                                    </li>
                                </ol>
                            </div>

                            <div class="bg-blue-50 p-5 rounded-xl border border-blue-200">
                                <h4 class="font-bold text-gray-800 mb-4 flex items-center">
                                    <i data-lucide="refresh-cw" class="w-5 h-5 mr-2 text-blue-600"></i>
                                    Como Restaurar Backup
                                </h4>
                                <ol class="space-y-3 text-sm">
                                    <li class="flex items-start">
                                        <div
                                            class="w-6 h-6 rounded-full bg-blue-100 text-blue-700 flex items-center justify-center mr-2 text-xs font-bold mt-0.5">
                                            1</div>
                                        <div>
                                            <strong>Baixe o arquivo .json</strong>
                                            <p class="text-gray-600 text-xs">Do Drive ou WhatsApp</p>
                                        </div>
                                    </li>
                                    <li class="flex items-start">
                                        <div
                                            class="w-6 h-6 rounded-full bg-blue-100 text-blue-700 flex items-center justify-center mr-2 text-xs font-bold mt-0.5">
                                            2</div>
                                        <div>
                                            <strong>Vá em Configurações</strong>
                                        </div>
                                    </li>
                                    <li class="flex items-start">
                                        <div
                                            class="w-6 h-6 rounded-full bg-blue-100 text-blue-700 flex items-center justify-center mr-2 text-xs font-bold mt-0.5">
                                            3</div>
                                        <div>
                                            <strong>Clique "Restaurar Backup"</strong>
                                            <p class="text-gray-600 text-xs">Selecione o arquivo</p>
                                        </div>
                                    </li>
                                </ol>
                            </div>
                        </div>
                    </div>

                    <!-- Rodapé do Manual -->
                    <div class="mt-10 bg-white border border-gray-200 rounded-2xl p-8 text-center shadow-sm">
                        <h3 class="text-lg font-bold text-gray-800 mb-2">Dúvidas Técnicas?</h3>
                        <p class="text-gray-500 text-sm mb-6">
                            Nossa equipe de suporte responde em até 24h úteis.
                        </p>
                        <a href="mailto:tecnologia@plenaaplicativos.com.br"
                            class="inline-flex items-center text-plena-blue font-bold hover:underline">
                            <i data-lucide="mail" class="w-5 h-5 mr-2"></i>
                            tecnologia@plenaaplicativos.com.br
                        </a>
                    </div>
                </div>
            </section>

            <!-- About View -->
            <section id="view-about" class="view-section hide fade-in">
                <div class="max-w-4xl mx-auto pb-12">

                    <!-- Header Institucional -->
                    <div class="bg-white p-8 rounded-2xl shadow-sm border border-gray-100 mb-8 text-center">
                        <div
                            class="w-20 h-20 rounded-full bg-gradient-to-r from-plena-blue to-plena-dark flex items-center justify-center mx-auto mb-4 shadow-lg shadow-blue-200">
                            <i data-lucide="shield-check" class="w-10 h-10 text-white"></i>
                        </div>
                        <h2 class="text-3xl font-bold text-gray-800 mb-1">Central de Segurança e Legalidade</h2>
                        <p class="text-gray-500 font-medium">Plena Soluções Digitais • Transparência Total</p>
                    </div>

                    <!-- Grid de Políticas -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                        <!-- Termos de Uso -->
                        <div class="bg-white p-6 rounded-xl border border-gray-200 hover:shadow-md transition-shadow">
                            <h3 class="font-bold text-gray-800 mb-3 flex items-center text-lg">
                                <div class="p-2 bg-blue-50 rounded-lg mr-3">
                                    <i data-lucide="file-text" class="w-5 h-5 text-plena-blue"></i>
                                </div>
                                Termos de Uso
                            </h3>
                            <p class="text-sm text-gray-600 leading-relaxed text-justify">
                                A licença concedida é <strong>pessoal, intransferível e não exclusiva</strong>. O
                                software é
                                fornecido "no estado em que se encontra" (as-is). É estritamente proibida a revenda,
                                cópia,
                                distribuição não autorizada ou engenharia reversa do código-fonte, sob pena das sanções
                                previstas na Lei de Propriedade Intelectual (9.610/98).
                            </p>
                        </div>

                        <!-- Privacidade e LGPD -->
                        <div class="bg-white p-6 rounded-xl border border-gray-200 hover:shadow-md transition-shadow">
                            <h3 class="font-bold text-gray-800 mb-3 flex items-center text-lg">
                                <div class="p-2 bg-green-50 rounded-lg mr-3">
                                    <i data-lucide="lock" class="w-5 h-5 text-green-600"></i>
                                </div>
                                Privacidade (LGPD)
                            </h3>
                            <p class="text-sm text-gray-600 leading-relaxed text-justify">
                                Adotamos a arquitetura <strong>Privacy by Design (Local-First)</strong>. Seus dados
                                financeiros e de clientes ficam salvos <strong>exclusivamente no seu
                                    dispositivo</strong>.
                                A Plena não coleta, não armazena e não tem acesso a nenhuma informação inserida no
                                sistema.
                                Sua privacidade é absoluta.
                            </p>
                        </div>
                    </div>

                    <!-- Responsabilidade do Usuário -->
                    <div class="bg-red-50 border border-red-100 p-8 rounded-2xl mb-8 relative overflow-hidden">
                        <div class="absolute top-0 right-0 p-4 opacity-10">
                            <i data-lucide="alert-octagon" class="w-32 h-32 text-red-900"></i>
                        </div>
                        <div class="relative z-10">
                            <h3 class="font-bold text-red-800 mb-4 flex items-center text-lg">
                                <i data-lucide="alert-triangle" class="w-6 h-6 mr-3"></i>
                                IMPORTANTE: Sua Responsabilidade sobre os Dados
                            </h3>
                            <div class="space-y-4 text-sm text-red-900/80 text-justify font-medium">
                                <p>
                                    <strong>1. Backup é Obrigatório:</strong> Como não temos acesso aos seus dados,
                                    <strong>não podemos recuperá-los</strong> em caso de perda, roubo ou dano ao seu
                                    dispositivo. A realização de cópias de segurança (Backup) é de responsabilidade
                                    única e
                                    exclusiva do usuário.
                                </p>
                                <p>
                                    <strong>2. Isenção de Responsabilidade Técnica:</strong> A Plena exime-se de
                                    qualquer
                                    responsabilidade por prejuízos decorrentes de falhas de hardware, vírus no
                                    dispositivo
                                    do usuário, ou uso incorreto dos cálculos financeiros do sistema. Verifique sempre
                                    as
                                    taxas configuradas.
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- Suporte e SLA -->
                    <div
                        class="bg-gradient-to-br from-gray-900 to-plena-dark text-white p-8 rounded-2xl mb-12 shadow-xl">
                        <div class="flex flex-col md:flex-row items-center justify-between gap-8">
                            <div class="flex-1">
                                <h3 class="font-bold text-xl mb-2 flex items-center">
                                    <i data-lucide="life-buoy" class="w-6 h-6 mr-3 text-plena-blue"></i>
                                    Suporte Premium Especializado
                                </h3>
                                <p class="text-gray-300 text-sm mb-6 leading-relaxed">
                                    Precisa de ajuda ou encontrou alguma inconsistência? Nossa equipe técnica está
                                    pronta
                                    para atender você com prioridade. Garantimos a qualidade e a segurança da nossa
                                    marca.
                                </p>

                                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                    <div class="bg-white/10 p-3 rounded-lg backdrop-blur-sm">
                                        <p class="text-xs text-gray-400 uppercase font-bold">Canal Oficial</p>
                                        <p class="font-bold text-white">E-mail</p>
                                    </div>
                                    <div class="bg-white/10 p-3 rounded-lg backdrop-blur-sm">
                                        <p class="text-xs text-gray-400 uppercase font-bold">Tempo de Resposta (SLA)</p>
                                        <p class="font-bold text-plena-blue">Até 24h Úteis</p>
                                    </div>
                                </div>
                            </div>

                            <div>
                                <a href="mailto:tecnologia@plenaaplicativos.com.br"
                                    class="inline-flex items-center justify-center bg-white text-plena-dark px-8 py-4 rounded-xl font-bold hover:bg-gray-100 transition-transform transform hover:scale-105 shadow-lg">
                                    <i data-lucide="mail" class="w-5 h-5 mr-2"></i>
                                    Falar com Suporte
                                </a>
                                <p class="text-xs text-center text-gray-400 mt-3">tecnologia@plenaaplicativos.com.br</p>
                            </div>
                        </div>
                    </div>

                    <!-- Rodapé Legal -->
                    <div class="text-center border-t border-gray-200 pt-8">
                        <p class="text-sm font-bold text-gray-800">Plena Soluções Digitais LTDA</p>
                        <p class="text-xs text-gray-500 mt-1">CNPJ: 17.347.919/0001-59 • Todos os direitos reservados
                        </p>
                        <p class="text-[10px] text-gray-400 mt-4">
                            Versão 5.0 Pro • Build 2026.01.07 • Módulo Estoque
                        </p>
                    </div>

                </div>
            </section>

        </div>
    </main>

    <!-- Order Modal -->
    <div id="orderModal" class="fixed inset-0 modal-backdrop hidden z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center p-6 border-b sticky top-0 bg-white z-10">
                <h3 class="text-lg font-bold text-gray-800" id="order-modal-title">Nova Ordem de Serviço</h3>
                <button onclick="closeModal('orderModal')" class="text-gray-400 hover:text-gray-600">
                    <i data-lucide="x"></i>
                </button>
            </div>

            <form onsubmit="submitOrder(event)" class="p-6 space-y-6">
                <input type="hidden" id="order-id">

                <!-- Client Info -->
                <div class="bg-blue-50 p-4 rounded-xl border border-blue-100">
                    <h4 class="text-sm font-bold text-plena-blue mb-4 flex items-center">
                        <i data-lucide="user" class="w-4 h-4 mr-2"></i>
                        Dados do Cliente
                    </h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="text-xs font-bold text-gray-500 uppercase">Nome do Cliente *</label>
                            <input type="text" id="order-client" required
                                class="w-full border p-2 rounded-lg bg-white focus:border-plena-blue outline-none"
                                placeholder="Nome completo">
                        </div>
                        <div>
                            <label class="text-xs font-bold text-gray-500 uppercase">WhatsApp/Telefone</label>
                            <input type="text" id="order-phone"
                                class="w-full border p-2 rounded-lg bg-white focus:border-plena-blue outline-none"
                                placeholder="(00) 00000-0000">
                        </div>
                    </div>
                </div>

                <!-- Device Info -->
                <div class="bg-gray-50 p-4 rounded-xl border border-gray-100">
                    <h4 class="text-sm font-bold text-gray-800 mb-4 flex items-center">
                        <i data-lucide="smartphone" class="w-4 h-4 mr-2"></i>
                        Equipamento
                    </h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="text-xs font-bold text-gray-500 uppercase">Tipo de Equipamento *</label>
                            <input type="text" id="order-device" required
                                class="w-full border p-2 rounded-lg bg-white focus:border-plena-blue outline-none"
                                placeholder="Ex: iPhone 11, Notebook Dell, etc.">
                        </div>
                        <div>
                            <label class="text-xs font-bold text-gray-500 uppercase">Marca</label>
                            <input type="text" id="order-brand"
                                class="w-full border p-2 rounded-lg bg-white focus:border-plena-blue outline-none"
                                placeholder="Ex: Apple, Samsung, etc.">
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="text-xs font-bold text-gray-500 uppercase">Número de Série/IMEI</label>
                            <input type="text" id="order-serial"
                                class="w-full border p-2 rounded-lg bg-white font-mono focus:border-plena-blue outline-none"
                                placeholder="Opcional">
                        </div>
                        <div>
                            <label class="text-xs font-bold text-gray-500 uppercase">Senha/Acesso</label>
                            <input type="text" id="order-password"
                                class="w-full border p-2 rounded-lg bg-yellow-50 focus:border-plena-blue outline-none"
                                placeholder="Senha do dispositivo">
                        </div>
                    </div>
                </div>

                <!-- Problem & Diagnosis -->
                <div class="space-y-4">
                    <div>
                        <label class="text-xs font-bold text-gray-500 uppercase">Defeito Relatado *</label>
                        <textarea id="order-problem" required rows="3"
                            class="w-full border p-2 rounded-lg bg-white focus:border-plena-blue outline-none"
                            placeholder="Descreva o problema conforme relatado pelo cliente..."></textarea>
                    </div>
                    <div>
                        <label class="text-xs font-bold text-gray-500 uppercase">Diagnóstico/Serviço</label>
                        <textarea id="order-diagnosis" rows="3"
                            class="w-full border p-2 rounded-lg bg-white focus:border-plena-blue outline-none"
                            placeholder="Laudo técnico e serviço a ser realizado..."></textarea>
                    </div>
                </div>

                <!-- Parts from Inventory -->
                <div class="bg-green-50 p-4 rounded-xl border border-green-100">
                    <h4 class="text-sm font-bold text-green-700 mb-4 flex items-center justify-between">
                        <span><i data-lucide="package" class="w-4 h-4 mr-2"></i> Peças do Estoque</span>
                        <button type="button" onclick="addPartFromInventory()"
                            class="text-xs bg-green-600 text-white px-3 py-1 rounded-lg hover:bg-green-700">
                            <i data-lucide="plus" class="w-3 h-3 inline mr-1"></i> Adicionar
                        </button>
                    </h4>
                    <div id="order-parts-list" class="space-y-2">
                        <!-- Parts will be added here dynamically -->
                    </div>
                    <div class="mt-4 flex justify-between items-center">
                        <span class="text-sm font-medium">Total Peças:</span>
                        <span id="order-parts-total" class="font-bold text-green-700">R$ 0,00</span>
                    </div>
                </div>

                <!-- Labor & Discount -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="text-xs font-bold text-gray-500 uppercase">Mão de Obra (R$)</label>
                        <input type="number" step="0.01" id="order-labor"
                            class="w-full border p-2 rounded-lg bg-white focus:border-plena-blue outline-none"
                            placeholder="0.00" value="0">
                    </div>
                    <div>
                        <label class="text-xs font-bold text-gray-500 uppercase">Desconto (R$)</label>
                        <input type="number" step="0.01" id="order-discount"
                            class="w-full border p-2 rounded-lg bg-white focus:border-plena-blue outline-none text-red-500"
                            placeholder="0.00" value="0">
                    </div>
                </div>

                <!-- Values Summary -->
                <div class="bg-gray-50 p-4 rounded-xl border border-gray-100">
                    <h4 class="text-sm font-bold text-gray-800 mb-4 flex items-center">
                        <i data-lucide="dollar-sign" class="w-4 h-4 mr-2"></i>
                        Resumo Financeiro
                    </h4>
                    <div class="space-y-2">
                        <div class="flex justify-between text-sm">
                            <span>Peças:</span>
                            <span id="summary-parts">R$ 0,00</span>
                        </div>
                        <div class="flex justify-between text-sm">
                            <span>Mão de Obra:</span>
                            <span id="summary-labor">R$ 0,00</span>
                        </div>
                        <div class="flex justify-between text-sm text-red-500">
                            <span>Desconto:</span>
                            <span id="summary-discount">-R$ 0,00</span>
                        </div>
                        <div class="flex justify-between border-t pt-2 mt-2">
                            <span class="font-bold text-gray-900 text-lg">TOTAL</span>
                            <span id="order-total" class="text-2xl font-bold text-plena-blue">R$ 0,00</span>
                        </div>
                    </div>
                </div>

                <div class="sticky bottom-0 bg-white pt-4 border-t">
                    <button type="submit"
                        class="w-full bg-plena-blue text-white py-4 rounded-xl font-bold hover:bg-plena-dark transition-all text-lg shadow-lg">
                        Salvar Ordem de Serviço
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Product Modal -->
    <div id="productModal" class="fixed inset-0 modal-backdrop hidden z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center p-6 border-b sticky top-0 bg-white z-10">
                <h3 class="text-lg font-bold text-gray-800" id="product-modal-title">Novo Produto</h3>
                <button onclick="closeModal('productModal')" class="text-gray-400 hover:text-gray-600">
                    <i data-lucide="x"></i>
                </button>
            </div>

            <form onsubmit="submitProduct(event)" class="p-6 space-y-4">
                <input type="hidden" id="product-id">

                <div>
                    <label class="text-xs font-bold text-gray-500 uppercase">Nome do Produto *</label>
                    <input type="text" id="product-name" required
                        class="w-full border p-2 rounded-lg bg-white focus:border-plena-blue outline-none"
                        placeholder="Ex: Tela iPhone 12, Bateria Samsung, etc.">
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="text-xs font-bold text-gray-500 uppercase">Código</label>
                        <input type="text" id="product-code"
                            class="w-full border p-2 rounded-lg bg-white font-mono focus:border-plena-blue outline-none"
                            placeholder="Auto ou manual">
                    </div>
                    <div>
                        <label class="text-xs font-bold text-gray-500 uppercase">Categoria *</label>
                        <input type="text" id="product-category" required list="categories"
                            class="w-full border p-2 rounded-lg bg-white focus:border-plena-blue outline-none"
                            placeholder="Ex: Telas, Baterias, Peças">
                        <datalist id="categories">
                            <option value="Telas">
                            <option value="Baterias">
                            <option value="Conectores">
                            <option value="Módulos">
                            <option value="Peças">
                            <option value="Ferramentas">
                            <option value="Materiais">
                        </datalist>
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="text-xs font-bold text-gray-500 uppercase">Estoque Atual</label>
                        <input type="number" id="product-stock" min="0" step="1" required
                            class="w-full border p-2 rounded-lg bg-white focus:border-plena-blue outline-none"
                            value="0">
                    </div>
                    <div>
                        <label class="text-xs font-bold text-gray-500 uppercase">Estoque Mínimo</label>
                        <input type="number" id="product-min-stock" min="0" step="1" required
                            class="w-full border p-2 rounded-lg bg-white focus:border-plena-blue outline-none"
                            value="3">
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="text-xs font-bold text-gray-500 uppercase">Preço de Custo (R$)</label>
                        <input type="number" step="0.01" id="product-cost" required
                            class="w-full border p-2 rounded-lg bg-white focus:border-plena-blue outline-none"
                            placeholder="0.00" value="0">
                    </div>
                    <div>
                        <label class="text-xs font-bold text-gray-500 uppercase">Preço de Venda (R$)</label>
                        <input type="number" step="0.01" id="product-price" required
                            class="w-full border p-2 rounded-lg bg-white focus:border-plena-blue outline-none"
                            placeholder="0.00" value="0">
                    </div>
                </div>

                <div>
                    <label class="text-xs font-bold text-gray-500 uppercase">Fornecedor</label>
                    <input type="text" id="product-supplier"
                        class="w-full border p-2 rounded-lg bg-white focus:border-plena-blue outline-none"
                        placeholder="Nome do fornecedor">
                </div>

                <div>
                    <label class="text-xs font-bold text-gray-500 uppercase">Observações</label>
                    <textarea id="product-notes" rows="2"
                        class="w-full border p-2 rounded-lg bg-white focus:border-plena-blue outline-none"
                        placeholder="Detalhes adicionais..."></textarea>
                </div>

                <button type="submit"
                    class="w-full bg-green-600 text-white py-3 rounded-xl font-bold shadow-lg shadow-green-200 hover:bg-green-700 transition-all mt-2">
                    Salvar Produto
                </button>
            </form>
        </div>
    </div>

    <!-- Movement Modal -->
    <div id="movementModal" class="fixed inset-0 modal-backdrop hidden z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center p-6 border-b sticky top-0 bg-white z-10">
                <h3 class="text-lg font-bold text-gray-800">Movimentação de Estoque</h3>
                <button onclick="closeModal('movementModal')" class="text-gray-400 hover:text-gray-600">
                    <i data-lucide="x"></i>
                </button>
            </div>

            <form onsubmit="submitMovement(event)" class="p-6 space-y-4">
                <div class="grid grid-cols-3 gap-3 p-1 bg-gray-100 rounded-lg">
                    <label class="cursor-pointer text-center">
                        <input type="radio" name="movement-type" value="in" class="peer hidden" checked>
                        <div
                            class="py-2 text-sm font-bold text-gray-500 rounded-md peer-checked:bg-green-100 peer-checked:text-green-600 shadow-sm transition-all">
                            Entrada
                        </div>
                    </label>
                    <label class="cursor-pointer text-center">
                        <input type="radio" name="movement-type" value="out" class="peer hidden">
                        <div
                            class="py-2 text-sm font-bold text-gray-500 rounded-md peer-checked:bg-red-100 peer-checked:text-red-600 shadow-sm transition-all">
                            Saída
                        </div>
                    </label>
                    <label class="cursor-pointer text-center">
                        <input type="radio" name="movement-type" value="adjust" class="peer hidden">
                        <div
                            class="py-2 text-sm font-bold text-gray-500 rounded-md peer-checked:bg-yellow-100 peer-checked:text-yellow-600 shadow-sm transition-all">
                            Ajuste
                        </div>
                    </label>
                </div>

                <div>
                    <label class="text-xs font-bold text-gray-500 uppercase">Produto *</label>
                    <select id="movement-product" required
                        class="w-full border p-2 rounded-lg text-sm bg-white outline-none">
                        <option value="">Selecione um produto</option>
                        <!-- Products will be populated dynamically -->
                    </select>
                </div>

                <div id="current-stock-info" class="bg-blue-50 p-3 rounded-lg hidden">
                    <p class="text-sm text-blue-700">
                        Estoque atual: <span id="current-stock">0</span> unidades
                    </p>
                </div>

                <div>
                    <label class="text-xs font-bold text-gray-500 uppercase">Quantidade *</label>
                    <input type="number" id="movement-quantity" min="1" step="1" required
                        class="w-full border p-2 rounded-lg bg-white focus:border-plena-blue outline-none"
                        placeholder="0">
                </div>

                <div>
                    <label class="text-xs font-bold text-gray-500 uppercase">Valor Unitário (R$)</label>
                    <input type="number" step="0.01" id="movement-unit-value"
                        class="w-full border p-2 rounded-lg bg-white focus:border-plena-blue outline-none"
                        placeholder="0.00">
                </div>

                <div>
                    <label class="text-xs font-bold text-gray-500 uppercase">Motivo *</label>
                    <select id="movement-reason" required
                        class="w-full border p-2 rounded-lg text-sm bg-white outline-none">
                        <option value="purchase">Compra/Reposição</option>
                        <option value="sale">Venda</option>
                        <option value="os_use">Uso em O.S.</option>
                        <option value="loss">Perda/Avaria</option>
                        <option value="adjustment">Ajuste de Inventário</option>
                        <option value="other">Outro</option>
                    </select>
                </div>

                <div>
                    <label class="text-xs font-bold text-gray-500 uppercase">Observações</label>
                    <textarea id="movement-notes" rows="2"
                        class="w-full border p-2 rounded-lg bg-white focus:border-plena-blue outline-none"
                        placeholder="Detalhes da movimentação..."></textarea>
                </div>

                <div id="movement-total" class="bg-gray-50 p-3 rounded-lg hidden">
                    <div class="flex justify-between">
                        <span class="font-medium">Valor Total:</span>
                        <span id="movement-total-value" class="font-bold text-lg text-green-600">R$ 0,00</span>
                    </div>
                </div>

                <button type="submit"
                    class="w-full bg-plena-blue text-white py-3 rounded-xl font-bold shadow-lg shadow-blue-200 hover:bg-plena-dark transition-all mt-2">
                    Registrar Movimentação
                </button>
            </form>
        </div>
    </div>

    <!-- Order View Modal -->
    <div id="orderViewModal" class="fixed inset-0 modal-backdrop hidden z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center p-6 border-b sticky top-0 bg-white z-10">
                <div>
                    <h3 class="text-lg font-bold text-gray-800">Ordem de Serviço</h3>
                    <p id="view-os-number" class="text-sm text-gray-500">#0000</p>
                </div>
                <button onclick="closeModal('orderViewModal')" class="text-gray-400 hover:text-gray-600">
                    <i data-lucide="x"></i>
                </button>
            </div>

            <div id="invoice-print" class="p-8 space-y-6 bg-white">
                <!-- Data injected via updatePrintHeaders() -->
                <div class="print-header"></div>

                <!-- OS Info Row -->
                <div class="flex justify-between items-center bg-gray-50 p-4 border rounded-lg mb-6">
                    <div>
                        <p class="text-xs text-gray-500 uppercase font-bold">Ordem de Serviço</p>
                        <p id="view-os-id" class="text-2xl font-mono font-bold text-gray-800">#0000</p>
                    </div>
                    <div class="text-right">
                        <p id="view-os-status" class="text-sm font-bold bg-white px-3 py-1 rounded border">Status: --
                        </p>
                        <p id="view-os-date" class="text-xs text-gray-500 mt-1">Data: --/--/----</p>
                    </div>
                </div>

                <!-- Main Content Grid -->
                <div class="grid grid-cols-2 gap-8 mb-6">
                    <!-- Client -->
                    <div class="border border-gray-200 rounded-lg p-4">
                        <h4 class="text-xs font-bold text-gray-400 uppercase border-b pb-2 mb-3">Dados do Cliente</h4>
                        <div class="space-y-1">
                            <p id="view-client" class="font-bold text-gray-800 text-lg">--</p>
                            <p id="view-phone" class="text-sm text-gray-600">--</p>
                        </div>
                    </div>

                    <!-- Device -->
                    <div class="border border-gray-200 rounded-lg p-4">
                        <h4 class="text-xs font-bold text-gray-400 uppercase border-b pb-2 mb-3">Equipamento</h4>
                        <div class="space-y-1">
                            <p id="view-device" class="font-bold text-gray-800">--</p>
                            <p id="view-serial" class="text-xs text-gray-500">S/N: --</p>
                            <p id="view-accessories" class="text-xs text-gray-500 italic">Acessórios: --</p>
                        </div>
                    </div>
                </div>

                <!-- Technical Details -->
                <div class="border border-gray-200 rounded-lg overflow-hidden mb-6">
                    <div class="grid grid-cols-1 border-b border-gray-200 p-4 bg-gray-50">
                        <h4 class="text-xs font-bold text-gray-400 uppercase">Defeito Relatado</h4>
                        <p id="view-problem" class="text-gray-800 text-sm mt-1">--</p>
                    </div>
                    <div class="p-4 bg-white">
                        <h4 class="text-xs font-bold text-gray-400 uppercase">Laudo Técnico / Serviço</h4>
                        <p id="view-diagnosis" class="text-gray-800 text-sm mt-1">--</p>
                    </div>
                </div>

                <!-- Parts Used -->
                <div id="view-parts-container" class="mb-6 hidden">
                    <h4 class="text-xs font-bold text-gray-400 uppercase mb-3">Peças Utilizadas</h4>
                    <div class="bg-gray-50 p-4 rounded-lg border border-gray-200">
                        <table class="w-full text-sm">
                            <thead>
                                <tr class="text-gray-500 border-b">
                                    <th class="pb-2 text-left">Produto</th>
                                    <th class="pb-2 text-center">Qtd</th>
                                    <th class="pb-2 text-right">Valor</th>
                                </tr>
                            </thead>
                            <tbody id="view-parts-list">
                                <!-- Parts will be injected here -->
                            </tbody>
                            <tfoot>
                                <tr class="border-t">
                                    <td colspan="2" class="pt-2 font-bold">Total Peças:</td>
                                    <td id="view-parts-total" class="pt-2 text-right font-bold text-green-600">R$ 0,00
                                    </td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                </div>

                <!-- Financial Summary -->
                <div class="flex justify-end">
                    <div class="w-1/2 border border-gray-200 rounded-lg p-4 bg-gray-50">
                        <h4 class="text-xs font-bold text-gray-400 uppercase border-b pb-2 mb-3">Resumo Financeiro</h4>
                        <div class="space-y-2 text-sm">
                            <div class="flex justify-between text-gray-600">
                                <span>Peças</span>
                                <span id="view-parts-summary">R$ 0,00</span>
                            </div>
                            <div class="flex justify-between text-gray-600">
                                <span>Mão de Obra</span>
                                <span id="view-labor">R$ 0,00</span>
                            </div>
                            <div class="flex justify-between text-red-500">
                                <span>Descontos</span>
                                <span id="view-discount">-R$ 0,00</span>
                            </div>
                            <div class="flex justify-between border-t border-gray-300 pt-2 mt-2">
                                <span class="font-bold text-gray-900 text-lg">TOTAL</span>
                                <span id="view-total" class="font-bold text-xl text-gray-900">R$ 0,00</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Legal Terms & Signatures -->
                <div class="mt-8 border-t-2 border-dashed border-gray-200 pt-6">
                    <div class="text-[10px] text-gray-500 text-justify leading-relaxed mb-12">
                        <p class="mb-2"><strong>TERMOS DE GARANTIA:</strong> A garantia cobre apenas defeitos de
                            fabricação das peças substituídas e falhas na mão de obra executada, pelo prazo legal de 90
                            dias (Art. 26, II do CDC). A garantia é anulada automaticamente em caso de: mau uso, quedas,
                            contato com líquidos, oxidação, descarga elétrica ou violação do selo de garantia.</p>
                        <p><strong>ABANDONO:</strong> Conforme Art. 1.275 do Código Civil, aparelhos não retirados no
                            prazo de 90 dias após notificação de conclusão serão considerados abandonados, podendo ser
                            descartados ou vendidos para custear despesas de armazenamento e reparo.</p>
                    </div>

                    <div class="flex justify-between gap-8">
                        <div class="flex-1 border-t border-gray-400 pt-2 text-center">
                            <p class="text-xs font-bold text-gray-600">Assinatura do Técnico</p>
                        </div>
                        <div class="flex-1 border-t border-gray-400 pt-2 text-center">
                            <p class="text-xs font-bold text-gray-600">Assinatura do Cliente</p>
                            <p class="text-[10px] text-gray-400">Declaro estar ciente e de acordo com os serviços.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="bg-gray-50 p-6 border-t space-y-4 print:hidden">
                <div class="flex items-center gap-3 bg-white p-3 rounded-lg border">
                    <span class="text-sm font-bold text-gray-500">Status:</span>
                    <select id="view-status-select" onchange="updateOrderStatus(this.value)"
                        class="flex-1 border-none bg-transparent font-bold text-gray-800 outline-none cursor-pointer">
                        <option value="received">📥 Recebido</option>
                        <option value="analyzing">🔍 Em Análise</option>
                        <option value="waiting_parts">⚙️ Aguardando Peça</option>
                        <option value="ready">✅ Pronto</option>
                        <option value="delivered">🚀 Entregue</option>
                    </select>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-4 gap-3">
                    <button onclick="editCurrentOrder()"
                        class="bg-white border border-gray-300 py-3 rounded-lg font-bold hover:bg-gray-50 flex justify-center items-center gap-2">
                        <i data-lucide="edit" class="w-4 h-4"></i> Editar
                    </button>
                    <button onclick="shareOrderWhatsApp()"
                        class="bg-[#25D366] text-white py-3 rounded-lg font-bold hover:bg-[#128C7E] flex justify-center items-center gap-2">
                        <i data-lucide="message-circle" class="w-4 h-4"></i> WhatsApp
                    </button>
                    <button onclick="window.print()"
                        class="bg-plena-blue text-white py-3 rounded-lg font-bold hover:bg-plena-dark flex justify-center items-center gap-2">
                        <i data-lucide="printer" class="w-4 h-4"></i> Imprimir
                    </button>
                    <button onclick="usePartsFromOrder()" id="btn-use-parts"
                        class="bg-green-600 text-white py-3 rounded-lg font-bold hover:bg-green-700 flex justify-center items-center gap-2">
                        <i data-lucide="package" class="w-4 h-4"></i> Usar Peças
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Transaction Modal -->
    <div id="transactionModal" class="fixed inset-0 modal-backdrop hidden z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md transform transition-all p-6">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-lg font-bold text-gray-800">Novo Lançamento</h3>
                <button onclick="closeModal('transactionModal')" class="text-gray-400 hover:text-gray-600">
                    <i data-lucide="x"></i>
                </button>
            </div>

            <form onsubmit="submitTransaction(event)" class="space-y-4">
                <input type="hidden" id="trans-id">

                <div class="grid grid-cols-2 gap-3 p-1 bg-gray-100 rounded-lg">
                    <label class="cursor-pointer text-center">
                        <input type="radio" name="trans-type" value="income" class="peer hidden" checked>
                        <div
                            class="py-2 text-sm font-bold text-gray-500 rounded-md peer-checked:bg-white peer-checked:text-green-600 shadow-sm transition-all">
                            Entrada
                        </div>
                    </label>
                    <label class="cursor-pointer text-center">
                        <input type="radio" name="trans-type" value="expense" class="peer hidden">
                        <div
                            class="py-2 text-sm font-bold text-gray-500 rounded-md peer-checked:bg-white peer-checked:text-red-600 shadow-sm transition-all">
                            Saída
                        </div>
                    </label>
                </div>

                <div>
                    <label class="text-xs font-bold text-gray-500 uppercase">Valor (R$)</label>
                    <input type="number" id="trans-amount" step="0.01" min="0.01" required
                        class="w-full border-2 border-gray-200 p-3 rounded-xl text-lg font-bold focus:border-plena-blue outline-none"
                        placeholder="0,00">
                </div>

                <div>
                    <label class="text-xs font-bold text-gray-500 uppercase">Descrição</label>
                    <input type="text" id="trans-desc" required
                        class="w-full border p-2 rounded-lg text-sm focus:border-plena-blue outline-none"
                        placeholder="Ex: Pagamento de OS #001, Compra de peças, etc.">
                </div>

                <div>
                    <label class="text-xs font-bold text-gray-500 uppercase">Categoria</label>
                    <select id="trans-category" class="w-full border p-2 rounded-lg text-sm bg-white outline-none">
                        <option value="service">Serviço Prestado</option>
                        <option value="parts">Peças</option>
                        <option value="supplies">Materiais</option>
                        <option value="rent">Aluguel</option>
                        <option value="utilities">Contas</option>
                        <option value="other">Outros</option>
                    </select>
                </div>

                <div>
                    <label class="text-xs font-bold text-gray-500 uppercase">Data</label>
                    <input type="date" id="trans-date" required
                        class="w-full border p-2 rounded-lg text-sm bg-white outline-none">
                </div>

                <button type="submit"
                    class="w-full bg-plena-blue text-white py-3 rounded-xl font-bold shadow-lg shadow-blue-200 hover:bg-plena-dark transition-all mt-2">
                    Salvar Lançamento
                </button>
            </form>
        </div>
    </div>

    <!-- Client Modal -->
    <div id="clientModal" class="fixed inset-0 modal-backdrop hidden z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md transform transition-all p-6">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-lg font-bold text-gray-800">Novo Cliente</h3>
                <button onclick="closeModal('clientModal')" class="text-gray-400 hover:text-gray-600">
                    <i data-lucide="x"></i>
                </button>
            </div>

            <form onsubmit="submitClient(event)" class="space-y-4">
                <input type="hidden" id="client-id">

                <div>
                    <label class="text-xs font-bold text-gray-500 uppercase">Nome Completo *</label>
                    <input type="text" id="client-name" required
                        class="w-full border p-2 rounded-lg text-sm focus:border-plena-blue outline-none"
                        placeholder="Nome do cliente">
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="text-xs font-bold text-gray-500 uppercase">Telefone</label>
                        <input type="text" id="client-phone"
                            class="w-full border p-2 rounded-lg text-sm focus:border-plena-blue outline-none"
                            placeholder="(00) 00000-0000">
                    </div>
                    <div>
                        <label class="text-xs font-bold text-gray-500 uppercase">E-mail</label>
                        <input type="email" id="client-email"
                            class="w-full border p-2 rounded-lg text-sm focus:border-plena-blue outline-none"
                            placeholder="cliente@email.com">
                    </div>
                </div>

                <div>
                    <label class="text-xs font-bold text-gray-500 uppercase">Endereço</label>
                    <input type="text" id="client-address"
                        class="w-full border p-2 rounded-lg text-sm focus:border-plena-blue outline-none"
                        placeholder="Endereço completo">
                </div>

                <div>
                    <label class="text-xs font-bold text-gray-500 uppercase">Observações</label>
                    <textarea id="client-notes" rows="2"
                        class="w-full border p-2 rounded-lg text-sm focus:border-plena-blue outline-none"
                        placeholder="Informações adicionais..."></textarea>
                </div>

                <button type="submit"
                    class="w-full bg-plena-blue text-white py-3 rounded-xl font-bold shadow-lg shadow-blue-200 hover:bg-plena-dark transition-all mt-2">
                    Salvar Cliente
                </button>
            </form>
        </div>
    </div>

    <!-- Closing Modal -->
    <div id="closingModal" class="fixed inset-0 modal-backdrop hidden z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-sm overflow-hidden">
            <div class="bg-gradient-to-r from-gray-900 to-black p-6 text-center text-white">
                <h3 class="font-bold text-lg">Fechamento de Caixa</h3>
                <p id="closing-date" class="text-sm text-gray-300 mt-1">Hoje</p>
                <p id="closing-time" class="text-xs text-gray-500 mt-0">--:--</p>
            </div>
            <div class="p-6">
                <div class="space-y-4 mb-6">
                    <div class="flex justify-between items-center p-3 bg-green-50 rounded-lg border border-green-100">
                        <div class="flex items-center">
                            <i data-lucide="trending-up" class="w-4 h-4 text-green-600 mr-2"></i>
                            <span class="text-sm">Entradas</span>
                        </div>
                        <span id="closing-inc" class="font-bold text-green-700">R$ 0,00</span>
                    </div>
                    <div class="flex justify-between items-center p-3 bg-red-50 rounded-lg border border-red-100">
                        <div class="flex items-center">
                            <i data-lucide="trending-down" class="w-4 h-4 text-red-600 mr-2"></i>
                            <span class="text-sm">Saídas</span>
                        </div>
                        <span id="closing-exp" class="font-bold text-red-700">R$ 0,00</span>
                    </div>
                    <div class="flex justify-between items-center pt-4 border-t">
                        <span class="font-bold text-gray-800">Saldo Final</span>
                        <span id="closing-bal" class="font-bold text-2xl text-gray-900">R$ 0,00</span>
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-3 mb-3">
                    <button onclick="shareClosingWhatsApp()"
                        class="bg-[#25D366] text-white py-2.5 rounded-lg font-bold text-sm hover:bg-[#128C7E] flex justify-center items-center gap-2">
                        <i data-lucide="message-circle" class="w-4 h-4"></i> WhatsApp
                    </button>
                    <button onclick="printClosing()"
                        class="bg-blue-600 text-white py-2.5 rounded-lg font-bold text-sm hover:bg-blue-700 flex justify-center items-center gap-2">
                        <i data-lucide="printer" class="w-4 h-4"></i> Imprimir
                    </button>
                </div>

                <button onclick="closeModal('closingModal')"
                    class="w-full bg-gray-100 text-gray-700 py-3 rounded-lg font-bold text-sm hover:bg-gray-200 transition-colors flex justify-center items-center gap-2">
                    Concluir
                </button>

                <div class="mt-4 pt-4 border-t border-gray-100 text-center">
                    <a href="https://www.plenaaplicativos.com.br" target="_blank"
                        class="text-[10px] text-gray-400 hover:text-plena-blue no-underline">
                        Plena Soluções Digitais &copy; 2026
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Part from Inventory Modal -->
    <div id="addPartModal" class="fixed inset-0 modal-backdrop hidden z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center p-6 border-b sticky top-0 bg-white z-10">
                <h3 class="text-lg font-bold text-gray-800">Adicionar Peça do Estoque</h3>
                <button onclick="closeModal('addPartModal')" class="text-gray-400 hover:text-gray-600">
                    <i data-lucide="x"></i>
                </button>
            </div>

            <div class="p-6 space-y-4">
                <div>
                    <label class="text-xs font-bold text-gray-500 uppercase">Selecione o Produto</label>
                    <select id="select-product" class="w-full border p-2 rounded-lg text-sm bg-white outline-none">
                        <option value="">Selecione um produto</option>
                        <!-- Products will be populated dynamically -->
                    </select>
                </div>

                <div id="product-info" class="bg-gray-50 p-4 rounded-lg hidden">
                    <div class="grid grid-cols-2 gap-4 text-sm">
                        <div>
                            <p class="text-gray-500">Estoque Disponível:</p>
                            <p id="available-stock" class="font-bold">0</p>
                        </div>
                        <div>
                            <p class="text-gray-500">Preço de Venda:</p>
                            <p id="product-price-display" class="font-bold text-green-600">R$ 0,00</p>
                        </div>
                    </div>
                </div>

                <div>
                    <label class="text-xs font-bold text-gray-500 uppercase">Quantidade</label>
                    <input type="number" id="part-quantity" min="1" step="1" value="1"
                        class="w-full border p-2 rounded-lg bg-white focus:border-plena-blue outline-none">
                </div>

                <div>
                    <label class="text-xs font-bold text-gray-500 uppercase">Observações (opcional)</label>
                    <input type="text" id="part-notes"
                        class="w-full border p-2 rounded-lg bg-white focus:border-plena-blue outline-none"
                        placeholder="Ex: Cor preta, versão Pro, etc.">
                </div>

                <div id="part-total" class="bg-green-50 p-4 rounded-lg hidden">
                    <div class="flex justify-between items-center">
                        <span class="font-medium">Total:</span>
                        <span id="part-total-value" class="font-bold text-lg text-green-600">R$ 0,00</span>
                    </div>
                </div>

                <button onclick="addSelectedPart()"
                    class="w-full bg-green-600 text-white py-3 rounded-xl font-bold shadow-lg shadow-green-200 hover:bg-green-700 transition-all">
                    Adicionar à O.S.
                </button>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script>
        // 🔒 DADOS DA LICENÇA
        const LICENSE_DATA = {
            active: false,
            ownerName: "",
            ownerDoc: ""
        };

        // ESTADO GLOBAL
        const DB_KEY = 'plena_assistencia_com_estoque_v1';
        const defaultDB = {
            orders: [],
            clients: [],
            products: [],
            movements: [],
            transactions: [],
            settings: {
                companyName: 'Minha Assistência Técnica',
                companyDoc: '',
                companyPhone: '',
                companyAddress: '',
                currency: 'R$',
                theme: 'light',
                autoBackup: true,
                termsAccepted: false,
                termsAcceptedAt: null
            }
        };

        let db = JSON.parse(localStorage.getItem(DB_KEY)) || defaultDB;

        // UTILITÁRIOS
        const sanitizeHTML = (str) => {
            if (!str) return '';
            return String(str)
                .replace(/&/g, '&amp;')
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;')
                .replace(/"/g, '&quot;')
                .replace(/'/g, '&#039;');
        };

        const save = () => {
            localStorage.setItem(DB_KEY, JSON.stringify(db));
            updateDataStatus();
        };

        const fmtMoney = (v) => {
            return v.toLocaleString('pt-BR', {
                style: 'currency',
                currency: 'BRL',
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            });
        };

        const fmtDate = (d) => {
            const date = new Date(d);
            return date.toLocaleDateString('pt-BR');
        };

        const fmtDateInput = (d) => {
            return new Date(d).toISOString().split('T')[0];
        };

        const getID = () => {
            return 'OS' + Date.now().toString(36).toUpperCase().substr(-6);
        };

        const getClientID = () => {
            return 'CL' + Date.now().toString(36).toUpperCase().substr(-6);
        };

        const getProductID = () => {
            return 'PR' + Date.now().toString(36).toUpperCase().substr(-6);
        };

        const getMovementID = () => {
            return 'MV' + Date.now().toString(36).toUpperCase().substr(-6);
        };

        const statusColors = {
            received: { bg: 'bg-gray-100', text: 'text-gray-600', label: 'Recebido' },
            analyzing: { bg: 'bg-blue-100', text: 'text-blue-600', label: 'Em Análise' },
            waiting_parts: { bg: 'bg-yellow-100', text: 'text-yellow-600', label: 'Aguardando Peça' },
            ready: { bg: 'bg-green-100', text: 'text-green-600', label: 'Pronto' },
            delivered: { bg: 'bg-purple-100', text: 'text-purple-600', label: 'Entregue' }
        };

        // VARIÁVEIS GLOBAIS PARA O SISTEMA DE ESTOQUE
        let currentOrderParts = []; // Array para armazenar partes selecionadas na O.S.
        let currentViewOrder = null; // Ordem sendo visualizada

        // INICIALIZAÇÃO
        function init() {
            lucide.createIcons();

            // Configurar datas padrão
            const today = new Date().toISOString().split('T')[0];
            const firstDay = new Date();
            firstDay.setDate(1);
            const firstDayStr = firstDay.toISOString().split('T')[0];

            // Configurar inputs de data
            const dateInputs = [
                { id: 'trans-date', value: today },
                { id: 'filter-start', value: firstDayStr },
                { id: 'filter-end', value: today },
                { id: 'cash-start', value: firstDayStr },
                { id: 'cash-end', value: today },
                { id: 'movement-start', value: firstDayStr },
                { id: 'movement-end', value: today }
            ];

            dateInputs.forEach(({ id, value }) => {
                const element = document.getElementById(id);
                if (element) element.value = value;
            });

            // Carregar configurações da empresa
            loadCompanySettings();

            // Renderizar dados iniciais
            renderDashboard();
            updateDataStatus();

            // Configurar periodicidade para salvar
            setInterval(save, 30000);

            // Configurar event listeners para cálculos
            setupEventListeners();

            // Verificar instalação PWA
            checkInstallState();
        }

        function setupEventListeners() {
            // Atualizar total da O.S. quando valores mudarem
            ['order-labor', 'order-discount'].forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('input', updateOrderSummary);
                }
            });

            // Atualizar valor total da movimentação
            const movementQty = document.getElementById('movement-quantity');
            const movementValue = document.getElementById('movement-unit-value');
            if (movementQty && movementValue) {
                movementQty.addEventListener('input', updateMovementTotal);
                movementValue.addEventListener('input', updateMovementTotal);
            }

            // Atualizar quando produto selecionado na movimentação
            const movementProduct = document.getElementById('movement-product');
            if (movementProduct) {
                movementProduct.addEventListener('change', function () {
                    updateMovementProductInfo(this.value);
                });
            }

            // Atualizar quando produto selecionado para adicionar à O.S.
            const selectProduct = document.getElementById('select-product');
            if (selectProduct) {
                selectProduct.addEventListener('change', function () {
                    updateSelectedProductInfo(this.value);
                });
            }

            // Atualizar quantidade de peça na O.S.
            const partQty = document.getElementById('part-quantity');
            if (partQty) {
                partQty.addEventListener('input', updatePartTotal);
            }
        }

        function checkInstallState() {
            if (window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone === true) {
                // Já está instalado
            }
        }

        function loadCompanySettings() {
            const settings = db.settings;
            document.getElementById('company-name').value = settings.companyName || '';
            document.getElementById('company-doc').value = settings.companyDoc || '';
            document.getElementById('company-phone').value = settings.companyPhone || '';
            document.getElementById('company-address').value = settings.companyAddress || '';
        }

        function saveCompanySettings() {
            db.settings.companyName = document.getElementById('company-name').value;
            db.settings.companyDoc = document.getElementById('company-doc').value;
            db.settings.companyPhone = document.getElementById('company-phone').value;
            db.settings.companyAddress = document.getElementById('company-address').value;
            save();
            showNotification('Configurações salvas com sucesso!', 'success');
        }

        // ROTEAMENTO E NAVEGAÇÃO
        function router(view) {
            // Esconder todas as views
            document.querySelectorAll('.view-section').forEach(el => el.classList.add('hide'));

            // Remover classe active de todos os nav items
            document.querySelectorAll('.nav-item').forEach(el => {
                el.classList.remove('bg-white/10', 'text-white');
                el.classList.add('text-gray-400');
            });

            // Mostrar view selecionada
            const viewElement = document.getElementById(`view-${view}`);
            if (viewElement) {
                viewElement.classList.remove('hide');
                viewElement.classList.add('fade-in');
            }

            // Ativar nav item selecionado
            const navElement = document.getElementById(`nav-${view}`);
            if (navElement) {
                navElement.classList.add('bg-white/10', 'text-white');
                navElement.classList.remove('text-gray-400');
            }

            // Atualizar título da página
            const titles = {
                dashboard: 'Dashboard',
                orders: 'Ordens de Serviço',
                clients: 'Clientes',
                inventory: 'Estoque',
                transactions: 'Fluxo de Caixa',
                reports: 'Relatórios',
                settings: 'Configurações',
                instructions: 'Manual de Uso',
                about: 'Sobre a Plena'
            };

            document.getElementById('page-title').innerText = titles[view] || 'Plena Assistência';

            // Fechar sidebar no mobile
            if (window.innerWidth < 1024) {
                toggleSidebar();
            }

            // Renderizar dados específicos da view
            if (view === 'dashboard') {
                renderDashboard();
            } else if (view === 'orders') {
                renderOrders();
            } else if (view === 'clients') {
                renderClients();
            } else if (view === 'inventory') {
                renderInventory();
                renderMovements();
                populateCategoryFilter();
                populateProductSelectors();
            } else if (view === 'transactions') {
                renderTransactions();
            } else if (view === 'settings') {
                loadCompanySettings();
            }
        }

        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('overlay');

            sidebar.classList.toggle('open');
            overlay.classList.toggle('hidden');

            // Bloquear scroll do body quando sidebar aberta
            document.body.style.overflow = sidebar.classList.contains('open') ? 'hidden' : '';
        }

        // DASHBOARD
        function renderDashboard() {
            const currentMonth = new Date().toISOString().slice(0, 7);
            const monthOrders = db.orders.filter(o => o.date.startsWith(currentMonth));

            // Calcular estatísticas
            const active = db.orders.filter(o => ['received', 'analyzing', 'waiting_parts'].includes(o.status)).length;
            const ready = db.orders.filter(o => o.status === 'ready').length;

            // Estatísticas de estoque
            const lowStock = db.products.filter(p => {
                return p.stock > 0 && p.stock <= p.minStock;
            }).length;

            const revenue = monthOrders
                .filter(o => o.status === 'delivered')
                .reduce((sum, o) => sum + (o.total || 0), 0);

            // Atualizar cards
            document.getElementById('dash-active').innerText = active;
            document.getElementById('dash-ready').innerText = ready;
            document.getElementById('dash-low-stock').innerText = lowStock;
            document.getElementById('dash-revenue').innerText = fmtMoney(revenue);

            // Atualizar gráfico
            renderChart();

            // Atualizar ordens recentes
            renderRecentOrders();

            // Atualizar alertas de estoque baixo
            renderLowStockAlerts();
        }

        function renderChart() {
            const chartArea = document.getElementById('chart-area');
            const statusCount = {
                received: 0,
                analyzing: 0,
                waiting_parts: 0,
                ready: 0,
                delivered: 0
            };

            db.orders.forEach(o => {
                if (statusCount[o.status] !== undefined) {
                    statusCount[o.status]++;
                }
            });

            const maxValue = Math.max(...Object.values(statusCount), 1);

            const chartData = [
                { label: 'Recebido', value: statusCount.received, color: '#9CA3AF' },
                { label: 'Análise', value: statusCount.analyzing, color: '#3B82F6' },
                { label: 'Peça', value: statusCount.waiting_parts, color: '#F59E0B' },
                { label: 'Pronto', value: statusCount.ready, color: '#10B981' },
                { label: 'Entregue', value: statusCount.delivered, color: '#8B5CF6' }
            ];

            let chartHTML = '';
            chartData.forEach(item => {
                const height = (item.value / maxValue) * 100;
                chartHTML += `
                    <div class="bar-group">
                        <div class="bar-wrapper">
                            <div class="bar" 
                                 style="height:${height}%; background-color:${item.color}"
                                 data-value="${item.value} ${item.label}"></div>
                        </div>
                        <div class="x-label">${item.label.substring(0, 3)}</div>
                    </div>
                `;
            });

            chartArea.innerHTML = chartHTML || '<p class="text-gray-400 text-sm">Sem dados para exibir</p>';
        }

        function renderRecentOrders() {
            const container = document.getElementById('recent-orders');
            const recent = db.orders
                .sort((a, b) => new Date(b.date) - new Date(a.date))
                .slice(0, 5);

            if (recent.length === 0) {
                container.innerHTML = '<p class="text-gray-400 text-sm text-center">Nenhuma ordem de serviço recente</p>';
                return;
            }

            container.innerHTML = recent.map(order => {
                const status = statusColors[order.status] || statusColors.received;
                return `
                    <div class="flex items-center justify-between p-3 hover:bg-gray-50 rounded-lg border border-gray-100">
                        <div class="flex items-center">
                            <div class="w-8 h-8 rounded-full ${status.bg} flex items-center justify-center mr-3">
                                <i data-lucide="clipboard" class="w-4 h-4 ${status.text}"></i>
                            </div>
                            <div>
                                <p class="text-sm font-medium text-gray-800">${order.client}</p>
                                <p class="text-xs text-gray-500">${order.device} • ${fmtDate(order.date)}</p>
                            </div>
                        </div>
                        <div class="text-right">
                            <span class="text-xs font-bold ${status.text}">${status.label}</span>
                            ${order.total > 0 ? `<p class="text-sm font-bold text-gray-800 mt-1">${fmtMoney(order.total)}</p>` : ''}
                        </div>
                    </div>
                `;
            }).join('');

            lucide.createIcons();
        }

        function renderLowStockAlerts() {
            const container = document.getElementById('low-stock-alerts');
            const lowStockProducts = db.products.filter(p => {
                return p.stock > 0 && p.stock <= p.minStock;
            }).slice(0, 5);

            if (lowStockProducts.length === 0) {
                container.innerHTML = '<p class="text-gray-400 text-sm text-center">Estoque em dia</p>';
                return;
            }

            container.innerHTML = lowStockProducts.map(product => {
                const stockClass = product.stock === 0 ? 'stock-critical' :
                    product.stock <= product.minStock * 0.5 ? 'stock-critical' : 'stock-low';

                return `
                    <div class="flex items-center justify-between p-3 ${stockClass} rounded-lg">
                        <div>
                            <p class="text-sm font-medium text-gray-800">${product.name}</p>
                            <p class="text-xs text-gray-600">${product.category}</p>
                        </div>
                        <div class="text-right">
                            <p class="text-sm font-bold ${product.stock === 0 ? 'text-red-600' : 'text-yellow-600'}">
                                ${product.stock} un.
                            </p>
                            <p class="text-xs text-gray-500">Mín: ${product.minStock}</p>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // ORDENS DE SERVIÇO COM INTEGRAÇÃO DE ESTOQUE
        function openOrderModal(order = null) {
            const modal = document.getElementById('orderModal');
            const title = modal.querySelector('#order-modal-title');

            // Resetar partes da ordem
            currentOrderParts = [];

            if (order) {
                // Modo edição
                title.textContent = 'Editar Ordem de Serviço';
                document.getElementById('order-id').value = order.id;
                document.getElementById('order-client').value = order.client || '';
                document.getElementById('order-phone').value = order.phone || '';
                document.getElementById('order-device').value = order.device || '';
                document.getElementById('order-brand').value = order.brand || '';
                document.getElementById('order-serial').value = order.serial || '';
                document.getElementById('order-password').value = order.password || '';
                document.getElementById('order-problem').value = order.problem || '';
                document.getElementById('order-diagnosis').value = order.diagnosis || '';
                document.getElementById('order-labor').value = order.labor || 0;
                document.getElementById('order-discount').value = order.discount || 0;

                // Carregar partes se existirem
                if (order.parts && Array.isArray(order.parts)) {
                    currentOrderParts = [...order.parts];
                    renderOrderPartsList();
                }

                updateOrderSummary();
            } else {
                // Modo criação
                title.textContent = 'Nova Ordem de Serviço';
                modal.querySelector('form').reset();
                document.getElementById('order-id').value = '';
                document.getElementById('order-labor').value = 0;
                document.getElementById('order-discount').value = 0;
                document.getElementById('order-parts-list').innerHTML = '';
                updateOrderSummary();
            }

            modal.classList.remove('hidden');
        }

        function addPartFromInventory() {
            // Popular seletor de produtos
            const select = document.getElementById('select-product');
            select.innerHTML = '<option value="">Selecione um produto</option>';

            db.products.forEach(product => {
                if (product.stock > 0) {
                    const option = document.createElement('option');
                    option.value = product.id;
                    option.textContent = `${product.name} (${product.stock} disponíveis)`;
                    select.appendChild(option);
                }
            });

            document.getElementById('addPartModal').classList.remove('hidden');
        }

        function updateSelectedProductInfo(productId) {
            const product = db.products.find(p => p.id === productId);
            const infoDiv = document.getElementById('product-info');
            const totalDiv = document.getElementById('part-total');

            if (product) {
                infoDiv.classList.remove('hidden');
                document.getElementById('available-stock').textContent = product.stock;
                document.getElementById('product-price-display').textContent = fmtMoney(product.price);

                // Calcular total inicial
                const quantity = parseInt(document.getElementById('part-quantity').value) || 1;
                const total = quantity * product.price;
                document.getElementById('part-total-value').textContent = fmtMoney(total);
                totalDiv.classList.remove('hidden');
            } else {
                infoDiv.classList.add('hidden');
                totalDiv.classList.add('hidden');
            }
        }

        function updatePartTotal() {
            const productId = document.getElementById('select-product').value;
            const quantity = parseInt(document.getElementById('part-quantity').value) || 1;
            const product = db.products.find(p => p.id === productId);

            if (product) {
                const total = quantity * product.price;
                document.getElementById('part-total-value').textContent = fmtMoney(total);
            }
        }

        function addSelectedPart() {
            const productId = document.getElementById('select-product').value;
            const quantity = parseInt(document.getElementById('part-quantity').value) || 1;
            const notes = document.getElementById('part-notes').value;

            const product = db.products.find(p => p.id === productId);

            if (!product) {
                showNotification('Selecione um produto válido', 'error');
                return;
            }

            if (quantity > product.stock) {
                showNotification(`Estoque insuficiente. Disponível: ${product.stock} unidades`, 'error');
                return;
            }

            // Adicionar à lista de partes
            const part = {
                productId: product.id,
                productName: product.name,
                quantity: quantity,
                unitPrice: product.price,
                total: quantity * product.price,
                notes: notes
            };

            currentOrderParts.push(part);
            renderOrderPartsList();
            updateOrderSummary();

            // Fechar modal e limpar
            closeModal('addPartModal');
            document.getElementById('part-quantity').value = 1;
            document.getElementById('part-notes').value = '';
            document.getElementById('select-product').value = '';

            showNotification('Peça adicionada à ordem de serviço', 'success');
        }

        function renderOrderPartsList() {
            const container = document.getElementById('order-parts-list');

            if (currentOrderParts.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-4 text-gray-400">
                        <i data-lucide="package" class="w-8 h-8 mx-auto mb-2"></i>
                        <p class="text-sm">Nenhuma peça adicionada</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = currentOrderParts.map((part, index) => `
                <div class="flex items-center justify-between p-3 bg-white border border-gray-200 rounded-lg">
                    <div class="flex-1">
                        <p class="font-medium text-gray-800">${part.productName}</p>
                        <p class="text-xs text-gray-500">
                            ${part.quantity} x ${fmtMoney(part.unitPrice)} = ${fmtMoney(part.total)}
                            ${part.notes ? ` • ${part.notes}` : ''}
                        </p>
                    </div>
                    <button onclick="removeOrderPart(${index})" 
                            class="ml-2 text-red-500 hover:text-red-700">
                        <i data-lucide="trash-2" class="w-4 h-4"></i>
                    </button>
                </div>
            `).join('');

            lucide.createIcons();
        }

        function removeOrderPart(index) {
            currentOrderParts.splice(index, 1);
            renderOrderPartsList();
            updateOrderSummary();
        }

        function updateOrderSummary() {
            // Calcular total das peças
            const partsTotal = currentOrderParts.reduce((sum, part) => sum + part.total, 0);

            // Obter valores de mão de obra e desconto
            const labor = parseFloat(document.getElementById('order-labor').value) || 0;
            const discount = parseFloat(document.getElementById('order-discount').value) || 0;

            // Calcular total geral
            const total = partsTotal + labor - discount;

            // Atualizar displays
            document.getElementById('order-parts-total').textContent = fmtMoney(partsTotal);
            document.getElementById('summary-parts').textContent = fmtMoney(partsTotal);
            document.getElementById('summary-labor').textContent = fmtMoney(labor);
            document.getElementById('summary-discount').textContent = fmtMoney(discount);
            document.getElementById('order-total').textContent = fmtMoney(total);
        }

        function submitOrder(e) {
            e.preventDefault();

            const id = document.getElementById('order-id').value;
            const labor = parseFloat(document.getElementById('order-labor').value) || 0;
            const discount = parseFloat(document.getElementById('order-discount').value) || 0;
            const partsTotal = currentOrderParts.reduce((sum, part) => sum + part.total, 0);
            const total = partsTotal + labor - discount;

            const order = {
                id: id || getID(),
                client: document.getElementById('order-client').value.trim(),
                phone: document.getElementById('order-phone').value.trim(),
                device: document.getElementById('order-device').value.trim(),
                brand: document.getElementById('order-brand').value.trim(),
                serial: document.getElementById('order-serial').value.trim(),
                password: document.getElementById('order-password').value.trim(),
                problem: document.getElementById('order-problem').value.trim(),
                diagnosis: document.getElementById('order-diagnosis').value.trim(),
                parts: currentOrderParts,
                labor,
                discount,
                total,
                date: id ? db.orders.find(o => o.id === id).date : new Date().toISOString().split('T')[0],
                status: id ? db.orders.find(o => o.id === id).status : 'received',
                updatedAt: new Date().toISOString()
            };

            if (!order.client || !order.device || !order.problem) {
                showNotification('Preencha todos os campos obrigatórios!', 'error');
                return;
            }

            if (id) {
                // Editar ordem existente
                const index = db.orders.findIndex(o => o.id === id);
                if (index !== -1) {
                    db.orders[index] = order;
                }
            } else {
                // Adicionar nova ordem
                db.orders.unshift(order);
            }

            // Salvar/atualizar cliente
            saveClientFromOrder(order);

            save();
            closeModal('orderModal');
            renderDashboard();
            renderOrders();

            showNotification('Ordem de serviço salva com sucesso!', 'success');
        }

        function saveClientFromOrder(order) {
            const existingClient = db.clients.find(c =>
                c.name.toLowerCase() === order.client.toLowerCase() ||
                (c.phone && c.phone === order.phone)
            );

            if (!existingClient && order.client) {
                db.clients.push({
                    id: getClientID(),
                    name: order.client,
                    phone: order.phone,
                    email: '',
                    address: '',
                    notes: '',
                    orders: 1,
                    lastOrder: order.date,
                    totalSpent: order.total,
                    createdAt: new Date().toISOString()
                });
            } else if (existingClient) {
                existingClient.orders += 1;
                existingClient.lastOrder = order.date;
                existingClient.totalSpent = (existingClient.totalSpent || 0) + order.total;
            }
        }

        // VIEW ORDER FUNCTIONS
        function openOrderView(id) {
            const order = db.orders.find(o => o.id === id);
            if (!order) return;

            currentViewOrder = order;

            // Preencher dados da visualização
            document.getElementById('view-os-number').textContent = order.id;
            document.getElementById('view-os-id').textContent = order.id;
            document.getElementById('view-os-date').textContent = `Data: ${fmtDate(order.date)}`;
            document.getElementById('view-os-status').textContent = `Status: ${statusColors[order.status]?.label || 'Recebido'}`;
            document.getElementById('view-client').textContent = order.client;
            document.getElementById('view-phone').textContent = order.phone || 'Não informado';
            document.getElementById('view-device').textContent = order.device + (order.brand ? ` - ${order.brand}` : '');
            document.getElementById('view-serial').textContent = order.serial || 'N/D';
            document.getElementById('view-problem').textContent = order.problem || 'Não informado';
            document.getElementById('view-diagnosis').textContent = order.diagnosis || 'Em análise';
            document.getElementById('view-labor').textContent = fmtMoney(order.labor || 0);
            document.getElementById('view-discount').textContent = fmtMoney(order.discount || 0);
            document.getElementById('view-total').textContent = fmtMoney(order.total || 0);

            // Mostrar/ocultar botão de usar peças
            const usePartsBtn = document.getElementById('btn-use-parts');
            if (usePartsBtn) {
                usePartsBtn.style.display = order.status === 'delivered' ? 'none' : 'flex';
            }

            // Atualizar seção de peças se existirem
            const partsContainer = document.getElementById('view-parts-container');
            const partsList = document.getElementById('view-parts-list');
            const partsTotalElem = document.getElementById('view-parts-total');
            const partsSummary = document.getElementById('view-parts-summary');

            if (order.parts && order.parts.length > 0) {
                partsContainer.classList.remove('hidden');

                // Calcular total das peças
                const partsTotal = order.parts.reduce((sum, part) => sum + part.total, 0);

                // Renderizar lista de peças
                partsList.innerHTML = order.parts.map(part => `
                    <tr>
                        <td class="py-2">${part.productName}${part.notes ? `<br><span class="text-xs text-gray-500">${part.notes}</span>` : ''}</td>
                        <td class="py-2 text-center">${part.quantity}</td>
                        <td class="py-2 text-right">${fmtMoney(part.total)}</td>
                    </tr>
                `).join('');

                partsTotalElem.textContent = fmtMoney(partsTotal);
                partsSummary.textContent = fmtMoney(partsTotal);
            } else {
                partsContainer.classList.add('hidden');
                partsSummary.textContent = 'R$ 0,00';
            }

            document.getElementById('view-status-select').value = order.status;
            document.getElementById('orderViewModal').classList.remove('hidden');

            // Injetar cabeçalho corporativo
            updatePrintHeaders();
        }

        function usePartsFromOrder() {
            if (!currentViewOrder || !currentViewOrder.parts || currentViewOrder.parts.length === 0) {
                showNotification('Esta ordem não tem peças para usar do estoque', 'warning');
                return;
            }

            if (confirm('Deseja debitar as peças usadas desta O.S. do estoque?\n\nEsta ação atualizará o estoque automaticamente.')) {
                currentViewOrder.parts.forEach(part => {
                    // Encontrar o produto no estoque
                    const product = db.products.find(p => p.id === part.productId);
                    if (product) {
                        // Verificar se há estoque suficiente
                        if (product.stock >= part.quantity) {
                            // Criar movimentação de saída
                            const movement = {
                                id: getMovementID(),
                                productId: product.id,
                                productName: product.name,
                                type: 'out',
                                quantity: part.quantity,
                                unitValue: product.cost, // Usar custo para movimentação interna
                                totalValue: part.quantity * product.cost,
                                reason: 'os_use',
                                notes: `Uso na O.S. ${currentViewOrder.id} - ${currentViewOrder.client}`,
                                date: new Date().toISOString().split('T')[0],
                                orderId: currentViewOrder.id
                            };

                            db.movements.push(movement);

                            // Atualizar estoque do produto
                            product.stock -= part.quantity;
                        } else {
                            showNotification(`Estoque insuficiente para ${product.name}. Disponível: ${product.stock}, Necessário: ${part.quantity}`, 'error');
                        }
                    }
                });

                save();
                renderInventory();
                renderMovements();

                showNotification('Peças debitadas do estoque com sucesso!', 'success');
            }
        }

        // SISTEMA DE ESTOQUE
        function openProductModal(product = null) {
            const modal = document.getElementById('productModal');
            const title = modal.querySelector('#product-modal-title');
            const form = modal.querySelector('form');

            if (product) {
                // Modo edição
                title.textContent = 'Editar Produto';
                document.getElementById('product-id').value = product.id;
                document.getElementById('product-name').value = product.name || '';
                document.getElementById('product-code').value = product.code || '';
                document.getElementById('product-category').value = product.category || '';
                document.getElementById('product-stock').value = product.stock || 0;
                document.getElementById('product-min-stock').value = product.minStock || 3;
                document.getElementById('product-cost').value = product.cost || 0;
                document.getElementById('product-price').value = product.price || 0;
                document.getElementById('product-supplier').value = product.supplier || '';
                document.getElementById('product-notes').value = product.notes || '';
            } else {
                // Modo criação
                title.textContent = 'Novo Produto';
                form.reset();
                document.getElementById('product-id').value = '';
                document.getElementById('product-stock').value = 0;
                document.getElementById('product-min-stock').value = 3;
                document.getElementById('product-cost').value = 0;
                document.getElementById('product-price').value = 0;

                // Gerar código automático se não estiver editando
                document.getElementById('product-code').value = 'PR' + Date.now().toString(36).toUpperCase().substr(-6);
            }

            modal.classList.remove('hidden');
        }

        function submitProduct(e) {
            e.preventDefault();

            const id = document.getElementById('product-id').value;
            const name = document.getElementById('product-name').value.trim();
            const category = document.getElementById('product-category').value.trim();

            if (!name || !category) {
                showNotification('Preencha todos os campos obrigatórios!', 'error');
                return;
            }

            const product = {
                id: id || getProductID(),
                code: document.getElementById('product-code').value.trim() || `PR${Date.now().toString(36).toUpperCase().substr(-6)}`,
                name,
                category,
                stock: parseInt(document.getElementById('product-stock').value) || 0,
                minStock: parseInt(document.getElementById('product-min-stock').value) || 3,
                cost: parseFloat(document.getElementById('product-cost').value) || 0,
                price: parseFloat(document.getElementById('product-price').value) || 0,
                supplier: document.getElementById('product-supplier').value.trim(),
                notes: document.getElementById('product-notes').value.trim(),
                createdAt: id ? db.products.find(p => p.id === id)?.createdAt : new Date().toISOString(),
                updatedAt: new Date().toISOString()
            };

            if (id) {
                // Editar produto existente
                const index = db.products.findIndex(p => p.id === id);
                if (index !== -1) {
                    db.products[index] = product;
                }
            } else {
                // Adicionar novo produto
                db.products.unshift(product);
            }

            save();
            closeModal('productModal');
            renderInventory();
            renderDashboard();

            // Atualizar selects que usam produtos
            populateProductSelectors();

            showNotification('Produto salvo com sucesso!', 'success');
        }

        function openMovementModal() {
            // Popular seletor de produtos
            const select = document.getElementById('movement-product');
            select.innerHTML = '<option value="">Selecione um produto</option>';

            db.products.forEach(product => {
                const option = document.createElement('option');
                option.value = product.id;
                option.textContent = `${product.name} (${product.stock} em estoque)`;
                select.appendChild(option);
            });

            // Resetar formulário
            document.getElementById('movementModal').querySelector('form').reset();
            document.querySelector('input[name="movement-type"][value="in"]').checked = true;
            document.getElementById('current-stock-info').classList.add('hidden');
            document.getElementById('movement-total').classList.add('hidden');

            const modal = document.getElementById('movementModal');
            modal.classList.remove('hidden');
        }

        function updateMovementProductInfo(productId) {
            const product = db.products.find(p => p.id === productId);
            const infoDiv = document.getElementById('current-stock-info');

            if (product) {
                infoDiv.classList.remove('hidden');
                document.getElementById('current-stock').textContent = product.stock;

                // Definir valor unitário padrão baseado no tipo de movimentação
                const movementType = document.querySelector('input[name="movement-type"]:checked').value;
                const unitValueInput = document.getElementById('movement-unit-value');

                if (movementType === 'in') {
                    unitValueInput.value = product.cost;
                } else if (movementType === 'out') {
                    unitValueInput.value = product.price;
                }

                updateMovementTotal();
            } else {
                infoDiv.classList.add('hidden');
            }
        }

        function updateMovementTotal() {
            const quantity = parseInt(document.getElementById('movement-quantity').value) || 0;
            const unitValue = parseFloat(document.getElementById('movement-unit-value').value) || 0;
            const total = quantity * unitValue;

            const totalDiv = document.getElementById('movement-total');
            if (total > 0) {
                document.getElementById('movement-total-value').textContent = fmtMoney(total);
                totalDiv.classList.remove('hidden');
            } else {
                totalDiv.classList.add('hidden');
            }
        }

        function submitMovement(e) {
            e.preventDefault();

            const productId = document.getElementById('movement-product').value;
            const type = document.querySelector('input[name="movement-type"]:checked').value;
            const quantity = parseInt(document.getElementById('movement-quantity').value);
            const unitValue = parseFloat(document.getElementById('movement-unit-value').value) || 0;
            const reason = document.getElementById('movement-reason').value;
            const notes = document.getElementById('movement-notes').value.trim();

            if (!productId || !quantity || quantity <= 0) {
                showNotification('Preencha todos os campos obrigatórios!', 'error');
                return;
            }

            const product = db.products.find(p => p.id === productId);
            if (!product) {
                showNotification('Produto não encontrado!', 'error');
                return;
            }

            // Verificar estoque para saídas
            if (type === 'out' && product.stock < quantity) {
                showNotification(`Estoque insuficiente! Disponível: ${product.stock}`, 'error');
                return;
            }

            // Criar movimentação
            const movement = {
                id: getMovementID(),
                productId: product.id,
                productName: product.name,
                type,
                quantity,
                unitValue,
                totalValue: quantity * unitValue,
                reason,
                notes,
                date: new Date().toISOString().split('T')[0],
                createdAt: new Date().toISOString()
            };

            // Atualizar estoque do produto
            if (type === 'in') {
                product.stock += quantity;
            } else if (type === 'out') {
                product.stock -= quantity;
            } else if (type === 'adjust') {
                // Para ajuste, o usuário deve digitar a quantidade final desejada
                // Neste caso, a quantidade é a nova quantidade do estoque
                product.stock = quantity;
            }

            // Registrar a movimentação
            db.movements.unshift(movement);

            // Se for uma entrada (compra), registrar como transação de saída
            if (type === 'in' && unitValue > 0) {
                const transaction = {
                    id: Date.now().toString(36) + Math.random().toString(36).substr(2, 5),
                    type: 'expense',
                    amount: movement.totalValue,
                    desc: `Compra de ${product.name} - ${quantity} unidades`,
                    category: 'parts',
                    date: movement.date
                };
                db.transactions.push(transaction);
            }

            save();
            closeModal('movementModal');
            renderInventory();
            renderMovements();
            renderDashboard();
            renderTransactions();

            showNotification('Movimentação registrada com sucesso!', 'success');
        }

        function renderInventory() {
            const term = document.getElementById('search-inventory')?.value.toLowerCase() || '';
            const category = document.getElementById('filter-category')?.value || 'all';
            const stockFilter = document.getElementById('filter-stock')?.value || 'all';

            // Filtrar produtos
            let filtered = db.products.filter(p => {
                const matchesTerm = p.name.toLowerCase().includes(term) ||
                    p.code.toLowerCase().includes(term) ||
                    p.category.toLowerCase().includes(term);
                const matchesCategory = category === 'all' || p.category === category;

                let matchesStock = true;
                if (stockFilter === 'low') {
                    matchesStock = p.stock > 0 && p.stock <= p.minStock;
                } else if (stockFilter === 'critical') {
                    matchesStock = p.stock <= p.minStock * 0.5 || p.stock === 0;
                } else if (stockFilter === 'out') {
                    matchesStock = p.stock === 0;
                }

                return matchesTerm && matchesCategory && matchesStock;
            });

            // Ordenar por nome
            filtered.sort((a, b) => a.name.localeCompare(b.name));

            // Atualizar tabela
            const tbody = document.getElementById('inventory-table-body');
            const emptyMsg = document.getElementById('empty-inventory-msg');

            if (filtered.length === 0) {
                tbody.innerHTML = '';
                emptyMsg?.classList.remove('hidden');
                updateInventoryStats(filtered);
                return;
            }

            emptyMsg?.classList.add('hidden');

            tbody.innerHTML = filtered.map(p => {
                // Determinar classe CSS baseada no nível de estoque
                let stockClass = '';
                let stockText = '';

                if (p.stock === 0) {
                    stockClass = 'stock-critical';
                    stockText = 'ESGOTADO';
                } else if (p.stock <= p.minStock * 0.5) {
                    stockClass = 'stock-critical';
                    stockText = 'CRÍTICO';
                } else if (p.stock <= p.minStock) {
                    stockClass = 'stock-low';
                    stockText = 'BAIXO';
                } else {
                    stockClass = 'stock-ok';
                    stockText = 'OK';
                }

                return `
                    <tr class="hover:bg-gray-50 group border-b border-gray-100 ${stockClass}">
                        <td class="px-6 py-4 font-mono text-sm text-gray-500">${p.code}</td>
                        <td class="px-6 py-4">
                            <div class="font-medium text-gray-800">${p.name}</div>
                            ${p.supplier ? `<div class="text-xs text-gray-400">${p.supplier}</div>` : ''}
                        </td>
                        <td class="px-6 py-4">
                            <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-gray-100 text-gray-800">
                                ${p.category}
                            </span>
                        </td>
                        <td class="px-6 py-4 text-center">
                            <span class="font-bold ${p.stock === 0 ? 'text-red-600' : p.stock <= p.minStock ? 'text-yellow-600' : 'text-green-600'}">
                                ${p.stock}
                            </span>
                            <div class="text-xs text-gray-500 ${stockClass.replace('stock-', 'text-')}">
                                ${stockText}
                            </div>
                        </td>
                        <td class="px-6 py-4 text-center text-gray-500">${p.minStock}</td>
                        <td class="px-6 py-4 text-right font-mono text-sm">${fmtMoney(p.cost)}</td>
                        <td class="px-6 py-4 text-right font-mono text-sm font-bold text-green-600">${fmtMoney(p.price)}</td>
                        <td class="px-6 py-4 text-center">
                            <div class="flex justify-center space-x-2 opacity-0 group-hover:opacity-100 transition-opacity">
                                <button onclick="openProductModal(${JSON.stringify(p).replace(/"/g, '&quot;')})" 
                                        class="text-gray-400 hover:text-blue-500 transition-colors"
                                        title="Editar">
                                    <i data-lucide="edit" class="w-4 h-4"></i>
                                </button>
                                <button onclick="deleteProduct('${p.id}')" 
                                        class="text-gray-400 hover:text-red-500 transition-colors"
                                        title="Excluir">
                                    <i data-lucide="trash-2" class="w-4 h-4"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');

            lucide.createIcons();
            updateInventoryStats(filtered);
        }

        function updateInventoryStats(products) {
            const total = products.length;
            const lowStock = products.filter(p => p.stock > 0 && p.stock <= p.minStock).length;

            // Calcular valor total do estoque
            const totalValue = products.reduce((sum, p) => sum + (p.stock * p.cost), 0);

            // Contar categorias únicas
            const categories = [...new Set(products.map(p => p.category))];

            document.getElementById('inv-total').textContent = total;
            document.getElementById('inv-value').textContent = fmtMoney(totalValue);
            document.getElementById('inv-low').textContent = lowStock;
            document.getElementById('inv-categories').textContent = categories.length;
        }

        function renderMovements() {
            const start = document.getElementById('movement-start')?.value || '';
            const end = document.getElementById('movement-end')?.value || '';
            const type = document.getElementById('movement-type')?.value || 'all';

            // Filtrar movimentações
            let filtered = db.movements.filter(m => {
                const matchesType = type === 'all' || m.type === type;
                const matchesDate = (!start || m.date >= start) && (!end || m.date <= end);
                return matchesType && matchesDate;
            });

            // Ordenar por data (mais recente primeiro)
            filtered.sort((a, b) => new Date(b.date) - new Date(a.date));

            // Atualizar tabela
            const tbody = document.getElementById('movements-table-body');

            if (filtered.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" class="px-6 py-8 text-center text-gray-400">
                            <i data-lucide="move" class="w-12 h-12 mx-auto mb-4 text-gray-300"></i>
                            <p>Nenhuma movimentação encontrada.</p>
                        </td>
                    </tr>
                `;
                return;
            }

            tbody.innerHTML = filtered.map(m => {
                const typeConfig = {
                    in: { icon: 'arrow-down-left', color: 'text-green-600', label: 'Entrada' },
                    out: { icon: 'arrow-up-right', color: 'text-red-600', label: 'Saída' },
                    adjust: { icon: 'refresh-cw', color: 'text-yellow-600', label: 'Ajuste' }
                }[m.type] || { icon: 'move', color: 'text-gray-600', label: 'Movimentação' };

                const reasonLabels = {
                    purchase: 'Compra',
                    sale: 'Venda',
                    os_use: 'Uso em O.S.',
                    loss: 'Perda/Avaria',
                    adjustment: 'Ajuste',
                    other: 'Outro'
                };

                return `
                    <tr class="hover:bg-gray-50 group border-b border-gray-100">
                        <td class="px-6 py-4 text-gray-500 whitespace-nowrap">${fmtDate(m.date)}</td>
                        <td class="px-6 py-4">
                            <div class="font-medium text-gray-800">${m.productName}</div>
                            ${m.notes ? `<div class="text-xs text-gray-400">${m.notes}</div>` : ''}
                        </td>
                        <td class="px-6 py-4">
                            <div class="flex items-center ${typeConfig.color}">
                                <i data-lucide="${typeConfig.icon}" class="w-4 h-4 mr-1"></i>
                                <span class="text-sm font-medium">${typeConfig.label}</span>
                            </div>
                        </td>
                        <td class="px-6 py-4 text-center font-bold ${m.type === 'in' ? 'text-green-600' : m.type === 'out' ? 'text-red-600' : 'text-yellow-600'}">
                            ${m.type === 'in' ? '+' : m.type === 'out' ? '-' : '±'} ${m.quantity}
                        </td>
                        <td class="px-6 py-4 text-sm text-gray-600">${reasonLabels[m.reason] || m.reason}</td>
                        <td class="px-6 py-4 text-right font-mono text-sm ${m.type === 'in' ? 'text-red-600' : 'text-green-600'}">
                            ${m.type === 'in' ? '-' : '+'} ${fmtMoney(m.totalValue)}
                        </td>
                    </tr>
                `;
            }).join('');

            lucide.createIcons();
        }

        function populateCategoryFilter() {
            const categories = [...new Set(db.products.map(p => p.category))].sort();
            const filter = document.getElementById('filter-category');

            if (filter) {
                // Salvar valor atual
                const currentValue = filter.value;

                // Reconstruir opções
                filter.innerHTML = '<option value="all">Todas Categorias</option>';
                categories.forEach(category => {
                    const option = document.createElement('option');
                    option.value = category;
                    option.textContent = category;
                    filter.appendChild(option);
                });

                // Restaurar valor selecionado se ainda existir
                if (categories.includes(currentValue)) {
                    filter.value = currentValue;
                }
            }
        }

        function populateProductSelectors() {
            // Popular seletor do modal de movimentação
            const movementSelect = document.getElementById('movement-product');
            if (movementSelect) {
                movementSelect.innerHTML = '<option value="">Selecione um produto</option>';
                db.products.forEach(product => {
                    const option = document.createElement('option');
                    option.value = product.id;
                    option.textContent = `${product.name} (${product.stock} em estoque)`;
                    movementSelect.appendChild(option);
                });
            }

            // Popular seletor do modal de adicionar peça à O.S.
            const partSelect = document.getElementById('select-product');
            if (partSelect) {
                partSelect.innerHTML = '<option value="">Selecione um produto</option>';
                db.products.forEach(product => {
                    if (product.stock > 0) {
                        const option = document.createElement('option');
                        option.value = product.id;
                        option.textContent = `${product.name} (${product.stock} disponíveis)`;
                        partSelect.appendChild(option);
                    }
                });
            }
        }

        function deleteProduct(id) {
            if (confirm('Tem certeza que deseja excluir este produto?\n\nEsta ação não pode ser desfeita.')) {
                // Verificar se o produto está sendo usado em alguma O.S.
                const usedInOrders = db.orders.some(order =>
                    order.parts && order.parts.some(part => part.productId === id)
                );

                if (usedInOrders) {
                    showNotification('Este produto está sendo usado em ordens de serviço e não pode ser excluído.', 'error');
                    return;
                }

                db.products = db.products.filter(p => p.id !== id);
                save();
                renderInventory();
                renderDashboard();
                populateProductSelectors();
                showNotification('Produto excluído com sucesso!', 'success');
            }
        }

        // FUNÇÕES RESTANTES DO SISTEMA ORIGINAL
        // (Clients, Transactions, Reports, Settings, etc.)
        // Nota: Mantive a estrutura original e adicionei apenas o necessário para o estoque
        // As funções abaixo são simplificadas para manter o foco no estoque

        function renderOrders() {
            // Implementação similar à original
            const tbody = document.getElementById('orders-table-body');
            const emptyMsg = document.getElementById('empty-msg');

            if (db.orders.length === 0) {
                tbody.innerHTML = '';
                emptyMsg?.classList.remove('hidden');
                return;
            }

            emptyMsg?.classList.add('hidden');

            // Implementação simplificada - em um sistema real, seria mais completa
            tbody.innerHTML = db.orders.map(order => {
                const status = statusColors[order.status] || statusColors.received;
                return `
                    <tr class="hover:bg-gray-50 group border-b border-gray-100">
                        <td class="px-6 py-4 font-mono text-sm text-gray-500">${order.id}</td>
                        <td class="px-6 py-4">
                            <div class="font-medium text-gray-800">${order.client}</div>
                            ${order.phone ? `<div class="text-xs text-gray-400">${order.phone}</div>` : ''}
                        </td>
                        <td class="px-6 py-4">
                            <div class="font-medium text-gray-800">${order.device}</div>
                            ${order.brand ? `<div class="text-xs text-gray-400">${order.brand}</div>` : ''}
                        </td>
                        <td class="px-6 py-4">
                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${status.bg} ${status.text}">
                                ${status.label}
                            </span>
                        </td>
                        <td class="px-6 py-4 text-gray-500 whitespace-nowrap">${fmtDate(order.date)}</td>
                        <td class="px-6 py-4 text-right font-bold ${order.total > 0 ? 'text-green-600' : 'text-gray-500'}">
                            ${fmtMoney(order.total)}
                        </td>
                        <td class="px-6 py-4 text-center">
                            <div class="flex justify-center space-x-2 opacity-0 group-hover:opacity-100 transition-opacity">
                                <button onclick="openOrderView('${order.id}')" 
                                        class="text-gray-400 hover:text-blue-500 transition-colors"
                                        title="Visualizar">
                                    <i data-lucide="eye" class="w-4 h-4"></i>
                                </button>
                                <button onclick="openOrderModal(${JSON.stringify(order).replace(/"/g, '&quot;')})" 
                                        class="text-gray-400 hover:text-yellow-500 transition-colors"
                                        title="Editar">
                                    <i data-lucide="edit" class="w-4 h-4"></i>
                                </button>
                                <button onclick="deleteOrder('${order.id}')" 
                                        class="text-gray-400 hover:text-red-500 transition-colors"
                                        title="Excluir">
                                    <i data-lucide="trash-2" class="w-4 h-4"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');

            lucide.createIcons();
        }

        function deleteOrder(id) {
            if (confirm('Tem certeza que deseja excluir esta ordem de serviço?')) {
                db.orders = db.orders.filter(o => o.id !== id);
                save();
                renderDashboard();
                renderOrders();
                showNotification('Ordem de serviço excluída com sucesso!', 'success');
            }
        }

        function updateOrderStatus(status) {
            if (currentViewOrder) {
                currentViewOrder.status = status;
                const index = db.orders.findIndex(o => o.id === currentViewOrder.id);
                if (index !== -1) {
                    db.orders[index] = currentViewOrder;
                    save();

                    // Atualizar visualização
                    document.getElementById('view-os-status').textContent = `Status: ${statusColors[status]?.label || status}`;

                    // Atualizar outras views
                    renderDashboard();
                    renderOrders();

                    showNotification('Status atualizado com sucesso!', 'success');
                }
            }
        }

        function editCurrentOrder() {
            if (currentViewOrder) {
                closeModal('orderViewModal');
                openOrderModal(currentViewOrder);
            }
        }

        function shareOrderWhatsApp() {
            // Implementação simplificada
            if (!currentViewOrder) return;

            const message = encodeURIComponent(
                `🔧 Ordem de Serviço #${currentViewOrder.id}\n` +
                `Cliente: ${currentViewOrder.client}\n` +
                `Equipamento: ${currentViewOrder.device}\n` +
                `Status: ${statusColors[currentViewOrder.status]?.label || 'Recebido'}\n` +
                `Total: ${fmtMoney(currentViewOrder.total)}`
            );

            window.open(`https://wa.me/?text=${message}`, '_blank');
        }

        function updatePrintHeaders() {
            const s = db.settings;
            const headerHTML = `
                <div class="flex flex-col items-center border-b-2 border-gray-800 pb-4 mb-6 print-header">
                    <h2 class="text-2xl font-bold text-gray-800 uppercase tracking-widest text-center">${s.companyName || 'ASSISTÊNCIA TÉCNICA'}</h2>
                    <div class="text-xs font-medium text-gray-500 flex flex-wrap justify-center gap-3 mt-2 uppercase tracking-wide">
                        ${s.companyDoc ? `<span>CNPJ/CPF: ${s.companyDoc}</span>` : ''}
                        ${s.companyPhone ? `<span>• Tel: ${s.companyPhone}</span>` : ''}
                    </div>
                    <p class="text-[10px] text-gray-400 mt-1 uppercase text-center">${s.companyAddress || ''}</p>
                </div>
            `;

            const containers = [
                document.getElementById('invoice-print'),
                document.getElementById('report-result'),
                document.querySelector('#closingModal .p-6')
            ];

            containers.forEach(container => {
                if (!container) return;
                const existingHeader = container.querySelector('.print-header');
                if (existingHeader) {
                    existingHeader.outerHTML = headerHTML;
                } else {
                    container.insertAdjacentHTML('afterbegin', headerHTML);
                }
            });
        }

        // FUNÇÕES DE RELATÓRIOS COM ESTOQUE
        function generateInventoryReport() {
            const reportContent = document.getElementById('report-content');

            // Calcular estatísticas de estoque
            const totalProducts = db.products.length;
            const totalValue = db.products.reduce((sum, p) => sum + (p.stock * p.cost), 0);
            const lowStockCount = db.products.filter(p => p.stock > 0 && p.stock <= p.minStock).length;
            const outOfStockCount = db.products.filter(p => p.stock === 0).length;

            // Produtos mais valiosos (por valor total em estoque)
            const mostValuable = [...db.products]
                .sort((a, b) => (b.stock * b.cost) - (a.stock * a.cost))
                .slice(0, 5);

            // Categorias com mais produtos
            const categoryCount = {};
            db.products.forEach(p => {
                categoryCount[p.category] = (categoryCount[p.category] || 0) + 1;
            });

            const topCategories = Object.entries(categoryCount)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 5);

            reportContent.innerHTML = `
                <div class="mb-6">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">Relatório de Estoque</h3>
                    <p class="text-sm text-gray-600">Data: ${new Date().toLocaleDateString('pt-BR')}</p>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                    <div class="bg-blue-50 p-4 rounded-xl border border-blue-100 text-center">
                        <p class="text-xs text-gray-500 uppercase font-bold mb-1">Total Produtos</p>
                        <p class="text-2xl font-bold text-blue-700">${totalProducts}</p>
                    </div>
                    <div class="bg-green-50 p-4 rounded-xl border border-green-100 text-center">
                        <p class="text-xs text-gray-500 uppercase font-bold mb-1">Valor Total</p>
                        <p class="text-2xl font-bold text-green-700">${fmtMoney(totalValue)}</p>
                    </div>
                    <div class="bg-yellow-50 p-4 rounded-xl border border-yellow-100 text-center">
                        <p class="text-xs text-gray-500 uppercase font-bold mb-1">Baixo Estoque</p>
                        <p class="text-2xl font-bold text-yellow-700">${lowStockCount}</p>
                    </div>
                    <div class="bg-red-50 p-4 rounded-xl border border-red-100 text-center">
                        <p class="text-xs text-gray-500 uppercase font-bold mb-1">Esgotados</p>
                        <p class="text-2xl font-bold text-red-700">${outOfStockCount}</p>
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                    <div class="bg-white p-4 rounded-xl border border-gray-200">
                        <h4 class="font-bold text-gray-800 mb-3">Produtos Mais Valiosos</h4>
                        ${mostValuable.length > 0 ? mostValuable.map(p => `
                            <div class="flex justify-between items-center mb-2 p-2 hover:bg-gray-50 rounded">
                                <div>
                                    <p class="font-medium text-gray-800">${p.name}</p>
                                    <p class="text-xs text-gray-500">${p.category}</p>
                                </div>
                                <div class="text-right">
                                    <p class="font-bold text-green-600">${fmtMoney(p.stock * p.cost)}</p>
                                    <p class="text-xs text-gray-500">${p.stock} unidades</p>
                                </div>
                            </div>
                        `).join('') : '<p class="text-gray-400 text-center">Nenhum produto cadastrado</p>'}
                    </div>

                    <div class="bg-white p-4 rounded-xl border border-gray-200">
                        <h4 class="font-bold text-gray-800 mb-3">Categorias com Mais Produtos</h4>
                        ${topCategories.length > 0 ? topCategories.map(([category, count]) => `
                            <div class="flex justify-between items-center mb-2 p-2 hover:bg-gray-50 rounded">
                                <span class="font-medium text-gray-800">${category}</span>
                                <span class="bg-blue-100 text-blue-700 px-2 py-1 rounded text-sm font-bold">${count}</span>
                            </div>
                        `).join('') : '<p class="text-gray-400 text-center">Nenhuma categoria</p>'}
                    </div>
                </div>

                <div class="bg-white p-4 rounded-xl border border-gray-200 mb-6">
                    <h4 class="font-bold text-gray-800 mb-3">Produtos com Estoque Baixo/Crítico</h4>
                    ${lowStockCount + outOfStockCount > 0 ?
                    db.products.filter(p => p.stock <= p.minStock).map(p => `
                            <div class="flex justify-between items-center mb-2 p-2 ${p.stock === 0 ? 'bg-red-50' : 'bg-yellow-50'} rounded">
                                <div>
                                    <p class="font-medium text-gray-800">${p.name}</p>
                                    <p class="text-xs text-gray-500">${p.category}</p>
                                </div>
                                <div class="text-right">
                                    <p class="font-bold ${p.stock === 0 ? 'text-red-600' : 'text-yellow-600'}">${p.stock} unidades</p>
                                    <p class="text-xs text-gray-500">Mínimo: ${p.minStock}</p>
                                </div>
                            </div>
                        `).join('') :
                    '<p class="text-gray-400 text-center">Todos os produtos estão com estoque adequado</p>'
                }
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <button onclick="printReport()"
                        class="bg-blue-600 text-white py-3 rounded-xl font-bold hover:bg-blue-700 flex justify-center items-center gap-2">
                        <i data-lucide="printer" class="w-4 h-4"></i> Imprimir Relatório
                    </button>
                    <button onclick="exportInventoryCSV()"
                        class="bg-green-600 text-white py-3 rounded-xl font-bold hover:bg-green-700 flex justify-center items-center gap-2">
                        <i data-lucide="download" class="w-4 h-4"></i> Exportar CSV
                    </button>
                </div>
            `;

            document.getElementById('report-result').classList.remove('hide');
            lucide.createIcons();
        }

        function exportInventoryCSV() {
            const headers = ['Código', 'Nome', 'Categoria', 'Estoque', 'Mínimo', 'Custo', 'Venda', 'Fornecedor'];
            const rows = db.products.map(p => {
                return [
                    p.code,
                    `"${p.name}"`,
                    p.category,
                    p.stock,
                    p.minStock,
                    p.cost.toFixed(2).replace('.', ','),
                    p.price.toFixed(2).replace('.', ','),
                    p.supplier || ''
                ];
            });

            const csv = [headers, ...rows].map(row => row.join(';')).join('\n');
            const blob = new Blob(['\uFEFF' + csv], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');

            a.href = url;
            a.download = `estoque_${new Date().toISOString().slice(0, 10)}.csv`;
            a.click();

            URL.revokeObjectURL(url);
            showNotification('CSV exportado com sucesso!', 'success');
        }

        // FUNÇÕES UTILITÁRIAS
        function closeModal(modalId) {
            document.getElementById(modalId).classList.add('hidden');
        }

        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 z-50 px-4 py-3 rounded-lg shadow-lg transform transition-all duration-300 ${type === 'success' ? 'bg-green-500 text-white' :
                type === 'error' ? 'bg-red-500 text-white' :
                    type === 'warning' ? 'bg-yellow-500 text-white' :
                        'bg-blue-500 text-white'}`;

            const icons = {
                success: 'check-circle',
                error: 'alert-circle',
                warning: 'alert-triangle',
                info: 'info'
            };

            notification.innerHTML = `
                <div class="flex items-center">
                    <i data-lucide="${icons[type]}" class="w-5 h-5 mr-2"></i>
                    <span>${message}</span>
                </div>
            `;

            document.body.appendChild(notification);
            lucide.createIcons();

            setTimeout(() => {
                notification.style.opacity = '0';
                notification.style.transform = 'translateX(100%)';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        function updateDataStatus() {
            console.log(`Dados atualizados: ${db.orders.length} O.S., ${db.clients.length} clientes, ${db.products.length} produtos, ${db.movements.length} movimentações`);
        }

        // OUTRAS FUNÇÕES DO SISTEMA ORIGINAL (simplificadas)
        function clearFilters() {
            // Implementação simplificada
            const firstDay = new Date();
            firstDay.setDate(1);
            const firstDayStr = firstDay.toISOString().split('T')[0];
            const today = new Date().toISOString().split('T')[0];

            const elements = [
                { id: 'search-order', value: '' },
                { id: 'filter-status', value: 'all' },
                { id: 'filter-start', value: firstDayStr },
                { id: 'filter-end', value: today }
            ];

            elements.forEach(({ id, value }) => {
                const element = document.getElementById(id);
                if (element) element.value = value;
            });

            renderOrders();
        }

        // INICIALIZAR APLICATIVO
        document.addEventListener('DOMContentLoaded', () => {
            init();
            // Iniciar no dashboard
            router('dashboard');
        });
    </script>

    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('sw.js')
                    .then(registration => {
                        console.log('ServiceWorker registration successful with scope: ', registration.scope);
                    })
                    .catch(err => {
                        console.log('ServiceWorker registration failed: ', err);
                    });
            });
        }
    </script>

    
    
        

    

<!-- PWA INSTALLATION TOAST (Standardized) -->
<div id="pwa-install-toast" style="display: none; position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); background-color: white; color: black; padding: 12px 16px; border-radius: 12px; box-shadow: 0 10px 25px rgba(0,0,0,0.2); z-index: 9999; align-items: center; gap: 12px; border: 1px solid #e5e7eb; min-width: 300px;">
    <div style="background-color: transparent; padding: 0; border-radius: 8px; display: flex; align-items: center; justify-content: center;">
        <img src="./icons/icon-192.png" alt="App Icon" style="width: 40px; height: 40px; border-radius: 8px; object-fit: cover;">
    </div>
    <div style="flex: 1;">
        <p style="font-size: 14px; font-weight: bold; margin: 0; color: #1f2937;">Instalar Aplicativo</p>
        <p style="font-size: 12px; color: #6b7280; margin: 0;">Acesso rápido 100% offline</p>
    </div>
    <button onclick="installPWA()" style="background-color: #000; color: white; border: none; padding: 8px 16px; border-radius: 8px; font-size: 12px; font-weight: bold; cursor: pointer; white-space: nowrap;">
        Instalar
    </button>
    <button onclick="dismissInstall()" style="background-color: transparent; border: none; color: #9ca3af; cursor: pointer; padding: 4px; display: flex; align-items: center;">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-x"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
    </button>
</div>

<script>
    let deferredPrompt;
    
    // Check if installed
    const isStandalone = window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone || document.referrer.includes('android-app://');

    window.addEventListener('beforeinstallprompt', (e) => {
        // Prevent Chrome 67 and earlier from automatically showing the prompt
        e.preventDefault();
        deferredPrompt = e;
        
        // Show the toast if not already dismissed and not in standalone mode
        if (!localStorage.getItem('pwa_dismissed') && !isStandalone) {
             const toast = document.getElementById('pwa-install-toast');
             if (toast) toast.style.display = 'flex';
        }
    });

    function installPWA() {
        if (deferredPrompt) {
            deferredPrompt.prompt();
            deferredPrompt.userChoice.then((choiceResult) => {
                if (choiceResult.outcome === 'accepted') {
                    console.log('User accepted the install prompt');
                }
                deferredPrompt = null;
                dismissInstall();
            });
        }
    }

    function dismissInstall() {
        const toast = document.getElementById('pwa-install-toast');
        if (toast) toast.style.display = 'none';
        localStorage.setItem('pwa_dismissed', 'true');
    }
</script>
</body>

</html>