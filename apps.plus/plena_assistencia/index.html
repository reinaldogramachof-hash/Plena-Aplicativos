<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Plena Assistência - Gestão Profissional</title>

    <link rel="manifest" href="manifest.json">
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#2563EB">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Plena Assistência">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        plena: {
                            blue: '#2563EB',
                            dark: '#1e40af',
                            black: '#1a1a1a',
                            green: '#10B981',
                            red: '#EF4444',
                            yellow: '#F59E0B',
                            purple: '#8B5CF6'
                        },
                    },
                    animation: {
                        'pulse-slow': 'pulse 3s infinite',
                        'slide-in': 'slideIn 0.3s ease-out',
                    }
                }
            }
        }
    </script>

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        /* CSS Padronizado */
        :root {
            --plena-blue: #2563EB;
            --plena-dark: #1e40af;
            --plena-black: #1a1a1a;
            --plena-green: #10B981;
            --plena-red: #EF4444;
            --plena-yellow: #F59E0B;
            --plena-purple: #8B5CF6;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background-color: #F3F4F6;
            -webkit-tap-highlight-color: transparent;
        }

        .hide {
            display: none !important;
        }

        .fade-in {
            animation: fadeIn 0.3s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(5px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideIn {
            from {
                transform: translateX(-10px);
                opacity: 0;
            }

            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* Gráfico CSS */
        .chart-container {
            display: flex;
            align-items: flex-end;
            justify-content: space-between;
            height: 180px;
            gap: 2%;
        }

        .bar-group {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            height: 100%;
            position: relative;
        }

        .bar-wrapper {
            display: flex;
            align-items: flex-end;
            justify-content: center;
            gap: 2px;
            height: 100%;
            width: 100%;
        }

        .bar {
            width: 45%;
            border-radius: 6px 6px 0 0;
            transition: height 0.5s ease;
            min-height: 2px;
            position: relative;
            cursor: pointer;
        }

        .bar:hover::after {
            content: attr(data-value);
            position: absolute;
            top: -30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            white-space: nowrap;
            z-index: 10;
        }

        /* Modal Backdrop */
        .modal-backdrop {
            background-color: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(4px);
            animation: fadeIn 0.2s ease;
        }

        /* Sidebar Mobile */
        @media (max-width: 1024px) {
            .sidebar {
                transform: translateX(-100%);
                position: fixed;
                z-index: 50;
                height: 100vh;
                width: 280px;
            }

            .sidebar.open {
                transform: translateX(0);
            }
        }

        @media (min-width: 1025px) {
            .sidebar {
                width: 280px;
                position: fixed;
                height: 100vh;
            }

            .main-content {
                margin-left: 280px;
            }
        }

        /* Card Hover Effects */
        .card-hover {
            transition: all 0.3s ease;
        }

        .card-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        /* Badges */
        .badge {
            display: inline-flex;
            align-items: center;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .badge-success {
            background-color: #DCFCE7;
            color: #166534;
        }

        .badge-warning {
            background-color: #FEF3C7;
            color: #92400E;
        }

        .badge-danger {
            background-color: #FEE2E2;
            color: #991B1B;
        }

        .badge-info {
            background-color: #DBEAFE;
            color: #1E40AF;
        }

        /* Status Colors */
        .status-received {
            background-color: #F3F4F6;
            color: #374151;
        }

        .status-analyzing {
            background-color: #DBEAFE;
            color: #1E40AF;
        }

        .status-waiting {
            background-color: #FEF3C7;
            color: #92400E;
        }

        .status-ready {
            background-color: #D1FAE5;
            color: #065F46;
        }

        .status-delivered {
            background-color: #E5E7EB;
            color: #4B5563;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #a1a1a1;
        }

        /* Print Styles */
        /* Print Styles - V4 Fixed */
        @media print {

            .sidebar,
            .no-print,
            header,
            button,
            .fab-container,
            .hidden-print {
                display: none !important;
            }

            .main-content {
                margin: 0 !important;
                padding: 0 !important;
                width: 100% !important;
            }

            body {
                background: white !important;
                color: black !important;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }

            .view-section {
                padding: 0 !important;
                display: block !important;
            }

            /* Esconder views não ativas - mas garantir que se for modal, o modal apareça */
            .view-section.hide {
                display: none !important;
            }

            /* Garante que o modal aberto seja impresso corretamente */
            .fixed.inset-0:not(.hidden) {
                position: absolute !important;
                overflow: visible !important;
                z-index: 9999 !important;
                background: white !important;
            }

            .fixed.inset-0:not(.hidden)>div {
                box-shadow: none !important;
                border: none !important;
                max-width: 100% !important;
                width: 100% !important;
                margin: 0 !important;
                padding: 0 !important;
            }

            /* Remover backdrop */
            .modal-backdrop {
                background-color: transparent !important;
                backdrop-filter: none !important;
            }
        }

        /* Tutorial Steps */
        .step-number {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 12px;
            flex-shrink: 0;
        }

        /* Checklist */
        .checklist-item {
            transition: all 0.2s ease;
        }

        .checklist-item.completed {
            opacity: 0.7;
            text-decoration: line-through;
        }

        /* Code-like examples */
        .code-block {
            background: #1a1a1a;
            color: #f8f8f2;
            padding: 12px 16px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            overflow-x: auto;
            margin: 8px 0;
        }

        /* Progress bar */
        .progress-bar {
            height: 6px;
            border-radius: 3px;
            background: #e5e7eb;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #2563EB, #1e40af);
            transition: width 0.5s ease;
        }
    </style>
</head>

<body class="text-gray-800 antialiased">

    <!-- Overlay para sidebar mobile -->
    <div id="overlay" class="fixed inset-0 bg-black/50 hidden z-40 transition-opacity" onclick="toggleSidebar()"></div>

    <!-- Sidebar -->
    <aside id="sidebar"
        class="sidebar bg-plena-black text-white transition-transform duration-300 flex flex-col shadow-2xl">
        <div class="h-20 flex items-center px-6 bg-gradient-to-r from-plena-blue to-plena-dark">
            <i data-lucide="wrench" class="w-8 h-8 mr-3"></i>
            <div>
                <h1 class="text-xl font-bold tracking-tight">PLENA ASSISTÊNCIA</h1>
                <p class="text-xs text-white/90 font-medium">Gestão de Assistência Técnica</p>
            </div>
        </div>

        <nav class="p-4 space-y-2 flex-1 overflow-y-auto">
            <button onclick="router('dashboard')"
                class="nav-item w-full flex items-center px-4 py-3 rounded-xl hover:bg-white/10 transition-all group active-nav"
                id="nav-dashboard">
                <i data-lucide="layout-dashboard" class="w-5 h-5 mr-3 text-gray-400 group-hover:text-white"></i>
                Dashboard
            </button>
            <button onclick="router('orders')"
                class="nav-item w-full flex items-center px-4 py-3 rounded-xl hover:bg-white/10 transition-all group"
                id="nav-orders">
                <i data-lucide="clipboard-list" class="w-5 h-5 mr-3 text-gray-400 group-hover:text-white"></i>
                Ordens de Serviço
            </button>
            <button onclick="router('clients')"
                class="nav-item w-full flex items-center px-4 py-3 rounded-xl hover:bg-white/10 transition-all group"
                id="nav-clients">
                <i data-lucide="users" class="w-5 h-5 mr-3 text-gray-400 group-hover:text-white"></i>
                Clientes
            </button>
            <button onclick="router('transactions')"
                class="nav-item w-full flex items-center px-4 py-3 rounded-xl hover:bg-white/10 transition-all group"
                id="nav-transactions">
                <i data-lucide="wallet" class="w-5 h-5 mr-3 text-gray-400 group-hover:text-white"></i>
                Fluxo de Caixa
            </button>
            <button onclick="router('reports')"
                class="nav-item w-full flex items-center px-4 py-3 rounded-xl hover:bg-white/10 transition-all group"
                id="nav-reports">
                <i data-lucide="bar-chart-3" class="w-5 h-5 mr-3 text-gray-400 group-hover:text-white"></i>
                Relatórios
            </button>
            <button onclick="router('settings')"
                class="nav-item w-full flex items-center px-4 py-3 rounded-xl hover:bg-white/10 transition-all group"
                id="nav-settings">
                <i data-lucide="settings" class="w-5 h-5 mr-3 text-gray-400 group-hover:text-white"></i>
                Configurações
            </button>

            <button onclick="router('instructions')"
                class="nav-item w-full flex items-center px-4 py-3 rounded-xl hover:bg-white/10 transition-all group"
                id="nav-instructions">
                <i data-lucide="book-open" class="w-5 h-5 mr-3 text-gray-400 group-hover:text-white"></i>
                Manual de Uso
            </button>
            <button onclick="router('about')"
                class="nav-item w-full flex items-center px-4 py-3 rounded-xl hover:bg-white/10 transition-all group"
                id="nav-about">
                <i data-lucide="info" class="w-5 h-5 mr-3 text-gray-400 group-hover:text-white"></i>
                Sobre a Plena
            </button>
        </nav>

        <div class="p-6 border-t border-white/10 text-center">
            <p class="text-xs text-gray-500">Todos os Direitos Reservados &copy; 2025</p>
            <a href="https://www.plenaaplicativos.com.br" target="_blank"
                class="text-[10px] text-gray-600 hover:text-plena-blue transition-colors mt-1 block decoration-0">
                Plena Soluções Digitais LTDA
            </a>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content min-h-screen flex flex-col">
        <!-- Header -->
        <header
            class="bg-white h-20 flex items-center justify-between px-4 lg:px-8 sticky top-0 z-30 shadow-sm border-b border-gray-100">
            <div class="flex items-center gap-4">
                <button onclick="toggleSidebar()" class="lg:hidden p-2 hover:bg-gray-100 rounded-lg text-gray-600">
                    <i data-lucide="menu" class="w-6 h-6"></i>
                </button>
                <h2 id="page-title" class="text-xl font-bold text-gray-800 hidden sm:block">Dashboard</h2>
            </div>

            <div class="flex items-center gap-2 sm:gap-3">
                <div class="relative group">
                    <div
                        class="absolute -inset-1 bg-plena-green/20 rounded-lg blur opacity-0 group-hover:opacity-100 transition duration-300">
                    </div>
                    <button onclick="openClosingModal()"
                        class="relative flex items-center px-4 py-2.5 bg-gray-800 text-white rounded-lg text-sm font-medium hover:bg-black transition-all shadow-sm active:scale-95">
                        <i data-lucide="check-circle-2" class="w-4 h-4 sm:mr-2"></i>
                        <span class="hidden sm:inline">Fechar Caixa</span>
                        <span class="sm:hidden">Fechar</span>
                    </button>
                </div>

                <div class="relative group">
                    <div
                        class="absolute -inset-1 bg-plena-blue/20 rounded-lg blur opacity-0 group-hover:opacity-100 transition duration-300">
                    </div>
                    <button onclick="openOrderModal()"
                        class="relative flex items-center px-4 py-2.5 bg-plena-blue text-white rounded-lg text-sm font-bold hover:bg-plena-dark transition-all shadow-lg shadow-blue-200 active:scale-95">
                        <i data-lucide="plus" class="w-5 h-5 sm:mr-2"></i>
                        <span class="hidden sm:inline">Nova O.S.</span>
                        <span class="sm:hidden">Nova</span>
                    </button>
                </div>
            </div>
        </header>

        <!-- Content Area -->
        <div class="p-4 lg:p-8 flex-1 overflow-y-auto">

            <!-- Dashboard View -->
            <section id="view-dashboard" class="view-section fade-in">
                <!-- Stats Cards -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100 card-hover">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-1">Em Andamento
                                </p>
                                <h3 id="dash-active" class="text-3xl font-bold text-plena-blue">0</h3>
                                <p class="text-xs text-gray-500 mt-1">OS ativas</p>
                            </div>
                            <div class="w-12 h-12 rounded-full bg-plena-blue/10 flex items-center justify-center">
                                <i data-lucide="clock" class="w-6 h-6 text-plena-blue"></i>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100 card-hover">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-1">Prontos</p>
                                <h3 id="dash-ready" class="text-3xl font-bold text-green-600">0</h3>
                                <p class="text-xs text-gray-500 mt-1">Aguardando retirada</p>
                            </div>
                            <div class="w-12 h-12 rounded-full bg-green-100 flex items-center justify-center">
                                <i data-lucide="check-circle" class="w-6 h-6 text-green-600"></i>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100 card-hover">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-1">Entregues</p>
                                <h3 id="dash-delivered" class="text-3xl font-bold text-purple-600">0</h3>
                                <p class="text-xs text-gray-500 mt-1">Este mês</p>
                            </div>
                            <div class="w-12 h-12 rounded-full bg-purple-100 flex items-center justify-center">
                                <i data-lucide="package-check" class="w-6 h-6 text-purple-600"></i>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100 card-hover">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-1">Faturamento</p>
                                <h3 id="dash-revenue" class="text-2xl font-bold text-gray-900">R$ 0,00</h3>
                                <p class="text-xs text-gray-500 mt-1">Mês atual</p>
                            </div>
                            <div class="w-12 h-12 rounded-full bg-yellow-100 flex items-center justify-center">
                                <i data-lucide="dollar-sign" class="w-6 h-6 text-yellow-600"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Charts and OS Status -->
                <div class="grid grid-cols-1 xl:grid-cols-3 gap-6 mb-8">
                    <div class="xl:col-span-2 bg-white p-6 rounded-2xl shadow-sm border border-gray-100">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="font-bold text-gray-800">Distribuição por Status</h3>
                        </div>
                        <div id="chart-area" class="chart-container"></div>
                    </div>

                    <!-- Quick Actions -->
                    <div class="space-y-6">
                        <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100">
                            <h3 class="font-bold text-gray-800 mb-4 flex items-center">
                                <i data-lucide="zap" class="w-4 h-4 mr-2 text-plena-blue"></i>
                                Ações Rápidas
                            </h3>
                            <div class="space-y-3">
                                <button onclick="router('orders')"
                                    class="w-full flex items-center justify-between p-3 bg-blue-50 hover:bg-blue-100 rounded-lg transition-colors">
                                    <span class="text-sm font-medium text-blue-700">Ver todas as O.S.</span>
                                    <i data-lucide="arrow-right" class="w-4 h-4 text-blue-500"></i>
                                </button>
                                <button onclick="openClientModal()"
                                    class="w-full flex items-center justify-between p-3 bg-green-50 hover:bg-green-100 rounded-lg transition-colors">
                                    <span class="text-sm font-medium text-green-700">Cadastrar Cliente</span>
                                    <i data-lucide="user-plus" class="w-4 h-4 text-green-500"></i>
                                </button>
                                <button onclick="router('reports')"
                                    class="w-full flex items-center justify-between p-3 bg-purple-50 hover:bg-purple-100 rounded-lg transition-colors">
                                    <span class="text-sm font-medium text-purple-700">Gerar Relatório</span>
                                    <i data-lucide="file-bar-chart" class="w-4 h-4 text-purple-500"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Recent Orders -->
                <div class="mt-8 bg-white p-6 rounded-2xl shadow-sm border border-gray-100">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="font-bold text-gray-800">Ordens de Serviço Recentes</h3>
                        <button onclick="router('orders')"
                            class="text-sm text-plena-blue hover:text-plena-dark font-medium">
                            Ver todas →
                        </button>
                    </div>
                    <div id="recent-orders" class="space-y-3">
                        <!-- Dynamic content -->
                    </div>
                </div>
            </section>

            <!-- Orders View -->
            <section id="view-orders" class="view-section hide fade-in">
                <div class="mb-6 flex flex-col sm:flex-row sm:items-center justify-between gap-4">
                    <div>
                        <h2 class="text-xl font-bold text-gray-800">Ordens de Serviço</h2>
                        <p class="text-sm text-gray-600">Gerencie todas as ordens de serviço</p>
                    </div>
                    <div class="flex items-center gap-3">
                        <button onclick="exportOrdersCSV()"
                            class="flex items-center gap-2 px-4 py-2 bg-green-100 text-green-700 rounded-lg text-sm font-medium hover:bg-green-200 transition-colors">
                            <i data-lucide="download" class="w-4 h-4"></i>
                            Exportar CSV
                        </button>
                        <button onclick="printOrderList()"
                            class="flex items-center gap-2 px-4 py-2 bg-blue-100 text-blue-700 rounded-lg text-sm font-medium hover:bg-blue-200 transition-colors">
                            <i data-lucide="printer" class="w-4 h-4"></i>
                            Imprimir Lista
                        </button>
                    </div>
                </div>

                <!-- Filters -->
                <div class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden mb-6">
                    <div class="p-4 bg-gray-50 grid grid-cols-1 md:grid-cols-4 gap-3 border-b border-gray-200">
                        <div class="relative">
                            <i data-lucide="search" class="absolute left-3 top-3 w-4 h-4 text-gray-400"></i>
                            <input type="text" id="search-order" onkeyup="renderOrders()" placeholder="Buscar..."
                                class="w-full pl-10 pr-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-plena-blue outline-none text-sm">
                        </div>
                        <div>
                            <input type="date" id="filter-start" onchange="renderOrders()"
                                class="w-full border p-2 rounded-lg text-sm bg-white">
                        </div>
                        <div>
                            <input type="date" id="filter-end" onchange="renderOrders()"
                                class="w-full border p-2 rounded-lg text-sm bg-white">
                        </div>
                        <div class="flex gap-2">
                            <select id="filter-status" onchange="renderOrders()"
                                class="flex-1 px-4 py-2 rounded-lg border border-gray-300 text-sm bg-white outline-none">
                                <option value="all">Todos Status</option>
                                <option value="received">Recebido</option>
                                <option value="analyzing">Em Análise</option>
                                <option value="waiting_parts">Aguardando Peça</option>
                                <option value="ready">Pronto</option>
                                <option value="delivered">Entregue</option>
                            </select>
                            <button onclick="clearFilters()"
                                class="px-3 py-2 bg-gray-200 hover:bg-gray-300 rounded-lg text-sm transition-colors">
                                <i data-lucide="x" class="w-4 h-4"></i>
                            </button>
                        </div>
                    </div>

                    <!-- Orders Table -->
                    <div class="overflow-x-auto">
                        <table class="w-full text-left">
                            <thead class="bg-gray-50 text-gray-500 text-xs uppercase">
                                <tr>
                                    <th class="px-6 py-3">Nº O.S.</th>
                                    <th class="px-6 py-3">Cliente</th>
                                    <th class="px-6 py-3">Equipamento</th>
                                    <th class="px-6 py-3">Status</th>
                                    <th class="px-6 py-3">Data Entrada</th>
                                    <th class="px-6 py-3 text-right">Valor</th>
                                    <th class="px-6 py-3 text-center">Ações</th>
                                </tr>
                            </thead>
                            <tbody id="orders-table-body" class="divide-y divide-gray-100 text-sm"></tbody>
                        </table>
                    </div>
                    <div id="empty-msg" class="hidden p-8 text-center text-gray-400">
                        <i data-lucide="clipboard-list" class="w-12 h-12 mx-auto mb-4 text-gray-300"></i>
                        <p>Nenhuma ordem de serviço encontrada.</p>
                    </div>
                </div>

                <!-- Summary -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                    <div class="bg-blue-50 p-4 rounded-xl border border-blue-100">
                        <p class="text-xs text-gray-500 uppercase font-bold mb-1">Em Andamento</p>
                        <p id="filter-active" class="text-lg font-bold text-blue-700">0</p>
                    </div>
                    <div class="bg-yellow-50 p-4 rounded-xl border border-yellow-100">
                        <p class="text-xs text-gray-500 uppercase font-bold mb-1">Aguardando</p>
                        <p id="filter-waiting" class="text-lg font-bold text-yellow-700">0</p>
                    </div>
                    <div class="bg-green-50 p-4 rounded-xl border border-green-100">
                        <p class="text-xs text-gray-500 uppercase font-bold mb-1">Prontos</p>
                        <p id="filter-ready" class="text-lg font-bold text-green-700">0</p>
                    </div>
                    <div class="bg-purple-50 p-4 rounded-xl border border-purple-100">
                        <p class="text-xs text-gray-500 uppercase font-bold mb-1">Total O.S.</p>
                        <p id="filter-total" class="text-lg font-bold text-purple-700">0</p>
                    </div>
                </div>
            </section>

            <!-- Clients View -->
            <section id="view-clients" class="view-section hide fade-in">
                <div class="mb-6 flex flex-col sm:flex-row sm:items-center justify-between gap-4">
                    <div>
                        <h2 class="text-xl font-bold text-gray-800">Clientes</h2>
                        <p class="text-sm text-gray-600">Gerencie seu cadastro de clientes</p>
                    </div>
                    <div class="flex items-center gap-3">
                        <button onclick="openClientModal()"
                            class="flex items-center gap-2 px-4 py-2 bg-plena-blue text-white rounded-lg text-sm font-bold hover:bg-plena-dark transition-colors">
                            <i data-lucide="user-plus" class="w-4 h-4"></i>
                            Novo Cliente
                        </button>
                    </div>
                </div>

                <!-- Clients Table -->
                <div class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden mb-6">
                    <div class="p-4 bg-gray-50 border-b border-gray-200">
                        <div class="relative">
                            <i data-lucide="search" class="absolute left-3 top-3 w-4 h-4 text-gray-400"></i>
                            <input type="text" id="search-client" onkeyup="renderClients()"
                                placeholder="Buscar cliente..."
                                class="w-full pl-10 pr-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-plena-blue outline-none text-sm">
                        </div>
                    </div>

                    <div class="overflow-x-auto">
                        <table class="w-full text-left">
                            <thead class="bg-gray-50 text-gray-500 text-xs uppercase">
                                <tr>
                                    <th class="px-6 py-3">Cliente</th>
                                    <th class="px-6 py-3">Contato</th>
                                    <th class="px-6 py-3">Total O.S.</th>
                                    <th class="px-6 py-3">Última O.S.</th>
                                    <th class="px-6 py-3 text-center">Ações</th>
                                </tr>
                            </thead>
                            <tbody id="clients-table-body" class="divide-y divide-gray-100 text-sm"></tbody>
                        </table>
                    </div>
                    <div id="empty-clients-msg" class="hidden p-8 text-center text-gray-400">
                        <i data-lucide="users" class="w-12 h-12 mx-auto mb-4 text-gray-300"></i>
                        <p>Nenhum cliente cadastrado.</p>
                    </div>
                </div>
            </section>

            <!-- Transactions View -->
            <section id="view-transactions" class="view-section hide fade-in">
                <div class="mb-6 flex flex-col sm:flex-row sm:items-center justify-between gap-4">
                    <div>
                        <h2 class="text-xl font-bold text-gray-800">Fluxo de Caixa</h2>
                        <p class="text-sm text-gray-600">Controle financeiro da assistência</p>
                    </div>
                    <div class="flex items-center gap-3">
                        <button onclick="openTransactionModal()"
                            class="flex items-center gap-2 px-4 py-2 bg-plena-blue text-white rounded-lg text-sm font-bold hover:bg-plena-dark transition-colors">
                            <i data-lucide="plus" class="w-4 h-4"></i>
                            Novo Lançamento
                        </button>
                    </div>
                </div>

                <!-- Stats Cards -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-1">Saldo Total</p>
                                <h3 id="cash-balance" class="text-3xl font-bold text-gray-900">R$ 0,00</h3>
                                <p class="text-xs text-gray-500 mt-1">Disponível</p>
                            </div>
                            <div class="w-12 h-12 rounded-full bg-plena-blue/10 flex items-center justify-center">
                                <i data-lucide="wallet" class="w-6 h-6 text-plena-blue"></i>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-1">Entradas (Mês)
                                </p>
                                <h3 id="cash-income" class="text-2xl font-bold text-green-600">+R$ 0,00</h3>
                                <p class="text-xs text-gray-500 mt-1">Receitas do mês</p>
                            </div>
                            <div class="w-12 h-12 rounded-full bg-green-100 flex items-center justify-center">
                                <i data-lucide="trending-up" class="w-6 h-6 text-green-600"></i>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-1">Saídas (Mês)
                                </p>
                                <h3 id="cash-expense" class="text-2xl font-bold text-red-600">-R$ 0,00</h3>
                                <p class="text-xs text-gray-500 mt-1">Despesas do mês</p>
                            </div>
                            <div class="w-12 h-12 rounded-full bg-red-100 flex items-center justify-center">
                                <i data-lucide="trending-down" class="w-6 h-6 text-red-600"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Transactions Table -->
                <div class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden">
                    <div class="p-4 bg-gray-50 grid grid-cols-1 md:grid-cols-3 gap-3 border-b border-gray-200">
                        <div>
                            <input type="date" id="cash-start" onchange="renderTransactions()"
                                class="w-full border p-2 rounded-lg text-sm bg-white">
                        </div>
                        <div>
                            <input type="date" id="cash-end" onchange="renderTransactions()"
                                class="w-full border p-2 rounded-lg text-sm bg-white">
                        </div>
                        <div class="flex gap-2">
                            <select id="cash-type" onchange="renderTransactions()"
                                class="flex-1 px-4 py-2 rounded-lg border border-gray-300 text-sm bg-white outline-none">
                                <option value="all">Todos</option>
                                <option value="income">Entradas</option>
                                <option value="expense">Saídas</option>
                            </select>
                        </div>
                    </div>

                    <div class="overflow-x-auto">
                        <table class="w-full text-left">
                            <thead class="bg-gray-50 text-gray-500 text-xs uppercase">
                                <tr>
                                    <th class="px-6 py-3">Data</th>
                                    <th class="px-6 py-3">Descrição</th>
                                    <th class="px-6 py-3">Categoria</th>
                                    <th class="px-6 py-3 text-right">Valor</th>
                                    <th class="px-6 py-3 text-center">Ações</th>
                                </tr>
                            </thead>
                            <tbody id="trans-table-body" class="divide-y divide-gray-100 text-sm"></tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Reports View -->
            <section id="view-reports" class="view-section hide fade-in">
                <div class="mb-6">
                    <h2 class="text-xl font-bold text-gray-800 mb-2">Relatórios da Assistência</h2>
                    <p class="text-sm text-gray-600">Gere relatórios detalhados para análise</p>
                </div>

                <!-- Report Cards -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
                    <button onclick="generateMonthlyReport()"
                        class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100 card-hover text-left">
                        <div class="w-12 h-12 rounded-full bg-blue-100 flex items-center justify-center mb-4">
                            <i data-lucide="calendar" class="w-6 h-6 text-plena-blue"></i>
                        </div>
                        <h3 class="font-bold text-gray-800 mb-2">Relatório Mensal</h3>
                        <p class="text-sm text-gray-600">Resumo completo do mês atual</p>
                    </button>

                    <button onclick="generatePerformanceReport()"
                        class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100 card-hover text-left">
                        <div class="w-12 h-12 rounded-full bg-green-100 flex items-center justify-center mb-4">
                            <i data-lucide="trending-up" class="w-6 h-6 text-green-600"></i>
                        </div>
                        <h3 class="font-bold text-gray-800 mb-2">Desempenho</h3>
                        <p class="text-sm text-gray-600">Análise de produtividade</p>
                    </button>

                    <button onclick="generateFinancialReport()"
                        class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100 card-hover text-left">
                        <div class="w-12 h-12 rounded-full bg-purple-100 flex items-center justify-center mb-4">
                            <i data-lucide="dollar-sign" class="w-6 h-6 text-purple-600"></i>
                        </div>
                        <h3 class="font-bold text-gray-800 mb-2">Financeiro</h3>
                        <p class="text-sm text-gray-600">Faturamento e despesas</p>
                    </button>
                </div>

                <!-- Report Results -->
                <div id="report-result" class="hide bg-white p-6 rounded-2xl shadow-sm border border-gray-100">
                    <div id="report-content"></div>
                </div>
            </section>

            <!-- Settings View -->
            <section id="view-settings" class="view-section hide fade-in">
                <div class="mb-6">
                <h2 class="text-xl font-bold text-gray-800 mb-2">Configurações do Sistema</h2>
                <p class="text-sm text-gray-600">Personalize e gerencie suas preferências</p>
            </div>

            <!-- PWA Install Button -->
            <div id="install-card" class="hidden mb-6 bg-gradient-to-r from-plena-blue to-plena-dark rounded-xl p-4 text-white shadow-lg flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <div class="p-2 bg-white/20 rounded-lg backdrop-blur-sm">
                        <i data-lucide="download" class="w-6 h-6 text-white"></i>
                    </div>
                    <div>
                        <h3 class="font-bold text-lg">Instalar Aplicativo</h3>
                        <p class="text-indigo-100 text-sm">Acesso rápido e offline</p>
                    </div>
                </div>
                <button onclick="installPWA()" class="px-4 py-2 bg-white text-plena-blue font-bold rounded-lg shadow-sm hover:bg-indigo-50 transition-colors">
                    Instalar
                </button>
            </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- Company Settings -->
                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100">
                        <h3 class="font-bold text-gray-800 mb-6 flex items-center">
                            <i data-lucide="building" class="w-5 h-5 mr-2 text-plena-blue"></i>
                            Configurações da Empresa
                        </h3>

                        <div class="space-y-4">
                            <div>
                                <label class="text-xs font-bold text-gray-500 uppercase">Nome da Assistência</label>
                                <input type="text" id="company-name" placeholder="Sua Assistência Técnica"
                                    class="w-full border p-2 rounded-lg text-sm">
                            </div>
                            <div>
                                <label class="text-xs font-bold text-gray-500 uppercase">CNPJ / CPF</label>
                                <input type="text" id="company-doc" placeholder="00.000.000/0000-00"
                                    class="w-full border p-2 rounded-lg text-sm">
                            </div>
                            <div>
                                <label class="text-xs font-bold text-gray-500 uppercase">Telefone para Contato</label>
                                <input type="text" id="company-phone" placeholder="(00) 00000-0000"
                                    class="w-full border p-2 rounded-lg text-sm">
                            </div>
                            <div>
                                <label class="text-xs font-bold text-gray-500 uppercase">Endereço</label>
                                <input type="text" id="company-address" placeholder="Endereço completo"
                                    class="w-full border p-2 rounded-lg text-sm">
                            </div>
                            <button onclick="saveCompanySettings()"
                                class="w-full bg-plena-blue text-white py-3 rounded-lg text-sm font-bold hover:bg-plena-dark transition-colors mt-4">
                                Salvar Configurações
                            </button>
                        </div>
                    </div>

                    <!-- Data Management -->
                    <div class="space-y-6">
                        <!-- PWA Install -->
                        <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100 hidden" id="pwa-install-card">
                            <h3 class="font-bold text-gray-800 mb-4 flex items-center">
                                <i data-lucide="download" class="w-5 h-5 mr-2 text-plena-blue"></i>
                                Instalar Aplicativo
                            </h3>
                            <p class="text-sm text-gray-600 mb-4">Instale este sistema como um aplicativo nativo no seu dispositivo para acesso offline e melhor performance.</p>
                            <button onclick="installPWA()" class="w-full bg-plena-blue text-white py-3 rounded-lg text-sm font-bold hover:bg-plena-dark transition-colors flex justify-center items-center gap-2">
                                <i data-lucide="smartphone" class="w-4 h-4"></i>
                                Instalar Agora
                            </button>
                        </div>

                        <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100">
                            <h3 class="font-bold text-gray-800 mb-4 flex items-center">
                                <i data-lucide="shield-alert" class="w-5 h-5 mr-2 text-plena-blue"></i>
                                Segurança de Dados
                            </h3>

                            <div class="bg-blue-50 border border-blue-200 p-4 rounded-lg text-sm text-blue-800 mb-6">
                                <p class="font-bold mb-2">⚠️ Importante</p>
                                <p>Seus dados ficam salvos 100% no navegador. Faça backup regularmente para evitar
                                    perdas!</p>
                            </div>

                            <div class="space-y-3">
                                <button onclick="downloadBackup()"
                                    class="w-full border border-gray-300 py-3 rounded-lg text-sm font-medium hover:bg-gray-50 flex justify-center items-center gap-2">
                                    <i data-lucide="download" class="w-4 h-4"></i>
                                    Baixar Backup Completo (.json)
                                </button>

                                <div class="relative">
                                    <button
                                        class="w-full bg-gray-800 text-white py-3 rounded-lg text-sm font-medium flex justify-center items-center gap-2">
                                        <i data-lucide="upload" class="w-4 h-4"></i>
                                        Restaurar Backup
                                    </button>
                                    <input type="file" onchange="restoreBackup(this)" accept=".json"
                                        class="absolute inset-0 opacity-0 cursor-pointer">
                                </div>
                            </div>
                        </div>

                        <!-- Danger Zone -->
                        <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100">
                            <h3 class="font-bold text-gray-800 mb-4 flex items-center text-red-600">
                                <i data-lucide="alert-triangle" class="w-5 h-5 mr-2"></i>
                                Zona de Perigo
                            </h3>

                            <div class="bg-red-50 p-4 rounded-lg border border-red-100 mb-4">
                                <p class="text-sm text-red-600"><strong>Atenção:</strong> Estas ações são irreversíveis.
                                </p>
                            </div>

                            <div class="grid grid-cols-2 gap-3">
                                <button onclick="clearOldOrders()"
                                    class="py-2.5 border border-red-300 text-red-600 rounded-lg text-sm hover:bg-red-50 transition-colors">
                                    Limpar O.S. Antigas
                                </button>
                                <button onclick="factoryReset()"
                                    class="py-2.5 bg-red-600 text-white rounded-lg text-sm hover:bg-red-700 transition-colors">
                                    Resetar Sistema
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Instructions View - MANUAL COMPLETO PADRONIZADO -->
            <section id="view-instructions" class="view-section hide fade-in">
                <div class="max-w-6xl mx-auto pb-12">
                    <!-- Cabeçalho Hero -->
                    <div class="text-center mb-10 pt-4">
                        <div
                            class="inline-flex items-center justify-center p-4 bg-gradient-to-r from-plena-blue to-plena-dark rounded-2xl mb-4 shadow-lg">
                            <i data-lucide="wrench" class="w-12 h-12 text-white"></i>
                        </div>
                        <h1 class="text-3xl font-bold text-gray-800 mb-2">Manual Completo de Uso</h1>
                        <p class="text-gray-600 text-lg max-w-2xl mx-auto">Guia passo a passo para gestores de
                            assistência técnica</p>
                        <div class="mt-4 flex flex-wrap justify-center gap-2">
                            <span class="px-3 py-1 bg-green-100 text-green-700 rounded-full text-xs font-bold">✓ Para
                                Iniciantes</span>
                            <span class="px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-xs font-bold">📱 Mobile e
                                Desktop</span>
                            <span class="px-3 py-1 bg-purple-100 text-plena-blue rounded-full text-xs font-bold">⚡
                                Rápido e Prático</span>
                        </div>
                    </div>

                    <!-- Barra de Progresso do Tutorial -->
                    <div class="bg-white rounded-2xl p-6 shadow-sm border border-gray-100 mb-8">
                        <h3 class="font-bold text-gray-800 mb-4 flex items-center">
                            <i data-lucide="compass" class="w-5 h-5 mr-2 text-plena-blue"></i>
                            Seu Progresso no Aprendizado
                        </h3>
                        <div class="mb-4">
                            <div class="progress-bar">
                                <div id="tutorial-progress" class="progress-fill" style="width: 0%"></div>
                            </div>
                            <div class="flex justify-between text-xs text-gray-500 mt-2">
                                <span>0% Concluído</span>
                                <span id="completed-steps">0/7 etapas</span>
                            </div>
                        </div>
                        <div class="grid grid-cols-2 md:grid-cols-7 gap-2">
                            <button onclick="scrollToSection('instalacao')"
                                class="tutorial-step text-center p-2 rounded-lg border border-gray-200 hover:bg-gray-50 text-xs">
                                1. Instalação
                            </button>
                            <button onclick="scrollToSection('primeiro-cadastro')"
                                class="tutorial-step text-center p-2 rounded-lg border border-gray-200 hover:bg-gray-50 text-xs">
                                2. Primeiro Cadastro
                            </button>
                            <button onclick="scrollToSection('os-management')"
                                class="tutorial-step text-center p-2 rounded-lg border border-gray-200 hover:bg-gray-50 text-xs">
                                3. Gerenciar O.S.
                            </button>
                            <button onclick="scrollToSection('relatorios')"
                                class="tutorial-step text-center p-2 rounded-lg border border-gray-200 hover:bg-gray-50 text-xs">
                                4. Relatórios
                            </button>
                            <button onclick="scrollToSection('backup')"
                                class="tutorial-step text-center p-2 rounded-lg border border-gray-200 hover:bg-gray-50 text-xs">
                                5. Backup
                            </button>
                            <button onclick="scrollToSection('duvidas')"
                                class="tutorial-step text-center p-2 rounded-lg border border-gray-200 hover:bg-gray-50 text-xs">
                                6. Dúvidas
                            </button>
                            <button onclick="scrollToSection('checklist')"
                                class="tutorial-step text-center p-2 rounded-lg border border-gray-200 hover:bg-gray-50 text-xs">
                                7. Checklist
                            </button>
                        </div>
                    </div>

                    <!-- Seção 1: Instalação -->
                    <div id="instalacao"
                        class="bg-white border border-gray-200 rounded-2xl p-6 shadow-sm mb-8 scroll-mt-24">
                        <div class="flex items-center justify-between mb-6">
                            <div class="flex items-center">
                                <div class="step-number bg-gradient-to-r from-plena-blue to-plena-dark text-white">1
                                </div>
                                <h3 class="text-xl font-bold text-gray-800">Instalação do Sistema</h3>
                            </div>
                            <button onclick="markSectionComplete('instalacao')"
                                class="text-xs text-gray-500 hover:text-green-600">
                                <i data-lucide="check-circle" class="w-4 h-4"></i> Marcar como concluído
                            </button>
                        </div>

                        <div class="bg-gray-900 rounded-2xl p-6 text-white shadow-lg mb-6">
                            <h4 class="font-bold text-lg mb-4 flex items-center">
                                <i data-lucide="download" class="w-5 h-5 mr-2 text-green-400"></i>
                                Torne o App Disponível OFFLINE
                            </h4>
                            <p class="text-gray-300 mb-4">Instale no celular para usar sem internet, igual um app
                                normal:</p>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 text-sm">
                                <div class="bg-white/10 p-4 rounded-xl border border-white/10">
                                    <div class="font-bold text-white mb-3 flex items-center">
                                        <div
                                            class="w-8 h-8 rounded-full bg-blue-600 flex items-center justify-center mr-2">
                                            <i data-lucide="smartphone" class="w-4 h-4"></i>
                                        </div>
                                        Android (Chrome)
                                    </div>
                                    <ol class="list-decimal pl-5 space-y-3 text-gray-300">
                                        <li class="flex items-start">
                                            <span class="mr-2">1.</span>
                                            <div>
                                                <strong>Abra esta página no Chrome</strong>
                                                <p class="text-xs text-gray-400">Não use outros navegadores</p>
                                            </div>
                                        </li>
                                        <li class="flex items-start">
                                            <span class="mr-2">2.</span>
                                            <div>
                                                <strong>Toque nos 3 pontinhos ☰</strong>
                                                <p class="text-xs text-gray-400">Canto superior direito</p>
                                            </div>
                                        </li>
                                        <li class="flex items-start">
                                            <span class="mr-2">3.</span>
                                            <div>
                                                <strong>Toque em "Instalar app" ou "Adicionar à tela inicial"</strong>
                                            </div>
                                        </li>
                                        <li class="flex items-start">
                                            <span class="mr-2">4.</span>
                                            <div>
                                                <strong>Pronto! O ícone aparecerá na sua tela inicial</strong>
                                            </div>
                                        </li>
                                    </ol>
                                </div>
                                <div class="bg-white/10 p-4 rounded-xl border border-white/10">
                                    <div class="font-bold text-white mb-3 flex items-center">
                                        <div
                                            class="w-8 h-8 rounded-full bg-gray-800 flex items-center justify-center mr-2">
                                            <i data-lucide="apple" class="w-4 h-4"></i>
                                        </div>
                                        iPhone (Safari)
                                    </div>
                                    <ol class="list-decimal pl-5 space-y-3 text-gray-300">
                                        <li class="flex items-start">
                                            <span class="mr-2">1.</span>
                                            <div>
                                                <strong>Abra esta página no Safari</strong>
                                                <p class="text-xs text-gray-400">Não use Chrome no iPhone</p>
                                            </div>
                                        </li>
                                        <li class="flex items-start">
                                            <span class="mr-2">2.</span>
                                            <div>
                                                <strong>Toque no ícone de compartilhar</strong>
                                                <p class="text-xs text-gray-400">É o quadrado com seta para cima</p>
                                            </div>
                                        </li>
                                        <li class="flex items-start">
                                            <span class="mr-2">3.</span>
                                            <div>
                                                <strong>Role para baixo e toque em "Adicionar à Tela de Início"</strong>
                                            </div>
                                        </li>
                                        <li class="flex items-start">
                                            <span class="mr-2">4.</span>
                                            <div>
                                                <strong>Toque "Adicionar" no canto superior direito</strong>
                                            </div>
                                        </li>
                                    </ol>
                                </div>
                                <div class="bg-white/10 p-4 rounded-xl border border-white/10">
                                    <div class="font-bold text-white mb-3 flex items-center">
                                        <div
                                            class="w-8 h-8 rounded-full bg-blue-600 flex items-center justify-center mr-2">
                                            <i data-lucide="monitor" class="w-4 h-4"></i>
                                        </div>
                                        Windows (Chrome/Edge)
                                    </div>
                                    <ol class="list-decimal pl-5 space-y-3 text-gray-300">
                                        <li class="flex items-start">
                                            <span class="mr-2">1.</span>
                                            <div>
                                                <strong>Acesse a URL do sistema</strong>
                                            </div>
                                        </li>
                                        <li class="flex items-start">
                                            <span class="mr-2">2.</span>
                                            <div>
                                                <strong>Clique no ícone de instalação</strong>
                                                <p class="text-xs text-gray-400">Localizado na barra de endereços (canto direito)</p>
                                            </div>
                                        </li>
                                        <li class="flex items-start">
                                            <span class="mr-2">3.</span>
                                            <div>
                                                <strong>Confirme a instalação</strong>
                                                <p class="text-xs text-gray-400">O app abrirá em uma janela separada</p>
                                            </div>
                                        </li>
                                    </ol>
                                </div>
                            </div>
                            <div class="mt-6 p-4 bg-yellow-900/30 border border-yellow-700 rounded-xl">
                                <p class="text-yellow-200 text-sm flex items-center">
                                    <i data-lucide="alert-circle" class="w-4 h-4 mr-2"></i>
                                    <strong>Dica:</strong> Depois de instalar, abra o app pelo ícone na tela inicial,
                                    não pelo navegador.
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- Seção 2: Configuração Inicial -->
                    <div id="primeiro-cadastro"
                        class="bg-white border border-gray-200 rounded-2xl p-6 shadow-sm mb-8 scroll-mt-24">
                        <div class="flex items-center justify-between mb-6">
                            <div class="flex items-center">
                                <div class="step-number bg-gradient-to-r from-plena-blue to-plena-dark text-white">2
                                </div>
                                <h3 class="text-xl font-bold text-gray-800">Configuração Inicial (10 Minutos)</h3>
                            </div>
                            <button onclick="markSectionComplete('primeiro-cadastro')"
                                class="text-xs text-gray-500 hover:text-green-600">
                                <i data-lucide="check-circle" class="w-4 h-4"></i> Marcar como concluído
                            </button>
                        </div>

                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <div class="space-y-4">
                                <div class="bg-blue-50 p-5 rounded-xl border border-blue-100">
                                    <h4 class="font-bold text-blue-700 mb-3 flex items-center">
                                        <i data-lucide="building" class="w-5 h-5 mr-2"></i>
                                        PASSO 1: Dados da Assistência
                                    </h4>
                                    <ol class="space-y-3 text-sm">
                                        <li class="flex items-start">
                                            <div
                                                class="w-6 h-6 rounded-full bg-blue-100 text-blue-700 flex items-center justify-center mr-2 text-xs font-bold">
                                                A</div>
                                            <div>
                                                <strong>Clique em "Configurações"</strong>
                                                <p class="text-gray-600 text-xs">Ícone da engrenagem</p>
                                            </div>
                                        </li>
                                        <li class="flex items-start">
                                            <div
                                                class="w-6 h-6 rounded-full bg-blue-100 text-blue-700 flex items-center justify-center mr-2 text-xs font-bold">
                                                B</div>
                                            <div>
                                                <strong>Nome da Assistência</strong>
                                                <p class="text-gray-600 text-xs">Ex: "TechFix Assistência"</p>
                                            </div>
                                        </li>
                                        <li class="flex items-start">
                                            <div
                                                class="w-6 h-6 rounded-full bg-blue-100 text-blue-700 flex items-center justify-center mr-2 text-xs font-bold">
                                                C</div>
                                            <div>
                                                <strong>CNPJ ou CPF</strong>
                                                <p class="text-gray-600 text-xs">Para O.S. impressas</p>
                                            </div>
                                        </li>
                                    </ol>
                                </div>

                                <div class="bg-green-50 p-5 rounded-xl border border-green-100">
                                    <h4 class="font-bold text-green-700 mb-3 flex items-center">
                                        <i data-lucide="clipboard-list" class="w-5 h-5 mr-2"></i>
                                        PASSO 2: Primeira O.S.
                                    </h4>
                                    <ol class="space-y-3 text-sm">
                                        <li class="flex items-start">
                                            <div
                                                class="w-6 h-6 rounded-full bg-green-100 text-green-700 flex items-center justify-center mr-2 text-xs font-bold">
                                                A</div>
                                            <div>
                                                <strong>Volte ao Dashboard</strong>
                                            </div>
                                        </li>
                                        <li class="flex items-start">
                                            <div
                                                class="w-6 h-6 rounded-full bg-green-100 text-green-700 flex items-center justify-center mr-2 text-xs font-bold">
                                                B</div>
                                            <div>
                                                <strong>Clique em "Nova O.S."</strong>
                                                <p class="text-gray-600 text-xs">Botão azul no topo</p>
                                            </div>
                                        </li>
                                        <li class="flex items-start">
                                            <div
                                                class="w-6 h-6 rounded-full bg-green-100 text-green-700 flex items-center justify-center mr-2 text-xs font-bold">
                                                C</div>
                                            <div>
                                                <strong>Preencha os dados:</strong>
                                                <div class="code-block mt-1 text-xs">
                                                    Cliente: "João Silva"<br>
                                                    Equip.: "iPhone 12 Pro"<br>
                                                    Defeito: "Tela quebrada"<br>
                                                    IMEI/Serial: Importante!
                                                </div>
                                            </div>
                                        </li>
                                    </ol>
                                </div>
                            </div>

                            <div class="space-y-4">
                                <div class="bg-purple-50 p-5 rounded-xl border border-purple-100">
                                    <h4 class="font-bold text-plena-blue mb-3 flex items-center">
                                        <i data-lucide="user" class="w-5 h-5 mr-2"></i>
                                        PASSO 3: Dados do Cliente
                                    </h4>
                                    <div class="space-y-2 text-sm">
                                        <div class="flex items-start">
                                            <i data-lucide="check" class="w-4 h-4 text-green-500 mt-0.5 mr-2"></i>
                                            <span><strong>Nome completo</strong></span>
                                        </div>
                                        <div class="flex items-start">
                                            <i data-lucide="check" class="w-4 h-4 text-green-500 mt-0.5 mr-2"></i>
                                            <span><strong>WhatsApp</strong> (enviar orçamentos)</span>
                                        </div>
                                        <div class="flex items-start">
                                            <i data-lucide="check" class="w-4 h-4 text-green-500 mt-0.5 mr-2"></i>
                                            <span><strong>CPF</strong> (opcional)</span>
                                        </div>
                                    </div>
                                    <div class="mt-4 p-3 bg-yellow-50 border border-yellow-200 rounded-lg">
                                        <p class="text-xs text-yellow-800">
                                            <strong>💡 Dica:</strong> WhatsApp é essencial para enviar orçamentos e
                                            avisar quando ficar pronto!
                                        </p>
                                    </div>
                                </div>

                                <div
                                    class="bg-gradient-to-r from-green-50 to-blue-50 p-5 rounded-xl border border-green-200">
                                    <h4 class="font-bold text-gray-800 mb-2 flex items-center">
                                        <i data-lucide="zap" class="w-5 h-5 mr-2 text-green-600"></i>
                                        Configuração Concluída!
                                    </h4>
                                    <p class="text-sm text-gray-700 mb-3">Sistema pronto para uso!</p>
                                    <div class="grid grid-cols-3 gap-2">
                                        <div class="bg-white p-2 rounded-lg text-center">
                                            <i data-lucide="clipboard-list"
                                                class="w-5 h-5 text-plena-blue mx-auto mb-1"></i>
                                            <p class="text-[10px] font-bold">Gerenciar O.S.</p>
                                        </div>
                                        <div class="bg-white p-2 rounded-lg text-center">
                                            <i data-lucide="users" class="w-5 h-5 text-plena-blue mx-auto mb-1"></i>
                                            <p class="text-[10px] font-bold">Clientes</p>
                                        </div>
                                        <div class="bg-white p-2 rounded-lg text-center">
                                            <i data-lucide="printer" class="w-5 h-5 text-plena-blue mx-auto mb-1"></i>
                                            <p class="text-[10px] font-bold">Imprimir</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Seção 3: Gerenciamento de O.S. -->
                        <div id="os-management"
                            class="bg-white border border-gray-200 rounded-2xl p-6 shadow-sm mb-8 scroll-mt-24">
                            <div class="flex items-center justify-between mb-6">
                                <div class="flex items-center">
                                    <div class="step-number bg-gradient-to-r from-plena-blue to-plena-dark text-white">3
                                    </div>
                                    <h3 class="text-xl font-bold text-gray-800">Gerenciamento de Ordens de Serviço</h3>
                                </div>
                                <button onclick="markSectionComplete('os-management')"
                                    class="text-xs text-gray-500 hover:text-green-600">
                                    <i data-lucide="check-circle" class="w-4 h-4"></i> Marcar como concluído
                                </button>
                            </div>

                            <div
                                class="bg-gradient-to-r from-blue-50 to-purple-50 p-5 rounded-xl border border-blue-200 mb-6">
                                <h4 class="font-bold text-gray-800 mb-3 flex items-center">
                                    <i data-lucide="workflow" class="w-5 h-5 mr-2 text-plena-blue"></i>
                                    Fluxo Completo de Trabalho
                                </h4>
                                <div class="grid grid-cols-2 md:grid-cols-5 gap-3 text-xs">
                                    <div class="bg-white p-3 rounded-lg text-center">
                                        <div
                                            class="w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center mx-auto mb-2">
                                            <span class="font-bold text-blue-700">1</span>
                                        </div>
                                        <p class="font-bold text-gray-800">Recebido</p>
                                        <p class="text-gray-600">Cliente traz equip.</p>
                                    </div>
                                    <div class="bg-white p-3 rounded-lg text-center">
                                        <div
                                            class="w-8 h-8 rounded-full bg-yellow-100 flex items-center justify-center mx-auto mb-2">
                                            <span class="font-bold text-yellow-700">2</span>
                                        </div>
                                        <p class="font-bold text-gray-800">Em Análise</p>
                                        <p class="text-gray-600">Diagnóstico</p>
                                    </div>
                                    <div class="bg-white p-3 rounded-lg text-center">
                                        <div
                                            class="w-8 h-8 rounded-full bg-orange-100 flex items-center justify-center mx-auto mb-2">
                                            <span class="font-bold text-orange-700">3</span>
                                        </div>
                                        <p class="font-bold text-gray-800">Orçamento</p>
                                        <p class="text-gray-600">Enviar WhatsApp</p>
                                    </div>
                                    <div class="bg-white p-3 rounded-lg text-center">
                                        <div
                                            class="w-8 h-8 rounded-full bg-green-100 flex items-center justify-center mx-auto mb-2">
                                            <span class="font-bold text-green-700">4</span>
                                        </div>
                                        <p class="font-bold text-gray-800">Em Reparo</p>
                                        <p class="text-gray-600">Executando</p>
                                    </div>
                                    <div class="bg-white p-3 rounded-lg text-center">
                                        <div
                                            class="w-8 h-8 rounded-full bg-purple-100 flex items-center justify-center mx-auto mb-2">
                                            <span class="font-bold text-purple-700">5</span>
                                        </div>
                                        <p class="font-bold text-gray-800">Pronto</p>
                                        <p class="text-gray-600">Avisar cliente</p>
                                    </div>
                                </div>
                            </div>

                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div class="bg-blue-50 p-4 rounded-xl border border-blue-100">
                                    <h5 class="font-bold text-blue-700 mb-2 flex items-center text-sm">
                                        <i data-lucide="clipboard-check" class="w-4 h-4 mr-2"></i>
                                        Dicas para Recebimento
                                    </h5>
                                    <ul class="space-y-1 text-xs text-gray-700">
                                        <li class="flex items-start">
                                            <i data-lucide="check" class="w-3 h-3 text-green-500 mr-2 mt-0.5"></i>
                                            <span>Anote marca, modelo e IMEI/Serial</span>
                                        </li>
                                        <li class="flex items-start">
                                            <i data-lucide="check" class="w-3 h-3 text-green-500 mr-2 mt-0.5"></i>
                                            <span>Descreva defeito relatado</span>
                                        </li>
                                        <li class="flex items-start">
                                            <i data-lucide="check" class="w-3 h-3 text-green-500 mr-2 mt-0.5"></i>
                                            <span>Fotos de marcas/arranhões existentes</span>
                                        </li>
                                    </ul>
                                </div>

                                <div class="bg-green-50 p-4 rounded-xl border border-green-100">
                                    <h5 class="font-bold text-green-700 mb-2 flex items-center text-sm">
                                        <i data-lucide="message-circle" class="w-4 h-4 mr-2"></i>
                                        Comunicação com Cliente
                                    </h5>
                                    <ul class="space-y-1 text-xs text-gray-700">
                                        <li class="flex items-start">
                                            <i data-lucide="check" class="w-3 h-3 text-green-500 mr-2 mt-0.5"></i>
                                            <span>Envie orçamento por WhatsApp</span>
                                        </li>
                                        <li class="flex items-start">
                                            <i data-lucide="check" class="w-3 h-3 text-green-500 mr-2 mt-0.5"></i>
                                            <span>Avise quando ficar pronto</span>
                                        </li>
                                        <li class="flex items-start">
                                            <i data-lucide="check" class="w-3 h-3 text-green-500 mr-2 mt-0.5"></i>
                                            <span>Confirme retirada</span>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <!-- Seção 4: Relatórios -->
                        <div id="relatorios"
                            class="bg-white border border-gray-200 rounded-2xl p-6 shadow-sm mb-8 scroll-mt-24">
                            <div class="flex items-center justify-between mb-6">
                                <div class="flex items-center">
                                    <div class="step-number bg-gradient-to-r from-plena-blue to-plena-dark text-white">4
                                    </div>
                                    <h3 class="text-xl font-bold text-gray-800">Relatórios e Análise</h3>
                                </div>
                                <button onclick="markSectionComplete('relatorios')"
                                    class="text-xs text-gray-500 hover:text-green-600">
                                    <i data-lucide="check-circle" class="w-4 h-4"></i> Marcar como concluído
                                </button>
                            </div>

                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div
                                    class="bg-gradient-to-br from-blue-50 to-white p-5 rounded-xl border border-blue-100">
                                    <div
                                        class="w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center mb-3">
                                        <i data-lucide="calendar" class="w-5 h-5 text-blue-600"></i>
                                    </div>
                                    <h4 class="font-bold text-gray-800 mb-2">Mensal</h4>
                                    <p class="text-xs text-gray-600">Resumo completo de O.S., faturamento e clientes
                                        atendidos</p>
                                </div>

                                <div
                                    class="bg-gradient-to-br from-green-50 to-white p-5 rounded-xl border border-green-100">
                                    <div
                                        class="w-10 h-10 rounded-full bg-green-100 flex items-center justify-center mb-3">
                                        <i data-lucide="trending-up" class="w-5 h-5 text-green-600"></i>
                                    </div>
                                    <h4 class="font-bold text-gray-800 mb-2">Desempenho</h4>
                                    <p class="text-xs text-gray-600">Tempo médio de reparo, equipamentos mais atendidos
                                    </p>
                                </div>

                                <div
                                    class="bg-gradient-to-br from-purple-50 to-white p-5 rounded-xl border border-purple-100">
                                    <div
                                        class="w-10 h-10 rounded-full bg-purple-100 flex items-center justify-center mb-3">
                                        <i data-lucide="dollar-sign" class="w-5 h-5 text-purple-600"></i>
                                    </div>
                                    <h4 class="font-bold text-gray-800 mb-2">Financeiro</h4>
                                    <p class="text-xs text-gray-600">Receitas, despesas e lucratividade</p>
                                </div>
                            </div>
                        </div>

                        <!-- Seção 5: Backup e Segurança -->
                        <div id="backup"
                            class="bg-white border border-gray-200 rounded-2xl p-6 shadow-sm mb-8 scroll-mt-24">
                            <div class="flex items-center justify-between mb-6">
                                <div class="flex items-center">
                                    <div class="step-number bg-gradient-to-r from-plena-blue to-plena-dark text-white">5
                                    </div>
                                    <h3 class="text-xl font-bold text-gray-800">Backup e Segurança dos Dados</h3>
                                </div>
                                <button onclick="markSectionComplete('backup')"
                                    class="text-xs text-gray-500 hover:text-green-600">
                                    <i data-lucide="check-circle" class="w-4 h-4"></i> Marcar como concluído
                                </button>
                            </div>

                            <div class="bg-red-50 border-l-4 border-red-500 p-6 rounded-r-xl mb-6">
                                <h4 class="font-bold text-red-800 mb-3 flex items-center">
                                    <i data-lucide="alert-octagon" class="w-5 h-5 mr-2"></i>
                                    ATENÇÃO: Leia com Cuidado!
                                </h4>
                                <div class="text-sm text-red-800 space-y-2">
                                    <p>📱 <strong>Seus dados ficam APENAS no seu celular/computador.</strong></p>
                                    <p>🔄 <strong>Se você perder o aparelho ou limpar o navegador, perderá TODOS os
                                            dados.</strong></p>
                                    <p>💾 <strong>O backup é SUA responsabilidade.</strong> Faça SEMPRE!</p>
                                </div>
                            </div>

                            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                <div class="bg-green-50 p-5 rounded-xl border border-green-200">
                                    <h4 class="font-bold text-gray-800 mb-4 flex items-center">
                                        <i data-lucide="download" class="w-5 h-5 mr-2 text-green-600"></i>
                                        Como Fazer Backup
                                    </h4>
                                    <ol class="space-y-3 text-sm">
                                        <li class="flex items-start">
                                            <div
                                                class="w-6 h-6 rounded-full bg-green-100 text-green-700 flex items-center justify-center mr-2 text-xs font-bold mt-0.5">
                                                1</div>
                                            <div>
                                                <strong>Acesse Configurações</strong>
                                                <p class="text-gray-600 text-xs">Menu lateral → Engrenagem</p>
                                            </div>
                                        </li>
                                        <li class="flex items-start">
                                            <div
                                                class="w-6 h-6 rounded-full bg-green-100 text-green-700 flex items-center justify-center mr-2 text-xs font-bold mt-0.5">
                                                2</div>
                                            <div>
                                                <strong>Clique "Baixar Backup (.json)"</strong>
                                                <p class="text-gray-600 text-xs">Na seção "Segurança de Dados"</p>
                                            </div>
                                        </li>
                                        <li class="flex items-start">
                                            <div
                                                class="w-6 h-6 rounded-full bg-green-100 text-green-700 flex items-center justify-center mr-2 text-xs font-bold mt-0.5">
                                                3</div>
                                            <div>
                                                <strong>Salve em 2 Lugares</strong>
                                                <p class="text-gray-600 text-xs">Google Drive + WhatsApp (para você
                                                    mesmo)</p>
                                            </div>
                                        </li>
                                    </ol>
                                </div>

                                <div class="bg-blue-50 p-5 rounded-xl border border-blue-200">
                                    <h4 class="font-bold text-gray-800 mb-4 flex items-center">
                                        <i data-lucide="refresh-cw" class="w-5 h-5 mr-2 text-blue-600"></i>
                                        Como Restaurar Backup
                                    </h4>
                                    <ol class="space-y-3 text-sm">
                                        <li class="flex items-start">
                                            <div
                                                class="w-6 h-6 rounded-full bg-blue-100 text-blue-700 flex items-center justify-center mr-2 text-xs font-bold mt-0.5">
                                                1</div>
                                            <div>
                                                <strong>Baixe o arquivo .json</strong>
                                                <p class="text-gray-600 text-xs">Do Drive ou WhatsApp</p>
                                            </div>
                                        </li>
                                        <li class="flex items-start">
                                            <div
                                                class="w-6 h-6 rounded-full bg-blue-100 text-blue-700 flex items-center justify-center mr-2 text-xs font-bold mt-0.5">
                                                2</div>
                                            <div>
                                                <strong>Vá em Configurações</strong>
                                            </div>
                                        </li>
                                        <li class="flex items-start">
                                            <div
                                                class="w-6 h-6 rounded-full bg-blue-100 text-blue-700 flex items-center justify-center mr-2 text-xs font-bold mt-0.5">
                                                3</div>
                                            <div>
                                                <strong>Clique "Restaurar Backup"</strong>
                                                <p class="text-gray-600 text-xs">Selecione o arquivo</p>
                                            </div>
                                        </li>
                                    </ol>
                                </div>
                            </div>

                            <div class="mt-6 bg-yellow-50 border border-yellow-200 rounded-xl p-4">
                                <p class="text-sm text-gray-800 flex items-center">
                                    <i data-lucide="calendar" class="w-5 h-5 text-yellow-600 mr-2"></i>
                                    <strong>Frequência Recomendada:</strong> <span class="ml-2">Faça backup <strong
                                            class="text-yellow-800">TODA SEMANA!</strong></span>
                                </p>
                            </div>
                        </div>

                        <!-- Seção 6: FAQ -->
                        <div id="duvidas"
                            class="bg-white border border-gray-200 rounded-2xl p-6 shadow-sm mb-8 scroll-mt-24">
                            <div class="flex items-center justify-between mb-6">
                                <div class="flex items-center">
                                    <div class="step-number bg-gradient-to-r from-plena-blue to-plena-dark text-white">6
                                    </div>
                                    <h3 class="text-xl font-bold text-gray-800">Dúvidas Frequentes (FAQ)</h3>
                                </div>
                                <button onclick="markSectionComplete('duvidas')"
                                    class="text-xs text-gray-500 hover:text-green-600">
                                    <i data-lucide="check-circle" class="w-4 h-4"></i> Marcar como concluído
                                </button>
                            </div>

                            <div class="space-y-4">
                                <details class="group bg-gray-50 border border-gray-200 rounded-xl overflow-hidden">
                                    <summary
                                        class="flex items-center justify-between p-4 cursor-pointer hover:bg-gray-100 transition-colors select-none">
                                        <div class="flex items-center gap-3 font-bold text-gray-700">
                                            <i data-lucide="help-circle" class="w-5 h-5 text-blue-600"></i>
                                            Perdi meu celular. Como recupero meus dados?
                                        </div>
                                        <i data-lucide="chevron-down"
                                            class="w-5 h-5 text-gray-400 group-open:rotate-180 transition-transform"></i>
                                    </summary>
                                    <div class="p-4 pt-0 border-t border-gray-100">
                                        <p class="text-sm text-gray-600 mt-3"><strong>Resposta:</strong> Se você fez
                                            backup regularmente:</p>
                                        <ol class="list-decimal pl-5 space-y-1 text-sm text-gray-600 mt-2">
                                            <li>Instale o app novamente</li>
                                            <li>Baixe seu backup (Drive/WhatsApp)</li>
                                            <li>Vá em Configurações → "Restaurar Backup"</li>
                                            <li>Selecione o arquivo .json</li>
                                        </ol>
                                        <div class="bg-yellow-50 p-3 rounded-lg mt-3">
                                            <p class="text-xs text-yellow-800"><strong>Importante:</strong> Se NÃO fez
                                                backup, os dados estão perdidos.</p>
                                        </div>
                                    </div>
                                </details>

                                <details class="group bg-gray-50 border border-gray-200 rounded-xl overflow-hidden">
                                    <summary
                                        class="flex items-center justify-between p-4 cursor-pointer hover:bg-gray-100 transition-colors select-none">
                                        <div class="flex items-center gap-3 font-bold text-gray-700">
                                            <i data-lucide="smartphone" class="w-5 h-5 text-green-600"></i>
                                            O app funciona sem internet?
                                        </div>
                                        <i data-lucide="chevron-down"
                                            class="w-5 h-5 text-gray-400 group-open:rotate-180 transition-transform"></i>
                                    </summary>
                                    <div class="p-4 pt-0 border-t border-gray-100">
                                        <p class="text-sm text-gray-600 mt-3"><strong>Resposta:</strong> Sim! O sistema
                                            funciona 100% OFFLINE.</p>
                                        <ul class="list-disc pl-5 space-y-1 text-sm text-gray-600 mt-2">
                                            <li>Cadastre O.S. sem internet</li>
                                            <li>Gerencie tudo localmente</li>
                                            <li>Imprima recibos offline</li>
                                        </ul>
                                        <p class="text-xs text-gray-500 mt-2"><strong>Nota:</strong> Para enviar
                                            WhatsApp você precisa de internet.</p>
                                    </div>
                                </details>

                                <details class="group bg-gray-50 border border-gray-200 rounded-xl overflow-hidden">
                                    <summary
                                        class="flex items-center justify-between p-4 cursor-pointer hover:bg-gray-100 transition-colors select-none">
                                        <div class="flex items-center gap-3 font-bold text-gray-700">
                                            <i data-lucide="printer" class="w-5 h-5 text-purple-600"></i>
                                            Como imprimir uma O.S.?
                                        </div>
                                        <i data-lucide="chevron-down"
                                            class="w-5 h-5 text-gray-400 group-open:rotate-180 transition-transform"></i>
                                    </summary>
                                    <div class="p-4 pt-0 border-t border-gray-100">
                                        <p class="text-sm text-gray-600 mt-3"><strong>Resposta:</strong> Clique no ícone
                                            da impressora ao lado da O.S.</p>
                                        <p class="text-sm text-gray-600 mt-2">Será aberta a janela de impressão com
                                            todos os dados formatados profissionalmente.</p>
                                    </div>
                                </details>
                            </div>
                        </div>

                        <!-- Seção 7: Checklist Interativo -->
                        <div id="checklist"
                            class="bg-white border border-gray-200 rounded-2xl p-6 shadow-sm mb-8 scroll-mt-24">
                            <div class="flex items-center justify-between mb-6">
                                <div class="flex items-center">
                                    <div class="step-number bg-gradient-to-r from-plena-blue to-plena-dark text-white">7
                                    </div>
                                    <h3 class="text-xl font-bold text-gray-800">Checklist Interativo - Sua Rotina</h3>
                                </div>
                                <button onclick="markSectionComplete('checklist')"
                                    class="text-xs text-gray-500 hover:text-green-600">
                                    <i data-lucide="check-circle" class="w-4 h-4"></i> Marcar como concluído
                                </button>
                            </div>

                            <div class="bg-gradient-to-r from-gray-800 to-gray-900 rounded-2xl p-6 text-white mb-6">
                                <div class="flex items-center justify-between mb-4">
                                    <h4 class="font-bold text-lg">Progresso do Checklist</h4>
                                    <div class="text-right">
                                        <div class="text-2xl font-bold" id="checklist-percent">0%</div>
                                        <div class="text-xs text-gray-400"><span id="checklist-completed">0</span>/<span
                                                id="checklist-total">0</span> tarefas</div>
                                    </div>
                                </div>
                                <div class="progress-bar mb-4">
                                    <div id="checklist-progress" class="progress-fill" style="width: 0%"></div>
                                </div>
                                <div id="next-tasks" class="space-y-2">
                                    <p class="text-xs text-gray-400">Marque as tarefas abaixo para acompanhar seu
                                        progresso</p>
                                </div>
                            </div>

                            <div class="space-y-4">
                                <div class="bg-blue-50 p-4 rounded-xl border border-blue-200">
                                    <h5 class="font-bold text-blue-700 mb-3 flex items-center">
                                        <i data-lucide="sunrise" class="w-4 h-4 mr-2"></i>
                                        Início da Semana
                                    </h5>
                                    <div class="space-y-2">
                                        <div class="checklist-item">
                                            <label class="flex items-center text-sm cursor-pointer">
                                                <input type="checkbox" id="check-1" onchange="updateChecklist()"
                                                    class="mr-2">
                                                <span for="check-1">Verificar O.S. prontas para entrega</span>
                                            </label>
                                        </div>
                                        <div class="checklist-item">
                                            <label class="flex items-center text-sm cursor-pointer">
                                                <input type="checkbox" id="check-2" onchange="updateChecklist()"
                                                    class="mr-2">
                                                <span for="check-2">Entrar em contato com clientes que têm equipamentos
                                                    prontos</span>
                                            </label>
                                        </div>
                                        <div class="checklist-item">
                                            <label class="flex items-center text-sm cursor-pointer">
                                                <input type="checkbox" id="check-3" onchange="updateChecklist()"
                                                    class="mr-2">
                                                <span for="check-3">Fazer backup semanal dos dados</span>
                                            </label>
                                        </div>
                                    </div>
                                </div>

                                <div class="bg-green-50 p-4 rounded-xl border border-green-200">
                                    <h5 class="font-bold text-green-700 mb-3 flex items-center">
                                        <i data-lucide="zap" class="w-4 h-4 mr-2"></i>
                                        Durante a Semana
                                    </h5>
                                    <div class="space-y-2">
                                        <div class="checklist-item">
                                            <label class="flex items-center text-sm cursor-pointer">
                                                <input type="checkbox" id="check-4" onchange="updateChecklist()"
                                                    class="mr-2">
                                                <span for="check-4">Atualizar status das O.S. em andamento</span>
                                            </label>
                                        </div>
                                        <div class="checklist-item">
                                            <label class="flex items-center text-sm cursor-pointer">
                                                <input type="checkbox" id="check-5" onchange="updateChecklist()"
                                                    class="mr-2">
                                                <span for="check-5">Registrar diagnósticos e orçamentos</span>
                                            </label>
                                        </div>
                                        <div class="checklist-item">
                                            <label class="flex items-center text-sm cursor-pointer">
                                                <input type="checkbox" id="check-6" onchange="updateChecklist()"
                                                    class="mr-2">
                                                <span for="check-6">Responder dúvidas de clientes por WhatsApp</span>
                                            </label>
                                        </div>
                                    </div>
                                </div>

                                <div class="bg-purple-50 p-4 rounded-xl border border-purple-200">
                                    <h5 class="font-bold text-purple-700 mb-3 flex items-center">
                                        <i data-lucide="sunset" class="w-4 h-4 mr-2"></i>
                                        Fim da Semana
                                    </h5>
                                    <div class="space-y-2">
                                        <div class="checklist-item">
                                            <label class="flex items-center text-sm cursor-pointer">
                                                <input type="checkbox" id="check-7" onchange="updateChecklist()"
                                                    class="mr-2">
                                                <span for="check-7">Gerar relatório semanal de faturamento</span>
                                            </label>
                                        </div>
                                        <div class="checklist-item">
                                            <label class="flex items-center text-sm cursor-pointer">
                                                <input type="checkbox" id="check-8" onchange="updateChecklist()"
                                                    class="mr-2">
                                                <span for="check-8">Fazer backup completo dos dados</span>
                                            </label>
                                        </div>
                                        <div class="checklist-item">
                                            <label class="flex items-center text-sm cursor-pointer">
                                                <input type="checkbox" id="check-9" onchange="updateChecklist()"
                                                    class="mr-2">
                                                <span for="check-9">Planejar próxima semana</span>
                                            </label>
                                        </div>
                                    </div>
                                </div>

                                <div class="bg-orange-50 p-4 rounded-xl border border-orange-200">
                                    <h5 class="font-bold text-orange-700 mb-3 flex items-center">
                                        <i data-lucide="plus-circle" class="w-4 h-4 mr-2"></i>
                                        Ao Receber Nova O.S.
                                    </h5>
                                    <div class="space-y-2">
                                        <div class="checklist-item">
                                            <label class="flex items-center text-sm cursor-pointer">
                                                <input type="checkbox" id="check-10" onchange="updateChecklist()"
                                                    class="mr-2">
                                                <span for="check-10">Cadastrar cliente (se novo)</span>
                                            </label>
                                        </div>
                                        <div class="checklist-item">
                                            <label class="flex items-center text-sm cursor-pointer">
                                                <input type="checkbox" id="check-11" onchange="updateChecklist()"
                                                    class="mr-2">
                                                <span for="check-11">Anotar equipamento, marca, modelo e IMEI</span>
                                            </label>
                                        </div>
                                        <div class="checklist-item">
                                            <label class="flex items-center text-sm cursor-pointer">
                                                <input type="checkbox" id="check-12" onchange="updateChecklist()"
                                                    class="mr-2">
                                                <span for="check-12">Gerar número da O.S. e imprimir via de
                                                    entrada</span>
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="mt-6 flex justify-center">
                                <button onclick="resetChecklist()"
                                    class="px-4 py-2 bg-red-100 text-red-700 rounded-lg text-sm hover:bg-red-200 transition-colors">
                                    <i data-lucide="rotate-ccw" class="w-4 h-4 inline mr-2"></i>
                                    Reiniciar Checklist
                                </button>
                            </div>
                        </div>

                        <!-- Rodapé do Manual -->
                        <div class="mt-10 bg-white border border-gray-200 rounded-2xl p-8 text-center shadow-sm">
                            <h3 class="text-lg font-bold text-gray-800 mb-2">Dúvidas Técnicas?</h3>
                            <p class="text-gray-500 text-sm mb-6">
                                Nossa equipe de suporte responde em até 24h úteis.
                            </p>
                            <a href="mailto:tecnologia@plenainformatica.com.br"
                                class="inline-flex items-center text-plena-blue font-bold hover:underline">
                                <i data-lucide="mail" class="w-5 h-5 mr-2"></i>
                                tecnologia@plenainformatica.com.br
                            </a>
                        </div>

                        <div class="text-center mt-8">
                            <p class="text-[10px] text-gray-400">Versão 4.1 Pro • Plena Soluções Digitais</p>
                        </div>

                    </div>
            </section>

            <!-- About View -->
            <section id="view-about" class="view-section hide fade-in">
                <div class="max-w-4xl mx-auto pb-12">
                    <div class="bg-white p-8 rounded-2xl shadow-sm border border-gray-100">
                        <div class="text-center mb-10">
                            <div
                                class="w-20 h-20 rounded-full bg-gradient-to-r from-plena-blue to-plena-dark flex items-center justify-center mx-auto mb-4 shadow-lg shadow-blue-200">
                                <i data-lucide="wrench" class="w-10 h-10 text-white"></i>
                            </div>
                            <h2 class="text-3xl font-bold text-gray-800 mb-1">Plena Soluções Digitais</h2>
                            <p class="text-gray-500 font-medium">Tecnologia acessível para assistências técnicas
                            </p>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                            <div class="bg-gray-50 p-6 rounded-xl border border-gray-100">
                                <h3 class="font-bold text-gray-800 mb-3 flex items-center">
                                    <i data-lucide="lock" class="w-5 h-5 mr-2 text-plena-blue"></i>
                                    Licença de Uso
                                </h3>
                                <p class="text-sm text-gray-600 leading-relaxed text-justify">
                                    Ao adquirir este software, você recebe uma licença de uso <strong>pessoal e
                                        intransferível</strong>. É proibida a revenda, distribuição pública,
                                    engenharia
                                    reversa ou modificação do código-fonte sem autorização expressa da Plena
                                    Soluções
                                    Digitais, sob pena da Lei de Direitos Autorais (9.610/98).
                                </p>
                            </div>

                            <div class="bg-gray-50 p-6 rounded-xl border border-gray-100">
                                <h3 class="font-bold text-gray-800 mb-3 flex items-center">
                                    <i data-lucide="shield-check" class="w-5 h-5 mr-2 text-green-600"></i>
                                    Privacidade e LGPD
                                </h3>
                                <p class="text-sm text-gray-600 leading-relaxed text-justify">
                                    Adotamos o conceito <em>Privacy by Design</em>. Este software opera em modo
                                    <strong>Local-First (Offline)</strong>. Nenhum dado financeiro ou pessoal
                                    dos seus
                                    clientes é enviado para nossos servidores. O controle e a responsabilidade
                                    pela
                                    guarda dos dados (backups) são exclusivamente do usuário.
                                </p>
                            </div>
                        </div>

                        <div class="bg-red-50 border-l-4 border-red-500 p-6 rounded-r-xl mb-8">
                            <h3 class="font-bold text-red-800 mb-2 flex items-center uppercase text-sm tracking-wide">
                                <i data-lucide="alert-triangle" class="w-4 h-4 mr-2"></i>
                                Termo de Isenção de Responsabilidade
                            </h3>
                            <div class="text-xs text-red-800 space-y-2 leading-relaxed text-justify opacity-90">
                                <p>
                                    1. <strong>Natureza da Ferramenta:</strong> Este software é uma ferramenta
                                    auxiliar
                                    de gestão e organização. Ele não substitui o controle contábil oficial da
                                    sua
                                    empresa.
                                    A Plena não se responsabiliza por erros operacionais ou perda de garantias
                                    de
                                    serviços.
                                </p>
                                <p>
                                    2. <strong>Perda de Dados:</strong> O usuário reconhece que o armazenamento
                                    é local
                                    (no navegador). A Plena não possui cópia dos seus dados e não pode
                                    recuperá-los em
                                    caso de formatação de dispositivo, limpeza de cache ou roubo, caso o usuário
                                    não
                                    tenha realizado os backups recomendados.
                                </p>
                            </div>
                        </div>

                        <div
                            class="border-t border-gray-100 pt-8 flex flex-col md:flex-row justify-between items-center gap-4">
                            <div class="text-center md:text-left">
                                <p class="text-sm font-bold text-gray-800">Suporte Oficial</p>
                                <a href="mailto:tecnologia@plenainformatica.com.br"
                                    class="text-sm text-plena-blue hover:underline">tecnologia@plenainformatica.com.br</a>
                            </div>
                            <div class="text-center md:text-right">
                                <p class="text-xs text-gray-400">Desenvolvido por Plena Soluções Digitais LTDA
                                </p>
                                <p class="text-xs text-gray-300">CNPJ: 17.347.919/0001-59 • v4.1 Pro</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

        </div>
    </main>

    <!-- Order Modal -->
    <div id="orderModal" class="fixed inset-0 modal-backdrop hidden z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center p-6 border-b sticky top-0 bg-white z-10">
                <h3 class="text-lg font-bold text-gray-800" id="order-modal-title">Nova Ordem de Serviço</h3>
                <button onclick="closeModal('orderModal')" class="text-gray-400 hover:text-gray-600">
                    <i data-lucide="x"></i>
                </button>
            </div>

            <form onsubmit="submitOrder(event)" class="p-6 space-y-6">
                <input type="hidden" id="order-id">

                <!-- Client Info -->
                <div class="bg-blue-50 p-4 rounded-xl border border-blue-100">
                    <h4 class="text-sm font-bold text-plena-blue mb-4 flex items-center">
                        <i data-lucide="user" class="w-4 h-4 mr-2"></i>
                        Dados do Cliente
                    </h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="text-xs font-bold text-gray-500 uppercase">Nome do Cliente *</label>
                            <input type="text" id="order-client" required
                                class="w-full border p-2 rounded-lg bg-white focus:border-plena-blue outline-none"
                                placeholder="Nome completo">
                        </div>
                        <div>
                            <label class="text-xs font-bold text-gray-500 uppercase">WhatsApp/Telefone</label>
                            <input type="text" id="order-phone"
                                class="w-full border p-2 rounded-lg bg-white focus:border-plena-blue outline-none"
                                placeholder="(00) 00000-0000">
                        </div>
                    </div>
                </div>

                <!-- Device Info -->
                <div class="bg-gray-50 p-4 rounded-xl border border-gray-100">
                    <h4 class="text-sm font-bold text-gray-800 mb-4 flex items-center">
                        <i data-lucide="smartphone" class="w-4 h-4 mr-2"></i>
                        Equipamento
                    </h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="text-xs font-bold text-gray-500 uppercase">Tipo de Equipamento *</label>
                            <input type="text" id="order-device" required
                                class="w-full border p-2 rounded-lg bg-white focus:border-plena-blue outline-none"
                                placeholder="Ex: iPhone 11, Notebook Dell, etc.">
                        </div>
                        <div>
                            <label class="text-xs font-bold text-gray-500 uppercase">Marca</label>
                            <input type="text" id="order-brand"
                                class="w-full border p-2 rounded-lg bg-white focus:border-plena-blue outline-none"
                                placeholder="Ex: Apple, Samsung, etc.">
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="text-xs font-bold text-gray-500 uppercase">Número de Série/IMEI</label>
                            <input type="text" id="order-serial"
                                class="w-full border p-2 rounded-lg bg-white font-mono focus:border-plena-blue outline-none"
                                placeholder="Opcional">
                        </div>
                        <div>
                            <label class="text-xs font-bold text-gray-500 uppercase">Senha/Acesso</label>
                            <input type="text" id="order-password"
                                class="w-full border p-2 rounded-lg bg-yellow-50 focus:border-plena-blue outline-none"
                                placeholder="Senha do dispositivo">
                        </div>
                    </div>
                </div>

                <!-- Problem & Diagnosis -->
                <div class="space-y-4">
                    <div>
                        <label class="text-xs font-bold text-gray-500 uppercase">Defeito Relatado *</label>
                        <textarea id="order-problem" required rows="3"
                            class="w-full border p-2 rounded-lg bg-white focus:border-plena-blue outline-none"
                            placeholder="Descreva o problema conforme relatado pelo cliente..."></textarea>
                    </div>
                    <div>
                        <label class="text-xs font-bold text-gray-500 uppercase">Diagnóstico/Serviço</label>
                        <textarea id="order-diagnosis" rows="3"
                            class="w-full border p-2 rounded-lg bg-white focus:border-plena-blue outline-none"
                            placeholder="Laudo técnico e serviço a ser realizado..."></textarea>
                    </div>
                </div>

                <!-- Accessories -->
                <div>
                    <label class="text-xs font-bold text-gray-500 uppercase mb-2 block">Acessórios Recebidos</label>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                        <label
                            class="flex items-center gap-2 p-2 bg-gray-50 rounded-lg cursor-pointer hover:bg-gray-100">
                            <input type="checkbox" id="acc-charger" class="rounded">
                            <span class="text-sm">Carregador</span>
                        </label>
                        <label
                            class="flex items-center gap-2 p-2 bg-gray-50 rounded-lg cursor-pointer hover:bg-gray-100">
                            <input type="checkbox" id="acc-case" class="rounded">
                            <span class="text-sm">Capa/Proteção</span>
                        </label>
                        <label
                            class="flex items-center gap-2 p-2 bg-gray-50 rounded-lg cursor-pointer hover:bg-gray-100">
                            <input type="checkbox" id="acc-chip" class="rounded">
                            <span class="text-sm">Chip/SD</span>
                        </label>
                        <label
                            class="flex items-center gap-2 p-2 bg-gray-50 rounded-lg cursor-pointer hover:bg-gray-100">
                            <input type="checkbox" id="acc-box" class="rounded">
                            <span class="text-sm">Caixa</span>
                        </label>
                    </div>
                </div>

                <!-- Values -->
                <div class="bg-gray-50 p-4 rounded-xl border border-gray-100">
                    <h4 class="text-sm font-bold text-gray-800 mb-4 flex items-center">
                        <i data-lucide="dollar-sign" class="w-4 h-4 mr-2"></i>
                        Valores
                    </h4>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <label class="text-xs font-bold text-gray-500 uppercase">Peças (R$)</label>
                            <input type="number" step="0.01" id="order-parts"
                                class="w-full border p-2 rounded-lg bg-white focus:border-plena-blue outline-none"
                                placeholder="0.00" value="0">
                        </div>
                        <div>
                            <label class="text-xs font-bold text-gray-500 uppercase">Mão de Obra (R$)</label>
                            <input type="number" step="0.01" id="order-labor"
                                class="w-full border p-2 rounded-lg bg-white focus:border-plena-blue outline-none"
                                placeholder="0.00" value="0">
                        </div>
                        <div>
                            <label class="text-xs font-bold text-gray-500 uppercase">Desconto (R$)</label>
                            <input type="number" step="0.01" id="order-discount"
                                class="w-full border p-2 rounded-lg bg-white focus:border-plena-blue outline-none text-red-500"
                                placeholder="0.00" value="0">
                        </div>
                    </div>
                    <div class="mt-4 pt-4 border-t border-gray-200">
                        <div class="flex justify-between items-center">
                            <span class="font-bold text-gray-800">Total:</span>
                            <span id="order-total" class="text-2xl font-bold text-plena-blue">R$ 0,00</span>
                        </div>
                    </div>
                </div>

                <div class="sticky bottom-0 bg-white pt-4 border-t">
                    <button type="submit"
                        class="w-full bg-plena-blue text-white py-4 rounded-xl font-bold hover:bg-plena-dark transition-all text-lg shadow-lg">
                        Salvar Ordem de Serviço
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Order View Modal -->
    <div id="orderViewModal" class="fixed inset-0 modal-backdrop hidden z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center p-6 border-b sticky top-0 bg-white z-10">
                <div>
                    <h3 class="text-lg font-bold text-gray-800">Ordem de Serviço</h3>
                    <p id="view-os-number" class="text-sm text-gray-500">#0000</p>
                </div>
                <button onclick="closeModal('orderViewModal')" class="text-gray-400 hover:text-gray-600">
                    <i data-lucide="x"></i>
                </button>
            </div>

            <div id="invoice-print" class="p-8 space-y-6 bg-white">
                <!-- Data injected via updatePrintHeaders() -->
                <div class="print-header"></div>

                <!-- OS Info Row -->
                <div class="flex justify-between items-center bg-gray-50 p-4 border rounded-lg mb-6">
                    <div>
                        <p class="text-xs text-gray-500 uppercase font-bold">Ordem de Serviço</p>
                        <p id="view-os-id" class="text-2xl font-mono font-bold text-gray-800">#0000</p>
                    </div>
                    <div class="text-right">
                        <p id="view-os-status" class="text-sm font-bold bg-white px-3 py-1 rounded border">Status: --
                        </p>
                        <p id="view-os-date" class="text-xs text-gray-500 mt-1">Data: --/--/----</p>
                    </div>
                </div>

                <!-- Main Content Grid -->
                <div class="grid grid-cols-2 gap-8 mb-6">
                    <!-- Client -->
                    <div class="border border-gray-200 rounded-lg p-4">
                        <h4 class="text-xs font-bold text-gray-400 uppercase border-b pb-2 mb-3">Dados do Cliente</h4>
                        <div class="space-y-1">
                            <p id="view-client" class="font-bold text-gray-800 text-lg">--</p>
                            <p id="view-phone" class="text-sm text-gray-600">--</p>
                        </div>
                    </div>

                    <!-- Device -->
                    <div class="border border-gray-200 rounded-lg p-4">
                        <h4 class="text-xs font-bold text-gray-400 uppercase border-b pb-2 mb-3">Equipamento</h4>
                        <div class="space-y-1">
                            <p id="view-device" class="font-bold text-gray-800">--</p>
                            <p id="view-serial" class="text-xs text-gray-500">S/N: --</p>
                            <p id="view-accessories" class="text-xs text-gray-500 italic">Acessórios: --</p>
                        </div>
                    </div>
                </div>

                <!-- Technical Details -->
                <div class="border border-gray-200 rounded-lg overflow-hidden mb-6">
                    <div class="grid grid-cols-1 border-b border-gray-200 p-4 bg-gray-50">
                        <h4 class="text-xs font-bold text-gray-400 uppercase">Defeito Relatado</h4>
                        <p id="view-problem" class="text-gray-800 text-sm mt-1">--</p>
                    </div>
                    <div class="p-4 bg-white">
                        <h4 class="text-xs font-bold text-gray-400 uppercase">Laudo Técnico / Serviço</h4>
                        <p id="view-diagnosis" class="text-gray-800 text-sm mt-1">--</p>
                    </div>
                </div>

                <!-- Financial Summary -->
                <div class="flex justify-end">
                    <div class="w-1/2 border border-gray-200 rounded-lg p-4 bg-gray-50">
                        <h4 class="text-xs font-bold text-gray-400 uppercase border-b pb-2 mb-3">Resumo Financeiro</h4>
                        <div class="space-y-2 text-sm">
                            <div class="flex justify-between text-gray-600">
                                <span>Peças</span>
                                <span id="view-parts">R$ 0,00</span>
                            </div>
                            <div class="flex justify-between text-gray-600">
                                <span>Mão de Obra</span>
                                <span id="view-labor">R$ 0,00</span>
                            </div>
                            <div class="flex justify-between text-red-500">
                                <span>Descontos</span>
                                <span id="view-discount">-R$ 0,00</span>
                            </div>
                            <div class="flex justify-between border-t border-gray-300 pt-2 mt-2">
                                <span class="font-bold text-gray-900 text-lg">TOTAL</span>
                                <span id="view-total" class="font-bold text-xl text-gray-900">R$ 0,00</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Legal Terms & Signatures -->
                <div class="mt-8 border-t-2 border-dashed border-gray-200 pt-6">
                    <div class="text-[10px] text-gray-500 text-justify leading-relaxed mb-12">
                        <p class="mb-2"><strong>TERMOS DE GARANTIA:</strong> A garantia cobre apenas defeitos de
                            fabricação das peças substituídas e falhas na mão de obra executada, pelo prazo legal de 90
                            dias (Art. 26, II do CDC). A garantia é anulada automaticamente em caso de: mau uso, quedas,
                            contato com líquidos, oxidação, descarga elétrica ou violação do selo de garantia.</p>
                        <p><strong>ABANDONO:</strong> Conforme Art. 1.275 do Código Civil, aparelhos não retirados no
                            prazo de 90 dias após notificação de conclusão serão considerados abandonados, podendo ser
                            descartados ou vendidos para custear despesas de armazenamento e reparo.</p>
                    </div>

                    <div class="flex justify-between gap-8">
                        <div class="flex-1 border-t border-gray-400 pt-2 text-center">
                            <p class="text-xs font-bold text-gray-600">Assinatura do Técnico</p>
                        </div>
                        <div class="flex-1 border-t border-gray-400 pt-2 text-center">
                            <p class="text-xs font-bold text-gray-600">Assinatura do Cliente</p>
                            <p class="text-[10px] text-gray-400">Declaro estar ciente e de acordo com os serviços.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="bg-gray-50 p-6 border-t space-y-4 print:hidden">
                <div class="flex items-center gap-3 bg-white p-3 rounded-lg border">
                    <span class="text-sm font-bold text-gray-500">Status:</span>
                    <select id="view-status-select" onchange="updateOrderStatus(this.value)"
                        class="flex-1 border-none bg-transparent font-bold text-gray-800 outline-none cursor-pointer">
                        <option value="received">📥 Recebido</option>
                        <option value="analyzing">🔍 Em Análise</option>
                        <option value="waiting_parts">⚙️ Aguardando Peça</option>
                        <option value="ready">✅ Pronto</option>
                        <option value="delivered">🚀 Entregue</option>
                    </select>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
                    <button onclick="editCurrentOrder()"
                        class="bg-white border border-gray-300 py-3 rounded-lg font-bold hover:bg-gray-50 flex justify-center items-center gap-2">
                        <i data-lucide="edit" class="w-4 h-4"></i> Editar
                    </button>
                    <button onclick="shareOrderWhatsApp()"
                        class="bg-[#25D366] text-white py-3 rounded-lg font-bold hover:bg-[#128C7E] flex justify-center items-center gap-2">
                        <i data-lucide="message-circle" class="w-4 h-4"></i> WhatsApp
                    </button>
                    <button onclick="window.print()"
                        class="bg-plena-blue text-white py-3 rounded-lg font-bold hover:bg-plena-dark flex justify-center items-center gap-2">
                        <i data-lucide="printer" class="w-4 h-4"></i> Imprimir
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Transaction Modal -->
    <div id="transactionModal" class="fixed inset-0 modal-backdrop hidden z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md transform transition-all p-6">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-lg font-bold text-gray-800">Novo Lançamento</h3>
                <button onclick="closeModal('transactionModal')" class="text-gray-400 hover:text-gray-600">
                    <i data-lucide="x"></i>
                </button>
            </div>

            <form onsubmit="submitTransaction(event)" class="space-y-4">
                <input type="hidden" id="trans-id">

                <div class="grid grid-cols-2 gap-3 p-1 bg-gray-100 rounded-lg">
                    <label class="cursor-pointer text-center">
                        <input type="radio" name="trans-type" value="income" class="peer hidden" checked>
                        <div
                            class="py-2 text-sm font-bold text-gray-500 rounded-md peer-checked:bg-white peer-checked:text-green-600 shadow-sm transition-all">
                            Entrada
                        </div>
                    </label>
                    <label class="cursor-pointer text-center">
                        <input type="radio" name="trans-type" value="expense" class="peer hidden">
                        <div
                            class="py-2 text-sm font-bold text-gray-500 rounded-md peer-checked:bg-white peer-checked:text-red-600 shadow-sm transition-all">
                            Saída
                        </div>
                    </label>
                </div>

                <div>
                    <label class="text-xs font-bold text-gray-500 uppercase">Valor (R$)</label>
                    <input type="number" id="trans-amount" step="0.01" min="0.01" required
                        class="w-full border-2 border-gray-200 p-3 rounded-xl text-lg font-bold focus:border-plena-blue outline-none"
                        placeholder="0,00">
                </div>

                <div>
                    <label class="text-xs font-bold text-gray-500 uppercase">Descrição</label>
                    <input type="text" id="trans-desc" required
                        class="w-full border p-2 rounded-lg text-sm focus:border-plena-blue outline-none"
                        placeholder="Ex: Pagamento de OS #001, Compra de peças, etc.">
                </div>

                <div>
                    <label class="text-xs font-bold text-gray-500 uppercase">Categoria</label>
                    <select id="trans-category" class="w-full border p-2 rounded-lg text-sm bg-white outline-none">
                        <option value="service">Serviço Prestado</option>
                        <option value="parts">Peças</option>
                        <option value="supplies">Materiais</option>
                        <option value="rent">Aluguel</option>
                        <option value="utilities">Contas</option>
                        <option value="other">Outros</option>
                    </select>
                </div>

                <div>
                    <label class="text-xs font-bold text-gray-500 uppercase">Data</label>
                    <input type="date" id="trans-date" required
                        class="w-full border p-2 rounded-lg text-sm bg-white outline-none">
                </div>

                <button type="submit"
                    class="w-full bg-plena-blue text-white py-3 rounded-xl font-bold shadow-lg shadow-blue-200 hover:bg-plena-dark transition-all mt-2">
                    Salvar Lançamento
                </button>
            </form>
        </div>
    </div>

    <!-- Client Modal -->
    <div id="clientModal" class="fixed inset-0 modal-backdrop hidden z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md transform transition-all p-6">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-lg font-bold text-gray-800">Novo Cliente</h3>
                <button onclick="closeModal('clientModal')" class="text-gray-400 hover:text-gray-600">
                    <i data-lucide="x"></i>
                </button>
            </div>

            <form onsubmit="submitClient(event)" class="space-y-4">
                <input type="hidden" id="client-id">

                <div>
                    <label class="text-xs font-bold text-gray-500 uppercase">Nome Completo *</label>
                    <input type="text" id="client-name" required
                        class="w-full border p-2 rounded-lg text-sm focus:border-plena-blue outline-none"
                        placeholder="Nome do cliente">
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="text-xs font-bold text-gray-500 uppercase">Telefone</label>
                        <input type="text" id="client-phone"
                            class="w-full border p-2 rounded-lg text-sm focus:border-plena-blue outline-none"
                            placeholder="(00) 00000-0000">
                    </div>
                    <div>
                        <label class="text-xs font-bold text-gray-500 uppercase">E-mail</label>
                        <input type="email" id="client-email"
                            class="w-full border p-2 rounded-lg text-sm focus:border-plena-blue outline-none"
                            placeholder="cliente@email.com">
                    </div>
                </div>

                <div>
                    <label class="text-xs font-bold text-gray-500 uppercase">Endereço</label>
                    <input type="text" id="client-address"
                        class="w-full border p-2 rounded-lg text-sm focus:border-plena-blue outline-none"
                        placeholder="Endereço completo">
                </div>

                <div>
                    <label class="text-xs font-bold text-gray-500 uppercase">Observações</label>
                    <textarea id="client-notes" rows="2"
                        class="w-full border p-2 rounded-lg text-sm focus:border-plena-blue outline-none"
                        placeholder="Informações adicionais..."></textarea>
                </div>

                <button type="submit"
                    class="w-full bg-plena-blue text-white py-3 rounded-xl font-bold shadow-lg shadow-blue-200 hover:bg-plena-dark transition-all mt-2">
                    Salvar Cliente
                </button>
            </form>
        </div>
    </div>

    <!-- Closing Modal -->
    <div id="closingModal" class="fixed inset-0 modal-backdrop hidden z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-sm overflow-hidden">
            <div class="bg-gradient-to-r from-gray-900 to-black p-6 text-center text-white">
                <h3 class="font-bold text-lg">Fechamento de Caixa</h3>
                <p id="closing-date" class="text-sm text-gray-300 mt-1">Hoje</p>
                <p id="closing-time" class="text-xs text-gray-500 mt-0">--:--</p>
            </div>
            <div class="p-6">
                <div class="space-y-4 mb-6">
                    <div class="flex justify-between items-center p-3 bg-green-50 rounded-lg border border-green-100">
                        <div class="flex items-center">
                            <i data-lucide="trending-up" class="w-4 h-4 text-green-600 mr-2"></i>
                            <span class="text-sm">Entradas</span>
                        </div>
                        <span id="closing-inc" class="font-bold text-green-700">R$ 0,00</span>
                    </div>
                    <div class="flex justify-between items-center p-3 bg-red-50 rounded-lg border border-red-100">
                        <div class="flex items-center">
                            <i data-lucide="trending-down" class="w-4 h-4 text-red-600 mr-2"></i>
                            <span class="text-sm">Saídas</span>
                        </div>
                        <span id="closing-exp" class="font-bold text-red-700">R$ 0,00</span>
                    </div>
                    <div class="flex justify-between items-center pt-4 border-t">
                        <span class="font-bold text-gray-800">Saldo Final</span>
                        <span id="closing-bal" class="font-bold text-2xl text-gray-900">R$ 0,00</span>
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-3 mb-3">
                    <button onclick="shareClosingWhatsApp()"
                        class="bg-[#25D366] text-white py-2.5 rounded-lg font-bold text-sm hover:bg-[#128C7E] flex justify-center items-center gap-2">
                        <i data-lucide="message-circle" class="w-4 h-4"></i> WhatsApp
                    </button>
                    <button onclick="printClosing()"
                        class="bg-blue-600 text-white py-2.5 rounded-lg font-bold text-sm hover:bg-blue-700 flex justify-center items-center gap-2">
                        <i data-lucide="printer" class="w-4 h-4"></i> Imprimir
                    </button>
                </div>

                <button onclick="closeModal('closingModal')"
                    class="w-full bg-gray-100 text-gray-700 py-3 rounded-lg font-bold text-sm hover:bg-gray-200 transition-colors flex justify-center items-center gap-2">
                    Concluir
                </button>

                <div class="mt-4 pt-4 border-t border-gray-100 text-center">
                    <a href="https://www.plenaaplicativos.com.br" target="_blank"
                        class="text-[10px] text-gray-400 hover:text-plena-blue no-underline">
                        Plena Soluções Digitais &copy; 2025
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script>
        // 🔒 DADOS DA LICENÇA
        const LICENSE_DATA = {
            active: false,
            ownerName: "",
            ownerDoc: ""
        };

        // ESTADO GLOBAL
        const DB_KEY = 'plena_assistencia_pro_v2';
        const defaultDB = {
            orders: [],
            clients: [],
            transactions: [],
            settings: {
                companyName: 'Minha Assistência Técnica',
                companyDoc: '',
                companyPhone: '',
                companyAddress: '',
                currency: 'R$',
                theme: 'light',
                autoBackup: true
            }
        };

        let db = JSON.parse(localStorage.getItem(DB_KEY)) || defaultDB;

        // UTILITÁRIOS
        const sanitizeHTML = (str) => {
            if (!str) return '';
            return String(str)
                .replace(/&/g, '&amp;')
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;')
                .replace(/"/g, '&quot;')
                .replace(/'/g, '&#039;');
        };

        const save = () => {
            localStorage.setItem(DB_KEY, JSON.stringify(db));
            updateDataStatus();
        };

        const fmtMoney = (v) => {
            return v.toLocaleString('pt-BR', {
                style: 'currency',
                currency: 'BRL',
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            });
        };

        const fmtDate = (d) => {
            const date = new Date(d);
            return date.toLocaleDateString('pt-BR');
        };

        const fmtDateInput = (d) => {
            return new Date(d).toISOString().split('T')[0];
        };

        const getID = () => {
            return 'OS' + Date.now().toString(36).toUpperCase().substr(-6);
        };

        const getClientID = () => {
            return 'CL' + Date.now().toString(36).toUpperCase().substr(-6);
        };

        const statusColors = {
            received: { bg: 'bg-gray-100', text: 'text-gray-600', label: 'Recebido' },
            analyzing: { bg: 'bg-blue-100', text: 'text-blue-600', label: 'Em Análise' },
            waiting_parts: { bg: 'bg-yellow-100', text: 'text-yellow-600', label: 'Aguardando Peça' },
            ready: { bg: 'bg-green-100', text: 'text-green-600', label: 'Pronto' },
            delivered: { bg: 'bg-purple-100', text: 'text-purple-600', label: 'Entregue' }
        };

        // INICIALIZAÇÃO
        function init() {
            lucide.createIcons();

            // 1. Verificar Licença e Bloquear Campos
            const isLicensed = LICENSE_DATA && LICENSE_DATA.active;

            // Campos de configurações da empresa
            const companyName = document.getElementById('company-name');
            const companyPhone = document.getElementById('company-phone');
            const companyAddress = document.getElementById('company-address');

            if (isLicensed) {
                // Bloquear edição
                [companyName, companyPhone, companyAddress, document.getElementById('company-doc')].forEach(input => {
                    if (input) {
                        input.disabled = true;
                        input.classList.add('bg-gray-100', 'cursor-not-allowed');
                        input.title = "Gerenciado pela licença de uso";
                    }
                });

                // Injetar Marca D'água
                injectWatermark();
            }

            // Configurar datas padrão
            const today = new Date().toISOString().split('T')[0];
            const firstDay = new Date();
            firstDay.setDate(1);
            const firstDayStr = firstDay.toISOString().split('T')[0];

            // Configurar inputs de data
            if (document.getElementById('trans-date')) document.getElementById('trans-date').value = today;
            if (document.getElementById('filter-start')) document.getElementById('filter-start').value = firstDayStr;
            if (document.getElementById('filter-end')) document.getElementById('filter-end').value = today;
            if (document.getElementById('cash-start')) document.getElementById('cash-start').value = firstDayStr;
            if (document.getElementById('cash-end')) document.getElementById('cash-end').value = today;

            // Carregar configurações da empresa
            loadCompanySettings();

            // Renderizar dados iniciais
            renderDashboard();
            updateDataStatus();

            // Configurar periodicidade para salvar
            setInterval(save, 30000);

            // Verificar instalação PWA
            checkInstallState();
        }

        function injectWatermark() {
            // Marca d'água na Sidebar
            const sidebarNav = document.querySelector('#sidebar nav');
            if (sidebarNav) {
                const watermarkDiv = document.createElement('div');
                watermarkDiv.className = 'mt-auto pt-6 pb-2 text-center opacity-50';
                watermarkDiv.innerHTML = `
                    <div class="test-xs font-mono text-white/40 mb-1">LICENCIADO PARA</div>
                    <div class="text-xs font-bold text-white/60">${LICENSE_DATA.ownerName}</div>
                    <div class="text-[10px] text-white/30">${LICENSE_DATA.ownerDoc}</div>
                `;
                sidebarNav.appendChild(watermarkDiv);
            }

            // Marca d'água no rodapé (visível apenas na impressão)
            const printWatermark = document.createElement('div');
            printWatermark.className = 'hidden print:block fixed bottom-0 left-0 w-full text-center border-t border-gray-200 pt-2 pb-4 bg-white';
            printWatermark.innerHTML = `
                <p class="text-[10px] text-gray-400 uppercase tracking-widest">
                    Licenciado para ${LICENSE_DATA.ownerName} • Documento: ${LICENSE_DATA.ownerDoc} • Uso Autorizado
                </p>
            `;
            document.body.appendChild(printWatermark);
        }

        // PWA INSTALLATION
        function checkInstallState() {
            // Verificar se já está instalado
            if (window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone === true) {
                // Esconder botão se já estiver instalado
                const installBtn = document.getElementById('nav-install');
                if (installBtn) installBtn.style.display = 'none';
            }
        }

        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
        });

        async function installApp() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                if (outcome === 'accepted') {
                    deferredPrompt = null;
                    const installBtn = document.getElementById('nav-install');
                    if (installBtn) installBtn.style.display = 'none';
                }
            } else {
                // Fallback: Redirecionar para manuais
                router('instructions');
                setTimeout(() => {
                    alert('Para instalar:\n\nNo Android (Chrome): Toque em ⋮ e "Instalar aplicativo"\nNo iOS (Safari): Toque em Compartilhar e "Adicionar à Tela de Início"');
                }, 500);
            }
        }

        function loadCompanySettings() {
            const settings = db.settings;
            document.getElementById('company-name').value = settings.companyName || '';
            document.getElementById('company-doc').value = settings.companyDoc || '';
            document.getElementById('company-phone').value = settings.companyPhone || '';
            document.getElementById('company-address').value = settings.companyAddress || '';
        }

        function saveCompanySettings() {
            db.settings.companyName = document.getElementById('company-name').value;
            db.settings.companyDoc = document.getElementById('company-doc').value;
            db.settings.companyPhone = document.getElementById('company-phone').value;
            db.settings.companyAddress = document.getElementById('company-address').value;
            save();
            showNotification('Configurações salvas com sucesso!', 'success');
        }

        // ROTEAMENTO E NAVEGAÇÃO
        function router(view) {
            // Esconder todas as views
            document.querySelectorAll('.view-section').forEach(el => el.classList.add('hide'));

            // Remover classe active de todos os nav items
            document.querySelectorAll('.nav-item').forEach(el => {
                el.classList.remove('bg-white/10', 'text-white');
                el.classList.add('text-gray-400');
            });

            // Mostrar view selecionada
            const viewElement = document.getElementById(`view-${view}`);
            if (viewElement) {
                viewElement.classList.remove('hide');
                viewElement.classList.add('fade-in');
            }

            // Ativar nav item selecionado
            const navElement = document.getElementById(`nav-${view}`);
            if (navElement) {
                navElement.classList.add('bg-white/10', 'text-white');
                navElement.classList.remove('text-gray-400');
            }

            // Atualizar título da página
            const titles = {
                dashboard: 'Dashboard',
                orders: 'Ordens de Serviço',
                clients: 'Clientes',
                transactions: 'Fluxo de Caixa',
                reports: 'Relatórios',
                settings: 'Configurações',
                instructions: 'Manual de Uso',
                about: 'Sobre a Plena'
            };

            document.getElementById('page-title').innerText = titles[view] || 'Plena Assistência';

            // Fechar sidebar no mobile
            if (window.innerWidth < 1024) {
                toggleSidebar();
            }

            // Renderizar dados específicos da view
            if (view === 'dashboard') {
                renderDashboard();
            } else if (view === 'orders') {
                renderOrders();
            } else if (view === 'clients') {
                renderClients();
            } else if (view === 'transactions') {
                renderTransactions();
            } else if (view === 'settings') {
                loadCompanySettings();
            }
        }

        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('overlay');

            sidebar.classList.toggle('open');
            overlay.classList.toggle('hidden');

            // Bloquear scroll do body quando sidebar aberta
            document.body.style.overflow = sidebar.classList.contains('open') ? 'hidden' : '';
        }

        // DASHBOARD
        function renderDashboard() {
            const currentMonth = new Date().toISOString().slice(0, 7);
            const monthOrders = db.orders.filter(o => o.date.startsWith(currentMonth));
            const monthTrans = db.transactions.filter(t => t.date.startsWith(currentMonth));

            // Calcular estatísticas
            const active = db.orders.filter(o => ['received', 'analyzing', 'waiting_parts'].includes(o.status)).length;
            const ready = db.orders.filter(o => o.status === 'ready').length;
            const delivered = monthOrders.filter(o => o.status === 'delivered').length;

            const revenue = monthOrders
                .filter(o => o.status === 'delivered')
                .reduce((sum, o) => sum + (o.total || 0), 0);

            // Atualizar cards
            document.getElementById('dash-active').innerText = active;
            document.getElementById('dash-ready').innerText = ready;
            document.getElementById('dash-delivered').innerText = delivered;
            document.getElementById('dash-revenue').innerText = fmtMoney(revenue);

            // Atualizar gráfico
            renderChart();

            // Atualizar ordens recentes
            renderRecentOrders();
        }

        function renderChart() {
            const chartArea = document.getElementById('chart-area');
            const statusCount = {
                received: 0,
                analyzing: 0,
                waiting_parts: 0,
                ready: 0,
                delivered: 0
            };

            db.orders.forEach(o => {
                if (statusCount[o.status] !== undefined) {
                    statusCount[o.status]++;
                }
            });

            const maxValue = Math.max(...Object.values(statusCount), 1);

            const chartData = [
                { label: 'Recebido', value: statusCount.received, color: '#9CA3AF' },
                { label: 'Análise', value: statusCount.analyzing, color: '#3B82F6' },
                { label: 'Peça', value: statusCount.waiting_parts, color: '#F59E0B' },
                { label: 'Pronto', value: statusCount.ready, color: '#10B981' },
                { label: 'Entregue', value: statusCount.delivered, color: '#8B5CF6' }
            ];

            let chartHTML = '';
            chartData.forEach(item => {
                const height = (item.value / maxValue) * 100;
                chartHTML += `
                    <div class="bar-group">
                        <div class="bar-wrapper">
                            <div class="bar" 
                                 style="height:${height}%; background-color:${item.color}"
                                 data-value="${item.value} ${item.label}"></div>
                        </div>
                        <div class="x-label">${item.label.substring(0, 3)}</div>
                    </div>
                `;
            });

            chartArea.innerHTML = chartHTML || '<p class="text-gray-400 text-sm">Sem dados para exibir</p>';
        }

        function renderRecentOrders() {
            const container = document.getElementById('recent-orders');
            const recent = db.orders
                .sort((a, b) => new Date(b.date) - new Date(a.date))
                .slice(0, 5);

            if (recent.length === 0) {
                container.innerHTML = '<p class="text-gray-400 text-sm text-center">Nenhuma ordem de serviço recente</p>';
                return;
            }

            container.innerHTML = recent.map(order => {
                const status = statusColors[order.status] || statusColors.received;
                return `
                    <div class="flex items-center justify-between p-3 hover:bg-gray-50 rounded-lg border border-gray-100">
                        <div class="flex items-center">
                            <div class="w-8 h-8 rounded-full ${status.bg} flex items-center justify-center mr-3">
                                <i data-lucide="clipboard" class="w-4 h-4 ${status.text}"></i>
                            </div>
                            <div>
                                <p class="text-sm font-medium text-gray-800">${order.client}</p>
                                <p class="text-xs text-gray-500">${order.device} • ${fmtDate(order.date)}</p>
                            </div>
                        </div>
                        <div class="text-right">
                            <span class="text-xs font-bold ${status.text}">${status.label}</span>
                            ${order.total > 0 ? `<p class="text-sm font-bold text-gray-800 mt-1">${fmtMoney(order.total)}</p>` : ''}
                        </div>
                    </div>
                `;
            }).join('');

            lucide.createIcons();
        }

        // ORDENS DE SERVIÇO
        function openOrderModal(order = null) {
            const modal = document.getElementById('orderModal');
            const title = modal.querySelector('#order-modal-title');
            const form = modal.querySelector('form');

            if (order) {
                // Modo edição
                title.textContent = 'Editar Ordem de Serviço';
                document.getElementById('order-id').value = order.id;
                document.getElementById('order-client').value = order.client || '';
                document.getElementById('order-phone').value = order.phone || '';
                document.getElementById('order-device').value = order.device || '';
                document.getElementById('order-brand').value = order.brand || '';
                document.getElementById('order-serial').value = order.serial || '';
                document.getElementById('order-password').value = order.password || '';
                document.getElementById('order-problem').value = order.problem || '';
                document.getElementById('order-diagnosis').value = order.diagnosis || '';
                document.getElementById('order-parts').value = order.parts || 0;
                document.getElementById('order-labor').value = order.labor || 0;
                document.getElementById('order-discount').value = order.discount || 0;

                // Checkboxes de acessórios
                const accessories = order.accessories || [];
                document.getElementById('acc-charger').checked = accessories.includes('Carregador');
                document.getElementById('acc-case').checked = accessories.includes('Capa/Proteção');
                document.getElementById('acc-chip').checked = accessories.includes('Chip/SD');
                document.getElementById('acc-box').checked = accessories.includes('Caixa');

                updateOrderTotal();
            } else {
                // Modo criação
                title.textContent = 'Nova Ordem de Serviço';
                form.reset();
                document.getElementById('order-id').value = '';
                document.getElementById('order-parts').value = 0;
                document.getElementById('order-labor').value = 0;
                document.getElementById('order-discount').value = 0;
                updateOrderTotal();
            }

            modal.classList.remove('hidden');
        }

        function updateOrderTotal() {
            const parts = parseFloat(document.getElementById('order-parts').value) || 0;
            const labor = parseFloat(document.getElementById('order-labor').value) || 0;
            const discount = parseFloat(document.getElementById('order-discount').value) || 0;
            const total = parts + labor - discount;
            document.getElementById('order-total').textContent = fmtMoney(total);
        }

        // Adicionar listeners para atualizar o total automaticamente
        document.addEventListener('DOMContentLoaded', () => {
            ['order-parts', 'order-labor', 'order-discount'].forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('input', updateOrderTotal);
                }
            });
        });

        function submitOrder(e) {
            e.preventDefault();

            const id = document.getElementById('order-id').value;
            const parts = parseFloat(document.getElementById('order-parts').value) || 0;
            const labor = parseFloat(document.getElementById('order-labor').value) || 0;
            const discount = parseFloat(document.getElementById('order-discount').value) || 0;
            const total = parts + labor - discount;

            // Coletar acessórios
            const accessories = [];
            if (document.getElementById('acc-charger').checked) accessories.push('Carregador');
            if (document.getElementById('acc-case').checked) accessories.push('Capa/Proteção');
            if (document.getElementById('acc-chip').checked) accessories.push('Chip/SD');
            if (document.getElementById('acc-box').checked) accessories.push('Caixa');

            const order = {
                id: id || getID(),
                client: document.getElementById('order-client').value.trim(),
                phone: document.getElementById('order-phone').value.trim(),
                device: document.getElementById('order-device').value.trim(),
                brand: document.getElementById('order-brand').value.trim(),
                serial: document.getElementById('order-serial').value.trim(),
                password: document.getElementById('order-password').value.trim(),
                problem: document.getElementById('order-problem').value.trim(),
                diagnosis: document.getElementById('order-diagnosis').value.trim(),
                parts,
                labor,
                discount,
                total,
                accessories,
                date: id ? db.orders.find(o => o.id === id).date : new Date().toISOString().split('T')[0],
                status: id ? db.orders.find(o => o.id === id).status : 'received',
                updatedAt: new Date().toISOString()
            };

            if (!order.client || !order.device || !order.problem) {
                showNotification('Preencha todos os campos obrigatórios!', 'error');
                return;
            }

            if (id) {
                // Editar ordem existente
                const index = db.orders.findIndex(o => o.id === id);
                if (index !== -1) {
                    db.orders[index] = order;
                }
            } else {
                // Adicionar nova ordem
                db.orders.unshift(order);
            }

            // Salvar/atualizar cliente
            saveClientFromOrder(order);

            save();
            closeModal('orderModal');
            renderDashboard();
            renderOrders();

            showNotification('Ordem de serviço salva com sucesso!', 'success');
        }

        function saveClientFromOrder(order) {
            const existingClient = db.clients.find(c =>
                c.name.toLowerCase() === order.client.toLowerCase() ||
                (c.phone && c.phone === order.phone)
            );

            if (!existingClient && order.client) {
                db.clients.push({
                    id: getClientID(),
                    name: order.client,
                    phone: order.phone,
                    email: '',
                    address: '',
                    notes: '',
                    orders: 1,
                    lastOrder: order.date,
                    totalSpent: order.total,
                    createdAt: new Date().toISOString()
                });
            } else if (existingClient) {
                existingClient.orders += 1;
                existingClient.lastOrder = order.date;
                existingClient.totalSpent = (existingClient.totalSpent || 0) + order.total;
            }
        }

        function renderOrders() {
            const term = document.getElementById('search-order')?.value.toLowerCase() || '';
            const filter = document.getElementById('filter-status')?.value || 'all';
            const start = document.getElementById('filter-start')?.value || '';
            const end = document.getElementById('filter-end')?.value || '';

            // Filtrar ordens
            let filtered = db.orders.filter(o => {
                const matchesTerm = o.client.toLowerCase().includes(term) ||
                    o.device.toLowerCase().includes(term) ||
                    o.id.toLowerCase().includes(term);
                const matchesStatus = filter === 'all' || o.status === filter;
                const matchesDate = (!start || o.date >= start) && (!end || o.date <= end);

                return matchesTerm && matchesStatus && matchesDate;
            });

            // Ordenar por data (mais recente primeiro)
            filtered.sort((a, b) => new Date(b.date) - new Date(a.date));

            // Atualizar tabela
            const tbody = document.getElementById('orders-table-body');
            const emptyMsg = document.getElementById('empty-msg');

            if (filtered.length === 0) {
                tbody.innerHTML = '';
                emptyMsg?.classList.remove('hidden');
                updateOrderSummary(filtered);
                return;
            }

            emptyMsg?.classList.add('hidden');

            tbody.innerHTML = filtered.map(o => {
                const status = statusColors[o.status] || statusColors.received;
                return `
                    <tr class="hover:bg-gray-50 group border-b border-gray-100">
                        <td class="px-6 py-4 font-mono text-sm text-gray-500">${o.id}</td>
                        <td class="px-6 py-4">
                            <div class="font-medium text-gray-800">${o.client}</div>
                            ${o.phone ? `<div class="text-xs text-gray-400">${o.phone}</div>` : ''}
                        </td>
                        <td class="px-6 py-4">
                            <div class="font-medium text-gray-800">${o.device}</div>
                            ${o.brand ? `<div class="text-xs text-gray-400">${o.brand}</div>` : ''}
                        </td>
                        <td class="px-6 py-4">
                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${status.bg} ${status.text}">
                                ${status.label}
                            </span>
                        </td>
                        <td class="px-6 py-4 text-gray-500 whitespace-nowrap">${fmtDate(o.date)}</td>
                        <td class="px-6 py-4 text-right font-bold ${o.total > 0 ? 'text-green-600' : 'text-gray-500'}">
                            ${fmtMoney(o.total)}
                        </td>
                        <td class="px-6 py-4 text-center">
                            <div class="flex justify-center space-x-2 opacity-0 group-hover:opacity-100 transition-opacity">
                                <button onclick="openOrderView('${o.id}')" 
                                        class="text-gray-400 hover:text-blue-500 transition-colors"
                                        title="Visualizar">
                                    <i data-lucide="eye" class="w-4 h-4"></i>
                                </button>
                                <button onclick="openOrderModal(${JSON.stringify(o).replace(/"/g, '&quot;')})" 
                                        class="text-gray-400 hover:text-yellow-500 transition-colors"
                                        title="Editar">
                                    <i data-lucide="edit" class="w-4 h-4"></i>
                                </button>
                                <button onclick="deleteOrder('${o.id}')" 
                                        class="text-gray-400 hover:text-red-500 transition-colors"
                                        title="Excluir">
                                    <i data-lucide="trash-2" class="w-4 h-4"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');

            lucide.createIcons();
            updateOrderSummary(filtered);
        }

        function updateOrderSummary(orders) {
            const active = orders.filter(o => ['received', 'analyzing', 'waiting_parts'].includes(o.status)).length;
            const waiting = orders.filter(o => o.status === 'waiting_parts').length;
            const ready = orders.filter(o => o.status === 'ready').length;
            const total = orders.length;

            document.getElementById('filter-active').textContent = active;
            document.getElementById('filter-waiting').textContent = waiting;
            document.getElementById('filter-ready').textContent = ready;
            document.getElementById('filter-total').textContent = total;
        }

        function clearFilters() {
            const firstDay = new Date();
            firstDay.setDate(1);
            const firstDayStr = firstDay.toISOString().split('T')[0];
            const today = new Date().toISOString().split('T')[0];

            document.getElementById('search-order').value = '';
            document.getElementById('filter-status').value = 'all';
            document.getElementById('filter-start').value = firstDayStr;
            document.getElementById('filter-end').value = today;

            renderOrders();
        }

        let currentViewOrder = null;
        function openOrderView(id) {
            const order = db.orders.find(o => o.id === id);
            if (!order) return;

            currentViewOrder = order;

            // Preencher dados da visualização
            document.getElementById('view-os-number').textContent = order.id;
            document.getElementById('view-os-id').textContent = order.id;
            document.getElementById('view-os-date').textContent = `Data: ${fmtDate(order.date)}`;
            document.getElementById('view-os-status').textContent = `Status: ${statusColors[order.status]?.label || 'Recebido'}`;
            document.getElementById('view-client').textContent = order.client;
            document.getElementById('view-phone').textContent = order.phone || 'Não informado';
            document.getElementById('view-device').textContent = order.device + (order.brand ? ` - ${order.brand}` : '');
            document.getElementById('view-serial').textContent = order.serial || 'N/D';
            document.getElementById('view-accessories').textContent = order.accessories?.length ? order.accessories.join(', ') : 'Nenhum';
            document.getElementById('view-problem').textContent = order.problem || 'Não informado';
            document.getElementById('view-diagnosis').textContent = order.diagnosis || 'Em análise';
            document.getElementById('view-parts').textContent = fmtMoney(order.parts || 0);
            document.getElementById('view-labor').textContent = fmtMoney(order.labor || 0);
            document.getElementById('view-discount').textContent = fmtMoney(order.discount || 0);
            document.getElementById('view-total').textContent = fmtMoney(order.total || 0);

            document.getElementById('view-status-select').value = order.status;


            document.getElementById('orderViewModal').classList.remove('hidden');

            // Injetar cabeçalho corporativo
            updatePrintHeaders();
        }

        function editCurrentOrder() {
            if (currentViewOrder) {
                closeModal('orderViewModal');
                openOrderModal(currentViewOrder);
            }
        }

        function updateOrderStatus(status) {
            if (currentViewOrder) {
                currentViewOrder.status = status;
                const index = db.orders.findIndex(o => o.id === currentViewOrder.id);
                if (index !== -1) {
                    db.orders[index] = currentViewOrder;
                    save();

                    // Atualizar visualização
                    document.getElementById('view-os-status').textContent = `Status: ${statusColors[status]?.label || status}`;

                    // Atualizar outras views
                    renderDashboard();
                    renderOrders();

                    showNotification('Status atualizado com sucesso!', 'success');
                }
            }
        }

        function shareOrderWhatsApp() {
            // Verifica se tem uma ordem aberta na visualização
            if (!currentViewOrder) return;

            const order = currentViewOrder;
            const company = db.settings; // Pega o nome da empresa das configurações

            // Formatadores auxiliares
            const fmtMoney = (v) => v.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
            const fmtDateBr = (d) => d.split('-').reverse().join('/');

            // --- CONSTRUÇÃO DA MENSAGEM (Usando \n para quebra de linha) ---

            // 1. Cabeçalho com Nome da Empresa
            let msg = `🔧 *${company.companyName || 'ASSISTÊNCIA TÉCNICA'}*\n`;
            msg += `📋 *ORDEM DE SERVIÇO #${order.id}*\n`;
            msg += `📅 *Data:* ${fmtDateBr(order.date)}\n\n`;

            // 2. Dados do Cliente
            msg += `👤 *CLIENTE*\n`;
            msg += `${order.client}\n\n`;

            // 3. Equipamento
            msg += `📱 *EQUIPAMENTO*\n`;
            msg += `Modelo: ${order.device}\n`;
            if (order.brand) msg += `Marca: ${order.brand}\n`;
            if (order.serial) msg += `S/N: ${order.serial}\n`;
            msg += `\n`;

            // 4. Detalhes Técnicos (O que foi feito)
            msg += `🛠️ *DETALHES TÉCNICOS*\n`;
            msg += `⚠️ *Defeito:* ${order.problem}\n`;

            // Só mostra o diagnóstico se tiver algo escrito
            if (order.diagnosis && order.diagnosis.trim() !== "") {
                msg += `✅ *Serviço/Laudo:* ${order.diagnosis}\n`;
            }
            msg += `\n`;

            // 5. Resumo Financeiro (Só mostra se tiver valor)
            msg += `💰 *RESUMO FINANCEIRO*\n`;
            if (order.parts > 0) msg += `Peças: ${fmtMoney(order.parts)}\n`;
            if (order.labor > 0) msg += `Mão de Obra: ${fmtMoney(order.labor)}\n`;
            if (order.discount > 0) msg += `Desconto: -${fmtMoney(order.discount)}\n`;
            msg += `*TOTAL: ${fmtMoney(order.total)}*\n\n`;

            // 6. Rodapé e Status
            const statusLabel = statusColors[order.status]?.label?.toUpperCase() || 'EM ANDAMENTO';
            msg += `📊 *STATUS: ${statusLabel}*\n`;
            msg += `--------------------------------\n`;
            msg += `_Agradecemos a preferência!_`;

            // Adiciona telefone da empresa se estiver configurado
            if (company.companyPhone) {
                msg += `\n📞 ${company.companyPhone}`;
            }

            // --- ENVIO ---
            // Codifica a mensagem inteira para URL (resolve problemas com '&', '#', etc)
            const encodedMsg = encodeURIComponent(msg);

            // Tenta usar o número do cliente
            const phone = order.phone?.replace(/\D/g, '') || '';
            const url = phone ? `https://wa.me/55${phone}?text=${encodedMsg}` : `https://wa.me/?text=${encodedMsg}`;

            window.open(url, '_blank');
        }

        function deleteOrder(id) {
            if (confirm('Tem certeza que deseja excluir esta ordem de serviço?')) {
                db.orders = db.orders.filter(o => o.id !== id);
                save();
                renderDashboard();
                renderOrders();
                showNotification('Ordem de serviço excluída com sucesso!', 'success');
            }
        }

        // CLIENTES
        function openClientModal(client = null) {
            const modal = document.getElementById('clientModal');
            const form = modal.querySelector('form');

            if (client) {
                // Modo edição
                document.getElementById('client-id').value = client.id;
                document.getElementById('client-name').value = client.name || '';
                document.getElementById('client-phone').value = client.phone || '';
                document.getElementById('client-email').value = client.email || '';
                document.getElementById('client-address').value = client.address || '';
                document.getElementById('client-notes').value = client.notes || '';
            } else {
                // Modo criação
                form.reset();
                document.getElementById('client-id').value = '';
            }

            modal.classList.remove('hidden');
        }

        function submitClient(e) {
            e.preventDefault();

            const id = document.getElementById('client-id').value;
            const name = document.getElementById('client-name').value.trim();

            if (!name) {
                showNotification('O nome do cliente é obrigatório!', 'error');
                return;
            }

            const client = {
                id: id || getClientID(),
                name,
                phone: document.getElementById('client-phone').value.trim(),
                email: document.getElementById('client-email').value.trim(),
                address: document.getElementById('client-address').value.trim(),
                notes: document.getElementById('client-notes').value.trim(),
                orders: id ? db.clients.find(c => c.id === id)?.orders || 0 : 0,
                lastOrder: id ? db.clients.find(c => c.id === id)?.lastOrder || '' : '',
                totalSpent: id ? db.clients.find(c => c.id === id)?.totalSpent || 0 : 0,
                updatedAt: new Date().toISOString(),
                createdAt: id ? db.clients.find(c => c.id === id)?.createdAt : new Date().toISOString()
            };

            if (id) {
                // Editar cliente existente
                const index = db.clients.findIndex(c => c.id === id);
                if (index !== -1) {
                    db.clients[index] = client;
                }
            } else {
                // Adicionar novo cliente
                db.clients.unshift(client);
            }

            save();
            closeModal('clientModal');
            renderClients();
            showNotification('Cliente salvo com sucesso!', 'success');
        }

        function renderClients() {
            const term = document.getElementById('search-client')?.value.toLowerCase() || '';

            // Filtrar clientes
            let filtered = db.clients.filter(c =>
                c.name.toLowerCase().includes(term) ||
                c.phone?.toLowerCase().includes(term) ||
                c.email?.toLowerCase().includes(term)
            );

            // Ordenar por nome
            filtered.sort((a, b) => a.name.localeCompare(b.name));

            // Atualizar tabela
            const tbody = document.getElementById('clients-table-body');
            const emptyMsg = document.getElementById('empty-clients-msg');

            if (filtered.length === 0) {
                tbody.innerHTML = '';
                emptyMsg?.classList.remove('hidden');
                return;
            }

            emptyMsg?.classList.add('hidden');

            tbody.innerHTML = filtered.map(c => {
                const orderCount = db.orders.filter(o => o.client.toLowerCase() === c.name.toLowerCase()).length;
                const lastOrder = db.orders
                    .filter(o => o.client.toLowerCase() === c.name.toLowerCase())
                    .sort((a, b) => new Date(b.date) - new Date(a.date))[0];

                return `
                    <tr class="hover:bg-gray-50 group border-b border-gray-100">
                        <td class="px-6 py-4">
                            <div class="font-medium text-gray-800">${c.name}</div>
                            ${c.email ? `<div class="text-xs text-gray-400">${c.email}</div>` : ''}
                        </td>
                        <td class="px-6 py-4">
                            ${c.phone ? `<div class="font-medium text-gray-800">${c.phone}</div>` : '<span class="text-gray-400">Não informado</span>'}
                            ${c.address ? `<div class="text-xs text-gray-400">${c.address.substring(0, 30)}...</div>` : ''}
                        </td>
                        <td class="px-6 py-4 text-center">
                            <span class="inline-flex items-center justify-center w-8 h-8 rounded-full bg-blue-100 text-blue-600 font-bold">
                                ${orderCount}
                            </span>
                        </td>
                        <td class="px-6 py-4 text-gray-500">
                            ${lastOrder ? fmtDate(lastOrder.date) : 'Nenhuma'}
                        </td>
                        <td class="px-6 py-4 text-center">
                            <div class="flex justify-center space-x-2 opacity-0 group-hover:opacity-100 transition-opacity">
                                <button onclick="openClientModal(${JSON.stringify(c).replace(/"/g, '&quot;')})" 
                                        class="text-gray-400 hover:text-blue-500 transition-colors"
                                        title="Editar">
                                    <i data-lucide="edit" class="w-4 h-4"></i>
                                </button>
                                <button onclick="deleteClient('${c.id}')" 
                                        class="text-gray-400 hover:text-red-500 transition-colors"
                                        title="Excluir">
                                    <i data-lucide="trash-2" class="w-4 h-4"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');

            lucide.createIcons();
        }

        function deleteClient(id) {
            if (confirm('Tem certeza que deseja excluir este cliente?')) {
                db.clients = db.clients.filter(c => c.id !== id);
                save();
                renderClients();
                showNotification('Cliente excluído com sucesso!', 'success');
            }
        }

        // TRANSAÇÕES
        function openTransactionModal(transaction = null) {
            const modal = document.getElementById('transactionModal');
            const today = new Date().toISOString().split('T')[0];

            if (transaction) {
                // Modo edição
                document.getElementById('trans-id').value = transaction.id;
                document.querySelector(`input[name="trans-type"][value="${transaction.type}"]`).checked = true;
                document.getElementById('trans-amount').value = transaction.amount;
                document.getElementById('trans-desc').value = transaction.desc;
                document.getElementById('trans-category').value = transaction.category || 'service';
                document.getElementById('trans-date').value = transaction.date;
            } else {
                // Modo criação
                modal.querySelector('form').reset();
                document.getElementById('trans-id').value = '';
                document.getElementById('trans-date').value = today;
                document.querySelector('input[name="trans-type"][value="income"]').checked = true;
            }

            modal.classList.remove('hidden');
        }

        function submitTransaction(e) {
            e.preventDefault();

            const id = document.getElementById('trans-id').value;
            const type = document.querySelector('input[name="trans-type"]:checked').value;
            const amount = parseFloat(document.getElementById('trans-amount').value);
            const desc = document.getElementById('trans-desc').value.trim();
            const category = document.getElementById('trans-category').value;
            const date = document.getElementById('trans-date').value;

            if (!desc || !amount || amount <= 0) {
                showNotification('Por favor, preencha todos os campos corretamente.', 'error');
                return;
            }

            const transaction = {
                id: id || Date.now().toString(36) + Math.random().toString(36).substr(2, 5),
                type,
                amount,
                desc,
                category,
                date
            };

            if (id) {
                // Editar transação existente
                const index = db.transactions.findIndex(t => t.id === id);
                if (index !== -1) {
                    db.transactions[index] = transaction;
                }
            } else {
                // Adicionar nova transação
                db.transactions.push(transaction);
            }

            save();
            closeModal('transactionModal');

            // Resetar formulário
            e.target.reset();
            document.getElementById('trans-date').value = new Date().toISOString().split('T')[0];

            // Atualizar views
            renderTransactions();
            if (document.getElementById('view-dashboard').classList.contains('hide') === false) {
                renderDashboard();
            }

            showNotification('Transação salva com sucesso!', 'success');
        }

        function renderTransactions() {
            const start = document.getElementById('cash-start')?.value || '';
            const end = document.getElementById('cash-end')?.value || '';
            const type = document.getElementById('cash-type')?.value || 'all';

            // Filtrar transações
            let filtered = db.transactions.filter(t => {
                const matchesType = type === 'all' || t.type === type;
                const matchesDate = (!start || t.date >= start) && (!end || t.date <= end);
                return matchesType && matchesDate;
            });

            // Ordenar por data (mais recente primeiro)
            filtered.sort((a, b) => new Date(b.date) - new Date(a.date));

            // Atualizar tabela
            const tbody = document.getElementById('trans-table-body');

            if (filtered.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="5" class="px-6 py-8 text-center text-gray-400">
                            <i data-lucide="wallet" class="w-12 h-12 mx-auto mb-4 text-gray-300"></i>
                            <p>Nenhuma transação encontrada.</p>
                        </td>
                    </tr>
                `;
                updateCashSummary(filtered);
                return;
            }

            tbody.innerHTML = filtered.map(t => {
                const isIncome = t.type === 'income';
                const categoryColors = {
                    service: 'bg-green-100 text-green-800',
                    parts: 'bg-blue-100 text-blue-800',
                    supplies: 'bg-yellow-100 text-yellow-800',
                    rent: 'bg-purple-100 text-purple-800',
                    utilities: 'bg-red-100 text-red-800',
                    other: 'bg-gray-100 text-gray-800'
                };

                return `
                    <tr class="hover:bg-gray-50 group border-b border-gray-100">
                        <td class="px-6 py-4 text-gray-500 whitespace-nowrap">${fmtDate(t.date)}</td>
                        <td class="px-6 py-4">
                            <div class="font-medium text-gray-800">${t.desc}</div>
                            <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium ${categoryColors[t.category] || 'bg-gray-100 text-gray-800'}">
                                ${t.category === 'service' ? 'Serviço' :
                        t.category === 'parts' ? 'Peças' :
                            t.category === 'supplies' ? 'Materiais' :
                                t.category === 'rent' ? 'Aluguel' :
                                    t.category === 'utilities' ? 'Contas' : 'Outros'}
                            </span>
                        </td>
                        <td class="px-6 py-4 text-right font-bold ${isIncome ? 'text-green-600' : 'text-red-600'}">
                            ${isIncome ? '+' : '-'} ${fmtMoney(t.amount)}
                        </td>
                        <td class="px-6 py-4 text-center">
                            <div class="flex justify-center space-x-2 opacity-0 group-hover:opacity-100 transition-opacity">
                                <button onclick="openTransactionModal(${JSON.stringify(t).replace(/"/g, '&quot;')})" 
                                        class="text-gray-400 hover:text-blue-500 transition-colors"
                                        title="Editar">
                                    <i data-lucide="edit" class="w-4 h-4"></i>
                                </button>
                                <button onclick="deleteTransaction('${t.id}')" 
                                        class="text-gray-400 hover:text-red-500 transition-colors"
                                        title="Excluir">
                                    <i data-lucide="trash-2" class="w-4 h-4"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');

            lucide.createIcons();
            updateCashSummary(filtered);
        }

        function updateCashSummary(transactions) {
            const currentMonth = new Date().toISOString().slice(0, 7);
            const monthTrans = db.transactions.filter(t => t.date.startsWith(currentMonth));

            const income = monthTrans.filter(t => t.type === 'income')
                .reduce((sum, t) => sum + t.amount, 0);
            const expense = monthTrans.filter(t => t.type === 'expense')
                .reduce((sum, t) => sum + t.amount, 0);
            const balance = income - expense;

            const filteredIncome = transactions.filter(t => t.type === 'income')
                .reduce((sum, t) => sum + t.amount, 0);
            const filteredExpense = transactions.filter(t => t.type === 'expense')
                .reduce((sum, t) => sum + t.amount, 0);
            const filteredBalance = filteredIncome - filteredExpense;

            document.getElementById('cash-balance').textContent = fmtMoney(balance);
            document.getElementById('cash-income').textContent = fmtMoney(income);
            document.getElementById('cash-expense').textContent = fmtMoney(expense);
        }

        function deleteTransaction(id) {
            if (confirm('Tem certeza que deseja excluir esta transação?')) {
                db.transactions = db.transactions.filter(t => t.id !== id);
                save();
                renderTransactions();
                renderDashboard();
                showNotification('Transação excluída com sucesso!', 'success');
            }
        }

        // RELATÓRIOS
        function generateMonthlyReport() {
            const currentMonth = new Date().toISOString().slice(0, 7);
            const monthOrders = db.orders.filter(o => o.date.startsWith(currentMonth));
            const monthTrans = db.transactions.filter(t => t.date.startsWith(currentMonth));

            const totalOrders = monthOrders.length;
            const deliveredOrders = monthOrders.filter(o => o.status === 'delivered').length;
            const revenue = monthOrders
                .filter(o => o.status === 'delivered')
                .reduce((sum, o) => sum + (o.total || 0), 0);

            const income = monthTrans.filter(t => t.type === 'income')
                .reduce((sum, t) => sum + t.amount, 0);
            const expense = monthTrans.filter(t => t.type === 'expense')
                .reduce((sum, t) => sum + t.amount, 0);
            const profit = income - expense;

            const reportContent = document.getElementById('report-content');
            reportContent.innerHTML = `
                <div class="mb-6">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">Relatório Mensal - ${new Date().toLocaleDateString('pt-BR', { month: 'long', year: 'numeric' })}</h3>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                    <div class="bg-blue-50 p-4 rounded-xl text-center border border-blue-100">
                        <p class="text-xs text-gray-500 uppercase font-bold">Total O.S.</p>
                        <p class="text-2xl font-bold text-blue-700 mt-2">${totalOrders}</p>
                    </div>
                    <div class="bg-green-50 p-4 rounded-xl text-center border border-green-100">
                        <p class="text-xs text-gray-500 uppercase font-bold">O.S. Entregues</p>
                        <p class="text-2xl font-bold text-green-700 mt-2">${deliveredOrders}</p>
                    </div>
                    <div class="bg-purple-50 p-4 rounded-xl text-center border border-purple-100">
                        <p class="text-xs text-gray-500 uppercase font-bold">Faturamento</p>
                        <p class="text-2xl font-bold text-purple-700 mt-2">${fmtMoney(revenue)}</p>
                    </div>
                </div>

                <div class="bg-white p-4 rounded-xl border border-gray-200 mb-6">
                    <h4 class="font-bold text-gray-800 mb-3">Fluxo de Caixa</h4>
                    <div class="space-y-2">
                        <div class="flex justify-between">
                            <span>Entradas:</span>
                            <span class="font-bold text-green-600">${fmtMoney(income)}</span>
                        </div>
                        <div class="flex justify-between">
                            <span>Saídas:</span>
                            <span class="font-bold text-red-600">${fmtMoney(expense)}</span>
                        </div>
                        <div class="flex justify-between border-t pt-2">
                            <span class="font-bold">Resultado:</span>
                            <span class="font-bold text-lg ${profit >= 0 ? 'text-green-600' : 'text-red-600'}">
                                ${fmtMoney(profit)}
                            </span>
                        </div>
                    </div>
                </div>

                <div class="bg-white p-4 rounded-xl border border-gray-200">
                    <h4 class="font-bold text-gray-800 mb-3">Distribuição por Status</h4>
                    <div class="space-y-2">
                        ${Object.entries(statusColors).map(([status, data]) => {
                const count = monthOrders.filter(o => o.status === status).length;
                const percentage = totalOrders > 0 ? ((count / totalOrders) * 100).toFixed(1) : 0;
                return `
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center">
                                        <div class="w-3 h-3 rounded-full mr-2 ${data.bg.replace('100', '500')}"></div>
                                        <span class="text-sm">${data.label}</span>
                                    </div>
                                    <div class="flex items-center gap-2">
                                        <span class="text-sm font-bold">${count}</span>
                                        <span class="text-xs text-gray-500">${percentage}%</span>
                                    </div>
                                </div>
                            `;
            }).join('')}
                    </div>
                </div>

                <div class="mt-6 grid grid-cols-1 md:grid-cols-2 gap-4">
                    <button onclick="printReport()"
                        class="bg-blue-600 text-white py-3 rounded-xl font-bold hover:bg-blue-700 flex justify-center items-center gap-2">
                        <i data-lucide="printer" class="w-4 h-4"></i> Imprimir Relatório
                    </button>
                    <button onclick="shareReportWhatsApp()"
                        class="bg-[#25D366] text-white py-3 rounded-xl font-bold hover:bg-[#128C7E] flex justify-center items-center gap-2">
                        <i data-lucide="message-circle" class="w-4 h-4"></i> Compartilhar
                    </button>
                </div>
            `;

            document.getElementById('report-result').classList.remove('hide');
            lucide.createIcons();
        }

        function generatePerformanceReport() {
            const last30Days = new Date();
            last30Days.setDate(last30Days.getDate() - 30);
            const last30DaysStr = last30Days.toISOString().split('T')[0];

            const recentOrders = db.orders.filter(o => o.date >= last30DaysStr);
            const completedOrders = recentOrders.filter(o => o.status === 'delivered');

            const avgCompletionTime = completedOrders.length > 0 ?
                completedOrders.reduce((sum, o) => {
                    const received = new Date(o.date);
                    const delivered = new Date(o.updatedAt || o.date);
                    const diffDays = (delivered - received) / (1000 * 60 * 60 * 24);
                    return sum + diffDays;
                }, 0) / completedOrders.length : 0;

            const reportContent = document.getElementById('report-content');
            reportContent.innerHTML = `
                <div class="mb-6">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">Relatório de Desempenho (Últimos 30 dias)</h3>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                    <div class="bg-blue-50 p-4 rounded-xl border border-blue-100">
                        <p class="text-xs text-gray-500 uppercase font-bold">O.S. Recebidas</p>
                        <p class="text-2xl font-bold text-blue-700 mt-2">${recentOrders.length}</p>
                    </div>
                    <div class="bg-green-50 p-4 rounded-xl border border-green-100">
                        <p class="text-xs text-gray-500 uppercase font-bold">O.S. Concluídas</p>
                        <p class="text-2xl font-bold text-green-700 mt-2">${completedOrders.length}</p>
                    </div>
                </div>

                <div class="bg-white p-4 rounded-xl border border-gray-200 mb-6">
                    <h4 class="font-bold text-gray-800 mb-3">Tempo Médio de Reparo</h4>
                    <div class="text-center">
                        <p class="text-3xl font-bold text-purple-600">${avgCompletionTime.toFixed(1)}</p>
                        <p class="text-sm text-gray-500">dias</p>
                    </div>
                </div>

                <div class="bg-white p-4 rounded-xl border border-gray-200">
                    <h4 class="font-bold text-gray-800 mb-3">Taxa de Conclusão</h4>
                    <div class="text-center">
                        <p class="text-3xl font-bold ${recentOrders.length > 0 ? 'text-green-600' : 'text-gray-600'}">
                            ${recentOrders.length > 0 ? ((completedOrders.length / recentOrders.length) * 100).toFixed(1) : 0}%
                        </p>
                        <p class="text-sm text-gray-500">de conclusão</p>
                    </div>
                </div>
            `;

            document.getElementById('report-result').classList.remove('hide');
            updatePrintHeaders();
        }

        function generateFinancialReport() {
            const currentMonth = new Date().toISOString().slice(0, 7);
            const monthTrans = db.transactions.filter(t => t.date.startsWith(currentMonth));

            const incomeByCategory = {};
            const expenseByCategory = {};

            monthTrans.forEach(t => {
                if (t.type === 'income') {
                    incomeByCategory[t.category] = (incomeByCategory[t.category] || 0) + t.amount;
                } else {
                    expenseByCategory[t.category] = (expenseByCategory[t.category] || 0) + t.amount;
                }
            });

            const totalIncome = Object.values(incomeByCategory).reduce((a, b) => a + b, 0);
            const totalExpense = Object.values(expenseByCategory).reduce((a, b) => a + b, 0);

            const reportContent = document.getElementById('report-content');
            reportContent.innerHTML = `
                <div class="mb-6">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">Relatório Financeiro</h3>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                    <div class="bg-green-50 p-4 rounded-xl border border-green-100">
                        <p class="text-xs text-gray-500 uppercase font-bold">Total Entradas</p>
                        <p class="text-2xl font-bold text-green-700 mt-2">${fmtMoney(totalIncome)}</p>
                    </div>
                    <div class="bg-red-50 p-4 rounded-xl border border-red-100">
                        <p class="text-xs text-gray-500 uppercase font-bold">Total Saídas</p>
                        <p class="text-2xl font-bold text-red-700 mt-2">${fmtMoney(totalExpense)}</p>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="bg-white p-4 rounded-xl border border-gray-200">
                        <h4 class="font-bold text-gray-800 mb-3">Entradas por Categoria</h4>
                        ${Object.entries(incomeByCategory).length > 0 ?
                    Object.entries(incomeByCategory).map(([category, amount]) => `
                                <div class="flex justify-between items-center mb-2">
                                    <span class="text-sm">${getCategoryLabel(category)}</span>
                                    <span class="font-bold text-green-600">${fmtMoney(amount)}</span>
                                </div>
                            `).join('') :
                    '<p class="text-gray-400 text-sm text-center">Nenhuma entrada este mês</p>'
                }
                    </div>

                    <div class="bg-white p-4 rounded-xl border border-gray-200">
                        <h4 class="font-bold text-gray-800 mb-3">Saídas por Categoria</h4>
                        ${Object.entries(expenseByCategory).length > 0 ?
                    Object.entries(expenseByCategory).map(([category, amount]) => `
                                <div class="flex justify-between items-center mb-2">
                                    <span class="text-sm">${getCategoryLabel(category)}</span>
                                    <span class="font-bold text-red-600">${fmtMoney(amount)}</span>
                                </div>
                            `).join('') :
                    '<p class="text-gray-400 text-sm text-center">Nenhuma saída este mês</p>'
                }
                    </div>
                </div>
            `;

            document.getElementById('report-result').classList.remove('hide');
            updatePrintHeaders();
        }

        function getCategoryLabel(category) {
            const labels = {
                service: 'Serviços',
                parts: 'Peças',
                supplies: 'Materiais',
                rent: 'Aluguel',
                utilities: 'Contas',
                other: 'Outros'
            };
            return labels[category] || category;
        }

        function shareReportWhatsApp() {
            const currentMonth = new Date().toLocaleDateString('pt-BR', { month: 'long', year: 'numeric' });

            // Recalcular totais rapidamente para o share
            const reportIncome = document.querySelector('#report-content .text-green-600.font-bold')?.innerText || "R$ 0,00";
            const reportExpense = document.querySelector('#report-content .text-red-600.font-bold')?.innerText || "R$ 0,00";
            const reportResult = document.querySelector('#report-content .text-lg.font-bold')?.innerText || "R$ 0,00";

            const message = `📊 *RELATÓRIO MENSAL*%0A` +
                `----------------------------%0A` +
                `📅 *Mês Ref:* ${currentMonth}%0A` +
                `----------------------------%0A` +
                `✅ *Entradas:* ${reportIncome}%0A` +
                `🔻 *Saídas:* ${reportExpense}%0A` +
                `----------------------------%0A` +
                `💰 *LUCRO:* ${reportResult}%0A` +
                `----------------------------%0A` +
                `_Gerado por Plena Assistência_`;

            window.open(`https://wa.me/?text=${message}`, '_blank');
        }

        function printReport() {
            window.print();
        }

        // FECHAMENTO DE CAIXA
        function openClosingModal() {
            const today = new Date().toISOString().split('T')[0];
            const todayTrans = db.transactions.filter(t => t.date === today);

            const income = todayTrans.filter(t => t.type === 'income')
                .reduce((sum, t) => sum + t.amount, 0);
            const expense = todayTrans.filter(t => t.type === 'expense')
                .reduce((sum, t) => sum + t.amount, 0);
            const balance = income - expense;

            document.getElementById('closing-inc').textContent = fmtMoney(income);
            document.getElementById('closing-exp').textContent = fmtMoney(expense);
            document.getElementById('closing-bal').textContent = fmtMoney(balance);
            document.getElementById('closing-date').textContent = fmtDate(today);
            document.getElementById('closing-time').textContent = new Date().toLocaleTimeString('pt-BR', {
                hour: '2-digit',
                minute: '2-digit'
            });

            document.getElementById('closingModal').classList.remove('hidden');
        }

        function shareClosingWhatsApp() {
            const today = new Date().toLocaleDateString('pt-BR');
            const inc = document.getElementById('closing-inc').textContent;
            const exp = document.getElementById('closing-exp').textContent;
            const bal = document.getElementById('closing-bal').textContent;

            const message = `✂️ *FECHAMENTO DE CAIXA*%0A` +
                `----------------------------%0A` +
                `📅 *Data:* ${today}%0A` +
                `🕒 *Hora:* ${new Date().toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' })}%0A` +
                `----------------------------%0A` +
                `✅ *Entradas:* ${inc}%0A` +
                `🔻 *Saídas:* ${exp}%0A` +
                `----------------------------%0A` +
                `💰 *SALDO:* ${bal}%0A` +
                `----------------------------%0A` +
                `_Gerado por Plena Assistência_`;

            window.open(`https://wa.me/?text=${message}`, '_blank');
        }

        function printClosing() {
            window.print();
        }

        // MODAIS
        function openModal(modalId) {
            document.getElementById(modalId).classList.remove('hidden');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.add('hidden');
        }

        // BACKUP E RESTAURAÇÃO
        function downloadBackup() {
            const backupData = {
                ...db,
                exportedAt: new Date().toISOString(),
                version: 'plena_assistencia_v2'
            };

            const dataStr = JSON.stringify(backupData, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,' + encodeURIComponent(dataStr);
            const exportFileName = `plena_assistencia_backup_${new Date().toISOString().slice(0, 10)}.json`;

            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileName);
            linkElement.click();

            showNotification('Backup baixado com sucesso!', 'success');
        }

        function restoreBackup(input) {
            const file = input.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function (e) {
                try {
                    const backup = JSON.parse(e.target.result);
                    
                    // Validação básica de integridade
                    const requiredKeys = ['orders', 'clients', 'transactions', 'settings'];
                    const isValid = requiredKeys.every(key => Array.isArray(backup[key]) || typeof backup[key] === 'object');
                    
                    if (isValid) {
                        if (confirm('Restaurar backup substituirá todos os dados atuais. Tem certeza?')) {
                            // Sanitização profunda do backup antes de carregar
                            const sanitizeObj = (obj) => {
                                if (typeof obj === 'string') return sanitizeHTML(obj);
                                if (Array.isArray(obj)) return obj.map(sanitizeObj);
                                if (typeof obj === 'object' && obj !== null) {
                                    Object.keys(obj).forEach(key => {
                                        obj[key] = sanitizeObj(obj[key]);
                                    });
                                    return obj;
                                }
                                return obj;
                            };
                            
                            db = sanitizeObj(backup);
                            save();
                            alert('Backup restaurado com sucesso! A página será recarregada.');
                            location.reload();
                        }
                    } else {
                        alert('Arquivo de backup inválido ou corrompido.');
                    }
                } catch (err) { 
                    console.error(err);
                    alert('Erro ao ler arquivo. Verifique se é um backup válido.'); 
                }
            };
            reader.readAsText(file);
        }

        function clearOldOrders() {
            const sixMonthsAgo = new Date();
            sixMonthsAgo.setMonth(sixMonthsAgo.getMonth() - 6);
            const sixMonthsAgoStr = sixMonthsAgo.toISOString().split('T')[0];

            const oldOrders = db.orders.filter(o => o.date < sixMonthsAgoStr && o.status === 'delivered');

            if (oldOrders.length === 0) {
                showNotification('Não há ordens antigas para limpar.', 'info');
                return;
            }

            if (confirm(`Tem certeza que deseja limpar ${oldOrders.length} ordens entregues há mais de 6 meses?`)) {
                db.orders = db.orders.filter(o => !(o.date < sixMonthsAgoStr && o.status === 'delivered'));
                save();
                renderDashboard();
                renderOrders();
                showNotification(`${oldOrders.length} ordens antigas removidas!`, 'success');
            }
        }

        function factoryReset() {
            if (confirm('ATENÇÃO: Isso resetará TODO o sistema para as configurações de fábrica. Todos os dados serão perdidos. Tem certeza?')) {
                localStorage.removeItem(DB_KEY);
                location.reload();
            }
        }

        // EXPORTAÇÃO
        function exportOrdersCSV() {
            const headers = ['Nº O.S.', 'Cliente', 'Telefone', 'Equipamento', 'Marca', 'Data Entrada', 'Status', 'Peças', 'Mão de Obra', 'Desconto', 'Total'];
            const rows = db.orders.map(o => {
                return [
                    o.id,
                    `"${o.client}"`,
                    o.phone || '',
                    `"${o.device}"`,
                    o.brand || '',
                    fmtDate(o.date),
                    statusColors[o.status]?.label || 'Recebido',
                    o.parts?.toFixed(2).replace('.', ',') || '0,00',
                    o.labor?.toFixed(2).replace('.', ',') || '0,00',
                    o.discount?.toFixed(2).replace('.', ',') || '0,00',
                    o.total?.toFixed(2).replace('.', ',') || '0,00'
                ];
            });

            const csv = [headers, ...rows].map(row => row.join(';')).join('\n');
            const blob = new Blob(['\uFEFF' + csv], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');

            a.href = url;
            a.download = `ordens_servico_${new Date().toISOString().slice(0, 10)}.csv`;
            a.click();

            URL.revokeObjectURL(url);
            showNotification('CSV exportado com sucesso!', 'success');
        }

        function printOrderList() {
            window.print();
        }

        // CABEÇALHO CORPORATIVO
        function updatePrintHeaders() {
            const s = db.settings;
            // Layout profissional do cabeçalho
            const headerHTML = `
                <div class="flex flex-col items-center border-b-2 border-gray-800 pb-4 mb-6 print-header">
                    <h2 class="text-2xl font-bold text-gray-800 uppercase tracking-widest text-center">${s.companyName || 'ASSISTÊNCIA TÉCNICA'}</h2>
                    <div class="text-xs font-medium text-gray-500 flex flex-wrap justify-center gap-3 mt-2 uppercase tracking-wide">
                        ${s.companyDoc ? `<span>CNPJ/CPF: ${s.companyDoc}</span>` : ''}
                        ${s.companyPhone ? `<span>• Tel: ${s.companyPhone}</span>` : ''}
                    </div>
                    <p class="text-[10px] text-gray-400 mt-1 uppercase text-center">${s.companyAddress || ''}</p>
                </div>
            `;

            // Containers onde o cabeçalho deve ser injetado
            const containers = [
                document.getElementById('invoice-print'),      // Modal de O.S.
                document.getElementById('report-result'),      // Relatórios
                document.querySelector('#closingModal .p-6')   // Fechamento de Caixa
            ];

            containers.forEach(container => {
                if (!container) return;

                // Verifica se já existe um cabeçalho lá dentro
                const existingHeader = container.querySelector('.print-header');

                if (existingHeader) {
                    // Se existe, atualiza o HTML dele
                    existingHeader.outerHTML = headerHTML;
                } else {
                    // Se não existe, insere no topo (início) do container
                    container.insertAdjacentHTML('afterbegin', headerHTML);
                }
            });
        }

        // UTILITÁRIOS GERAIS
        function updateDataStatus() {
            const totalOrders = db.orders.length;
            const totalClients = db.clients.length;
            const totalTrans = db.transactions.length;

            console.log(`Dados atualizados: ${totalOrders} O.S., ${totalClients} clientes, ${totalTrans} transações`);
        }

        function showNotification(message, type = 'info') {
            // Criar elemento de notificação
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 z-50 px-4 py-3 rounded-lg shadow-lg transform transition-all duration-300 ${type === 'success' ? 'bg-green-500 text-white' :
                type === 'error' ? 'bg-red-500 text-white' :
                    'bg-blue-500 text-white'
                }`;
            notification.innerHTML = `
                <div class="flex items-center">
                    <i data-lucide="${type === 'success' ? 'check-circle' : type === 'error' ? 'alert-circle' : 'info'}" 
                       class="w-5 h-5 mr-2"></i>
                    <span>${message}</span>
                </div>
            `;

            document.body.appendChild(notification);
            lucide.createIcons();

            // Remover após 3 segundos
            setTimeout(() => {
                notification.style.opacity = '0';
                notification.style.transform = 'translateX(100%)';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }



        /****************************************************
         * FUNÇÕES DO MANUAL DE USO INTERATIVO
         ****************************************************/

        // Rolar suavemente para uma seção específica do manual
        function scrollToSection(sectionId) {
            const element = document.getElementById(sectionId);
            if (element) {
                element.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        }

        // Marcar uma seção do tutorial como concluída
        function markSectionComplete(sectionId) {
            const completedSections = JSON.parse(localStorage.getItem('plena_manual_completed') || '[]');
            if (!completedSections.includes(sectionId)) {
                completedSections.push(sectionId);
                localStorage.setItem('plena_manual_completed', JSON.stringify(completedSections));
                updateTutorialProgress();
                showNotification('Seção marcada como concluída!', 'success');
            }
        }

        // Atualizar barra de progresso do tutorial
        function updateTutorialProgress() {
            const sections = ['instalacao', 'primeiro-cadastro', 'os-management', 'relatorios', 'backup', 'duvidas', 'checklist'];
            const completedSections = JSON.parse(localStorage.getItem('plena_manual_completed') || '[]');

            const progress = (completedSections.length / sections.length) * 100;

            const progressBar = document.getElementById('tutorial-progress');
            const completedSteps = document.getElementById('completed-steps');

            if (progressBar) progressBar.style.width = `${progress}%`;
            if (completedSteps) completedSteps.textContent = `${completedSections.length}/${sections.length} etapas`;

            // Atualizar visual dos botões das seções
            sections.forEach(sectionId => {
                const button = document.querySelector(`[onclick="scrollToSection('${sectionId}')"]`);
                if (button) {
                    if (completedSections.includes(sectionId)) {
                        button.classList.add('bg-green-100', 'border-green-300');
                        button.classList.remove('border-gray-200');
                    }
                }
            });
        }

        // Atualizar checklist interativo
        function updateChecklist() {
            const checkboxes = document.querySelectorAll('#checklist input[type="checkbox"]');
            if (!checkboxes.length) return; // Se não houver checklist, sair

            const total = checkboxes.length;
            const checked = document.querySelectorAll('#checklist input[type="checkbox"]:checked').length;

            const percent = Math.round((checked / total) * 100);

            // Atualizar progresso visual
            const percentElement = document.getElementById('checklist-percent');
            const progressElement = document.getElementById('checklist-progress');
            const completedElement = document.getElementById('checklist-completed');
            const totalElement = document.getElementById('checklist-total');

            if (percentElement) percentElement.textContent = `${percent}%`;
            if (progressElement) progressElement.style.width = `${percent}%`;
            if (completedElement) completedElement.textContent = checked;
            if (totalElement) totalElement.textContent = total;

            // Atualizar próximas tarefas
            const nextTasks = document.getElementById('next-tasks');
            if (nextTasks) {
                const uncheckedItems = Array.from(checkboxes)
                    .filter(cb => !cb.checked)
                    .slice(0, 3)
                    .map(cb => {
                        const label = document.querySelector(`label[for=" ${cb.id}"]`);
                        return label ? label.textContent.trim() : '';
                    })
                    .filter(text => text !== '');

                if (uncheckedItems.length > 0) {
                    nextTasks.innerHTML = uncheckedItems.map(task => `
                        <div class="flex items-center">
                            <i data-lucide="circle" class="w-3 h-3 text-white/60 mr-2"></i>
                            <span class="text-xs text-white/90">${task}</span>
                        </div>
                    `).join('');
                } else {
                    nextTasks.innerHTML = `
                        <div class="flex items-center">
                            <i data-lucide="check-circle" class="w-3 h-3 text-green-400 mr-2"></i>
                            <span class="text-xs text-white/90">Todas as tarefas concluídas!</span>
                        </div>
                    `;
                }

                // Recriar ícones do Lucide
                if (window.lucide) lucide.createIcons();
            }

            // Atualizar estado visual dos itens
            checkboxes.forEach(cb => {
                const item = cb.closest('.checklist-item');
                if (item) {
                    if (cb.checked) {
                        item.classList.add('completed');
                    } else {
                        item.classList.remove('completed');
                    }
                }
            });

            // Salvar estado no localStorage
            const checklistState = {};
            checkboxes.forEach(cb => {
                checklistState[cb.id] = cb.checked;
            });
            localStorage.setItem('plena_checklist_state', JSON.stringify(checklistState));
        }

        // Resetar checklist
        function resetChecklist() {
            if (confirm('Tem certeza que deseja reiniciar todas as tarefas do checklist?')) {
                const checkboxes = document.querySelectorAll('#checklist input[type="checkbox"]');
                checkboxes.forEach(cb => {
                    cb.checked = false;
                });
                updateChecklist();
                localStorage.removeItem('plena_checklist_state');
                showNotification('Checklist reiniciado com sucesso!', 'success');
            }
        }

        // Carregar estado do checklist ao abrir a página
        function loadChecklistState() {
            const savedState = JSON.parse(localStorage.getItem('plena_checklist_state') || '{}');
            Object.keys(savedState).forEach(id => {
                const checkbox = document.getElementById(id);
                if (checkbox) {
                    checkbox.checked = savedState[id];
                }
            });
            updateChecklist();
        }

        // Mostrar exemplo (para botões de demonstração no manual)
        function showExample(type) {
            if (type === 'whatsapp') {
                alert('Exemplo de O.S. WhatsApp:\n\n' +
                    '🔧 *ORDEM DE SERVIÇO*\n' +
                    '----------------------------\n' +
                    '👤 *Cliente:* João Silva\n' +
                    '📱 *Equipamento:* iPhone 12 Pro\n' +
                    '----------------------------\n' +
                    '🛠️ *Defeito:* Tela quebrada\n' +
                    '📅 *Data:* 18/12/2025\n' +
                    '🏷️ *O.S. #:* 00123\n' +
                    '----------------------------\n' +
                    '✅ *Status:* Em Análise\n' +
                    '_Gerado por Plena Assistência_');
            } else if (type === 'formal') {
                alert('Exemplo de O.S. formal (PDF):\n\n' +
                    'Será aberta uma janela de impressão com:\n' +
                    '- Dados da sua empresa\n' +
                    '- Dados completos do cliente\n' +
                    '- Descrição do equipamento e defeito\n' +
                    '- Diagnóstico e orçamento\n' +
                    '- Valores de peças e mão de obra\n' +
                    '- Prazo de garantia\n' +
                    '\nClique em "Imprimir" para gerar PDF.');
            }
        }

        /****************************************************
         * FIM DAS FUNÇÕES DO MANUAL DE USO
         ****************************************************/



        // OFFLINE SUPPORT
        window.addEventListener('online', () => {
            showNotification('Conexão restaurada!', 'success');
        });

        window.addEventListener('offline', () => {
            showNotification('Modo offline ativado. Seus dados estão seguros localmente.', 'warning');
        });

        // PWA & Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('sw.js')
                    .then(reg => console.log('SW registered'))
                    .catch(err => console.log('SW error', err));
            });
        }

        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            const pwaCard = document.getElementById('pwa-install-card');
            if (pwaCard) pwaCard.classList.remove('hidden');
        });

        window.installPWA = async function() {
            if (!deferredPrompt) return;
            deferredPrompt.prompt();
            const { outcome } = await deferredPrompt.userChoice;
            if (outcome === 'accepted') {
                deferredPrompt = null;
                const pwaCard = document.getElementById('pwa-install-card');
                if (pwaCard) pwaCard.classList.add('hidden');
            }
        };

        // INICIALIZAR APLICATIVO
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>

</html>