<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plena Nexus ERP v1.0</title>

    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- FontAwesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <!-- Google Fonts: Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        :root {
            --sidebar-width: 260px;
            --primary-bg: #f3f4f6;
            --sidebar-bg: #111827;
            --sidebar-color: #9ca3af;
            --sidebar-active-bg: #0d6efd;
            --sidebar-active-color: #ffffff;
        }

        body {
            background-color: var(--primary-bg);
            font-family: 'Inter', sans-serif;
            overflow-x: hidden;
        }

        /* Layout */
        .wrapper {
            display: flex;
            width: 100%;
            align-items: stretch;
        }

        #sidebar {
            min-width: var(--sidebar-width);
            max-width: var(--sidebar-width);
            background: var(--sidebar-bg);
            color: var(--sidebar-color);
            transition: all 0.3s;
            min-height: 100vh;
            position: fixed;
            z-index: 1000;
        }

        #content {
            width: 100%;
            padding: 20px;
            margin-left: var(--sidebar-width);
            transition: all 0.3s;
        }

        /* Sidebar Elements */
        .sidebar-header {
            padding: 20px;
            background: #0f172a;
            border-bottom: 1px solid #1f2937;
        }

        #sidebar ul.components {
            padding: 20px 0;
        }

        .sidebar-section-header {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: #6b7280;
            padding: 0 25px;
            margin-top: 1.5rem;
            margin-bottom: 0.5rem;
            font-weight: 700;
        }

        #sidebar ul li a {
            padding: 10px 25px;
            font-size: 0.95em;
            display: block;
            color: var(--sidebar-color);
            text-decoration: none;
            display: flex;
            align-items: center;
            border-left: 3px solid transparent;
        }

        #sidebar ul li a:hover {
            color: #fff;
            background: #1f2937;
        }

        #sidebar ul li.active>a {
            color: #fff;
            background: var(--sidebar-active-bg);
            border-left-color: #fff;
            margin: 0 10px;
            border-radius: 6px;
            border-left: none;
        }

        #sidebar ul li a i {
            width: 25px;
            text-align: center;
            margin-right: 10px;
        }

        /* Utility */
        .card {
            border: none;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
            margin-bottom: 1.5rem;
            border-radius: 0.5rem;
        }

        .card-header {
            background-color: #fff;
            border-bottom: 1px solid #e5e7eb;
            font-weight: 600;
            padding: 1rem 1.25rem;
            border-radius: 0.5rem 0.5rem 0 0 !important;
        }

        .table> :not(caption)>*>* {
            padding: 1rem 1rem;
            border-bottom-color: #e5e7eb;
        }

        .avatar {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            font-weight: 600;
            font-size: 12px;
        }

        .status-badge {
            padding: 4px 8px;
            border-radius: 9999px;
            font-size: 12px;
            font-weight: 500;
        }

        .status-success {
            background-color: #d1fae5;
            color: #065f46;
        }

        .status-warning {
            background-color: #fef3c7;
            color: #92400e;
        }

        .status-danger {
            background-color: #fee2e2;
            color: #991b1b;
        }

        .status-info {
            background-color: #dbeafe;
            color: #1e40af;
        }

        .status-neutral {
            background-color: #f3f4f6;
            color: #374151;
        }

        .form-control:focus,
        .form-select:focus {
            border-color: #3b82f6;
            box-shadow: 0 0 0 0.25rem rgba(59, 130, 246, 0.25);
        }

        .spin-icon {
            animation: fa-spin 2s infinite linear;
        }

        /* Timeline for Logs/Notifications */
        .timeline-item {
            position: relative;
            padding-left: 20px;
            border-left: 2px solid #e5e7eb;
            padding-bottom: 15px;
        }

        .timeline-item::before {
            content: '';
            position: absolute;
            left: -6px;
            top: 5px;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #fff;
            border: 2px solid #6b7280;
        }

        .timeline-item.success::before {
            border-color: #10b981;
            background: #d1fae5;
        }

        .timeline-item.info::before {
            border-color: #3b82f6;
            background: #dbeafe;
        }

        .timeline-item.danger::before {
            border-color: #ef4444;
            background: #fee2e2;
        }

        [v-cloak] {
            display: none;
        }
    </style>
</head>

<body>
    <div id="app" v-cloak>
        <!-- Login Overlay -->
        <div v-if="!isAuthenticated"
            class="d-flex align-items-center justify-content-center vh-100 bg-dark position-fixed w-100 start-0 top-0"
            style="z-index: 9999; --bs-bg-opacity: .95;">
            <div class="card border-0 shadow-lg" style="width: 100%; max-width: 380px;">
                <div class="card-body p-5 text-center">
                    <div class="mb-4 text-primary">
                        <i class="fa-solid fa-layer-group fa-3x"></i>
                    </div>
                    <h4 class="fw-bold mb-1">Plena Nexus</h4>
                    <p class="text-muted small mb-4">Ambiente Administrativo Seguro</p>

                    <form @submit.prevent="login">
                        <div class="form-floating mb-3">
                            <input type="password" class="form-control" id="floatingPassword" placeholder="Senha"
                                v-model="loginPassword">
                            <label for="floatingPassword">Senha de Acesso</label>
                        </div>
                        <button class="btn btn-primary w-100 py-2 fw-bold" type="submit">
                            <i class="fa-solid fa-lock-open me-2"></i> Autenticar
                        </button>
                    </form>
                </div>
            </div>
        </div>

        <!-- Main Content Wrapper -->
        <div class="wrapper" v-if="isAuthenticated">
            <!-- Sidebar -->
            <nav id="sidebar">
                <div class="sidebar-header d-flex align-items-center">
                    <i class="fa-solid fa-layer-group fa-lg me-2 text-primary"></i>
                    <h5 class="mb-0 fw-bold text-white">Plena ERP</h5>
                </div>

                <ul class="list-unstyled components">

                    <!-- GRUPO 1 -->
                    <div class="sidebar-section-header">Gest√£o Comercial</div>
                    <li :class="{ active: currentTab === 'dashboard' }">
                        <a href="#" @click.prevent="currentTab = 'dashboard'">
                            <i class="fa-solid fa-chart-line"></i> Dashboard
                        </a>
                    </li>
                    <li :class="{ active: currentTab === 'vendas' }">
                        <a href="#" @click.prevent="currentTab = 'vendas'">
                            <i class="fa-solid fa-sack-dollar"></i> Vendas
                        </a>
                    </li>
                    <li :class="{ active: currentTab === 'crm' }">
                        <a href="#" @click.prevent="currentTab = 'crm'">
                            <i class="fa-solid fa-users"></i> CRM & Clientes
                        </a>
                    </li>

                    <!-- GRUPO 2 -->
                    <div class="sidebar-section-header">Produtos & Acesso</div>
                    <li :class="{ active: currentTab === 'licencas' }">
                        <a href="#" @click.prevent="currentTab = 'licencas'">
                            <i class="fa-solid fa-key"></i> Licen√ßas
                        </a>
                    </li>
                    <li :class="{ active: currentTab === 'apps' }">
                        <a href="#" @click.prevent="currentTab = 'apps'">
                            <i class="fa-solid fa-store"></i> Cat√°logo Apps
                        </a>
                    </li>
                    <li :class="{ active: currentTab === 'parceiros' }">
                        <a href="#" @click.prevent="currentTab = 'parceiros'">
                            <i class="fa-solid fa-handshake"></i> Parceiros
                        </a>
                    </li>

                    <!-- GRUPO 3 (NOVO) -->
                    <div class="sidebar-section-header">Comunica√ß√£o</div>
                    <li :class="{ active: currentTab === 'notificacoes' }">
                        <a href="#" @click.prevent="currentTab = 'notificacoes'">
                            <i class="fa-solid fa-bullhorn"></i> Notifica√ß√µes
                        </a>
                    </li>

                    <!-- GRUPO 4 -->
                    <div class="sidebar-section-header">Infraestrutura</div>
                    <li :class="{ active: currentTab === 'financeiro' }">
                        <a href="#" @click.prevent="currentTab = 'financeiro'">
                            <i class="fa-solid fa-wallet"></i> Financeiro
                        </a>
                    </li>
                    <li :class="{ active: currentTab === 'sistema' }">
                        <a href="#" @click.prevent="currentTab = 'sistema'">
                            <i class="fa-solid fa-server"></i> Sistema (DevOps)
                        </a>
                    </li>
                </ul>
            </nav>

            <!-- Page Content -->
            <div id="content">
                <!-- Navbar -->
                <nav class="navbar navbar-expand-lg navbar-light bg-white rounded shadow-sm mb-4 p-3">
                    <div class="container-fluid">
                        <h4 class="mb-0 text-gray-800">{{ getTabTitle(currentTab) }}</h4>
                        <div class="ms-auto d-flex align-items-center">
                            <button class="btn btn-outline-secondary me-3" title="Atualizar"
                                @click="runSystemDiagnosis">
                                <i class="fa-solid fa-sync" :class="{'spin-icon': diagnosisLoading}"></i>
                            </button>
                            <div class="d-flex align-items-center">
                                <div class="me-3 text-end d-none d-md-block">
                                    <span class="d-block small text-muted">Administrador</span>
                                    <span class="fw-bold fs-6">Super Admin</span>
                                </div>
                                <div class="avatar bg-primary text-white">SA</div>
                            </div>
                        </div>
                    </div>
                </nav>

                <!-- 1. DASHBOARD BI -->
                <div v-if="currentTab === 'dashboard'">
                    <!-- KPIs -->
                    <div class="row g-4 mb-4">
                        <div class="col-md-3">
                            <div class="card h-100 border-start border-4 border-primary">
                                <div class="card-body">
                                    <h6 class="text-muted small text-uppercase mb-2">Faturamento (M√™s)</h6>
                                    <h3 class="fw-bold mb-0">R$ {{ formatMoney(kpi.faturamento) }}</h3>
                                    <small class="text-success"><i class="fa-solid fa-arrow-up"></i> 12% vs m√™s
                                        anterior</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card h-100 border-start border-4 border-success">
                                <div class="card-body">
                                    <h6 class="text-muted small text-uppercase mb-2">MRR (Recorrente)</h6>
                                    <h3 class="fw-bold mb-0">R$ {{ formatMoney(kpi.mrr) }}</h3>
                                    <small class="text-muted">Receita fixa mensal</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card h-100 border-start border-4 border-info">
                                <div class="card-body">
                                    <h6 class="text-muted small text-uppercase mb-2">Licen√ßas Ativas</h6>
                                    <h3 class="fw-bold mb-0">{{ kpi.licencas }}</h3>
                                    <small class="text-success">+5 novas hoje</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card h-100 border-start border-4 border-warning">
                                <div class="card-body">
                                    <h6 class="text-muted small text-uppercase mb-2">Renova√ß√µes (7 dias)</h6>
                                    <h3 class="fw-bold mb-0">{{ kpi.tickets }}</h3>
                                    <small class="text-danger" v-if="kpi.tickets > 0">{{ kpi.tickets }} vencendo em
                                        breve</small>
                                    <small class="text-success" v-else>Tudo em dia!</small>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- BI: Gr√°fico e Ranking -->
                    <div class="row g-4 mb-4">
                        <!-- Gr√°fico Evolu√ß√£o -->
                        <div class="col-md-8">
                            <div class="card h-100">
                                <div class="card-header bg-white">
                                    <i class="fa-solid fa-chart-area me-2 text-primary"></i> Evolu√ß√£o Financeira (6
                                    Meses)
                                </div>
                                <div class="card-body">
                                    <canvas id="revenueChart" style="max-height: 300px;"></canvas>
                                </div>
                            </div>
                        </div>

                        <!-- Ranking Top Produtos -->
                        <div class="col-md-4">
                            <div class="card h-100">
                                <div class="card-header bg-white">
                                    <i class="fa-solid fa-trophy me-2 text-warning"></i> Top Produtos
                                </div>
                                <div class="card-body">
                                    <div v-for="(prod, index) in topProducts" :key="index" class="mb-4">
                                        <div class="d-flex justify-content-between align-items-center mb-1">
                                            <div class="d-flex align-items-center">
                                                <span class="fs-5 me-2" v-if="index === 0">ü•á</span>
                                                <span class="fs-5 me-2" v-if="index === 1">ü•à</span>
                                                <span class="fs-5 me-2" v-if="index === 2">ü•â</span>
                                                <span class="fw-bold text-dark">{{ prod.name }}</span>
                                            </div>
                                            <small class="text-muted">{{ prod.sales }} vendas</small>
                                        </div>
                                        <div class="progress" style="height: 6px;">
                                            <div class="progress-bar"
                                                :class="index === 0 ? 'bg-warning' : (index === 1 ? 'bg-secondary' : 'bg-primary')"
                                                role="progressbar" :style="{ width: prod.percent + '%' }"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Activity Feed (New) -->
                    <div class="card mb-4">
                        <div class="card-header bg-white">
                            <i class="fa-solid fa-bolt me-2 text-warning"></i> Atividade Recente
                        </div>
                        <div class="card-body p-0">
                            <div class="list-group list-group-flush">
                                <div v-for="(log, i) in realTimeLogs.slice(0, 5)" :key="i"
                                    class="list-group-item d-flex justify-content-between align-items-center">
                                    <div>
                                        <span class="badge me-2" :class="getLogLevelClass(log.level)">{{ log.level
                                            }}</span>
                                        <span class="small">{{ log.msg }}</span>
                                    </div>
                                    <small class="text-muted">{{ log.ts }}</small>
                                </div>
                                <div v-if="realTimeLogs.length === 0" class="p-3 text-center text-muted small">
                                    Nenhuma atividade recente registrada.
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- √öltimas Vendas -->
                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center bg-white">
                            <span>√öltimas Vendas</span>
                            <a href="#" @click.prevent="currentTab = 'vendas'" class="btn btn-sm btn-link">Ver todas</a>
                        </div>
                        <div class="table-responsive">
                            <table class="table table-hover mb-0 align-middle">
                                <thead class="bg-light">
                                    <tr>
                                        <th>Data</th>
                                        <th>Cliente</th>
                                        <th>Produto</th>
                                        <th>Valor</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr v-for="venda in vendas.slice(0, 5)" :key="venda.id">
                                        <td>{{ formatDate(venda.data) }}</td>
                                        <td>
                                            <div class="fw-bold">{{ venda.cliente }}</div>
                                            <small class="text-muted">{{ venda.email }}</small>
                                        </td>
                                        <td>{{ venda.produto }}</td>
                                        <td>R$ {{ formatMoney(venda.valor) }}</td>
                                        <td>
                                            <span class="status-badge" :class="getStatusClass(venda.status)">
                                                {{ getStatusLabel(venda.status) }}
                                            </span>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- 2. VENDAS (TRANSLATED) -->
                <div v-if="currentTab === 'vendas'">
                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <div class="row align-items-center flex-grow-1">
                                <div class="col">
                                    <input type="text" class="form-control form-control-sm" v-model="salesSearch"
                                        placeholder="Buscar transa√ß√£o...">
                                </div>
                                <div class="col-auto">
                                    <select class="form-select form-select-sm" v-model="salesStatusFilter">
                                        <option value="">Todos Status</option>
                                        <option value="paid">Confirmado/Pago</option>
                                        <option value="pending">Pendente</option>
                                        <option value="refunded">Estornado</option>
                                    </select>
                                </div>
                            </div>
                            <button class="btn btn-sm btn-success ms-3" @click="openNewLicenseModal"><i
                                    class="fa-solid fa-plus"></i> Nova Venda Manual</button>
                        </div>
                        <div class="table-responsive">
                            <table class="table table-hover mb-0 align-middle">
                                <thead class="bg-light">
                                    <tr>
                                        <th>ID Transa√ß√£o</th>
                                        <th>Data</th>
                                        <th>Cliente</th>
                                        <th>Produto</th>
                                        <th>Valor</th>
                                        <th>Status</th>
                                        <th class="text-end">A√ß√µes</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr v-for="venda in filteredSales" :key="venda.id">
                                        <td class="font-monospace text-muted small">#{{ venda.mp_id }}</td>
                                        <td>{{ formatDate(venda.data) }}</td>
                                        <td>
                                            <div class="fw-bold">{{ venda.cliente }}</div>
                                            <small class="text-muted">{{ venda.email }}</small>
                                        </td>
                                        <td>{{ venda.produto }}</td>
                                        <td class="fw-bold">R$ {{ formatMoney(venda.valor) }}</td>
                                        <td>
                                            <span class="status-badge" :class="getStatusClass(venda.status)">
                                                {{ getStatusLabel(venda.status) }}
                                            </span>
                                        </td>
                                        <td class="text-end">
                                            <button class="btn btn-sm btn-light" title="Ver Detalhes"><i
                                                    class="fa-solid fa-eye"></i></button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- 3. LICEN√áAS -->
                <div v-if="currentTab === 'licencas'">
                    <div class="card">
                        <div class="card-header d-flex justify-content-between">
                            <div class="d-flex gap-2">
                                <input type="text" class="form-control form-control-sm"
                                    placeholder="Buscar Licen√ßa/Cliente" style="width: 250px;">
                                <button class="btn btn-sm btn-primary">Filtrar</button>
                            </div>
                            <button class="btn btn-sm btn-success" @click="openNewLicenseModal"><i
                                    class="fa-solid fa-plus"></i> Nova Manual</button>
                        </div>
                        <div class="table-responsive">
                            <table class="table table-hover mb-0 align-middle">
                                <thead class="bg-light">
                                    <tr>
                                        <th>Chave</th>
                                        <th>Cliente</th>
                                        <th>Produto</th>
                                        <th>Tipo</th>
                                        <th>Desde</th>
                                        <th>Vencimento</th>
                                        <th>Device ID</th>
                                        <th>Status</th>
                                        <th class="text-end">A√ß√µes</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr v-for="lic in licencas" :key="lic.key">
                                        <td class="font-monospace small text-primary user-select-all">{{ lic.key }}</td>
                                        <td>
                                            <div class="fw-bold">{{ lic.cliente }}</div>
                                        </td>
                                        <td>{{ lic.produto }}</td>
                                        <td>
                                            <span v-if="lic.type === 'lifetime'" class="text-success fw-bold"><i
                                                    class="fa-solid fa-infinity"></i> Vital√≠cio</span>
                                            <span v-else>{{ formatDate(lic.expires_at) }}</span>
                                        </td>
                                        <td>
                                            <small class="text-muted">{{ lic.activated_at ? formatDate(lic.activated_at)
                                                : '‚Äî' }}</small>
                                        </td>
                                        <td>
                                            <span class="font-monospace small text-muted">
                                                {{ lic.device_id ? lic.device_id.substring(0,8) + '...' : '‚Äî' }}
                                            </span>
                                        </td>
                                        <td>
                                            <span class="status-badge"
                                                :class="lic.status === 'active' ? 'status-success' : 'status-danger'">
                                                {{ lic.status === 'active' ? 'Ativo' : 'Bloqueado' }}
                                            </span>
                                        </td>
                                        <td class="text-end">
                                            <div class="btn-group btn-group-sm">
                                                <button class="btn btn-light text-primary" title="Renovar +30d"
                                                    @click="renewLicense(lic)"><i
                                                        class="fa-solid fa-calendar-plus"></i></button>
                                                <button class="btn btn-light text-danger"
                                                    title="Desvincular Dispositivo" @click="resetDevice(lic)"
                                                    v-if="lic.device_id"><i
                                                        class="fa-solid fa-mobile-screen-button"></i></button>
                                                <button class="btn btn-light text-danger" title="Bloquear"
                                                    @click="toggleBlock(lic)"><i class="fa-solid fa-lock"></i></button>
                                                <button class="btn btn-light text-primary" title="Editar"
                                                    @click="openEditModal(lic)"><i class="fa-solid fa-pen"></i></button>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- 4. CRM -->
                <div v-if="currentTab === 'crm'">
                    <div class="row">
                        <div class="col-md-8">
                            <div class="card">
                                <div class="card-header bg-white d-flex justify-content-between align-items-center">
                                    <span>Clientes & Leads</span>
                                    <button class="btn btn-sm btn-primary" @click="openLeadModal()"><i
                                            class="fa-solid fa-plus"></i> Novo Lead</button>
                                </div>
                                <div class="table-responsive">
                                    <table class="table table-hover mb-0 align-middle">
                                        <thead class="bg-light">
                                            <tr>
                                                <th>Nome</th>
                                                <th>Email</th>
                                                <th>Telefone</th>
                                                <th>Origem</th>
                                                <th class="text-end">Contato</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr v-for="lead in leads" :key="lead.id">
                                                <td>{{ lead.name }}</td>
                                                <td>{{ lead.email }}</td>
                                                <td>{{ lead.phone }}</td>
                                                <td>
                                                    <span class="badge bg-light text-dark border">{{ lead.source
                                                        }}</span>
                                                </td>
                                                <td class="text-end">
                                                    <div class="btn-group btn-group-sm">
                                                        <a :href="'https://wa.me/55'+lead.phone.replace(/\D/g,'')"
                                                            target="_blank" class="btn btn-success text-white"
                                                            title="WhatsApp">
                                                            <i class="fa-brands fa-whatsapp"></i>
                                                        </a>
                                                        <button class="btn btn-light text-primary"
                                                            @click="openLeadModal(lead)" title="Editar">
                                                            <i class="fa-solid fa-pen"></i>
                                                        </button>
                                                        <button class="btn btn-light text-danger"
                                                            @click="deleteLead(lead.id)" title="Excluir">
                                                            <i class="fa-solid fa-trash"></i>
                                                        </button>
                                                    </div>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card bg-white">
                                <div class="card-body text-center">
                                    <h5 class="card-title text-muted mb-4">Funil de Vendas</h5>
                                    <div class="d-flex justify-content-around mb-3">
                                        <div>
                                            <h2>1,240</h2>
                                            <small class="text-muted">Visitantes</small>
                                        </div>
                                        <div class="border-end"></div>
                                        <div>
                                            <h2 class="text-warning">45</h2>
                                            <small class="text-muted">Leads</small>
                                        </div>
                                        <div class="border-end"></div>
                                        <div>
                                            <h2 class="text-success">12</h2>
                                            <small class="text-muted">Vendas</small>
                                        </div>
                                    </div>
                                    <div class="progress" style="height: 10px;">
                                        <div class="progress-bar bg-primary" role="progressbar" style="width: 100%">
                                        </div>
                                        <div class="progress-bar bg-warning" role="progressbar" style="width: 15%">
                                        </div>
                                        <div class="progress-bar bg-success" role="progressbar" style="width: 5%"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div v-if="currentTab === 'financeiro'">
                    <!-- KPI Cards -->
                    <div class="row g-4 mb-4">
                        <div class="col-md-4">
                            <div class="card bg-primary text-white h-100">
                                <div class="card-body">
                                    <h6 class="card-title opacity-75">Saldo Dispon√≠vel</h6>
                                    <h2 class="fw-bold">R$ {{ formatMoney(financeiro.saldo) }}</h2>
                                    <small class="opacity-75"><i class="fa-solid fa-wallet"></i> Caixa Geral</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card bg-success text-white h-100">
                                <div class="card-body">
                                    <h6 class="card-title opacity-75">Receitas (Total)</h6>
                                    <h2 class="fw-bold">R$ {{ formatMoney(financeiro.receitas) }}</h2>
                                    <small class="opacity-75"><i class="fa-solid fa-arrow-trend-up"></i>
                                        Acumulado</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card bg-danger text-white h-100">
                                <div class="card-body">
                                    <h6 class="card-title opacity-75">Despesas (Total)</h6>
                                    <h2 class="fw-bold">R$ {{ formatMoney(financeiro.despesas) }}</h2>
                                    <small class="opacity-75"><i class="fa-solid fa-arrow-trend-down"></i>
                                        Acumulado</small>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Extrato Table -->
                    <div class="card">
                        <div class="card-header bg-white d-flex justify-content-between align-items-center py-3">
                            <h5 class="mb-0">Extrato Financeiro</h5>
                            <button class="btn btn-primary btn-sm" @click="openFinanceModal">
                                <i class="fa-solid fa-plus me-1"></i> Lan√ßar Movimenta√ß√£o
                            </button>
                        </div>
                        <div class="table-responsive">
                            <table class="table table-hover mb-0 align-middle">
                                <thead class="bg-light">
                                    <tr>
                                        <th>Data</th>
                                        <th>Descri√ß√£o</th>
                                        <th>Categoria</th>
                                        <th class="text-end">Valor</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr v-for="t in financeiro.transacoes" :key="t.id">
                                        <td class="small text-muted">{{ formatDateTime(t.date) }}</td>
                                        <td>
                                            <div class="fw-bold">{{ t.description }}</div>
                                            <small class="text-muted font-monospace" v-if="t.related_id">Ref: {{
                                                t.related_id }}</small>
                                        </td>
                                        <td>
                                            <span class="badge bg-light text-dark border">{{ t.category }}</span>
                                        </td>
                                        <td class="text-end fw-bold"
                                            :class="t.type === 'income' ? 'text-success' : 'text-danger'">
                                            {{ t.type === 'income' ? '+' : '-' }} R$ {{ formatMoney(t.amount) }}
                                        </td>
                                    </tr>
                                    <tr v-if="financeiro.transacoes.length === 0">
                                        <td colspan="4" class="text-center py-4 text-muted">
                                            Nenhuma transa√ß√£o encontrada.
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- 6. CAT√ÅLOGO APPS -->
                <div v-if="currentTab === 'apps'">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h5 class="mb-0">Meus Aplicativos</h5>
                        <button class="btn btn-outline-secondary" @click="refreshData"><i class="fa-solid fa-sync"></i>
                            Atualizar Lista</button>
                    </div>
                    <div class="row g-4">
                        <div v-for="app in apps" :key="app.id" class="col-md-4 col-lg-3">
                            <div class="card h-100">
                                <div class="card-body text-center">
                                    <div class="avatar bg-light text-primary mx-auto mb-3"
                                        style="width: 60px; height: 60px; font-size: 24px;">
                                        <i class="fa-solid fa-store"></i>
                                    </div>
                                    <h5 class="card-title mb-1">{{ app.name }}</h5>
                                    <p class="text-muted small mb-3">ID: {{ app.slug }}</p>

                                    <p class="text-muted small mb-3">ID: {{ app.slug }}</p>

                                    <h4 class="fw-bold mb-3">R$ {{ formatMoney(app.price) }}</h4>

                                    <div class="d-grid gap-2 mb-3">
                                        <button class="btn btn-outline-dark btn-sm" @click="openEditAppModal(app)">
                                            <i class="fa-solid fa-cog"></i> Gerenciar Produto
                                        </button>
                                    </div>

                                    <div class="d-grid gap-2">
                                        <button class="btn btn-sm btn-outline-primary" @click="copyCheckout(app)">
                                            <i class="fa-solid fa-link"></i> Copiar Link
                                        </button>
                                        <button class="btn btn-sm btn-outline-secondary">
                                            <i class="fa-solid fa-tag"></i> Oferta
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 7. PARCEIROS -->
                <div v-if="currentTab === 'parceiros'">
                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <span>Programa de Afiliados</span>
                            <button class="btn btn-sm btn-success" @click="openPartnerModal"><i
                                    class="fa-solid fa-plus"></i> Novo
                                Parceiro</button>
                        </div>
                        <div class="table-responsive">
                            <table class="table table-hover mb-0 align-middle">
                                <thead class="bg-light">
                                    <tr>
                                        <th>Parceiro</th>
                                        <th>Cupom</th>
                                        <th>Desconto Cliente</th>
                                        <th>Comiss√£o</th>
                                        <th>Vendas</th>
                                        <th>Status</th>
                                        <th class="text-end">A√ß√µes</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr v-for="p in parceiros" :key="p.id">
                                        <td>{{ p.name }}</td>
                                        <td><span class="badge bg-dark font-monospace">{{ p.code }}</span></td>
                                        <td>{{ p.discount_percent }}%</td>
                                        <td>{{ p.commission_percent }}%</td>
                                        <td>{{ p.sales_count }}</td>
                                        <td>{{ p.sales_count }}</td>
                                        <td><span class="status-badge status-success">Ativo</span></td>
                                        <td>
                                            <button class="btn btn-sm btn-light text-danger"
                                                @click="deletePartner(p.id)"><i class="fa-solid fa-trash"></i></button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- 8. NOTIFICA√á√ïES (NEW) -->
                <div v-if="currentTab === 'notificacoes'">
                    <h4 class="mb-4">Central de Comunica√ß√£o Push</h4>
                    <div class="row g-4">
                        <!-- Nova Mensagem -->
                        <div class="col-md-5">
                            <div class="card h-100">
                                <div class="card-header bg-primary text-white">
                                    <i class="fa-solid fa-paper-plane me-2"></i> Enviar Comunicado
                                </div>
                                <div class="card-body">
                                    <form @submit.prevent="sendNotification">
                                        <div class="mb-3">
                                            <label class="form-label small fw-bold text-muted">Destino (Alvo)</label>
                                            <select class="form-select" v-model="newNotification.target">
                                                <option value="all">TODOS O SISTEMA (Global)</option>
                                                <option v-for="app in apps" :key="app.id" :value="app.slug">{{ app.name
                                                    }} Users</option>
                                            </select>
                                        </div>

                                        <div class="mb-3">
                                            <label class="form-label small fw-bold text-muted">T√≠tulo da
                                                Notifica√ß√£o</label>
                                            <input type="text" class="form-control" v-model="newNotification.title"
                                                placeholder="Ex: Manuten√ß√£o Programada" required>
                                        </div>

                                        <div class="mb-3">
                                            <label class="form-label small fw-bold text-muted">Tipo de Mensagem</label>
                                            <select class="form-select" v-model="newNotification.type">
                                                <option value="info">Info (Azul)</option>
                                                <option value="warning">Alerta (Amarelo)</option>
                                                <option value="danger">Atualiza√ß√£o Cr√≠tica / Backup (Vermelho)</option>
                                            </select>
                                        </div>

                                        <div class="mb-3">
                                            <label class="form-label small fw-bold text-muted">Mensagem</label>
                                            <textarea class="form-control" rows="5" v-model="newNotification.message"
                                                placeholder="Digite sua mensagem de broadcast aqui..."
                                                required></textarea>
                                        </div>

                                        <div class="mb-3 form-check">
                                            <input type="checkbox" class="form-check-input" id="requireRead"
                                                v-model="newNotification.requireRead">
                                            <label class="form-check-label small" for="requireRead">Exigir Leitura
                                                (Modal
                                                Bloqueante)</label>
                                        </div>

                                        <div class="d-grid">
                                            <button type="submit" class="btn btn-primary">
                                                <i class="fa-solid fa-rocket me-2"></i> Enviar Disparo
                                            </button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>

                        <!-- Hist√≥rico -->
                        <div class="col-md-7">
                            <div class="card h-100">
                                <div class="card-header">
                                    <i class="fa-solid fa-clock-rotate-left me-2"></i> Hist√≥rico de Envios
                                    <span class="badge bg-secondary ms-2">{{ notifications_history.length }}</span>
                                </div>
                                <div
                                    class="bg-light p-2 border-bottom d-flex justify-content-between align-items-center">
                                    <small class="text-muted fw-bold">Alcance: {{ activeDevicesCount || 0 }}
                                        dispositivos ativos</small>
                                    <button class="btn btn-xs btn-outline-danger" @click="clearNotifications"
                                        style="font-size: 0.75rem;">
                                        <i class="fa-solid fa-trash"></i> Limpar Tudo
                                    </button>
                                    <div class="card-body overflow-auto" style="max-height: 600px;">
                                        <div class="timeline ps-3">
                                            <div v-for="(notif, idx) in notifications_history" :key="idx"
                                                class="timeline-item mb-4"
                                                :class="notif.type == 'danger' ? 'danger' : (notif.type == 'warning' ? 'info' : 'success')">

                                                <div class="d-flex justify-content-between align-items-start mb-1">
                                                    <span class="badge rounded-pill"
                                                        :class="notif.type == 'danger' ? 'bg-danger' : (notif.type == 'warning' ? 'bg-warning text-dark' : 'bg-info text-dark')">
                                                        {{ notif.type.toUpperCase() }}
                                                    </span>
                                                    <small class="text-muted">{{ notif.date }}</small>
                                                </div>

                                                <h6 class="fw-bold mb-1">{{ notif.target === 'all' ? 'GLOBAL SYSTEM' :
                                                    notif.target }}</h6>
                                                <p class="mb-1 small text-secondary bg-light p-2 rounded border">{{
                                                    notif.message }}</p>

                                                <div class="d-flex gap-2">
                                                    <small class="text-muted"><i
                                                            class="fa-solid fa-check-double text-primary"></i>
                                                        Enviado</small>
                                                    <small v-if="notif.requireRead" class="text-danger fw-bold"><i
                                                            class="fa-solid fa-exclamation-circle"></i> Leitura
                                                        Obrigat√≥ria</small>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 9. SISTEMA / DEVOPS -->
                    <div v-if="currentTab === 'sistema'">
                        <div class="row g-4">
                            <!-- Status e Diagn√≥stico -->
                            <div class="col-md-5">
                                <div class="card">
                                    <div class="card-header d-flex justify-content-between align-items-center">
                                        <span>Health Check</span>
                                        <button class="btn btn-sm btn-outline-primary" @click="runSystemDiagnosis"
                                            :disabled="diagnosisLoading">
                                            <i class="fa-solid fa-sync" :class="{'spin-icon': diagnosisLoading}"></i>
                                        </button>
                                    </div>
                                    <ul class="list-group list-group-flush">
                                        <li class="list-group-item d-flex justify-content-between align-items-center">
                                            <div>
                                                <i class="fa-solid fa-database me-2"
                                                    :class="systemStatus.db ? 'text-success' : 'text-danger'"></i>
                                                Banco de Dados (JSON)
                                            </div>
                                            <span class="badge" :class="systemStatus.db ? 'bg-success' : 'bg-danger'">
                                                {{ diagnosisLoading ? '...' : (systemStatus.db ? 'ONLINE' : 'OFFLINE')
                                                }}
                                            </span>
                                        </li>
                                        <li class="list-group-item d-flex justify-content-between align-items-center">
                                            <div>
                                                <i class="fa-solid fa-envelope me-2"
                                                    :class="systemStatus.smtp ? 'text-success' : 'text-danger'"></i>
                                                SMTP (Titan Email)
                                            </div>
                                            <span class="badge" :class="systemStatus.smtp ? 'bg-success' : 'bg-danger'">
                                                {{ diagnosisLoading ? '...' : (systemStatus.smtp ? 'CONECTADO' : 'ERRO')
                                                }}
                                            </span>
                                        </li>
                                        <li class="list-group-item d-flex justify-content-between align-items-center">
                                            <div>
                                                <i class="fa-solid fa-credit-card me-2"
                                                    :class="systemStatus.mp ? 'text-success' : 'text-danger'"></i>
                                                Mercado Pago API
                                            </div>
                                            <span class="badge" :class="systemStatus.mp ? 'bg-success' : 'bg-danger'">
                                                {{ diagnosisLoading ? '...' : (systemStatus.mp ? 'VALIDADO' : 'ERRO') }}
                                            </span>
                                        </li>
                                    </ul>
                                </div>

                                <!-- Teste de Email -->
                                <div class="card">
                                    <div class="card-header">Teste de Disparo (SMTP)</div>
                                    <div class="card-body">
                                        <label class="form-label small text-muted">Email Destino</label>
                                        <div class="input-group mb-3">
                                            <input type="email" class="form-control" v-model="testEmail"
                                                placeholder="admin@plena.com">
                                            <button class="btn btn-outline-primary" type="button"
                                                @click="sendTestEmail">
                                                <i class="fa-solid fa-paper-plane"></i>
                                            </button>
                                        </div>
                                        <div v-if="testEmailResult" class="alert alert-success py-2 small mb-0">
                                            <i class="fa-solid fa-check-circle me-1"></i> {{ testEmailResult }}
                                        </div>
                                    </div>
                                </div>

                                <!-- Equipe -->
                                <div class="card mt-4">
                                    <div class="card-header">Equipe Admin</div>
                                    <ul class="list-group list-group-flush">
                                        <li class="list-group-item d-flex align-items-center justify-content-between">
                                            <div class="d-flex align-items-center">
                                                <div class="avatar bg-primary text-white me-2"
                                                    style="width: 24px; height: 24px;">SA</div>
                                                <span>Super Admin</span>
                                            </div>
                                            <span class="badge bg-dark">Master</span>
                                        </li>
                                    </ul>
                                </div>
                            </div>

                            <!-- Logs -->
                            <div class="col-md-7">
                                <div class="card bg-dark text-white font-monospace h-100">
                                    <div
                                        class="card-header bg-dark text-white border-bottom border-secondary d-flex justify-content-between">
                                        <span>System Logs</span>
                                        <button class="btn btn-sm btn-outline-secondary"
                                            style="font-size: 0.7em;">Clear</button>
                                    </div>
                                    <div class="card-body p-2 overflow-auto"
                                        style="max-height: 400px; font-size: 0.85em;">
                                        <div class="mb-1"><span class="text-secondary">[21:00:01]</span> <span
                                                class="text-info">INFO:</span> Admin Panel init sequence started.</div>
                                        <div class="mb-1"><span class="text-secondary">[21:00:02]</span> <span
                                                class="text-success">OK:</span> Loaded 124 active licenses from
                                            database.
                                        </div>
                                        <div class="mb-1"><span class="text-secondary">[21:05:12]</span> <span
                                                class="text-warning">WARN:</span> Payment preference #1293 created
                                            (Waiting).
                                        </div>
                                        <div class="mb-1"><span class="text-secondary">[21:06:55]</span> <span
                                                class="text-success">OK:</span> Payment #1293 approved. License
                                            generated.
                                        </div>
                                        <div class="mb-1"><span class="text-secondary">[21:07:00]</span> <span
                                                class="text-success">OK:</span> Email sent via smtp.titan.email to
                                            client.
                                        </div>
                                        <div v-for="l in realTimeLogs" :key="l.ts" class="mb-1">
                                            <span class="text-secondary">[{{ l.ts }}]</span> <span
                                                class="text-info">DIAG:</span> {{ l.msg }}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                </div> <!-- End of content -->
            </div> <!-- End of wrapper -->

            <!-- MODALS -->

            <!-- New License Modal -->
            <div class="modal fade" id="newLicenseModal" tabindex="-1" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">Nova Licen√ßa Manual</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <form @submit.prevent="createLicense">
                                <div class="mb-3">
                                    <label class="form-label">Cliente (Email) <span class="text-danger">*</span></label>
                                    <input type="email" class="form-control" v-model="newLicense.cliente" required
                                        placeholder="cliente@email.com">
                                </div>
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">WhatsApp (com DDD) <span
                                                class="text-danger">*</span></label>
                                        <input type="text" class="form-control" v-model="newLicense.whatsapp" required
                                            placeholder="11999999999">
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">CPF (Apenas n√∫meros)</label>
                                        <input type="text" class="form-control" v-model="newLicense.cpf"
                                            placeholder="000.000.000-00">
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">Pre√ßo Personalizado (R$)</label>
                                        <input type="number" step="0.01" class="form-control" v-model="newLicense.price"
                                            placeholder="Auto">
                                        <small class="text-muted">Deixe vazio para usar pre√ßo do cat√°logo.</small>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">Licen√ßa para:</label>
                                        <select class="form-select" v-model="newLicense.produto">
                                            <option v-for="app in apps" :value="app.name">{{ app.name }}</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Ciclo de Cobran√ßa</label>
                                    <select class="form-select" v-model="newLicense.type">
                                        <option value="monthly">Mensal (30 dias)</option>
                                        <option value="yearly">Anual (365 dias)</option>
                                        <option value="lifetime">Vital√≠cio (10 anos)</option>
                                        <option value="developer">Desenvolvedor (Master / Interno)</option>
                                    </select>
                                </div>
                                <div class="d-grid">
                                    <button type="submit" class="btn btn-primary">Gerar Licen√ßa e Cobran√ßa</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Edit License Modal -->
            <div class="modal fade" id="editLicenseModal" tabindex="-1" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">Editar Licen√ßa</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body" v-if="editingLicense">
                            <div class="mb-3">
                                <label class="form-label">Chave</label>
                                <input type="text" class="form-control" :value="editingLicense.key" disabled readonly>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Cliente</label>
                                <input type="text" class="form-control" v-model="editingLicense.cliente">
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Status</label>
                                <select class="form-select" v-model="editingLicense.status">
                                    <option value="active">Ativo</option>
                                    <option value="blocked">Bloqueado</option>
                                </select>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                            <button type="button" class="btn btn-primary" @click="updateLicense">Salvar
                                Altera√ß√µes</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Edit App Modal (Nexus 2.0) - MOVED OUTSIDE -->
            <div class="modal fade" id="editAppModal" tabindex="-1" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">Gerenciar Produto</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <div class="alert alert-info py-2 small">
                                <i class="fa-solid fa-info-circle"></i> As altera√ß√µes refletem imediatamente no
                                cat√°logo.
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Identificador (Slug)</label>
                                <input type="text" class="form-control" :value="editingApp.slug" disabled readonly>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Nome Comercial</label>
                                <input type="text" class="form-control" v-model="editingApp.name">
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Pre√ßo (R$)</label>
                                <input type="number" step="0.01" class="form-control" v-model="editingApp.price">
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                            <button type="button" class="btn btn-primary" @click="updateAppConfig">
                                <i class="fa-solid fa-save me-2"></i> Salvar Configura√ß√£o
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- New Lead Modal (CRM) -->
        <div class="modal fade" id="newLeadModal" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">{{ newLead.id ? 'Editar Lead' : 'Novo Lead' }}</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <form @submit.prevent="saveLead">
                            <div class="mb-3">
                                <label class="form-label">Nome <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" v-model="newLead.name" required>
                            </div>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Email</label>
                                    <input type="email" class="form-control" v-model="newLead.email">
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">WhatsApp</label>
                                    <input type="text" class="form-control" v-model="newLead.phone">
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Origem</label>
                                    <select class="form-select" v-model="newLead.source">
                                        <option value="Manual">Manual</option>
                                        <option value="Website">Site / Landing Page</option>
                                        <option value="Indica√ß√£o">Indica√ß√£o</option>
                                        <option value="Checkout (Abandono)">Checkout (Abandono)</option>
                                    </select>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Status</label>
                                    <select class="form-select" v-model="newLead.status">
                                        <option value="Novo">Novo</option>
                                        <option value="Em Negocia√ß√£o">Em Negocia√ß√£o</option>
                                        <option value="Aguardando Pagamento">Aguardando Pagamento</option>
                                        <option value="Fechado (Venda)">Fechado (Venda)</option>
                                        <option value="Perdido">Perdido</option>
                                    </select>
                                </div>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Notas</label>
                                <textarea class="form-control" rows="3" v-model="newLead.notes"></textarea>
                            </div>
                            <div class="d-grid">
                                <button type="submit" class="btn btn-primary">Salvar Lead</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <!-- Create Partner Modal -->
        <div class="modal fade" id="partnerModal" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Novo Parceiro</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <form @submit.prevent="createPartner">
                            <div class="mb-3">
                                <label class="form-label">Nome do Parceiro</label>
                                <input type="text" class="form-control" v-model="newPartner.name" required>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Cupom (C√≥digo)</label>
                                <input type="text" class="form-control text-uppercase font-monospace"
                                    v-model="newPartner.code" required placeholder="EX: PARCEIRO10">
                            </div>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Desconto Cliente (%)</label>
                                    <input type="number" class="form-control" v-model="newPartner.discount_percent"
                                        min="0" max="100">
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Comiss√£o (%)</label>
                                    <input type="number" class="form-control" v-model="newPartner.commission_percent"
                                        min="0" max="100">
                                </div>
                            </div>
                            <div class="d-grid">
                                <button type="submit" class="btn btn-success">Criar Parceiro</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <!-- Finance Modal (Nexus 2.0) -->
        <div class="modal fade" id="financeModal" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Novo Lan√ßamento Financeiro</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <form @submit.prevent="createTransaction">
                            <div class="mb-3">
                                <label class="form-label">Tipo de Movimenta√ß√£o</label>
                                <div class="d-flex gap-2">
                                    <div class="form-check flex-fill p-2 border rounded">
                                        <input class="form-check-input ms-1" type="radio" name="transType"
                                            id="typeExpense" value="expense" v-model="newTrans.type">
                                        <label class="form-check-label w-100 ps-2 text-danger fw-bold"
                                            for="typeExpense">
                                            <i class="fa-solid fa-arrow-trend-down"></i> Sa√≠da (Despesa)
                                        </label>
                                    </div>
                                    <div class="form-check flex-fill p-2 border rounded">
                                        <input class="form-check-input ms-1" type="radio" name="transType"
                                            id="typeIncome" value="income" v-model="newTrans.type">
                                        <label class="form-check-label w-100 ps-2 text-success fw-bold"
                                            for="typeIncome">
                                            <i class="fa-solid fa-arrow-trend-up"></i> Entrada (Receita)
                                        </label>
                                    </div>
                                </div>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Valor (R$)</label>
                                <input type="number" step="0.01" class="form-control form-control-lg"
                                    v-model="newTrans.amount" required placeholder="0.00">
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Descri√ß√£o</label>
                                <input type="text" class="form-control" v-model="newTrans.description" required
                                    placeholder="Ex: Servidor AWS, An√∫ncio Facebook...">
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Categoria</label>
                                <select class="form-select" v-model="newTrans.category">
                                    <option value="outros">Outros</option>
                                    <option value="servidor">Infraestrutura/Servidor</option>
                                    <option value="marketing">Marketing/An√∫ncios</option>
                                    <option value="ferramentas">Ferramentas/SaaS</option>
                                    <option value="pessoal">Retirada/Pessoal</option>
                                    <option value="venda_manual" v-if="newTrans.type === 'income'">Venda Manual</option>
                                </select>
                            </div>
                            <div class="d-grid mt-4">
                                <button type="submit" class="btn btn-primary btn-lg"> Confirmar Lan√ßamento</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

    </div> <!-- End of #app -->

    <!-- Vue 3 and Bootstrap JS -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="assets/js/admin_logic_v1.js?v=5.8"></script>
</body>

</html>